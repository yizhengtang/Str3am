{"version":3,"file":"bc-ur-registry-sol.cjs.production.min.js","sources":["../src/RegistryType.ts","../src/SolSignRequest.ts","../src/SolSignature.ts","../src/SOLNFTItem.ts","../src/index.ts"],"sourcesContent":["import { RegistryType } from \"@keystonehq/bc-ur-registry\";\n\nexport const ExtendedRegistryTypes = {\n  SOL_SIGN_REQUEST: new RegistryType(\"sol-sign-request\", 1101),\n  SOL_SIGNATURE: new RegistryType(\"sol-signature\", 1102),\n  SOL_NFT_ITEM: new RegistryType(\"sol-nft-item\", 1104),\n};\n","import {\n  CryptoKeypath,\n  extend,\n  DataItem,\n  PathComponent,\n  RegistryItem,\n  DataItemMap,\n} from \"@keystonehq/bc-ur-registry\";\nimport { ExtendedRegistryTypes } from \"./RegistryType\";\nimport * as uuid from \"uuid\";\n\nconst { decodeToDataItem, RegistryTypes } = extend;\n\nexport enum SignType {\n  Transaction = 1,\n  Message = 2,\n}\n\nenum Keys {\n  requestId = 1,\n  signData,\n  derivationPath,\n  address,\n  origin,\n  signType ,\n}\n\ntype signRequestProps = {\n  requestId?: Buffer;\n  signData: Buffer;\n  derivationPath: CryptoKeypath;\n  address?: Buffer;\n  origin?: string;\n  signType: SignType;\n};\n\nexport class SolSignRequest extends RegistryItem {\n  private requestId?: Buffer;\n  private signData: Buffer;\n  private derivationPath: CryptoKeypath;\n  private address?: Buffer;\n  private origin?: string;\n  private signType: SignType;\n\n  getRegistryType = () => ExtendedRegistryTypes.SOL_SIGN_REQUEST;\n\n  constructor(args: signRequestProps) {\n    super();\n    this.requestId = args.requestId;\n    this.signData = args.signData;\n    this.derivationPath = args.derivationPath;\n    this.address = args.address;\n    this.origin = args.origin;\n    this.signType = args.signType;\n  }\n\n  public getRequestId = () => this.requestId;\n  public getSignData = () => this.signData;\n  public getDerivationPath = () => this.derivationPath.getPath();\n  public getSignRequestAddress = () => this.address;\n  public getOrigin = () => this.origin;\n  public getSignType = () => this.signType;\n\n  public toDataItem = () => {\n    const map: DataItemMap = {};\n    if (this.requestId) {\n      map[Keys.requestId] = new DataItem(\n        this.requestId,\n        RegistryTypes.UUID.getTag()\n      );\n    }\n    if (this.address) {\n      map[Keys.address] = this.address;\n    }\n\n    if (this.origin) {\n      map[Keys.origin] = this.origin;\n    }\n\n    map[Keys.signData] = this.signData;\n    map[Keys.signType] = this.signType;\n\n    const keyPath = this.derivationPath.toDataItem();\n    keyPath.setTag(this.derivationPath.getRegistryType().getTag());\n    map[Keys.derivationPath] = keyPath;\n\n    return new DataItem(map);\n  };\n\n  public static fromDataItem = (dataItem: DataItem) => {\n    const map = dataItem.getData();\n    const signData = map[Keys.signData];\n    const derivationPath = CryptoKeypath.fromDataItem(map[Keys.derivationPath]);\n    const address = map[Keys.address] ? map[Keys.address] : undefined;\n    const requestId = map[Keys.requestId]\n      ? map[Keys.requestId].getData()\n      : undefined;\n    const origin = map[Keys.origin] ? map[Keys.origin] : undefined;\n    const signType = map[Keys.signType];\n\n    return new SolSignRequest({\n      requestId,\n      signData,\n      derivationPath,\n      address,\n      origin,\n      signType\n    });\n  };\n\n  public static fromCBOR = (_cborPayload: Buffer) => {\n    const dataItem = decodeToDataItem(_cborPayload);\n    return SolSignRequest.fromDataItem(dataItem);\n  };\n\n  public static constructSOLRequest(\n    signData: Buffer,\n    hdPath: string,\n    xfp: string,\n    signType: SignType,\n    uuidString?: string,\n    address?: string,\n    origin?: string\n  ) {\n    const paths = hdPath.replace(/[m|M]\\//, \"\").split(\"/\");\n    const hdpathObject = new CryptoKeypath(\n      paths.map((path) => {\n        const index = parseInt(path.replace(\"'\", \"\"));\n        let isHardened = false;\n        if (path.endsWith(\"'\")) {\n          isHardened = true;\n        }\n        return new PathComponent({ index, hardened: isHardened });\n      }),\n      Buffer.from(xfp, \"hex\")\n    );\n\n    return new SolSignRequest({\n      requestId: uuidString\n        ? Buffer.from(uuid.parse(uuidString) as Uint8Array)\n        : undefined,\n      signData,\n      derivationPath: hdpathObject,\n      address: address\n        ? Buffer.from(address.replace(\"0x\", \"\"), \"hex\")\n        : undefined,\n      origin: origin || undefined,\n      signType,\n    });\n  }\n}\n","import {\n  extend,\n  DataItem,\n  RegistryItem,\n  DataItemMap,\n} from \"@keystonehq/bc-ur-registry\";\nimport { ExtendedRegistryTypes } from \"./RegistryType\";\n\nconst { RegistryTypes, decodeToDataItem } = extend;\n\nenum Keys {\n  requestId = 1,\n  signature,\n}\n\nexport class SolSignature extends RegistryItem {\n  private requestId?: Buffer;\n  private signature: Buffer;\n\n  getRegistryType = () => ExtendedRegistryTypes.SOL_SIGNATURE;\n\n  constructor(signature: Buffer, requestId?: Buffer) {\n    super();\n    this.signature = signature;\n    this.requestId = requestId;\n  }\n\n  public getRequestId = () => this.requestId;\n  public getSignature = () => this.signature;\n\n  public toDataItem = () => {\n    const map: DataItemMap = {};\n    if (this.requestId) {\n      map[Keys.requestId] = new DataItem(\n        this.requestId,\n        RegistryTypes.UUID.getTag()\n      );\n    }\n    map[Keys.signature] = this.signature;\n    return new DataItem(map);\n  };\n\n  public static fromDataItem = (dataItem: DataItem) => {\n    const map = dataItem.getData();\n    const signature = map[Keys.signature];\n    const requestId = map[Keys.requestId]\n      ? map[Keys.requestId].getData()\n      : undefined;\n\n    return new SolSignature(signature, requestId);\n  };\n\n  public static fromCBOR = (_cborPayload: Buffer) => {\n    const dataItem = decodeToDataItem(_cborPayload);\n    return SolSignature.fromDataItem(dataItem);\n  };\n}\n","import {\n  extend,\n  DataItem,\n  RegistryItem,\n  DataItemMap,\n} from \"@keystonehq/bc-ur-registry\";\nimport { ExtendedRegistryTypes } from \"./RegistryType\";\n\nconst { decodeToDataItem } = extend;\n\nenum Keys {\n  mintAddress = 1,\n  collectionName,\n  name,\n  mediaData,\n}\n\ntype NFTProps = {\n  mintAddress: string;\n  collectionName: string;\n  name: string;\n  mediaData: string;\n};\n\nexport class SOLNFTItem extends RegistryItem {\n  private name: string;\n  private mintAddress: string;\n  private collectionName: string;\n  private mediaData: string;\n\n  getRegistryType = () => ExtendedRegistryTypes.SOL_NFT_ITEM;\n\n  constructor(args: NFTProps) {\n    super();\n    this.name = args.name;\n    this.mintAddress = args.mintAddress;\n    this.collectionName = args.collectionName;\n    this.mediaData = args.mediaData; // remove the data perfix for android usage\n  }\n\n  public getName = () => this.name;\n  public getMediaData = () => this.mediaData;\n  public getMintAddress = () => this.mintAddress;\n  public getCollectionName = () => this.collectionName;\n\n  public toDataItem = () => {\n    const map: DataItemMap = {};\n    map[Keys.name] = this.name;\n    map[Keys.mintAddress] = this.mintAddress;\n    map[Keys.collectionName] = this.collectionName;\n    map[Keys.mediaData] = this.mediaData;\n\n    return new DataItem(map);\n  };\n\n  public static fromDataItem = (dataItem: DataItem) => {\n    const map = dataItem.getData();\n    const name = map[Keys.name];\n    const mediaData = map[Keys.mediaData];\n    const mintAddress = map[Keys.mintAddress];\n    const collectionName = map[Keys.collectionName];\n\n    return new SOLNFTItem({\n      name,\n      mintAddress,\n      collectionName,\n      mediaData,\n    });\n  };\n\n  public static fromCBOR = (_cborPayload: Buffer) => {\n    const dataItem = decodeToDataItem(_cborPayload);\n    return SOLNFTItem.fromDataItem(dataItem);\n  };\n\n  public static constructETHNFTItem(\n    mintAddress: string,\n    collectionName: string,\n    name: string,\n    mediaData: string\n  ) {\n    return new SOLNFTItem({\n      mintAddress,\n      collectionName,\n      mediaData,\n      name,\n    });\n  }\n}\n","import { patchTags } from \"@keystonehq/bc-ur-registry\";\nimport { ExtendedRegistryTypes } from \"./RegistryType\";\nexport * from \"@keystonehq/bc-ur-registry\";\n\npatchTags(\n  Object.values(ExtendedRegistryTypes)\n    .filter((rt) => !!rt.getTag())\n    .map((rt) => rt.getTag()) as number[]\n);\n\nexport { SolSignRequest, SignType } from \"./SolSignRequest\";\nexport { SolSignature } from \"./SolSignature\";\nexport { SOLNFTItem } from \"./SOLNFTItem\";\n"],"names":["ExtendedRegistryTypes","SOL_SIGN_REQUEST","RegistryType","SOL_SIGNATURE","SOL_NFT_ITEM","decodeToDataItem","RegistryTypes","extend","SignType","Keys","SolSignRequest","RegistryItem","constructor","args","super","this","requestId","signData","derivationPath","getPath","address","origin","signType","map","DataItem","UUID","getTag","keyPath","toDataItem","setTag","getRegistryType","[object Object]","hdPath","xfp","uuidString","paths","replace","split","hdpathObject","CryptoKeypath","path","index","parseInt","isHardened","endsWith","PathComponent","hardened","Buffer","from","uuid","undefined","dataItem","getData","fromDataItem","_cborPayload","SolSignature","signature","SOLNFTItem","name","mediaData","mintAddress","collectionName","patchTags","Object","values","filter","rt"],"mappings":"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"}