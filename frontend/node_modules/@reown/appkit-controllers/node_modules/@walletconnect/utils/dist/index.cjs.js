"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Rr=require("detect-browser"),me=require("@walletconnect/time"),ae=require("@walletconnect/window-getters"),Tr=require("@walletconnect/window-metadata"),Ur=require("viem"),_r=require("bs58"),Cr=require("@walletconnect/relay-auth"),N=require("uint8arrays"),Pr=require("elliptic"),$r=require("@walletconnect/relay-api");function Lr(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var Br=Lr(_r);const $e=":";function We(e){const[t,n]=e.split($e);return{namespace:t,reference:n}}function $t(e){const{namespace:t,reference:n}=e;return[t,n].join($e)}function Je(e){const[t,n,r]=e.split($e);return{namespace:t,reference:n,address:r}}function Lt(e){const{namespace:t,reference:n,address:r}=e;return[t,n,r].join($e)}function Ye(e,t){const n=[];return e.forEach(r=>{const o=t(r);n.includes(o)||n.push(o)}),n}function Bt(e){const{address:t}=Je(e);return t}function jt(e){const{namespace:t,reference:n}=Je(e);return $t({namespace:t,reference:n})}function jr(e,t){const{namespace:n,reference:r}=We(t);return Lt({namespace:n,reference:r,address:e})}function kr(e){return Ye(e,Bt)}function kt(e){return Ye(e,jt)}function Vr(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...o.accounts)}),n}function Dr(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...kt(o.accounts))}),n}function Mr(e,t=[]){const n=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const o=e[r];n.push(...Le(r,o))}),n}function Le(e,t){return e.includes(":")?[e]:t.chains||[]}const Vt="ReactNative",H={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Be=" ",Fr=":",Dt="/",Xe=2,Hr=1e3,Mt="js";function Qe(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function te(){return!ae.getDocument()&&!!ae.getNavigator()&&navigator.product===Vt}function Kr(){return te()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function qr(){return te()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ie(){return!Qe()&&!!ae.getNavigator()&&!!ae.getDocument()}function ue(){return te()?H.reactNative:Qe()?H.node:Ie()?H.browser:H.unknown}function zr(){var e;try{return te()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Ft(e,t){const n=new URLSearchParams(e);for(const r of Object.keys(t).sort())if(t.hasOwnProperty(r)){const o=t[r];o!==void 0&&n.set(r,o)}return n.toString()}function Gr(){return Tr.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Wr(e,t){var n;const r=ue(),o={protocol:e,version:t,env:r};return r==="browser"&&(o.host=((n=ae.getLocation())==null?void 0:n.host)||"unknown"),o}function Ht(){if(ue()===H.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const e=Rr.detect();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function Kt(){var e;const t=ue();return t===H.browser?[t,((e=ae.getLocation())==null?void 0:e.host)||"unknown"].join(":"):t}function qt(e,t,n){const r=Ht(),o=Kt();return[[e,t].join("-"),[Mt,n].join("-"),r,o].join("/")}function Jr({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:o,projectId:s,useOnCloseEvent:i,bundleId:c,packageName:u}){const a=n.split("?"),l=qt(e,t,r),f={auth:o,ua:l,projectId:s,useOnCloseEvent:i||void 0,packageName:u||void 0,bundleId:c||void 0},d=Ft(a[1]||"",f);return a[0]+"?"+d}function Yr(e){let t=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const n=typeof t<"u"?e.split("://")[1]:e;return t=t==="wss"?"https":"http",[t,n].join("://")}function Xr(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function zt(e,t=Xe){return Gt(e.split(Dt),t)}function Qr(e){return zt(e).join(Be)}function ne(e,t){return e.filter(n=>t.includes(n)).length===e.length}function Gt(e,t=Xe){return e.slice(Math.max(e.length-t,0))}function Zr(e){return Object.fromEntries(e.entries())}function eo(e){return new Map(Object.entries(e))}function to(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const no=e=>e;function Wt(e){return e.trim().replace(/^\w/,t=>t.toUpperCase())}function ro(e){return e.split(Be).map(t=>Wt(t)).join(Be)}function oo(e=me.FIVE_MINUTES,t){const n=me.toMiliseconds(e||me.FIVE_MINUTES);let r,o,s,i;return{resolve:c=>{s&&r&&(clearTimeout(s),r(c),i=Promise.resolve(c))},reject:c=>{s&&o&&(clearTimeout(s),o(c))},done:()=>new Promise((c,u)=>{if(i)return c(i);s=setTimeout(()=>{const a=new Error(t);i=Promise.reject(a),u(a)},n),r=c,o=u})}}function so(e,t,n){return new Promise(async(r,o)=>{const s=setTimeout(()=>o(new Error(n)),t);try{const i=await e;r(i)}catch(i){o(i)}clearTimeout(s)})}function Ze(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function io(e){return Ze("topic",e)}function co(e){return Ze("id",e)}function ao(e){const[t,n]=e.split(":"),r={id:void 0,topic:void 0};if(t==="topic"&&typeof n=="string")r.topic=n;else if(t==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function uo(e,t){return me.fromMiliseconds((t||Date.now())+me.toMiliseconds(e))}function fo(e){return Date.now()>=me.toMiliseconds(e)}function lo(e,t){return`${e}${t?`:${t}`:""}`}function Q(e=[],t=[]){return[...new Set([...e,...t])]}async function po({id:e,topic:t,wcDeepLink:n}){var r;try{if(!n)return;const o=typeof n=="string"?JSON.parse(n):n,s=o?.href;if(typeof s!="string")return;const i=Jt(s,e,t),c=ue();if(c===H.browser){if(!((r=ae.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Yt(i)}else c===H.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(i)}catch(o){console.error(o)}}function Jt(e,t,n){const r=`requestId=${t}&sessionTopic=${n}`;e.endsWith("/")&&(e=e.slice(0,-1));let o=`${e}`;if(e.startsWith("https://t.me")){const s=e.includes("?")?"&startapp=":"?startapp=";o=`${o}${s}${Zt(r,!0)}`}else o=`${o}/wc?${r}`;return o}function Yt(e){let t="_self";Qt()?t="_top":(Xt()||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"),window.open(e,t,"noreferrer noopener")}async function ho(e,t){let n="";try{if(Ie()&&(n=localStorage.getItem(t),n))return n;n=await e.getItem(t)}catch(r){console.error(r)}return n}function et(e,t){return e.filter(n=>t.includes(n))}function go(e,t){if(!e.includes(t))return null;const n=e.split(/([&,?,=])/),r=n.indexOf(t);return n[r+2]}function yo(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function mo(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function Xt(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Qt(){try{return window.self!==window.top}catch{return!1}}function Zt(e,t=!1){const n=Buffer.from(e).toString("base64");return t?n.replace(/[=]/g,""):n}function tt(e){return Buffer.from(e,"base64").toString("utf-8")}function bo(e){return new Promise(t=>setTimeout(t,e))}function Oe(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function wo(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function je(e,...t){if(!wo(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function nt(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Oe(e.outputLen),Oe(e.blockLen)}function be(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function en(e,t){je(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const ke=BigInt(2**32-1),tn=BigInt(32);function Eo(e,t=!1){return t?{h:Number(e&ke),l:Number(e>>tn&ke)}:{h:Number(e>>tn&ke)|0,l:Number(e&ke)|0}}function vo(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let o=0;o<e.length;o++){const{h:s,l:i}=Eo(e[o],t);[n[o],r[o]]=[s,i]}return[n,r]}const xo=(e,t,n)=>e<<n|t>>>32-n,Ao=(e,t,n)=>t<<n|e>>>32-n,So=(e,t,n)=>t<<n-32|e>>>64-n,No=(e,t,n)=>e<<n-32|t>>>64-n,we=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Io(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function rt(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function W(e,t){return e<<32-t|e>>>t}const nn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Oo(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function rn(e){for(let t=0;t<e.length;t++)e[t]=Oo(e[t])}function Ro(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function Ee(e){return typeof e=="string"&&(e=Ro(e)),je(e),e}class ot{clone(){return this._cloneInto()}}function on(e){const t=r=>e().update(Ee(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Re(e=32){if(we&&typeof we.getRandomValues=="function")return we.getRandomValues(new Uint8Array(e));if(we&&typeof we.randomBytes=="function")return we.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const sn=[],cn=[],an=[],To=BigInt(0),Te=BigInt(1),Uo=BigInt(2),_o=BigInt(7),Co=BigInt(256),Po=BigInt(113);for(let e=0,t=Te,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],sn.push(2*(5*r+n)),cn.push((e+1)*(e+2)/2%64);let o=To;for(let s=0;s<7;s++)t=(t<<Te^(t>>_o)*Po)%Co,t&Uo&&(o^=Te<<(Te<<BigInt(s))-Te);an.push(o)}const[$o,Lo]=vo(an,!0),un=(e,t,n)=>n>32?So(e,t,n):xo(e,t,n),fn=(e,t,n)=>n>32?No(e,t,n):Ao(e,t,n);function Bo(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let i=0;i<10;i++)n[i]=e[i]^e[i+10]^e[i+20]^e[i+30]^e[i+40];for(let i=0;i<10;i+=2){const c=(i+8)%10,u=(i+2)%10,a=n[u],l=n[u+1],f=un(a,l,1)^n[c],d=fn(a,l,1)^n[c+1];for(let g=0;g<50;g+=10)e[i+g]^=f,e[i+g+1]^=d}let o=e[2],s=e[3];for(let i=0;i<24;i++){const c=cn[i],u=un(o,s,c),a=fn(o,s,c),l=sn[i];o=e[l],s=e[l+1],e[l]=u,e[l+1]=a}for(let i=0;i<50;i+=10){for(let c=0;c<10;c++)n[c]=e[i+c];for(let c=0;c<10;c++)e[i+c]^=~n[(c+2)%10]&n[(c+4)%10]}e[0]^=$o[r],e[1]^=Lo[r]}n.fill(0)}class Pt extends ot{constructor(t,n,r,o=!1,s=24){if(super(),this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=o,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Oe(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Io(this.state)}keccak(){nn||rn(this.state32),Bo(this.state32,this.rounds),nn||rn(this.state32),this.posOut=0,this.pos=0}update(t){be(this);const{blockLen:n,state:r}=this;t=Ee(t);const o=t.length;for(let s=0;s<o;){const i=Math.min(n-this.pos,o-s);for(let c=0;c<i;c++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:o}=this;t[r]^=n,(n&128)!==0&&r===o-1&&this.keccak(),t[o-1]^=128,this.keccak()}writeInto(t){be(this,!1),je(t),this.finish();const n=this.state,{blockLen:r}=this;for(let o=0,s=t.length;o<s;){this.posOut>=r&&this.keccak();const i=Math.min(r-this.posOut,s-o);t.set(n.subarray(this.posOut,this.posOut+i),o),this.posOut+=i,o+=i}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Oe(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(en(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:o,rounds:s,enableXOF:i}=this;return t||(t=new Pt(n,r,o,i,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=o,t.enableXOF=i,t.destroyed=this.destroyed,t}}const jo=(e,t,n)=>on(()=>new Pt(t,e,n)),ko=jo(1,136,256/8),Vo="https://rpc.walletconnect.org/v1";function st(e){const t=`Ethereum Signed Message:
${e.length}`,n=new TextEncoder().encode(t+e);return"0x"+Buffer.from(ko(n)).toString("hex")}async function ln(e,t,n,r,o,s){switch(n.t){case"eip191":return await dn(e,t,n.s);case"eip1271":return await pn(e,t,n.s,r,o,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}async function dn(e,t,n){return(await Ur.recoverAddress({hash:st(t),signature:n})).toLowerCase()===e.toLowerCase()}async function pn(e,t,n,r,o,s){const i=We(r);if(!i.namespace||!i.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const c="0x1626ba7e",u="0000000000000000000000000000000000000000000000000000000000000040",a="0000000000000000000000000000000000000000000000000000000000000041",l=n.substring(2),f=st(t).substring(2),d=c+f+u+a+l,g=await fetch(`${s||Vo}/?chainId=${r}&projectId=${o}`,{method:"POST",body:JSON.stringify({id:Do(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:d},"latest"]})}),{result:y}=await g.json();return y?y.slice(0,c.length).toLowerCase()===c.toLowerCase():!1}catch(c){return console.error("isValidEip1271Signature: ",c),!1}}function Do(){return Date.now()+Math.floor(Math.random()*1e3)}function Mo(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);const r=n[0];if(r===0)throw new Error("No signatures found");const o=1+r*64;if(n.length<o)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(e,"base64").slice(1,65);return Br.default.encode(s)}var Fo=Object.defineProperty,Ho=Object.defineProperties,Ko=Object.getOwnPropertyDescriptors,hn=Object.getOwnPropertySymbols,qo=Object.prototype.hasOwnProperty,zo=Object.prototype.propertyIsEnumerable,gn=(e,t,n)=>t in e?Fo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,it=(e,t)=>{for(var n in t||(t={}))qo.call(t,n)&&gn(e,n,t[n]);if(hn)for(var n of hn(t))zo.call(t,n)&&gn(e,n,t[n]);return e},yn=(e,t)=>Ho(e,Ko(t));const Go="did:pkh:",Ve=e=>e?.split(":"),mn=e=>{const t=e&&Ve(e);if(t)return e.includes(Go)?t[3]:t[1]},bn=e=>{const t=e&&Ve(e);if(t)return t[2]+":"+t[3]},ct=e=>{const t=e&&Ve(e);if(t)return t.pop()};async function Wo(e){const{cacao:t,projectId:n}=e,{s:r,p:o}=t,s=wn(o,o.iss),i=ct(o.iss);return await ln(i,s,r,bn(o.iss),n)}const wn=(e,t)=>{const n=`${e.domain} wants you to sign in with your Ethereum account:`,r=ct(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let o=e.statement||void 0;const s=`URI: ${e.aud||e.uri}`,i=`Version: ${e.version}`,c=`Chain ID: ${mn(t)}`,u=`Nonce: ${e.nonce}`,a=`Issued At: ${e.iat}`,l=e.exp?`Expiration Time: ${e.exp}`:void 0,f=e.nbf?`Not Before: ${e.nbf}`:void 0,d=e.requestId?`Request ID: ${e.requestId}`:void 0,g=e.resources?`Resources:${e.resources.map(p=>`
- ${p}`).join("")}`:void 0,y=Me(e.resources);if(y){const p=re(y);o=ft(o,p)}return[n,r,"",o,"",s,i,c,u,a,l,f,d,g].filter(p=>p!=null).join(`
`)};function Jo(e,t,n){return n.includes("did:pkh:")||(n=`did:pkh:${n}`),{h:{t:"caip122"},p:{iss:n,domain:e.domain,aud:e.aud,version:e.version,nonce:e.nonce,iat:e.iat,statement:e.statement,requestId:e.requestId,resources:e.resources,nbf:e.nbf,exp:e.exp},s:t}}function Yo(e){var t;const{authPayload:n,chains:r,methods:o}=e,s=n.statement||"";if(!(r!=null&&r.length))return n;const i=n.chains,c=et(i,r);if(!(c!=null&&c.length))throw new Error("No supported chains");const u=En(n.resources);if(!u)return n;J(u);const a=vn(u,"eip155");let l=n?.resources||[];if(a!=null&&a.length){const f=xn(a),d=et(f,o);if(!(d!=null&&d.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(f)}, supported: ${JSON.stringify(o)}`);const g=at("request",d,{chains:c}),y=In(u,"eip155",g);l=((t=n?.resources)==null?void 0:t.slice(0,-1))||[],l.push(De(y))}return yn(it({},n),{statement:Rn(s,Me(l)),chains:c,resources:n!=null&&n.resources||l.length>0?l:void 0})}function En(e){const t=Me(e);if(t&&ut(t))return re(t)}function Xo(e,t){var n;return(n=e?.att)==null?void 0:n.hasOwnProperty(t)}function vn(e,t){var n,r;return(n=e?.att)!=null&&n[t]?Object.keys((r=e?.att)==null?void 0:r[t]):[]}function Qo(e){return e?.map(t=>Object.keys(t))||[]}function xn(e){return e?.map(t=>{var n;return(n=t.split("/"))==null?void 0:n[1]})||[]}function An(e){return Buffer.from(JSON.stringify(e)).toString("base64")}function Sn(e){return JSON.parse(Buffer.from(e,"base64").toString("utf-8"))}function J(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(!(t!=null&&t.length))throw new Error("No resources found in `att` property");t.forEach(n=>{const r=e.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(o=>{const s=r[o];if(!Array.isArray(s))throw new Error(`Ability limits ${o} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${o} is empty array, must be an array with objects`);s.forEach(i=>{if(typeof i!="object")throw new Error(`Ability limits (${o}) must be an array of objects, found: ${i}`)})})})}function Nn(e,t,n,r={}){return n?.sort((o,s)=>o.localeCompare(s)),{att:{[e]:at(t,n,r)}}}function In(e,t,n){var r;e.att[t]=it({},n);const o=(r=Object.keys(e.att))==null?void 0:r.sort((i,c)=>i.localeCompare(c)),s={att:{}};return o.reduce((i,c)=>(i.att[c]=e.att[c],i),s)}function at(e,t,n={}){t=t?.sort((o,s)=>o.localeCompare(s));const r=t.map(o=>({[`${e}/${o}`]:[n]}));return Object.assign({},...r)}function De(e){return J(e),`urn:recap:${An(e).replace(/=/g,"")}`}function re(e){const t=Sn(e.replace("urn:recap:",""));return J(t),t}function Zo(e,t,n){const r=Nn(e,t,n);return De(r)}function ut(e){return e&&e.includes("urn:recap:")}function es(e,t){const n=re(e),r=re(t),o=On(n,r);return De(o)}function On(e,t){J(e),J(t);const n=Object.keys(e.att).concat(Object.keys(t.att)).sort((o,s)=>o.localeCompare(s)),r={att:{}};return n.forEach(o=>{var s,i;Object.keys(((s=e.att)==null?void 0:s[o])||{}).concat(Object.keys(((i=t.att)==null?void 0:i[o])||{})).sort((c,u)=>c.localeCompare(u)).forEach(c=>{var u,a;r.att[o]=yn(it({},r.att[o]),{[c]:((u=e.att[o])==null?void 0:u[c])||((a=t.att[o])==null?void 0:a[c])})})}),r}function ft(e="",t){J(t);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(n))return e;const r=[];let o=0;Object.keys(t.att).forEach(c=>{const u=Object.keys(t.att[c]).map(f=>({ability:f.split("/")[0],action:f.split("/")[1]}));u.sort((f,d)=>f.action.localeCompare(d.action));const a={};u.forEach(f=>{a[f.ability]||(a[f.ability]=[]),a[f.ability].push(f.action)});const l=Object.keys(a).map(f=>(o++,`(${o}) '${f}': '${a[f].join("', '")}' for '${c}'.`));r.push(l.join(", ").replace(".,","."))});const s=r.join(" "),i=`${n}${s}`;return`${e?e+" ":""}${i}`}function ts(e){var t;const n=re(e);J(n);const r=(t=n.att)==null?void 0:t.eip155;return r?Object.keys(r).map(o=>o.split("/")[1]):[]}function ns(e){const t=re(e);J(t);const n=[];return Object.values(t.att).forEach(r=>{Object.values(r).forEach(o=>{var s;(s=o?.[0])!=null&&s.chains&&n.push(o[0].chains)})}),[...new Set(n.flat())]}function Rn(e,t){if(!t)return e;const n=re(t);return J(n),ft(e,n)}function Me(e){if(!e)return;const t=e?.[e.length-1];return ut(t)?t:void 0}function lt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Tn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function K(e,...t){if(!Tn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Un(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function rs(e,t){K(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function _n(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}const oe=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),os=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ss=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ss)throw new Error("Non little-endian hardware is not supported");function is(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function dt(e){if(typeof e=="string")e=is(e);else if(Tn(e))e=pt(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function cs(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function as(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const us=(e,t)=>{function n(r,...o){if(K(r),e.nonceLength!==void 0){const l=o[0];if(!l)throw new Error("nonce / iv required");e.varSizeNonce?K(l):K(l,e.nonceLength)}const s=e.tagLength;s&&o[1]!==void 0&&K(o[1]);const i=t(r,...o),c=(l,f)=>{if(f!==void 0){if(l!==2)throw new Error("cipher output not supported");K(f)}};let u=!1;return{encrypt(l,f){if(u)throw new Error("cannot encrypt() twice with same key + nonce");return u=!0,K(l),c(i.encrypt.length,f),i.encrypt(l,f)},decrypt(l,f){if(K(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return c(i.decrypt.length,f),i.decrypt(l,f)}}}return Object.assign(n,e),n};function Cn(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!fs(t))throw new Error("invalid output, must be aligned");return t}function Pn(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),u=r?4:0,a=r?0:4;e.setUint32(t+u,i,r),e.setUint32(t+a,c,r)}function fs(e){return e.byteOffset%4===0}function pt(e){return Uint8Array.from(e)}function ve(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const $n=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),ls=$n("expand 16-byte k"),ds=$n("expand 32-byte k"),ps=oe(ls),hs=oe(ds);function x(e,t){return e<<t|e>>>32-t}function ht(e){return e.byteOffset%4===0}const Fe=64,gs=16,Ln=2**32-1,Bn=new Uint32Array;function ys(e,t,n,r,o,s,i,c){const u=o.length,a=new Uint8Array(Fe),l=oe(a),f=ht(o)&&ht(s),d=f?oe(o):Bn,g=f?oe(s):Bn;for(let y=0;y<u;i++){if(e(t,n,r,l,i,c),i>=Ln)throw new Error("arx: counter overflow");const p=Math.min(Fe,u-y);if(f&&p===Fe){const m=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let B=0,b;B<gs;B++)b=m+B,g[b]=d[b]^l[B];y+=Fe;continue}for(let m=0,B;m<p;m++)B=y+m,s[B]=o[B]^a[m];y+=p}}function ms(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=cs({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return lt(o),lt(i),_n(s),_n(n),(c,u,a,l,f=0)=>{K(c),K(u),K(a);const d=a.length;if(l===void 0&&(l=new Uint8Array(d)),K(l),lt(f),f<0||f>=Ln)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const g=[];let y=c.length,p,m;if(y===32)g.push(p=pt(c)),m=hs;else if(y===16&&n)p=new Uint8Array(32),p.set(c),p.set(c,16),m=ps,g.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);ht(u)||g.push(u=pt(u));const B=oe(p);if(r){if(u.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,B,oe(u.subarray(0,16)),B),u=u.subarray(16)}const b=16-o;if(b!==u.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const S=new Uint8Array(12);S.set(u,s?0:12-u.length),u=S,g.push(u)}const U=oe(u);return ys(e,m,B,U,a,l,f,i),ve(...g),l}}const M=(e,t)=>e[t++]&255|(e[t++]&255)<<8;class bs{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=dt(t),K(t,32);const n=M(t,0),r=M(t,2),o=M(t,4),s=M(t,6),i=M(t,8),c=M(t,10),u=M(t,12),a=M(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|u<<5)&8065,this.r[8]=(u>>>8|a<<8)&8191,this.r[9]=a>>>5&127;for(let l=0;l<8;l++)this.pad[l]=M(t,16+2*l)}process(t,n,r=!1){const o=r?0:2048,{h:s,r:i}=this,c=i[0],u=i[1],a=i[2],l=i[3],f=i[4],d=i[5],g=i[6],y=i[7],p=i[8],m=i[9],B=M(t,n+0),b=M(t,n+2),U=M(t,n+4),S=M(t,n+6),V=M(t,n+8),E=M(t,n+10),L=M(t,n+12),j=M(t,n+14);let v=s[0]+(B&8191),A=s[1]+((B>>>13|b<<3)&8191),w=s[2]+((b>>>10|U<<6)&8191),P=s[3]+((U>>>7|S<<9)&8191),I=s[4]+((S>>>4|V<<12)&8191),_=s[5]+(V>>>1&8191),O=s[6]+((V>>>14|E<<2)&8191),R=s[7]+((E>>>11|L<<5)&8191),T=s[8]+((L>>>8|j<<8)&8191),C=s[9]+(j>>>5|o),h=0,k=h+v*c+A*(5*m)+w*(5*p)+P*(5*y)+I*(5*g);h=k>>>13,k&=8191,k+=_*(5*d)+O*(5*f)+R*(5*l)+T*(5*a)+C*(5*u),h+=k>>>13,k&=8191;let D=h+v*u+A*c+w*(5*m)+P*(5*p)+I*(5*y);h=D>>>13,D&=8191,D+=_*(5*g)+O*(5*d)+R*(5*f)+T*(5*l)+C*(5*a),h+=D>>>13,D&=8191;let $=h+v*a+A*u+w*c+P*(5*m)+I*(5*p);h=$>>>13,$&=8191,$+=_*(5*y)+O*(5*g)+R*(5*d)+T*(5*f)+C*(5*l),h+=$>>>13,$&=8191;let z=h+v*l+A*a+w*u+P*c+I*(5*m);h=z>>>13,z&=8191,z+=_*(5*p)+O*(5*y)+R*(5*g)+T*(5*d)+C*(5*f),h+=z>>>13,z&=8191;let Y=h+v*f+A*l+w*a+P*u+I*c;h=Y>>>13,Y&=8191,Y+=_*(5*m)+O*(5*p)+R*(5*y)+T*(5*g)+C*(5*d),h+=Y>>>13,Y&=8191;let X=h+v*d+A*f+w*l+P*a+I*u;h=X>>>13,X&=8191,X+=_*c+O*(5*m)+R*(5*p)+T*(5*y)+C*(5*g),h+=X>>>13,X&=8191;let pe=h+v*g+A*d+w*f+P*l+I*a;h=pe>>>13,pe&=8191,pe+=_*u+O*c+R*(5*m)+T*(5*p)+C*(5*y),h+=pe>>>13,pe&=8191;let he=h+v*y+A*g+w*d+P*f+I*l;h=he>>>13,he&=8191,he+=_*a+O*u+R*c+T*(5*m)+C*(5*p),h+=he>>>13,he&=8191;let ge=h+v*p+A*y+w*g+P*d+I*f;h=ge>>>13,ge&=8191,ge+=_*l+O*a+R*u+T*c+C*(5*m),h+=ge>>>13,ge&=8191;let ye=h+v*m+A*p+w*y+P*g+I*d;h=ye>>>13,ye&=8191,ye+=_*f+O*l+R*a+T*u+C*c,h+=ye>>>13,ye&=8191,h=(h<<2)+h|0,h=h+k|0,k=h&8191,h=h>>>13,D+=h,s[0]=k,s[1]=D,s[2]=$,s[3]=z,s[4]=Y,s[5]=X,s[6]=pe,s[7]=he,s[8]=ge,s[9]=ye}finalize(){const{h:t,pad:n}=this,r=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let c=2;c<10;c++)t[c]+=o,o=t[c]>>>13,t[c]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,r[0]=t[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=t[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let s=(o^1)-1;for(let c=0;c<10;c++)r[c]&=s;s=~s;for(let c=0;c<10;c++)t[c]=t[c]&s|r[c];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+n[0];t[0]=i&65535;for(let c=1;c<8;c++)i=(t[c]+n[c]|0)+(i>>>16)|0,t[c]=i&65535;ve(r)}update(t){Un(this);const{buffer:n,blockLen:r}=this;t=dt(t);const o=t.length;for(let s=0;s<o;){const i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){ve(this.h,this.r,this.buffer,this.pad)}digestInto(t){Un(this),rs(t,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=r[i]>>>0,t[s++]=r[i]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}}function ws(e){const t=(r,o)=>e(o).update(dt(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}const Es=ws(e=>new bs(e));function vs(e,t,n,r,o,s=20){let i=e[0],c=e[1],u=e[2],a=e[3],l=t[0],f=t[1],d=t[2],g=t[3],y=t[4],p=t[5],m=t[6],B=t[7],b=o,U=n[0],S=n[1],V=n[2],E=i,L=c,j=u,v=a,A=l,w=f,P=d,I=g,_=y,O=p,R=m,T=B,C=b,h=U,k=S,D=V;for(let z=0;z<s;z+=2)E=E+A|0,C=x(C^E,16),_=_+C|0,A=x(A^_,12),E=E+A|0,C=x(C^E,8),_=_+C|0,A=x(A^_,7),L=L+w|0,h=x(h^L,16),O=O+h|0,w=x(w^O,12),L=L+w|0,h=x(h^L,8),O=O+h|0,w=x(w^O,7),j=j+P|0,k=x(k^j,16),R=R+k|0,P=x(P^R,12),j=j+P|0,k=x(k^j,8),R=R+k|0,P=x(P^R,7),v=v+I|0,D=x(D^v,16),T=T+D|0,I=x(I^T,12),v=v+I|0,D=x(D^v,8),T=T+D|0,I=x(I^T,7),E=E+w|0,D=x(D^E,16),R=R+D|0,w=x(w^R,12),E=E+w|0,D=x(D^E,8),R=R+D|0,w=x(w^R,7),L=L+P|0,C=x(C^L,16),T=T+C|0,P=x(P^T,12),L=L+P|0,C=x(C^L,8),T=T+C|0,P=x(P^T,7),j=j+I|0,h=x(h^j,16),_=_+h|0,I=x(I^_,12),j=j+I|0,h=x(h^j,8),_=_+h|0,I=x(I^_,7),v=v+A|0,k=x(k^v,16),O=O+k|0,A=x(A^O,12),v=v+A|0,k=x(k^v,8),O=O+k|0,A=x(A^O,7);let $=0;r[$++]=i+E|0,r[$++]=c+L|0,r[$++]=u+j|0,r[$++]=a+v|0,r[$++]=l+A|0,r[$++]=f+w|0,r[$++]=d+P|0,r[$++]=g+I|0,r[$++]=y+_|0,r[$++]=p+O|0,r[$++]=m+R|0,r[$++]=B+T|0,r[$++]=b+C|0,r[$++]=U+h|0,r[$++]=S+k|0,r[$++]=V+D|0}const xs=ms(vs,{counterRight:!1,counterLength:4,allowShortKeys:!1}),As=new Uint8Array(16),jn=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(As.subarray(n))},Ss=new Uint8Array(32);function kn(e,t,n,r,o){const s=e(t,n,Ss),i=Es.create(s);o&&jn(i,o),jn(i,r);const c=new Uint8Array(16),u=os(c);Pn(u,0,BigInt(o?o.length:0),!0),Pn(u,8,BigInt(r.length),!0),i.update(c);const a=i.digest();return ve(s,c),a}const Ns=e=>(t,n,r)=>({encrypt(s,i){const c=s.length;i=Cn(c+16,i,!1),i.set(s);const u=i.subarray(0,-16);e(t,n,u,u,1);const a=kn(e,t,n,u,r);return i.set(a,c),ve(a),i},decrypt(s,i){i=Cn(s.length-16,i,!1);const c=s.subarray(0,-16),u=s.subarray(-16),a=kn(e,t,n,c,r);if(!as(u,a))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),e(t,n,i,i,1),ve(a),i}}),Vn=us({blockSize:64,nonceLength:12,tagLength:16},Ns(xs));class Dn extends ot{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,nt(t);const r=Ee(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return be(this),this.iHash.update(t),this}digestInto(t){be(this),je(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const gt=(e,t,n)=>new Dn(e,t).update(n).digest();gt.create=(e,t)=>new Dn(e,t);function Is(e,t,n){return nt(e),n===void 0&&(n=new Uint8Array(e.outputLen)),gt(e,Ee(n),Ee(t))}const yt=new Uint8Array([0]),Mn=new Uint8Array;function Os(e,t,n,r=32){if(nt(e),Oe(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=Mn);const s=new Uint8Array(o*e.outputLen),i=gt.create(e,t),c=i._cloneInto(),u=new Uint8Array(i.outputLen);for(let a=0;a<o;a++)yt[0]=a+1,c.update(a===0?Mn:u).update(n).update(yt).digestInto(u),s.set(u,e.outputLen*a),i._cloneInto(c);return i.destroy(),c.destroy(),u.fill(0),yt.fill(0),s.slice(0,r)}const Rs=(e,t,n,r,o)=>Os(e,Is(e,t,n),r,o);function Ts(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),u=r?4:0,a=r?0:4;e.setUint32(t+u,i,r),e.setUint32(t+a,c,r)}function Us(e,t,n){return e&t^~e&n}function _s(e,t,n){return e&t^e&n^t&n}class Cs extends ot{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=rt(this.buffer)}update(t){be(this);const{view:n,buffer:r,blockLen:o}=this;t=Ee(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const u=rt(t);for(;o<=s-i;i+=o)this.process(u,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){be(this),en(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let f=i;f<o;f++)n[f]=0;Ts(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=rt(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const a=u/4,l=this.get();if(a>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<a;f++)c.setUint32(4*f,l[f],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}}const Ps=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),se=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ie=new Uint32Array(64);class $s extends Cs{constructor(){super(64,32,8,!1),this.A=se[0]|0,this.B=se[1]|0,this.C=se[2]|0,this.D=se[3]|0,this.E=se[4]|0,this.F=se[5]|0,this.G=se[6]|0,this.H=se[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:u}=this;return[t,n,r,o,s,i,c,u]}set(t,n,r,o,s,i,c,u){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=u|0}process(t,n){for(let f=0;f<16;f++,n+=4)ie[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const d=ie[f-15],g=ie[f-2],y=W(d,7)^W(d,18)^d>>>3,p=W(g,17)^W(g,19)^g>>>10;ie[f]=p+ie[f-7]+y+ie[f-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:u,G:a,H:l}=this;for(let f=0;f<64;f++){const d=W(c,6)^W(c,11)^W(c,25),g=l+d+Us(c,u,a)+Ps[f]+ie[f]|0,p=(W(r,2)^W(r,13)^W(r,22))+_s(r,o,s)|0;l=a,a=u,u=c,c=i+g|0,i=s,s=o,o=r,r=g+p|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,u=u+this.F|0,a=a+this.G|0,l=l+this.H|0,this.set(r,o,s,i,c,u,a,l)}roundClean(){ie.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const He=on(()=>new $s);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fn=BigInt(0);function mt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Hn(e){if(!mt(e))throw new Error("Uint8Array expected")}const Ls=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Bs(e){Hn(e);let t="";for(let n=0;n<e.length;n++)t+=Ls[e[n]];return t}function js(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Fn:BigInt("0x"+e)}const Z={_0:48,_9:57,A:65,F:70,a:97,f:102};function Kn(e){if(e>=Z._0&&e<=Z._9)return e-Z._0;if(e>=Z.A&&e<=Z.F)return e-(Z.A-10);if(e>=Z.a&&e<=Z.f)return e-(Z.a-10)}function qn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){const i=Kn(e.charCodeAt(s)),c=Kn(e.charCodeAt(s+1));if(i===void 0||c===void 0){const u=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+s)}r[o]=i*16+c}return r}function zn(e){return Hn(e),js(Bs(Uint8Array.from(e).reverse()))}function ks(e,t){return qn(e.toString(16).padStart(t*2,"0"))}function Vs(e,t){return ks(e,t).reverse()}function Gn(e,t,n){let r;if(typeof t=="string")try{r=qn(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(mt(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(e+" of length "+n+" expected, got "+o);return r}const bt=e=>typeof e=="bigint"&&Fn<=e;function Ds(e,t,n){return bt(e)&&bt(t)&&bt(n)&&t<=e&&e<n}function Wn(e,t,n,r){if(!Ds(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}const Ms={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||mt(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Fs(e,t,n={}){const r=(o,s,i)=>{const c=Ms[s];if(typeof c!="function")throw new Error("invalid validator function");const u=e[o];if(!(i&&u===void 0)&&!c(u,e))throw new Error("param "+String(o)+" is invalid. Expected "+s+", got "+u)};for(const[o,s]of Object.entries(t))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return e}const xe=BigInt(0),Ke=BigInt(1);function Jn(e,t){const n=e%t;return n>=xe?n:t+n}function Hs(e,t,n){if(t<xe)throw new Error("invalid exponent, negatives unsupported");if(n<=xe)throw new Error("invalid modulus");if(n===Ke)return xe;let r=Ke;for(;t>xe;)t&Ke&&(r=r*e%n),e=e*e%n,t>>=Ke;return r}function G(e,t,n){let r=e;for(;t-- >xe;)r*=r,r%=n;return r}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Ae=BigInt(0),wt=BigInt(1);function Ks(e){return Fs(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...e})}function qs(e){const t=Ks(e),{P:n}=t,r=b=>Jn(b,n),o=t.montgomeryBits,s=Math.ceil(o/8),i=t.nByteLength,c=t.adjustScalarBytes||(b=>b),u=t.powPminus2||(b=>Hs(b,n-BigInt(2),n));function a(b,U,S){const V=r(b*(U-S));return U=r(U-V),S=r(S+V),[U,S]}const l=(t.a-BigInt(2))/BigInt(4);function f(b,U){Wn("u",b,Ae,n),Wn("scalar",U,Ae,n);const S=U,V=b;let E=wt,L=Ae,j=b,v=wt,A=Ae,w;for(let I=BigInt(o-1);I>=Ae;I--){const _=S>>I&wt;A^=_,w=a(A,E,j),E=w[0],j=w[1],w=a(A,L,v),L=w[0],v=w[1],A=_;const O=E+L,R=r(O*O),T=E-L,C=r(T*T),h=R-C,k=j+v,D=j-v,$=r(D*O),z=r(k*T),Y=$+z,X=$-z;j=r(Y*Y),v=r(V*r(X*X)),E=r(R*C),L=r(h*(R+r(l*h)))}w=a(A,E,j),E=w[0],j=w[1],w=a(A,L,v),L=w[0],v=w[1];const P=u(L);return r(E*P)}function d(b){return Vs(r(b),s)}function g(b){const U=Gn("u coordinate",b,s);return i===32&&(U[31]&=127),zn(U)}function y(b){const U=Gn("scalar",b),S=U.length;if(S!==s&&S!==i){let V=""+s+" or "+i;throw new Error("invalid scalar, expected "+V+" bytes, got "+S)}return zn(c(U))}function p(b,U){const S=g(U),V=y(b),E=f(S,V);if(E===Ae)throw new Error("invalid private or public key received");return d(E)}const m=d(t.Gu);function B(b){return p(b,m)}return{scalarMult:p,scalarMultBase:B,getSharedSecret:(b,U)=>p(b,U),getPublicKey:b=>B(b),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:m}}const Et=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const zs=BigInt(1),Yn=BigInt(2),Gs=BigInt(3),Ws=BigInt(5);BigInt(8);function Js(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=Et,c=e*e%s*e%s,u=G(c,Yn,s)*c%s,a=G(u,zs,s)*e%s,l=G(a,Ws,s)*a%s,f=G(l,t,s)*l%s,d=G(f,n,s)*f%s,g=G(d,r,s)*d%s,y=G(g,o,s)*g%s,p=G(y,o,s)*g%s,m=G(p,t,s)*l%s;return{pow_p_5_8:G(m,Yn,s)*e%s,b2:c}}function Ys(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const vt=qs({P:Et,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=Et,{pow_p_5_8:n,b2:r}=Js(e);return Jn(G(n,Gs,t)*r,t)},adjustScalarBytes:Ys,randomBytes:Re}),xt="base10",F="base16",At="base64pad",Xs="base64url",Se="utf8",St=0,Ne=1,Ue=2,Qs=0,Xn=1,_e=12,Nt=32;function Zs(){const e=vt.utils.randomPrivateKey(),t=vt.getPublicKey(e);return{privateKey:N.toString(e,F),publicKey:N.toString(t,F)}}function ei(){const e=Re(Nt);return N.toString(e,F)}function ti(e,t){const n=vt.getSharedSecret(N.fromString(e,F),N.fromString(t,F)),r=Rs(He,n,void 0,void 0,Nt);return N.toString(r,F)}function ni(e){const t=He(N.fromString(e,F));return N.toString(t,F)}function ri(e){const t=He(N.fromString(e,Se));return N.toString(t,F)}function It(e){return N.fromString(`${e}`,xt)}function fe(e){return Number(N.toString(e,xt))}function oi(e){const t=It(typeof e.type<"u"?e.type:St);if(fe(t)===Ne&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?N.fromString(e.senderPublicKey,F):void 0,r=typeof e.iv<"u"?N.fromString(e.iv,F):Re(_e),o=N.fromString(e.symKey,F),s=Vn(o,r).encrypt(N.fromString(e.message,Se));return Ot({type:t,sealed:s,iv:r,senderPublicKey:n,encoding:e.encoding})}function si(e){const t=N.fromString(e.symKey,F),{sealed:n,iv:r}=qe(e),o=Vn(t,r).decrypt(n);if(o===null)throw new Error("Failed to decrypt");return N.toString(o,Se)}function ii(e,t){const n=It(Ue),r=Re(_e),o=N.fromString(e,Se);return Ot({type:n,sealed:o,iv:r,encoding:t})}function ci(e,t){const{sealed:n}=qe({encoded:e,encoding:t});return N.toString(n,Se)}function Ot(e){const{encoding:t=At}=e;if(fe(e.type)===Ue)return N.toString(N.concat([e.type,e.sealed]),t);if(fe(e.type)===Ne){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return N.toString(N.concat([e.type,e.senderPublicKey,e.iv,e.sealed]),t)}return N.toString(N.concat([e.type,e.iv,e.sealed]),t)}function qe(e){const{encoded:t,encoding:n=At}=e,r=N.fromString(t,n),o=r.slice(Qs,Xn),s=Xn;if(fe(o)===Ne){const a=s+Nt,l=a+_e,f=r.slice(s,a),d=r.slice(a,l),g=r.slice(l);return{type:o,sealed:g,iv:d,senderPublicKey:f}}if(fe(o)===Ue){const a=r.slice(s),l=Re(_e);return{type:o,sealed:a,iv:l}}const i=s+_e,c=r.slice(s,i),u=r.slice(i);return{type:o,sealed:u,iv:c}}function ai(e,t){const n=qe({encoded:e,encoding:t?.encoding});return Qn({type:fe(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?N.toString(n.senderPublicKey,F):void 0,receiverPublicKey:t?.receiverPublicKey})}function Qn(e){const t=e?.type||St;if(t===Ne){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function ui(e){return e.type===Ne&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}function fi(e){return e.type===Ue}function Zn(e){return new Pr.ec("p256").keyFromPublic({x:Buffer.from(e.x,"base64").toString("hex"),y:Buffer.from(e.y,"base64").toString("hex")},"hex")}function li(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n>0&&(t+="=".repeat(4-n)),t}function di(e){return Buffer.from(li(e),"base64")}function pi(e,t){const[n,r,o]=e.split("."),s=di(o);if(s.length!==64)throw new Error("Invalid signature length");const i=s.slice(0,32).toString("hex"),c=s.slice(32,64).toString("hex"),u=`${n}.${r}`,a=He(u),l=Zn(t),f=N.toString(a,F);if(!l.verify(f,{r:i,s:c}))throw new Error("Invalid signature");return Cr.decodeJWT(e).payload}const er="irn";function hi(e){return e?.relay||{protocol:er}}function gi(e){const t=$r.RELAY_JSONRPC[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}function tr(e,t="-"){const n={},r="relay"+t;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),i=e[o];n[s]=i}}),n}function yi(e){if(!e.includes("wc:")){const a=tt(e);a!=null&&a.includes("wc:")&&(e=a)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,t),o=e.substring(t+1,n).split("@"),s=typeof n<"u"?e.substring(n):"",i=new URLSearchParams(s),c={};i.forEach((a,l)=>{c[l]=a});const u=typeof c.methods=="string"?c.methods.split(","):void 0;return{protocol:r,topic:nr(o[0]),version:parseInt(o[1],10),symKey:c.symKey,relay:tr(c),methods:u,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function nr(e){return e.startsWith("//")?e.substring(2):e}function rr(e,t="-"){const n="relay",r={};return Object.keys(e).forEach(o=>{const s=o,i=n+t+s;e[s]&&(r[i]=e[s])}),r}function mi(e){const t=new URLSearchParams,n=rr(e.relay);Object.keys(n).sort().forEach(o=>{t.set(o,n[o])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const r=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${r}`}function bi(e,t,n){return`${e}?wc_ev=${n}&topic=${t}`}var wi=Object.defineProperty,Ei=Object.defineProperties,vi=Object.getOwnPropertyDescriptors,or=Object.getOwnPropertySymbols,xi=Object.prototype.hasOwnProperty,Ai=Object.prototype.propertyIsEnumerable,sr=(e,t,n)=>t in e?wi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Si=(e,t)=>{for(var n in t||(t={}))xi.call(t,n)&&sr(e,n,t[n]);if(or)for(var n of or(t))Ai.call(t,n)&&sr(e,n,t[n]);return e},Ni=(e,t)=>Ei(e,vi(t));function le(e){const t=[];return e.forEach(n=>{const[r,o]=n.split(":");t.push(`${r}:${o}`)}),t}function ir(e){const t=[];return Object.values(e).forEach(n=>{t.push(...le(n.accounts))}),t}function cr(e,t){const n=[];return Object.values(e).forEach(r=>{le(r.accounts).includes(t)&&n.push(...r.methods)}),n}function ar(e,t){const n=[];return Object.values(e).forEach(r=>{le(r.accounts).includes(t)&&n.push(...r.events)}),n}function Ii(e,t){const n=wr(e,t);if(n)throw new Error(n.message);const r={};for(const[o,s]of Object.entries(e))r[o]={methods:s.methods,events:s.events,chains:s.accounts.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)};return r}function Oi(e){const{proposal:{requiredNamespaces:t,optionalNamespaces:n={}},supportedNamespaces:r}=e,o=Tt(t),s=Tt(n),i={};Object.keys(r).forEach(a=>{const l=r[a].chains,f=r[a].methods,d=r[a].events,g=r[a].accounts;l.forEach(y=>{if(!g.some(p=>p.includes(y)))throw new Error(`No accounts provided for chain ${y} in namespace ${a}`)}),i[a]={chains:l,methods:f,events:d,accounts:g}});const c=vr(t,i,"approve()");if(c)throw new Error(c.message);const u={};return!Object.keys(t).length&&!Object.keys(n).length?i:(Object.keys(o).forEach(a=>{const l=r[a].chains.filter(y=>{var p,m;return(m=(p=o[a])==null?void 0:p.chains)==null?void 0:m.includes(y)}),f=r[a].methods.filter(y=>{var p,m;return(m=(p=o[a])==null?void 0:p.methods)==null?void 0:m.includes(y)}),d=r[a].events.filter(y=>{var p,m;return(m=(p=o[a])==null?void 0:p.events)==null?void 0:m.includes(y)}),g=l.map(y=>r[a].accounts.filter(p=>p.includes(`${y}:`))).flat();u[a]={chains:l,methods:f,events:d,accounts:g}}),Object.keys(s).forEach(a=>{var l,f,d,g,y,p;if(!r[a])return;const m=(f=(l=s[a])==null?void 0:l.chains)==null?void 0:f.filter(S=>r[a].chains.includes(S)),B=r[a].methods.filter(S=>{var V,E;return(E=(V=s[a])==null?void 0:V.methods)==null?void 0:E.includes(S)}),b=r[a].events.filter(S=>{var V,E;return(E=(V=s[a])==null?void 0:V.events)==null?void 0:E.includes(S)}),U=m?.map(S=>r[a].accounts.filter(V=>V.includes(`${S}:`))).flat();u[a]={chains:Q((d=u[a])==null?void 0:d.chains,m),methods:Q((g=u[a])==null?void 0:g.methods,B),events:Q((y=u[a])==null?void 0:y.events,b),accounts:Q((p=u[a])==null?void 0:p.accounts,U)}}),u)}function Rt(e){return e.includes(":")}function ur(e){return Rt(e)?e.split(":")[0]:e}function Tt(e){var t,n,r;const o={};if(!ze(e))return o;for(const[s,i]of Object.entries(e)){const c=Rt(s)?[s]:i.chains,u=i.methods||[],a=i.events||[],l=ur(s);o[l]=Ni(Si({},o[l]),{chains:Q(c,(t=o[l])==null?void 0:t.chains),methods:Q(u,(n=o[l])==null?void 0:n.methods),events:Q(a,(r=o[l])==null?void 0:r.events)})}return o}function fr(e){const t={};return e?.forEach(n=>{var r;const[o,s]=n.split(":");t[o]||(t[o]={accounts:[],chains:[],events:[],methods:[]}),t[o].accounts.push(n),(r=t[o].chains)==null||r.push(`${o}:${s}`)}),t}function Ri(e,t){t=t.map(r=>r.replace("did:pkh:",""));const n=fr(t);for(const[r,o]of Object.entries(n))o.methods?o.methods=Q(o.methods,e):o.methods=e,o.events=["chainChanged","accountsChanged"];return n}const lr={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},dr={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ee(e,t){const{message:n,code:r}=dr[e];return{message:t?`${n} ${t}`:n,code:r}}function de(e,t){const{message:n,code:r}=lr[e];return{message:t?`${n} ${t}`:n,code:r}}function Ce(e,t){return Array.isArray(e)?typeof t<"u"&&e.length?e.every(t):!0:!1}function ze(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function ce(e){return typeof e>"u"}function q(e,t){return t&&ce(e)?!0:typeof e=="string"&&!!e.trim().length}function Ge(e,t){return t&&ce(e)?!0:typeof e=="number"&&!isNaN(e)}function Ti(e,t){const{requiredNamespaces:n}=t,r=Object.keys(e.namespaces),o=Object.keys(n);let s=!0;return ne(o,r)?(r.forEach(i=>{const{accounts:c,methods:u,events:a}=e.namespaces[i],l=le(c),f=n[i];(!ne(Le(i,f),l)||!ne(f.methods,u)||!ne(f.events,a))&&(s=!1)}),s):!1}function Pe(e){return q(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function pr(e){if(q(e,!1)&&e.includes(":")){const t=e.split(":");if(t.length===3){const n=t[0]+":"+t[1];return!!t[2]&&Pe(n)}}return!1}function Ui(e){function t(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(q(e,!1)){if(t(e))return!0;const n=tt(e);return t(n)}}catch{}return!1}function _i(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function Ci(e){return e?.topic}function Pi(e,t){let n=null;return q(e?.publicKey,!1)||(n=ee("MISSING_OR_INVALID",`${t} controller public key should be a string`)),n}function Ut(e){let t=!0;return Ce(e)?e.length&&(t=e.every(n=>q(n,!1))):t=!1,t}function hr(e,t,n){let r=null;return Ce(t)&&t.length?t.forEach(o=>{r||Pe(o)||(r=de("UNSUPPORTED_CHAINS",`${n}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):Pe(e)||(r=de("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function gr(e,t,n){let r=null;return Object.entries(e).forEach(([o,s])=>{if(r)return;const i=hr(o,Le(o,s),`${t} ${n}`);i&&(r=i)}),r}function yr(e,t){let n=null;return Ce(e)?e.forEach(r=>{n||pr(r)||(n=de("UNSUPPORTED_ACCOUNTS",`${t}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=de("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function mr(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=yr(r?.accounts,`${t} namespace`);o&&(n=o)}),n}function br(e,t){let n=null;return Ut(e?.methods)?Ut(e?.events)||(n=de("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):n=de("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),n}function _t(e,t){let n=null;return Object.values(e).forEach(r=>{if(n)return;const o=br(r,`${t}, namespace`);o&&(n=o)}),n}function $i(e,t,n){let r=null;if(e&&ze(e)){const o=_t(e,t);o&&(r=o);const s=gr(e,t,n);s&&(r=s)}else r=ee("MISSING_OR_INVALID",`${t}, ${n} should be an object with data`);return r}function wr(e,t){let n=null;if(e&&ze(e)){const r=_t(e,t);r&&(n=r);const o=mr(e,t);o&&(n=o)}else n=ee("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return n}function Er(e){return q(e.protocol,!0)}function Li(e,t){let n=!1;return t&&!e?n=!0:e&&Ce(e)&&e.length&&e.forEach(r=>{n=Er(r)}),n}function Bi(e){return typeof e=="number"}function ji(e){return typeof e<"u"&&typeof e!==null}function ki(e){return!(!e||typeof e!="object"||!e.code||!Ge(e.code,!1)||!e.message||!q(e.message,!1))}function Vi(e){return!(ce(e)||!q(e.method,!1))}function Di(e){return!(ce(e)||ce(e.result)&&ce(e.error)||!Ge(e.id,!1)||!q(e.jsonrpc,!1))}function Mi(e){return!(ce(e)||!q(e.name,!1))}function Fi(e,t){return!(!Pe(t)||!ir(e).includes(t))}function Hi(e,t,n){return q(n,!1)?cr(e,t).includes(n):!1}function Ki(e,t,n){return q(n,!1)?ar(e,t).includes(n):!1}function vr(e,t,n){let r=null;const o=qi(e),s=zi(t),i=Object.keys(o),c=Object.keys(s),u=xr(Object.keys(e)),a=xr(Object.keys(t)),l=u.filter(f=>!a.includes(f));return l.length&&(r=ee("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(t).toString()}`)),ne(i,c)||(r=ee("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${i.toString()}
      Approved: ${c.toString()}`)),Object.keys(t).forEach(f=>{if(!f.includes(":")||r)return;const d=le(t[f].accounts);d.includes(f)||(r=ee("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${f}
        Required: ${f}
        Approved: ${d.toString()}`))}),i.forEach(f=>{r||(ne(o[f].methods,s[f].methods)?ne(o[f].events,s[f].events)||(r=ee("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${f}`)):r=ee("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${f}`))}),r}function qi(e){const t={};return Object.keys(e).forEach(n=>{var r;n.includes(":")?t[n]=e[n]:(r=e[n].chains)==null||r.forEach(o=>{t[o]={methods:e[n].methods,events:e[n].events}})}),t}function xr(e){return[...new Set(e.map(t=>t.includes(":")?t.split(":")[0]:t))]}function zi(e){const t={};return Object.keys(e).forEach(n=>{if(n.includes(":"))t[n]=e[n];else{const r=le(e[n].accounts);r?.forEach(o=>{t[o]={accounts:e[n].accounts.filter(s=>s.includes(`${o}:`)),methods:e[n].methods,events:e[n].events}})}}),t}function Gi(e,t){return Ge(e,!1)&&e<=t.max&&e>=t.min}function Wi(){const e=ue();return new Promise(t=>{switch(e){case H.browser:t(Ar());break;case H.reactNative:t(Sr());break;case H.node:t(Nr());break;default:t(!0)}})}function Ar(){return Ie()&&navigator?.onLine}async function Sr(){if(te()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function Nr(){return!0}function Ji(e){switch(ue()){case H.browser:Ir(e);break;case H.reactNative:Or(e);break;case H.node:break}}function Ir(e){!te()&&Ie()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function Or(e){te()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}const Ct={};class Yi{static get(t){return Ct[t]}static set(t,n){Ct[t]=n}static delete(t){delete Ct[t]}}exports.BASE10=xt,exports.BASE16=F,exports.BASE64=At,exports.BASE64URL=Xs,exports.COLON=Fr,exports.DEFAULT_DEPTH=Xe,exports.EMPTY_SPACE=Be,exports.ENV_MAP=H,exports.INTERNAL_ERRORS=dr,exports.MemoryStore=Yi,exports.ONE_THOUSAND=Hr,exports.REACT_NATIVE_PRODUCT=Vt,exports.RELAYER_DEFAULT_PROTOCOL=er,exports.SDK_ERRORS=lr,exports.SDK_TYPE=Mt,exports.SLASH=Dt,exports.TYPE_0=St,exports.TYPE_1=Ne,exports.TYPE_2=Ue,exports.UTF8=Se,exports.addResourceToRecap=In,exports.appendToQueryString=Ft,exports.assertType=Xr,exports.assignAbilityToActions=at,exports.base64Decode=Sn,exports.base64Encode=An,exports.buildApprovedNamespaces=Oi,exports.buildAuthObject=Jo,exports.buildNamespacesFromAuth=Ri,exports.buildRecapStatement=Rn,exports.calcExpiry=uo,exports.capitalize=ro,exports.capitalizeWord=Wt,exports.createDelayedPromise=oo,exports.createEncodedRecap=Zo,exports.createExpiringPromise=so,exports.createRecap=Nn,exports.decodeRecap=re,exports.decodeTypeByte=fe,exports.decodeTypeTwoEnvelope=ci,exports.decrypt=si,exports.deriveSymKey=ti,exports.deserialize=qe,exports.encodeRecap=De,exports.encodeTypeByte=It,exports.encodeTypeTwoEnvelope=ii,exports.encrypt=oi,exports.engineEvent=lo,exports.enumify=no,exports.extractSolanaTransactionId=Mo,exports.formatAccountId=Lt,exports.formatAccountWithChain=jr,exports.formatChainId=$t,exports.formatDeeplinkUrl=Jt,exports.formatExpirerTarget=Ze,exports.formatIdTarget=co,exports.formatMessage=wn,exports.formatMessageContext=Qr,exports.formatRelayParams=rr,exports.formatRelayRpcUrl=Jr,exports.formatStatementFromRecap=ft,exports.formatTopicTarget=io,exports.formatUA=qt,exports.formatUri=mi,exports.fromBase64=tt,exports.generateKeyPair=Zs,exports.generateRandomBytes32=ei,exports.getAccountsChains=le,exports.getAccountsFromNamespaces=Vr,exports.getAddressFromAccount=Bt,exports.getAddressesFromAccounts=kr,exports.getAppId=zr,exports.getAppMetadata=Gr,exports.getBrowserOnlineStatus=Ar,exports.getChainFromAccount=jt,exports.getChainsFromAccounts=kt,exports.getChainsFromNamespace=Le,exports.getChainsFromNamespaces=Dr,exports.getChainsFromRecap=ns,exports.getChainsFromRequiredNamespaces=Mr,exports.getCommonValuesInArrays=et,exports.getCryptoKeyFromKeyData=Zn,exports.getDecodedRecapFromResources=En,exports.getDeepLink=ho,exports.getDidAddress=ct,exports.getDidAddressSegments=Ve,exports.getDidChainId=mn,exports.getEnvironment=ue,exports.getHttpUrl=Yr,exports.getInternalError=ee,exports.getJavascriptID=Kt,exports.getJavascriptOS=Ht,exports.getLastItems=Gt,exports.getLinkModeURL=bi,exports.getMethodsFromRecap=ts,exports.getNamespacedDidChainId=bn,exports.getNamespacesChains=ir,exports.getNamespacesEventsForChainId=ar,exports.getNamespacesFromAccounts=fr,exports.getNamespacesMethodsForChainId=cr,exports.getNodeOnlineStatus=Nr,exports.getReCapActions=xn,exports.getReactNativeOnlineStatus=Sr,exports.getRecapAbilitiesFromResource=Qo,exports.getRecapFromResources=Me,exports.getRecapResource=vn,exports.getRelayClientMetadata=Wr,exports.getRelayProtocolApi=gi,exports.getRelayProtocolName=hi,exports.getRequiredNamespacesFromNamespaces=Ii,exports.getSdkError=de,exports.getSearchParamFromURL=go,exports.getUniqueValues=Ye,exports.handleDeeplinkRedirect=po,exports.hasOverlap=ne,exports.hashEthereumMessage=st,exports.hashKey=ni,exports.hashMessage=ri,exports.isAndroid=Kr,exports.isBrowser=Ie,exports.isCaipNamespace=Rt,exports.isConformingNamespaces=vr,exports.isExpired=fo,exports.isIframe=Qt,exports.isIos=qr,exports.isNode=Qe,exports.isOnline=Wi,exports.isProposalStruct=_i,exports.isReactNative=te,exports.isRecap=ut,exports.isSessionCompatible=Ti,exports.isSessionStruct=Ci,exports.isTelegram=Xt,exports.isTestRun=mo,exports.isTypeOneEnvelope=ui,exports.isTypeTwoEnvelope=fi,exports.isUndefined=ce,exports.isValidAccountId=pr,exports.isValidAccounts=yr,exports.isValidActions=br,exports.isValidArray=Ce,exports.isValidChainId=Pe,exports.isValidChains=hr,exports.isValidController=Pi,exports.isValidEip1271Signature=pn,exports.isValidEip191Signature=dn,exports.isValidErrorReason=ki,exports.isValidEvent=Mi,exports.isValidId=Bi,exports.isValidNamespaceAccounts=mr,exports.isValidNamespaceActions=_t,exports.isValidNamespaceChains=gr,exports.isValidNamespaceMethodsOrEvents=Ut,exports.isValidNamespaces=wr,exports.isValidNamespacesChainId=Fi,exports.isValidNamespacesEvent=Ki,exports.isValidNamespacesRequest=Hi,exports.isValidNumber=Ge,exports.isValidObject=ze,exports.isValidParams=ji,exports.isValidRecap=J,exports.isValidRelay=Er,exports.isValidRelays=Li,exports.isValidRequest=Vi,exports.isValidRequestExpiry=Gi,exports.isValidRequiredNamespaces=$i,exports.isValidResponse=Di,exports.isValidString=q,exports.isValidUrl=Ui,exports.mapEntries=to,exports.mapToObj=Zr,exports.mergeArrays=Q,exports.mergeEncodedRecaps=es,exports.mergeRecaps=On,exports.normalizeNamespaces=Tt,exports.objToMap=eo,exports.openDeeplink=Yt,exports.parseAccountId=Je,exports.parseChainId=We,exports.parseContextNames=zt,exports.parseExpirerTarget=ao,exports.parseNamespaceKey=ur,exports.parseRelayParams=tr,exports.parseTopic=nr,exports.parseUri=yi,exports.populateAuthPayload=Yo,exports.recapHasResource=Xo,exports.serialize=Ot,exports.sleep=bo,exports.subscribeToBrowserNetworkChange=Ir,exports.subscribeToNetworkChange=Ji,exports.subscribeToReactNativeNetworkChange=Or,exports.toBase64=Zt,exports.uuidv4=yo,exports.validateDecoding=ai,exports.validateEncoding=Qn,exports.validateSignedCacao=Wo,exports.verifyP256Jwt=pi,exports.verifySignature=ln;
//# sourceMappingURL=index.cjs.js.map
