(function(X,Jt){typeof exports=="object"&&typeof module<"u"?Jt(exports):typeof define=="function"&&define.amd?define(["exports"],Jt):(X=typeof globalThis<"u"?globalThis:X||self,Jt(X["@walletconnect/sign-client"]={}))})(this,function(X){"use strict";var Jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jo(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var $t={exports:{}},Fi=typeof Reflect=="object"?Reflect:null,Vu=Fi&&typeof Fi.apply=="function"?Fi.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Es;Fi&&typeof Fi.ownKeys=="function"?Es=Fi.ownKeys:Object.getOwnPropertySymbols?Es=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Es=function(e){return Object.getOwnPropertyNames(e)};function y1(t){console&&console.warn&&console.warn(t)}var Ku=Number.isNaN||function(e){return e!==e};function oe(){oe.init.call(this)}$t.exports=oe,$t.exports.once=_1,oe.EventEmitter=oe,oe.prototype._events=void 0,oe.prototype._eventsCount=0,oe.prototype._maxListeners=void 0;var Hu=10;function xs(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(oe,"defaultMaxListeners",{enumerable:!0,get:function(){return Hu},set:function(t){if(typeof t!="number"||t<0||Ku(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Hu=t}}),oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ku(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Wu(t){return t._maxListeners===void 0?oe.defaultMaxListeners:t._maxListeners}oe.prototype.getMaxListeners=function(){return Wu(this)},oe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Vu(c,this,r);else for(var u=c.length,f=Zu(c,u),i=0;i<u;++i)Vu(f[i],this,r);return!0};function Gu(t,e,r,i){var n,s,o;if(xs(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),n=Wu(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,y1(a)}return t}oe.prototype.addListener=function(e,r){return Gu(this,e,r,!1)},oe.prototype.on=oe.prototype.addListener,oe.prototype.prependListener=function(e,r){return Gu(this,e,r,!0)};function v1(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Yu(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=v1.bind(i);return n.listener=r,i.wrapFn=n,n}oe.prototype.once=function(e,r){return xs(r),this.on(e,Yu(this,e,r)),this},oe.prototype.prependOnceListener=function(e,r){return xs(r),this.prependListener(e,Yu(this,e,r)),this},oe.prototype.removeListener=function(e,r){var i,n,s,o,a;if(xs(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===r||i[o].listener===r){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():m1(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this},oe.prototype.off=oe.prototype.removeListener,oe.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function Xu(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?w1(n):Zu(n,n.length)}oe.prototype.listeners=function(e){return Xu(this,e,!0)},oe.prototype.rawListeners=function(e){return Xu(this,e,!1)},oe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ju.call(t,e)},oe.prototype.listenerCount=Ju;function Ju(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}oe.prototype.eventNames=function(){return this._eventsCount>0?Es(this._events):[]};function Zu(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function m1(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function w1(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function _1(t,e){return new Promise(function(r,i){function n(o){t.removeListener(e,s),i(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}Qu(t,e,s,{once:!0}),e!=="error"&&E1(t,n,{once:!0})})}function E1(t,e,r){typeof t.on=="function"&&Qu(t,"error",e,r)}function Qu(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var z={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Vo=function(t,e){return Vo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Vo(t,e)};function x1(t,e){Vo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ko=function(){return Ko=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ko.apply(this,arguments)};function S1(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function I1(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function A1(t,e){return function(r,i){e(r,i,t)}}function O1(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function D1(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(f){try{u(i.next(f))}catch(d){o(d)}}function c(f){try{u(i.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):n(f.value).then(a,c)}u((i=i.apply(t,e||[])).next())})}function $1(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(f){return c([u,f])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(f){u=[6,f],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function M1(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function P1(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ho(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ef(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function R1(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ef(arguments[e]));return t}function T1(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function Sn(t){return this instanceof Sn?(this.v=t,this):new Sn(t)}function N1(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(b){i[b]&&(n[b]=function(v){return new Promise(function(g,E){s.push([b,v,g,E])>1||a(b,v)})})}function a(b,v){try{c(i[b](v))}catch(g){d(s[0][3],g)}}function c(b){b.value instanceof Sn?Promise.resolve(b.value.v).then(u,f):d(s[0][2],b)}function u(b){a("next",b)}function f(b){a("throw",b)}function d(b,v){b(v),s.shift(),s.length&&a(s[0][0],s[0][1])}}function C1(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Sn(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function B1(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ho=="function"?Ho(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function F1(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function L1(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function U1(t){return t&&t.__esModule?t:{default:t}}function q1(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function z1(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var k1=Object.freeze({__proto__:null,__extends:x1,get __assign(){return Ko},__rest:S1,__decorate:I1,__param:A1,__metadata:O1,__awaiter:D1,__generator:$1,__createBinding:M1,__exportStar:P1,__values:Ho,__read:ef,__spread:R1,__spreadArrays:T1,__await:Sn,__asyncGenerator:N1,__asyncDelegator:C1,__asyncValues:B1,__makeTemplateObject:F1,__importStar:L1,__importDefault:U1,__classPrivateFieldGet:q1,__classPrivateFieldSet:z1}),Ss=jo(k1),Wo={},In={},tf;function j1(){if(tf)return In;tf=1,Object.defineProperty(In,"__esModule",{value:!0}),In.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return In.delay=t,In}var fi={},Go={},hi={},rf;function V1(){return rf||(rf=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.ONE_THOUSAND=hi.ONE_HUNDRED=void 0,hi.ONE_HUNDRED=100,hi.ONE_THOUSAND=1e3),hi}var Yo={},nf;function K1(){return nf||(nf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Yo)),Yo}var sf;function of(){return sf||(sf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ss;e.__exportStar(V1(),t),e.__exportStar(K1(),t)}(Go)),Go}var af;function H1(){if(af)return fi;af=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.fromMiliseconds=fi.toMiliseconds=void 0;const t=of();function e(i){return i*t.ONE_THOUSAND}fi.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return fi.fromMiliseconds=r,fi}var cf;function W1(){return cf||(cf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ss;e.__exportStar(j1(),t),e.__exportStar(H1(),t)}(Wo)),Wo}var Li={},uf;function G1(){if(uf)return Li;uf=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Li.Watch=t,Li.default=t,Li}var Xo={},An={},ff;function Y1(){if(ff)return An;ff=1,Object.defineProperty(An,"__esModule",{value:!0}),An.IWatch=void 0;class t{}return An.IWatch=t,An}var hf;function X1(){return hf||(hf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ss.__exportStar(Y1(),t)}(Xo)),Xo}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ss;e.__exportStar(W1(),t),e.__exportStar(G1(),t),e.__exportStar(X1(),t),e.__exportStar(of(),t)})(z);class di{}class J1 extends di{constructor(e){super()}}const df=z.FIVE_SECONDS,Ui={pulse:"heartbeat_pulse"};class Jo extends J1{constructor(e){super(e),this.events=new $t.exports.EventEmitter,this.interval=df,this.interval=e?.interval||df}static async init(e){const r=new Jo(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),z.toMiliseconds(this.interval))}pulse(){this.events.emit(Ui.pulse)}}const Z1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Q1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,eb=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function tb(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){rb(t);return}return e}function rb(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Is(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.endsWith('"')&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const i=r.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!eb.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Z1.test(t)||Q1.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,tb)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function ib(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function rt(t,...e){try{return ib(t(...e))}catch(r){return Promise.reject(r)}}function nb(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function sb(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function As(t){if(nb(t))return String(t);if(sb(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return As(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Zo="base64:";function ob(t){return typeof t=="string"?t:Zo+ub(t)}function ab(t){return typeof t!="string"||!t.startsWith(Zo)?t:cb(t.slice(Zo.length))}function cb(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function ub(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Mt(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function fb(...t){return Mt(t.join(":"))}function Os(t){return t=Mt(t),t?t+":":""}function VI(t){return t}const hb="memory",db=()=>{const t=new Map;return{name:hb,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function lb(t={}){const e={mounts:{"":t.driver||db()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const f of e.mountpoints)if(u.startsWith(f))return{base:f,relativeKey:u.slice(f.length),driver:e.mounts[f]};return{base:"",relativeKey:u,driver:e.mounts[""]}},i=(u,f)=>e.mountpoints.filter(d=>d.startsWith(u)||f&&u.startsWith(d)).map(d=>({relativeBase:u.length>d.length?u.slice(d.length):void 0,mountpoint:d,driver:e.mounts[d]})),n=(u,f)=>{if(e.watching){f=Mt(f);for(const d of e.watchListeners)d(u,f)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await lf(e.mounts[u],n,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,f,d)=>{const b=new Map,v=g=>{let E=b.get(g.base);return E||(E={driver:g.driver,base:g.base,items:[]},b.set(g.base,E)),E};for(const g of u){const E=typeof g=="string",I=Mt(E?g:g.key),$=E?void 0:g.value,D=E||!g.options?f:{...f,...g.options},M=r(I);v(M).items.push({key:I,value:$,relativeKey:M.relativeKey,options:D})}return Promise.all([...b.values()].map(g=>d(g))).then(g=>g.flat())},c={hasItem(u,f={}){u=Mt(u);const{relativeKey:d,driver:b}=r(u);return rt(b.hasItem,d,f)},getItem(u,f={}){u=Mt(u);const{relativeKey:d,driver:b}=r(u);return rt(b.getItem,d,f).then(v=>Is(v))},getItems(u,f={}){return a(u,f,d=>d.driver.getItems?rt(d.driver.getItems,d.items.map(b=>({key:b.relativeKey,options:b.options})),f).then(b=>b.map(v=>({key:fb(d.base,v.key),value:Is(v.value)}))):Promise.all(d.items.map(b=>rt(d.driver.getItem,b.relativeKey,b.options).then(v=>({key:b.key,value:Is(v)})))))},getItemRaw(u,f={}){u=Mt(u);const{relativeKey:d,driver:b}=r(u);return b.getItemRaw?rt(b.getItemRaw,d,f):rt(b.getItem,d,f).then(v=>ab(v))},async setItem(u,f,d={}){if(f===void 0)return c.removeItem(u);u=Mt(u);const{relativeKey:b,driver:v}=r(u);v.setItem&&(await rt(v.setItem,b,As(f),d),v.watch||n("update",u))},async setItems(u,f){await a(u,f,async d=>{if(d.driver.setItems)return rt(d.driver.setItems,d.items.map(b=>({key:b.relativeKey,value:As(b.value),options:b.options})),f);d.driver.setItem&&await Promise.all(d.items.map(b=>rt(d.driver.setItem,b.relativeKey,As(b.value),b.options)))})},async setItemRaw(u,f,d={}){if(f===void 0)return c.removeItem(u,d);u=Mt(u);const{relativeKey:b,driver:v}=r(u);if(v.setItemRaw)await rt(v.setItemRaw,b,f,d);else if(v.setItem)await rt(v.setItem,b,ob(f),d);else return;v.watch||n("update",u)},async removeItem(u,f={}){typeof f=="boolean"&&(f={removeMeta:f}),u=Mt(u);const{relativeKey:d,driver:b}=r(u);b.removeItem&&(await rt(b.removeItem,d,f),(f.removeMeta||f.removeMata)&&await rt(b.removeItem,d+"$",f),b.watch||n("remove",u))},async getMeta(u,f={}){typeof f=="boolean"&&(f={nativeOnly:f}),u=Mt(u);const{relativeKey:d,driver:b}=r(u),v=Object.create(null);if(b.getMeta&&Object.assign(v,await rt(b.getMeta,d,f)),!f.nativeOnly){const g=await rt(b.getItem,d+"$",f).then(E=>Is(E));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(v,g))}return v},setMeta(u,f,d={}){return this.setItem(u+"$",f,d)},removeMeta(u,f={}){return this.removeItem(u+"$",f)},async getKeys(u,f={}){u=Os(u);const d=i(u,!0);let b=[];const v=[];for(const g of d){const E=await rt(g.driver.getKeys,g.relativeBase,f);for(const I of E){const $=g.mountpoint+Mt(I);b.some(D=>$.startsWith(D))||v.push($)}b=[g.mountpoint,...b.filter(I=>!I.startsWith(g.mountpoint))]}return u?v.filter(g=>g.startsWith(u)&&g[g.length-1]!=="$"):v.filter(g=>g[g.length-1]!=="$")},async clear(u,f={}){u=Os(u),await Promise.all(i(u,!1).map(async d=>{if(d.driver.clear)return rt(d.driver.clear,d.relativeBase,f);if(d.driver.removeItem){const b=await d.driver.getKeys(d.relativeBase||"",f);return Promise.all(b.map(v=>d.driver.removeItem(v,f)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>pf(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(f=>f!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,f){if(u=Os(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((d,b)=>b.length-d.length)),e.mounts[u]=f,e.watching&&Promise.resolve(lf(f,n,u)).then(d=>{e.unwatch[u]=d}).catch(console.error),c},async unmount(u,f=!0){u=Os(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),f&&await pf(e.mounts[u]),e.mountpoints=e.mountpoints.filter(d=>d!==u),delete e.mounts[u])},getMount(u=""){u=Mt(u)+":";const f=r(u);return{driver:f.driver,base:f.base}},getMounts(u="",f={}){return u=Mt(u),i(u,f.parents).map(b=>({driver:b.driver,base:b.mountpoint}))},keys:(u,f={})=>c.getKeys(u,f),get:(u,f={})=>c.getItem(u,f),set:(u,f,d={})=>c.setItem(u,f,d),has:(u,f={})=>c.hasItem(u,f),del:(u,f={})=>c.removeItem(u,f),remove:(u,f={})=>c.removeItem(u,f)};return c}function lf(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function pf(t){typeof t.dispose=="function"&&await rt(t.dispose)}function li(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function bf(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=li(r);return(n,s)=>i.then(o=>s(o.transaction(e,n).objectStore(e)))}let Qo;function On(){return Qo||(Qo=bf("keyval-store","keyval")),Qo}function gf(t,e=On()){return e("readonly",r=>li(r.get(t)))}function pb(t,e,r=On()){return r("readwrite",i=>(i.put(e,t),li(i.transaction)))}function bb(t,e=On()){return e("readwrite",r=>(r.delete(t),li(r.transaction)))}function gb(t=On()){return t("readwrite",e=>(e.clear(),li(e.transaction)))}function yb(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},li(t.transaction)}function vb(t=On()){return t("readonly",e=>{if(e.getAllKeys)return li(e.getAllKeys());const r=[];return yb(e,i=>r.push(i.key)).then(()=>r)})}const mb=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),wb=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function qi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return wb(t)}catch{return t}}function pi(t){return typeof t=="string"?t:mb(t)||""}const _b="idb-keyval";var Eb=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=bf(t.dbName,t.storeName)),{name:_b,options:t,async hasItem(n){return!(typeof await gf(r(n),i)>"u")},async getItem(n){return await gf(r(n),i)??null},setItem(n,s){return pb(r(n),s,i)},removeItem(n){return bb(r(n),i)},getKeys(){return vb(i)},clear(){return gb(i)}}};const xb="WALLET_CONNECT_V2_INDEXED_DB",Sb="keyvaluestorage";class Ib{constructor(){this.indexedDb=lb({driver:Eb({dbName:xb,storeName:Sb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,pi(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var ea=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ds={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ea<"u"&&ea.localStorage?Ds.exports=ea.localStorage:typeof window<"u"&&window.localStorage?Ds.exports=window.localStorage:Ds.exports=new e})();function Ab(t){var e;return[t[0],qi((e=t[1])!=null?e:"")]}class Ob{constructor(){this.localStorage=Ds.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Ab)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return qi(r)}async setItem(e,r){this.localStorage.setItem(e,pi(r))}async removeItem(e){this.localStorage.removeItem(e)}}const Db="wc_storage_version",yf=1,$b=async(t,e,r)=>{const i=Db,n=await e.getItem(i);if(n&&n>=yf){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(i,yf),r(e),Mb(t,o)},Mb=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class Pb{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Ob;this.storage=e;try{const r=new Ib;$b(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}function Rb(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Tb=Nb;function Nb(t,e,r){var i=r&&r.stringify||Rb,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var a=1;a<s;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",f=1-n,d=-1,b=t&&t.length||0,v=0;v<b;){if(t.charCodeAt(v)===37&&v+1<b){switch(d=d>-1?d:0,t.charCodeAt(v+1)){case 100:case 102:if(f>=c||e[f]==null)break;d<v&&(u+=t.slice(d,v)),u+=Number(e[f]),d=v+2,v++;break;case 105:if(f>=c||e[f]==null)break;d<v&&(u+=t.slice(d,v)),u+=Math.floor(Number(e[f])),d=v+2,v++;break;case 79:case 111:case 106:if(f>=c||e[f]===void 0)break;d<v&&(u+=t.slice(d,v));var g=typeof e[f];if(g==="string"){u+="'"+e[f]+"'",d=v+2,v++;break}if(g==="function"){u+=e[f].name||"<anonymous>",d=v+2,v++;break}u+=i(e[f]),d=v+2,v++;break;case 115:if(f>=c)break;d<v&&(u+=t.slice(d,v)),u+=String(e[f]),d=v+2,v++;break;case 37:d<v&&(u+=t.slice(d,v)),u+="%",d=v+2,v++,f--;break}++f}++v}return d===-1?t:(d<b&&(u+=t.slice(d)),u)}const vf=Tb;var $r=cr;const Dn=Vb().console||{},Cb={mapHttpRequest:Ms,mapHttpResponse:Ms,wrapRequestSerializer:ra,wrapResponseSerializer:ra,wrapErrorSerializer:ra,req:Ms,res:Ms,err:qb};function Bb(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function cr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Dn;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=Bb(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=$n),Object.defineProperty(c,"levelVal",{get:f}),Object.defineProperty(c,"level",{get:d,set:b});const u={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:zb(t)};c.levels=cr.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=$n,c.serializers=i,c._serialize=n,c._stdErrSerialize=s,c.child=v,e&&(c._logEvent=ta());function f(){return this.level==="silent"?1/0:this.levels.values[this.level]}function d(){return this._level}function b(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,zi(u,c,"error","log"),zi(u,c,"fatal","error"),zi(u,c,"warn","error"),zi(u,c,"info","log"),zi(u,c,"debug","log"),zi(u,c,"trace","log")}function v(g,E){if(!g)throw new Error("missing bindings for child Pino");E=E||{},n&&g.serializers&&(E.serializers=g.serializers);const I=E.serializers;if(n&&I){var $=Object.assign({},i,I),D=t.browser.serialize===!0?Object.keys($):n;delete g.serializers,$s([g],D,$,this._stdErrSerialize)}function M(P){this._childLevel=(P._childLevel|0)+1,this.error=ki(P,g,"error"),this.fatal=ki(P,g,"fatal"),this.warn=ki(P,g,"warn"),this.info=ki(P,g,"info"),this.debug=ki(P,g,"debug"),this.trace=ki(P,g,"trace"),$&&(this.serializers=$,this._serialize=D),e&&(this._logEvent=ta([].concat(P._logEvent.bindings,g)))}return M.prototype=this,new M(this)}return c}cr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},cr.stdSerializers=Cb,cr.stdTimeFunctions=Object.assign({},{nullTime:mf,epochTime:wf,unixTime:kb,isoTime:jb});function zi(t,e,r,i){const n=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?$n:n[r]?n[r]:Dn[r]||Dn[i]||$n,Fb(t,e,r)}function Fb(t,e,r){!t.transmit&&e[r]===$n||(e[r]=function(i){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Dn?Dn:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&$s(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(a,Lb(this,r,o,s)):i.apply(a,o),t.transmit){const u=t.transmit.level||e.level,f=cr.levels.values[u],d=cr.levels.values[r];if(d<f)return;Ub(this,{ts:s,methodLevel:r,methodValue:d,transmitLevel:u,transmitValue:cr.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function Lb(t,e,r,i){t._serialize&&$s(r,t._serialize,t.serializers,t._stdErrSerialize);const n=r.slice();let s=n[0];const o={};i&&(o.time=i),o.level=cr.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof n[0]=="object";)Object.assign(o,n.shift());s=n.length?vf(n.shift(),n):void 0}else typeof s=="string"&&(s=vf(n.shift(),n));return s!==void 0&&(o.msg=s),o}function $s(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=cr.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const s in t[n])e&&e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function ki(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return t[r].apply(this,i)}}function Ub(t,e,r){const i=e.send,n=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;$s(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,i(s,t._logEvent,a),t._logEvent=ta(c)}function ta(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function qb(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function zb(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?mf:wf}function Ms(){return{}}function ra(t){return t}function $n(){}function mf(){return!1}function wf(){return Date.now()}function kb(){return Math.round(Date.now()/1e3)}function jb(){return new Date(Date.now()).toISOString()}function Vb(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const Kb={level:"info"},Mn="custom_context",ia=1e3*1024;class Hb{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class _f{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Hb(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}}class Ef{constructor(e,r=ia){this.level=e??"error",this.levelValue=$r.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new _f(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===$r.levels.values.error?console.error(e):r===$r.levels.values.warn?console.warn(e):r===$r.levels.values.debug?console.debug(e):r===$r.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(pi({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new _f(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(pi({extraMetadata:e})),new Blob(r,{type:"application/json"})}}class Wb{constructor(e,r=ia){this.baseChunkLogger=new Ef(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}}class Gb{constructor(e,r=ia){this.baseChunkLogger=new Ef(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var Yb=Object.defineProperty,Xb=Object.defineProperties,Jb=Object.getOwnPropertyDescriptors,xf=Object.getOwnPropertySymbols,Zb=Object.prototype.hasOwnProperty,Qb=Object.prototype.propertyIsEnumerable,Sf=(t,e,r)=>e in t?Yb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ps=(t,e)=>{for(var r in e||(e={}))Zb.call(e,r)&&Sf(t,r,e[r]);if(xf)for(var r of xf(e))Qb.call(e,r)&&Sf(t,r,e[r]);return t},Rs=(t,e)=>Xb(t,Jb(e));function na(t){return Rs(Ps({},t),{level:t?.level||Kb.level})}function eg(t,e=Mn){return t[e]||""}function tg(t,e,r=Mn){return t[r]=e,t}function Pt(t,e=Mn){let r="";return typeof t.bindings>"u"?r=eg(t,e):r=t.bindings().context||"",r}function rg(t,e,r=Mn){const i=Pt(t,r);return i.trim()?`${i}/${e}`:e}function St(t,e,r=Mn){const i=rg(t,e,r),n=t.child({context:i});return tg(n,i,r)}function ig(t){var e,r;const i=new Wb((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:$r(Rs(Ps({},t.opts),{level:"trace",browser:Rs(Ps({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})})),chunkLoggerController:i}}function ng(t){var e;const r=new Gb((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:$r(Rs(Ps({},t.opts),{level:"trace"})),chunkLoggerController:r}}function sg(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?ig(t):ng(t)}var og=Object.defineProperty,ag=(t,e,r)=>e in t?og(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,If=(t,e,r)=>ag(t,typeof e!="symbol"?e+"":e,r);class cg extends di{constructor(e){super(),this.opts=e,If(this,"protocol","wc"),If(this,"version",2)}}var ug=Object.defineProperty,fg=(t,e,r)=>e in t?ug(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hg=(t,e,r)=>fg(t,typeof e!="symbol"?e+"":e,r);class dg extends di{constructor(e,r){super(),this.core=e,this.logger=r,hg(this,"records",new Map)}}class lg{constructor(e,r){this.logger=e,this.core=r}}class pg extends di{constructor(e,r){super(),this.relayer=e,this.logger=r}}class bg extends di{constructor(e){super()}}class gg{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class yg extends di{constructor(e,r){super(),this.relayer=e,this.logger=r}}class vg extends di{constructor(e,r){super(),this.core=e,this.logger=r}}class mg{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}}class wg{constructor(e,r){this.projectId=e,this.logger=r}}class _g{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}}var Eg=Object.defineProperty,xg=(t,e,r)=>e in t?Eg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Af=(t,e,r)=>xg(t,typeof e!="symbol"?e+"":e,r);class Sg{constructor(e){this.opts=e,Af(this,"protocol","wc"),Af(this,"version",2)}}class Ig{constructor(e){this.client=e}}function Ag(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Of(t,...e){if(!Ag(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Df(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Og(t,e){Of(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ji=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sa=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Dg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function $f(t){return typeof t=="string"&&(t=Dg(t)),Of(t),t}class $g{clone(){return this._cloneInto()}}function Mg(t){const e=i=>t().update($f(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Mf(t=32){if(ji&&typeof ji.getRandomValues=="function")return ji.getRandomValues(new Uint8Array(t));if(ji&&typeof ji.randomBytes=="function")return ji.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Pg(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}class Rg extends $g{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=sa(this.buffer)}update(e){Df(this);const{view:r,buffer:i,blockLen:n}=this;e=$f(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=sa(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Df(this),Og(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let d=o;d<n;d++)r[d]=0;Pg(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=sa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,f[d],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}}const Ts=BigInt(2**32-1),oa=BigInt(32);function Pf(t,e=!1){return e?{h:Number(t&Ts),l:Number(t>>oa&Ts)}:{h:Number(t>>oa&Ts)|0,l:Number(t&Ts)|0}}function Tg(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=Pf(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const Ng=(t,e)=>BigInt(t>>>0)<<oa|BigInt(e>>>0),Cg=(t,e,r)=>t>>>r,Bg=(t,e,r)=>t<<32-r|e>>>r,Fg=(t,e,r)=>t>>>r|e<<32-r,Lg=(t,e,r)=>t<<32-r|e>>>r,Ug=(t,e,r)=>t<<64-r|e>>>r-32,qg=(t,e,r)=>t>>>r-32|e<<64-r,zg=(t,e)=>e,kg=(t,e)=>t,jg=(t,e,r)=>t<<r|e>>>32-r,Vg=(t,e,r)=>e<<r|t>>>32-r,Kg=(t,e,r)=>e<<r-32|t>>>64-r,Hg=(t,e,r)=>t<<r-32|e>>>64-r;function Wg(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const Gg=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Yg=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Xg=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Jg=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,Zg=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),Qg=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,Y={fromBig:Pf,split:Tg,toBig:Ng,shrSH:Cg,shrSL:Bg,rotrSH:Fg,rotrSL:Lg,rotrBH:Ug,rotrBL:qg,rotr32H:zg,rotr32L:kg,rotlSH:jg,rotlSL:Vg,rotlBH:Kg,rotlBL:Hg,add:Wg,add3L:Gg,add3H:Yg,add4L:Xg,add4H:Jg,add5H:Qg,add5L:Zg},[ey,ty]=Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Vr=new Uint32Array(80),Kr=new Uint32Array(80);class ry extends Rg{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:f,Fh:d,Fl:b,Gh:v,Gl:g,Hh:E,Hl:I}=this;return[e,r,i,n,s,o,a,c,u,f,d,b,v,g,E,I]}set(e,r,i,n,s,o,a,c,u,f,d,b,v,g,E,I){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=f|0,this.Fh=d|0,this.Fl=b|0,this.Gh=v|0,this.Gl=g|0,this.Hh=E|0,this.Hl=I|0}process(e,r){for(let M=0;M<16;M++,r+=4)Vr[M]=e.getUint32(r),Kr[M]=e.getUint32(r+=4);for(let M=16;M<80;M++){const P=Vr[M-15]|0,T=Kr[M-15]|0,N=Y.rotrSH(P,T,1)^Y.rotrSH(P,T,8)^Y.shrSH(P,T,7),C=Y.rotrSL(P,T,1)^Y.rotrSL(P,T,8)^Y.shrSL(P,T,7),B=Vr[M-2]|0,R=Kr[M-2]|0,V=Y.rotrSH(B,R,19)^Y.rotrBH(B,R,61)^Y.shrSH(B,R,6),A=Y.rotrSL(B,R,19)^Y.rotrBL(B,R,61)^Y.shrSL(B,R,6),h=Y.add4L(C,A,Kr[M-7],Kr[M-16]),p=Y.add4H(h,N,V,Vr[M-7],Vr[M-16]);Vr[M]=p|0,Kr[M]=h|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:f,Eh:d,El:b,Fh:v,Fl:g,Gh:E,Gl:I,Hh:$,Hl:D}=this;for(let M=0;M<80;M++){const P=Y.rotrSH(d,b,14)^Y.rotrSH(d,b,18)^Y.rotrBH(d,b,41),T=Y.rotrSL(d,b,14)^Y.rotrSL(d,b,18)^Y.rotrBL(d,b,41),N=d&v^~d&E,C=b&g^~b&I,B=Y.add5L(D,T,C,ty[M],Kr[M]),R=Y.add5H(B,$,P,N,ey[M],Vr[M]),V=B|0,A=Y.rotrSH(i,n,28)^Y.rotrBH(i,n,34)^Y.rotrBH(i,n,39),h=Y.rotrSL(i,n,28)^Y.rotrBL(i,n,34)^Y.rotrBL(i,n,39),p=i&s^i&a^s&a,m=n&o^n&c^o&c;$=E|0,D=I|0,E=v|0,I=g|0,v=d|0,g=b|0,{h:d,l:b}=Y.add(u|0,f|0,R|0,V|0),u=a|0,f=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const y=Y.add3L(V,h,m);i=Y.add3H(y,R,A,p),n=y|0}({h:i,l:n}=Y.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Y.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Y.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:f}=Y.add(this.Dh|0,this.Dl|0,u|0,f|0),{h:d,l:b}=Y.add(this.Eh|0,this.El|0,d|0,b|0),{h:v,l:g}=Y.add(this.Fh|0,this.Fl|0,v|0,g|0),{h:E,l:I}=Y.add(this.Gh|0,this.Gl|0,E|0,I|0),{h:$,l:D}=Y.add(this.Hh|0,this.Hl|0,$|0,D|0),this.set(i,n,s,o,a,c,u,f,d,b,v,g,E,I,$,D)}roundClean(){Vr.fill(0),Kr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const iy=Mg(()=>new ry);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const aa=BigInt(0),Rf=BigInt(1),ny=BigInt(2);function ca(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ua(t){if(!ca(t))throw new Error("Uint8Array expected")}function fa(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const sy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ha(t){ua(t);let e="";for(let r=0;r<t.length;r++)e+=sy[t[r]];return e}function Tf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?aa:BigInt("0x"+t)}const Mr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Nf(t){if(t>=Mr._0&&t<=Mr._9)return t-Mr._0;if(t>=Mr.A&&t<=Mr.F)return t-(Mr.A-10);if(t>=Mr.a&&t<=Mr.f)return t-(Mr.a-10)}function Cf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=Nf(t.charCodeAt(s)),a=Nf(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function oy(t){return Tf(ha(t))}function Ns(t){return ua(t),Tf(ha(Uint8Array.from(t).reverse()))}function Bf(t,e){return Cf(t.toString(16).padStart(e*2,"0"))}function da(t,e){return Bf(t,e).reverse()}function Pr(t,e,r){let i;if(typeof e=="string")try{i=Cf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ca(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Ff(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];ua(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const la=t=>typeof t=="bigint"&&aa<=t;function ay(t,e,r){return la(t)&&la(e)&&la(r)&&e<=t&&t<r}function Pn(t,e,r,i){if(!ay(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function cy(t){let e;for(e=0;t>aa;t>>=Rf,e+=1);return e}const uy=t=>(ny<<BigInt(t-1))-Rf,fy={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ca(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function pa(t,e,r={}){const i=(n,s,o)=>{const a=fy[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function Lf(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const it=BigInt(0),Oe=BigInt(1),bi=BigInt(2),hy=BigInt(3),ba=BigInt(4),Uf=BigInt(5),qf=BigInt(8);function Qe(t,e){const r=t%e;return r>=it?r:e+r}function dy(t,e,r){if(e<it)throw new Error("invalid exponent, negatives unsupported");if(r<=it)throw new Error("invalid modulus");if(r===Oe)return it;let i=Oe;for(;e>it;)e&Oe&&(i=i*t%r),t=t*t%r,e>>=Oe;return i}function ur(t,e,r){let i=t;for(;e-- >it;)i*=i,i%=r;return i}function zf(t,e){if(t===it)throw new Error("invert: expected non-zero number");if(e<=it)throw new Error("invert: expected positive modulus, got "+e);let r=Qe(t,e),i=e,n=it,s=Oe;for(;r!==it;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==Oe)throw new Error("invert: does not exist");return Qe(n,e)}function ly(t){const e=(t-Oe)/bi;let r,i,n;for(r=t-Oe,i=0;r%bi===it;r/=bi,i++);for(n=bi;n<t&&dy(n,e,t)!==t-Oe;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+Oe)/ba;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+Oe)/bi;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,n),r),f=o.pow(a,s),d=o.pow(a,r);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let b=1;for(let g=o.sqr(d);b<c&&!o.eql(g,o.ONE);b++)g=o.sqr(g);const v=o.pow(u,Oe<<BigInt(c-b-1));u=o.sqr(v),f=o.mul(f,v),d=o.mul(d,u),c=b}return f}}function py(t){if(t%ba===hy){const e=(t+Oe)/ba;return function(r,i){const n=r.pow(i,e);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(t%qf===Uf){const e=(t-Uf)/qf;return function(r,i){const n=r.mul(i,bi),s=r.pow(n,e),o=r.mul(i,s),a=r.mul(r.mul(o,bi),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return ly(t)}const by=(t,e)=>(Qe(t,e)&Oe)===Oe,gy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function yy(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=gy.reduce((i,n)=>(i[n]="function",i),e);return pa(t,r)}function vy(t,e,r){if(r<it)throw new Error("invalid exponent, negatives unsupported");if(r===it)return t.ONE;if(r===Oe)return e;let i=t.ONE,n=e;for(;r>it;)r&Oe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Oe;return i}function my(t,e){const r=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),n),r}function kf(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function jf(t,e,r=!1,i={}){if(t<=it)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=kf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:uy(n),ZERO:it,ONE:Oe,create:c=>Qe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return it<=c&&c<t},is0:c=>c===it,isOdd:c=>(c&Oe)===Oe,neg:c=>Qe(-c,t),eql:(c,u)=>c===u,sqr:c=>Qe(c*c,t),add:(c,u)=>Qe(c+u,t),sub:(c,u)=>Qe(c-u,t),mul:(c,u)=>Qe(c*u,t),pow:(c,u)=>vy(a,c,u),div:(c,u)=>Qe(c*zf(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>zf(c,t),sqrt:i.sqrt||(c=>(o||(o=py(t)),o(a,c))),invertBatch:c=>my(a,c),cmov:(c,u,f)=>f?u:c,toBytes:c=>r?da(c,s):Bf(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Ns(c):oy(c)}});return Object.freeze(a)}const Vf=BigInt(0),Cs=BigInt(1);function ga(t,e){const r=e.negate();return t?r:e}function Kf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ya(t,e){Kf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function wy(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function _y(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const va=new WeakMap,Hf=new WeakMap;function ma(t){return Hf.get(t)||1}function Ey(t,e){return{constTimeNegate:ga,hasPrecomputes(r){return ma(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Vf;)i&Cs&&(n=n.add(s)),s=s.double(),i>>=Cs;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=ya(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let f=1;f<s;f++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=ya(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),f=2**r,d=BigInt(r);for(let b=0;b<s;b++){const v=b*o;let g=Number(n&u);n>>=d,g>o&&(g-=f,n+=Cs);const E=v,I=v+Math.abs(g)-1,$=b%2!==0,D=g<0;g===0?c=c.add(ga($,i[E])):a=a.add(ga(D,i[I]))}return{p:a,f:c}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=ya(r,e),c=BigInt(2**r-1),u=2**r,f=BigInt(r);for(let d=0;d<o;d++){const b=d*a;if(n===Vf)break;let v=Number(n&c);if(n>>=f,v>a&&(v-=u,n+=Cs),v===0)continue;let g=i[b+Math.abs(v)-1];v<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,i,n){let s=va.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&va.set(i,n(s))),s},wNAFCached(r,i,n){const s=ma(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=ma(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){Kf(i,e),Hf.set(r,i),va.delete(r)}}}function xy(t,e,r,i){if(wy(r,t),_y(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=cy(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o;let f=n;for(let d=u;d>=0;d-=o){c.fill(n);for(let v=0;v<i.length;v++){const g=i[v],E=Number(g>>BigInt(d)&BigInt(a));c[E]=c[E].add(r[v])}let b=n;for(let v=c.length-1,g=n;v>0;v--)g=g.add(c[v]),b=b.add(g);if(f=f.add(b),d!==0)for(let v=0;v<o;v++)f=f.double()}return f}function Sy(t){return yy(t.Fp),pa(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...kf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Zt=BigInt(0),Rt=BigInt(1),Bs=BigInt(2),Iy=BigInt(8),Ay={zip215:!0};function Oy(t){const e=Sy(t);return pa(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Dy(t){const e=Oy(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Bs<<BigInt(a*8)-Rt,f=r.create,d=jf(e.n,e.nBitLength),b=e.uvRatio||((y,w)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(w))}}catch{return{isValid:!1,value:Zt}}}),v=e.adjustScalarBytes||(y=>y),g=e.domain||((y,w,S)=>{if(fa("phflag",S),w.length||S)throw new Error("Contexts/pre-hash are not supported");return y});function E(y,w){Pn("coordinate "+y,w,Zt,u)}function I(y){if(!(y instanceof M))throw new Error("ExtendedPoint expected")}const $=Lf((y,w)=>{const{ex:S,ey:O,ez:_}=y,l=y.is0();w==null&&(w=l?Iy:r.inv(_));const x=f(S*w),F=f(O*w),L=f(_*w);if(l)return{x:Zt,y:Rt};if(L!==Rt)throw new Error("invZ was invalid");return{x,y:F}}),D=Lf(y=>{const{a:w,d:S}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:O,ey:_,ez:l,et:x}=y,F=f(O*O),L=f(_*_),U=f(l*l),j=f(U*U),K=f(F*w),W=f(U*f(K+L)),J=f(j+f(S*f(F*L)));if(W!==J)throw new Error("bad point: equation left != right (1)");const H=f(O*_),G=f(l*x);if(H!==G)throw new Error("bad point: equation left != right (2)");return!0});class M{constructor(w,S,O,_){this.ex=w,this.ey=S,this.ez=O,this.et=_,E("x",w),E("y",S),E("z",O),E("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof M)throw new Error("extended point not allowed");const{x:S,y:O}=w||{};return E("x",S),E("y",O),new M(S,O,Rt,f(S*O))}static normalizeZ(w){const S=r.invertBatch(w.map(O=>O.ez));return w.map((O,_)=>O.toAffine(S[_])).map(M.fromAffine)}static msm(w,S){return xy(M,d,w,S)}_setWindowSize(w){N.setWindowSize(this,w)}assertValidity(){D(this)}equals(w){I(w);const{ex:S,ey:O,ez:_}=this,{ex:l,ey:x,ez:F}=w,L=f(S*F),U=f(l*_),j=f(O*F),K=f(x*_);return L===U&&j===K}is0(){return this.equals(M.ZERO)}negate(){return new M(f(-this.ex),this.ey,this.ez,f(-this.et))}double(){const{a:w}=e,{ex:S,ey:O,ez:_}=this,l=f(S*S),x=f(O*O),F=f(Bs*f(_*_)),L=f(w*l),U=S+O,j=f(f(U*U)-l-x),K=L+x,W=K-F,J=L-x,H=f(j*W),G=f(K*J),Pe=f(j*J),Q=f(W*K);return new M(H,G,Q,Pe)}add(w){I(w);const{a:S,d:O}=e,{ex:_,ey:l,ez:x,et:F}=this,{ex:L,ey:U,ez:j,et:K}=w;if(S===BigInt(-1)){const ye=f((l-_)*(U+L)),ms=f((l+_)*(U-L)),ge=f(ms-ye);if(ge===Zt)return this.double();const ve=f(x*Bs*K),ws=f(F*Bs*j),me=ws+ve,we=ms+ye,_s=ws-ve,Se=f(me*ge),Ie=f(we*_s),ko=f(me*_s),Ae=f(ge*we);return new M(Se,Ie,Ae,ko)}const W=f(_*L),J=f(l*U),H=f(F*O*K),G=f(x*j),Pe=f((_+l)*(L+U)-W-J),Q=G-H,ne=G+H,xt=f(J-S*W),fe=f(Pe*Q),Ee=f(ne*xt),zo=f(Pe*xt),xe=f(Q*ne);return new M(fe,Ee,xe,zo)}subtract(w){return this.add(w.negate())}wNAF(w){return N.wNAFCached(this,w,M.normalizeZ)}multiply(w){const S=w;Pn("scalar",S,Rt,i);const{p:O,f:_}=this.wNAF(S);return M.normalizeZ([O,_])[0]}multiplyUnsafe(w,S=M.ZERO){const O=w;return Pn("scalar",O,Zt,i),O===Zt?T:this.is0()||O===Rt?this:N.wNAFCachedUnsafe(this,O,M.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return N.unsafeLadder(this,i).is0()}toAffine(w){return $(this,w)}clearCofactor(){const{h:w}=e;return w===Rt?this:this.multiplyUnsafe(w)}static fromHex(w,S=!1){const{d:O,a:_}=e,l=r.BYTES;w=Pr("pointHex",w,l),fa("zip215",S);const x=w.slice(),F=w[l-1];x[l-1]=F&-129;const L=Ns(x),U=S?u:r.ORDER;Pn("pointHex.y",L,Zt,U);const j=f(L*L),K=f(j-Rt),W=f(O*j-_);let{isValid:J,value:H}=b(K,W);if(!J)throw new Error("Point.fromHex: invalid y coordinate");const G=(H&Rt)===Rt,Pe=(F&128)!==0;if(!S&&H===Zt&&Pe)throw new Error("Point.fromHex: x=0 and x_0=1");return Pe!==G&&(H=f(-H)),M.fromAffine({x:H,y:L})}static fromPrivateKey(w){return R(w).point}toRawBytes(){const{x:w,y:S}=this.toAffine(),O=da(S,r.BYTES);return O[O.length-1]|=w&Rt?128:0,O}toHex(){return ha(this.toRawBytes())}}M.BASE=new M(e.Gx,e.Gy,Rt,f(e.Gx*e.Gy)),M.ZERO=new M(Zt,Rt,Rt,Zt);const{BASE:P,ZERO:T}=M,N=Ey(M,a*8);function C(y){return Qe(y,i)}function B(y){return C(Ns(y))}function R(y){const w=r.BYTES;y=Pr("private key",y,w);const S=Pr("hashed private key",s(y),2*w),O=v(S.slice(0,w)),_=S.slice(w,2*w),l=B(O),x=P.multiply(l),F=x.toRawBytes();return{head:O,prefix:_,scalar:l,point:x,pointBytes:F}}function V(y){return R(y).pointBytes}function A(y=new Uint8Array,...w){const S=Ff(...w);return B(s(g(S,Pr("context",y),!!n)))}function h(y,w,S={}){y=Pr("message",y),n&&(y=n(y));const{prefix:O,scalar:_,pointBytes:l}=R(w),x=A(S.context,O,y),F=P.multiply(x).toRawBytes(),L=A(S.context,F,l,y),U=C(x+L*_);Pn("signature.s",U,Zt,i);const j=Ff(F,da(U,r.BYTES));return Pr("result",j,r.BYTES*2)}const p=Ay;function m(y,w,S,O=p){const{context:_,zip215:l}=O,x=r.BYTES;y=Pr("signature",y,2*x),w=Pr("message",w),S=Pr("publicKey",S,x),l!==void 0&&fa("zip215",l),n&&(w=n(w));const F=Ns(y.slice(x,2*x));let L,U,j;try{L=M.fromHex(S,l),U=M.fromHex(y.slice(0,x),l),j=P.multiplyUnsafe(F)}catch{return!1}if(!l&&L.isSmallOrder())return!1;const K=A(_,U.toRawBytes(),L.toRawBytes(),w);return U.add(L.multiplyUnsafe(K)).subtract(j).clearCofactor().equals(M.ZERO)}return P._setWindowSize(8),{CURVE:e,getPublicKey:V,sign:h,verify:m,ExtendedPoint:M,utils:{getExtendedPublicKey:R,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,w=M.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const wa=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Wf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const $y=BigInt(1),Gf=BigInt(2);BigInt(3);const My=BigInt(5),Py=BigInt(8);function Ry(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=wa,o=t*t%s*t%s,a=ur(o,Gf,s)*o%s,c=ur(a,$y,s)*t%s,u=ur(c,My,s)*c%s,f=ur(u,e,s)*u%s,d=ur(f,r,s)*f%s,b=ur(d,i,s)*d%s,v=ur(b,n,s)*b%s,g=ur(v,n,s)*b%s,E=ur(g,e,s)*u%s;return{pow_p_5_8:ur(E,Gf,s)*t%s,b2:o}}function Ty(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Ny(t,e){const r=wa,i=Qe(e*e*e,r),n=Qe(i*i*e,r),s=Ry(t*n).pow_p_5_8;let o=Qe(t*i*s,r);const a=Qe(e*o*o,r),c=o,u=Qe(o*Wf,r),f=a===t,d=a===Qe(-t,r),b=a===Qe(-t*Wf,r);return f&&(o=c),(d||b)&&(o=u),by(o,r)&&(o=Qe(-o,r)),{isValid:f||d,value:o}}const Cy=jf(wa,void 0,!0),By={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Cy,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Py,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:iy,randomBytes:Mf,adjustScalarBytes:Ty,uvRatio:Ny},Yf=Dy(By),Fy="EdDSA",Ly="JWT",Fs=".",Ls="base64url",Xf="utf8",Jf="utf8",Uy=":",qy="did",zy="key",Zf="base58btc",ky="z",jy="K36",Vy=32;function _a(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Qf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?_a(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function eh(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Qf(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return _a(r)}function Ky(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var E=0,I=0,$=0,D=g.length;$!==D&&g[$]===0;)$++,E++;for(var M=(D-$)*f+1>>>0,P=new Uint8Array(M);$!==D;){for(var T=g[$],N=0,C=M-1;(T!==0||N<I)&&C!==-1;C--,N++)T+=256*P[C]>>>0,P[C]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");I=N,$++}for(var B=M-I;B!==M&&P[B]===0;)B++;for(var R=c.repeat(E);B<M;++B)R+=t.charAt(P[B]);return R}function b(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var E=0;if(g[E]!==" "){for(var I=0,$=0;g[E]===c;)I++,E++;for(var D=(g.length-E)*u+1>>>0,M=new Uint8Array(D);g[E];){var P=r[g.charCodeAt(E)];if(P===255)return;for(var T=0,N=D-1;(P!==0||T<$)&&N!==-1;N--,T++)P+=a*M[N]>>>0,M[N]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");$=T,E++}if(g[E]!==" "){for(var C=D-$;C!==D&&M[C]===0;)C++;for(var B=new Uint8Array(I+(D-C)),R=I;C!==D;)B[R++]=M[C++];return B}}}function v(g){var E=b(g);if(E)return E;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:b,decode:v}}var Hy=Ky,Wy=Hy;const th=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Gy=t=>new TextEncoder().encode(t),Yy=t=>new TextDecoder().decode(t);class Xy{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Jy{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return rh(this,e)}}class Zy{constructor(e){this.decoders=e}or(e){return rh(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const rh=(t,e)=>new Zy({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Qy{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Xy(e,r,i),this.decoder=new Jy(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Us=({name:t,prefix:e,encode:r,decode:i})=>new Qy(t,e,r,i),Rn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Wy(r,e);return Us({prefix:t,name:e,encode:i,decode:s=>th(n(s))})},e2=(t,e,r,i)=>{const n={};for(let f=0;f<e.length;++f)n[e[f]]=f;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let f=0;f<s;++f){const d=n[t[f]];if(d===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|d,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},t2=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},ht=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Us({prefix:e,name:t,encode(n){return t2(n,i,r)},decode(n){return e2(n,i,r,t)}}),r2=Us({prefix:"\0",name:"identity",encode:t=>Yy(t),decode:t=>Gy(t)});var i2=Object.freeze({__proto__:null,identity:r2});const n2=ht({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var s2=Object.freeze({__proto__:null,base2:n2});const o2=ht({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var a2=Object.freeze({__proto__:null,base8:o2});const c2=Rn({prefix:"9",name:"base10",alphabet:"0123456789"});var u2=Object.freeze({__proto__:null,base10:c2});const f2=ht({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),h2=ht({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var d2=Object.freeze({__proto__:null,base16:f2,base16upper:h2});const l2=ht({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),p2=ht({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),b2=ht({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),g2=ht({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),y2=ht({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),v2=ht({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),m2=ht({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w2=ht({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_2=ht({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var E2=Object.freeze({__proto__:null,base32:l2,base32upper:p2,base32pad:b2,base32padupper:g2,base32hex:y2,base32hexupper:v2,base32hexpad:m2,base32hexpadupper:w2,base32z:_2});const x2=Rn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),S2=Rn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var I2=Object.freeze({__proto__:null,base36:x2,base36upper:S2});const A2=Rn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),O2=Rn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var D2=Object.freeze({__proto__:null,base58btc:A2,base58flickr:O2});const $2=ht({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),M2=ht({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),P2=ht({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),R2=ht({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var T2=Object.freeze({__proto__:null,base64:$2,base64pad:M2,base64url:P2,base64urlpad:R2});const ih=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),N2=ih.reduce((t,e,r)=>(t[r]=e,t),[]),C2=ih.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function B2(t){return t.reduce((e,r)=>(e+=N2[r],e),"")}function F2(t){const e=[];for(const r of t){const i=C2[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const L2=Us({prefix:"\u{1F680}",name:"base256emoji",encode:B2,decode:F2});var U2=Object.freeze({__proto__:null,base256emoji:L2}),q2=sh,nh=128,z2=127,k2=~z2,j2=Math.pow(2,31);function sh(t,e,r){e=e||[],r=r||0;for(var i=r;t>=j2;)e[r++]=t&255|nh,t/=128;for(;t&k2;)e[r++]=t&255|nh,t>>>=7;return e[r]=t|0,sh.bytes=r-i+1,e}var V2=Ea,K2=128,oh=127;function Ea(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw Ea.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&oh)<<n:(o&oh)*Math.pow(2,n),n+=7}while(o>=K2);return Ea.bytes=s-i,r}var H2=Math.pow(2,7),W2=Math.pow(2,14),G2=Math.pow(2,21),Y2=Math.pow(2,28),X2=Math.pow(2,35),J2=Math.pow(2,42),Z2=Math.pow(2,49),Q2=Math.pow(2,56),ev=Math.pow(2,63),tv=function(t){return t<H2?1:t<W2?2:t<G2?3:t<Y2?4:t<X2?5:t<J2?6:t<Z2?7:t<Q2?8:t<ev?9:10},rv={encode:q2,decode:V2,encodingLength:tv},ah=rv;const ch=(t,e,r=0)=>(ah.encode(t,e,r),e),uh=t=>ah.encodingLength(t),xa=(t,e)=>{const r=e.byteLength,i=uh(t),n=i+uh(r),s=new Uint8Array(n+r);return ch(t,s,0),ch(r,s,i),s.set(e,n),new iv(t,r,e,s)};class iv{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const fh=({name:t,code:e,encode:r})=>new nv(t,e,r);class nv{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?xa(this.code,r):r.then(i=>xa(this.code,i))}else throw Error("Unknown type, must be binary type")}}const hh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),sv=fh({name:"sha2-256",code:18,encode:hh("SHA-256")}),ov=fh({name:"sha2-512",code:19,encode:hh("SHA-512")});var av=Object.freeze({__proto__:null,sha256:sv,sha512:ov});const dh=0,cv="identity",lh=th;var uv=Object.freeze({__proto__:null,identity:{code:dh,name:cv,encode:lh,digest:t=>xa(dh,lh(t))}});new TextEncoder,new TextDecoder;const ph={...i2,...s2,...a2,...u2,...d2,...E2,...I2,...D2,...T2,...U2};({...av,...uv});function bh(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const gh=bh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Sa=bh("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Qf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),yh={utf8:gh,"utf-8":gh,hex:ph.base16,latin1:Sa,ascii:Sa,binary:Sa,...ph};function qs(t,e="utf8"){const r=yh[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Vi(t,e="utf8"){const r=yh[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?_a(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function vh(t){return qi(qs(Vi(t,Ls),Xf))}function zs(t){return qs(Vi(pi(t),Xf),Ls)}function mh(t){const e=Vi(jy,Zf),r=ky+qs(eh([e,t]),Zf);return[qy,zy,r].join(Uy)}function fv(t){return qs(t,Ls)}function hv(t){return Vi(t,Ls)}function dv(t){return Vi([zs(t.header),zs(t.payload)].join(Fs),Jf)}function lv(t){return[zs(t.header),zs(t.payload),fv(t.signature)].join(Fs)}function Ia(t){const e=t.split(Fs),r=vh(e[0]),i=vh(e[1]),n=hv(e[2]),s=Vi(e.slice(0,2).join(Fs),Jf);return{header:r,payload:i,signature:n,data:s}}function wh(t=Mf(Vy)){const e=Yf.getPublicKey(t);return{secretKey:eh([t,e]),publicKey:e}}async function pv(t,e,r,i,n=z.fromMiliseconds(Date.now())){const s={alg:Fy,typ:Ly},o=mh(i.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},u=dv({header:s,payload:c}),f=Yf.sign(u,i.secretKey.slice(0,32));return lv({header:s,payload:c,signature:f})}var _h=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},bv=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),gv=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),yv=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),vv=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),mv=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),wv=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,_v=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Eh=3,Ev=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",wv]],xh=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function xv(t){return t?Sh(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new mv:typeof navigator<"u"?Sh(navigator.userAgent):Av()}function Sv(t){return t!==""&&Ev.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Sh(t){var e=Sv(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new vv;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Eh&&(n=_h(_h([],n,!0),Ov(Eh-n.length),!0)):n=[];var s=n.join("."),o=Iv(t),a=_v.exec(t);return a&&a[1]?new yv(r,s,o,a[1]):new bv(r,s,o)}function Iv(t){for(var e=0,r=xh.length;e<r;e++){var i=xh[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function Av(){var t=typeof process<"u"&&process.version;return t?new gv(process.version.slice(1)):null}function Ov(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var he={};Object.defineProperty(he,"__esModule",{value:!0}),he.getLocalStorage=he.getLocalStorageOrThrow=he.getCrypto=he.getCryptoOrThrow=Ih=he.getLocation=he.getLocationOrThrow=Aa=he.getNavigator=he.getNavigatorOrThrow=Tn=he.getDocument=he.getDocumentOrThrow=he.getFromWindowOrThrow=he.getFromWindow=void 0;function gi(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}he.getFromWindow=gi;function Ki(t){const e=gi(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}he.getFromWindowOrThrow=Ki;function Dv(){return Ki("document")}he.getDocumentOrThrow=Dv;function $v(){return gi("document")}var Tn=he.getDocument=$v;function Mv(){return Ki("navigator")}he.getNavigatorOrThrow=Mv;function Pv(){return gi("navigator")}var Aa=he.getNavigator=Pv;function Rv(){return Ki("location")}he.getLocationOrThrow=Rv;function Tv(){return gi("location")}var Ih=he.getLocation=Tv;function Nv(){return Ki("crypto")}he.getCryptoOrThrow=Nv;function Cv(){return gi("crypto")}he.getCrypto=Cv;function Bv(){return Ki("localStorage")}he.getLocalStorageOrThrow=Bv;function Fv(){return gi("localStorage")}he.getLocalStorage=Fv;var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});var Ah=Oa.getWindowMetadata=void 0;const Oh=he;function Lv(){let t,e;try{t=Oh.getDocumentOrThrow(),e=Oh.getLocationOrThrow()}catch{return null}function r(){const d=t.getElementsByTagName("link"),b=[];for(let v=0;v<d.length;v++){const g=d[v],E=g.getAttribute("rel");if(E&&E.toLowerCase().indexOf("icon")>-1){const I=g.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let $=e.protocol+"//"+e.host;if(I.indexOf("/")===0)$+=I;else{const D=e.pathname.split("/");D.pop();const M=D.join("/");$+=M+"/"+I}b.push($)}else if(I.indexOf("//")===0){const $=e.protocol+I;b.push($)}else b.push(I)}}return b}function i(...d){const b=t.getElementsByTagName("meta");for(let v=0;v<b.length;v++){const g=b[v],E=["itemprop","property","name"].map(I=>g.getAttribute(I)).filter(I=>I?d.includes(I):!1);if(E.length&&E){const I=g.getAttribute("content");if(I)return I}}return""}function n(){let d=i("name","og:site_name","og:title","twitter:title");return d||(d=t.title),d}function s(){return i("description","og:description","twitter:description","keywords")}const o=n(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}Ah=Oa.getWindowMetadata=Lv;function Nn(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Dh(t){return Nn(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const $h="2.23.2";let Da={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${$h}`};class yi extends Error{constructor(e,r={}){const i=r.cause instanceof yi?r.cause.details:r.cause?.message?r.cause.message:r.details,n=r.cause instanceof yi&&r.cause.docsPath||r.docsPath,s=Da.getDocsUrl?.({...r,docsPath:n}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...i?[`Details: ${i}`]:[],...Da.version?[`Version: ${Da.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=n,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=$h}walk(e){return Mh(this,e)}}function Mh(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Mh(t.cause,e):e?null:t}class Ph extends yi{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function Hi(t,{dir:e,size:r=32}={}){return typeof t=="string"?Uv(t,{dir:e,size:r}):qv(t,{dir:e,size:r})}function Uv(t,{dir:e,size:r=32}={}){if(r===null)return t;const i=t.replace("0x","");if(i.length>r*2)throw new Ph({size:Math.ceil(i.length/2),targetSize:r,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function qv(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Ph({size:t.length,targetSize:r,type:"bytes"});const i=new Uint8Array(r);for(let n=0;n<r;n++){const s=e==="right";i[s?n:r-n-1]=t[s?n:t.length-n-1]}return i}class zv extends yi{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number "${s}" is not in safe ${n?`${n*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class kv extends yi{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Wi(t,{size:e}){if(Dh(t)>e)throw new kv({givenSize:Dh(t),maxSize:e})}function $a(t,e={}){const{signed:r}=e;e.size&&Wi(t,{size:e.size});const i=BigInt(t);if(!r)return i;const n=(t.length-2)/2,s=(1n<<BigInt(n)*8n-1n)-1n;return i<=s?i:i-BigInt(`0x${"f".padStart(n*2,"f")}`)-1n}function jv(t,e={}){return Number($a(t,e))}const Vv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ma(t,e={}){return typeof t=="number"||typeof t=="bigint"?Th(t,e):typeof t=="string"?Wv(t,e):typeof t=="boolean"?Kv(t,e):Rh(t,e)}function Kv(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(Wi(r,{size:e.size}),Hi(r,{size:e.size})):r}function Rh(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=Vv[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(Wi(i,{size:e.size}),Hi(i,{dir:"right",size:e.size})):i}function Th(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const c=typeof t=="bigint"?"n":"";throw new zv({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:r,size:i,value:`${t}${c}`})}const a=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?Hi(a,{size:i}):a}const Hv=new TextEncoder;function Wv(t,e={}){const r=Hv.encode(t);return Rh(r,e)}const Gv=new TextEncoder;function Yv(t,e={}){return typeof t=="number"||typeof t=="bigint"?Jv(t,e):typeof t=="boolean"?Xv(t,e):Nn(t)?Ch(t,e):Bh(t,e)}function Xv(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(Wi(r,{size:e.size}),Hi(r,{size:e.size})):r}const Rr={zero:48,nine:57,A:65,F:70,a:97,f:102};function Nh(t){if(t>=Rr.zero&&t<=Rr.nine)return t-Rr.zero;if(t>=Rr.A&&t<=Rr.F)return t-(Rr.A-10);if(t>=Rr.a&&t<=Rr.f)return t-(Rr.a-10)}function Ch(t,e={}){let r=t;e.size&&(Wi(r,{size:e.size}),r=Hi(r,{dir:"right",size:e.size}));let i=r.slice(2);i.length%2&&(i=`0${i}`);const n=i.length/2,s=new Uint8Array(n);for(let o=0,a=0;o<n;o++){const c=Nh(i.charCodeAt(a++)),u=Nh(i.charCodeAt(a++));if(c===void 0||u===void 0)throw new yi(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);s[o]=c*16+u}return s}function Jv(t,e){const r=Th(t,e);return Ch(r)}function Bh(t,e={}){const r=Gv.encode(t);return typeof e.size=="number"?(Wi(r,{size:e.size}),Hi(r,{dir:"right",size:e.size})):r}function ks(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Zv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Cn(t,...e){if(!Zv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Qv(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ks(t.outputLen),ks(t.blockLen)}function Gi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Fh(t,e){Cn(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const js=BigInt(2**32-1),Lh=BigInt(32);function em(t,e=!1){return e?{h:Number(t&js),l:Number(t>>Lh&js)}:{h:Number(t>>Lh&js)|0,l:Number(t&js)|0}}function tm(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=em(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const rm=(t,e,r)=>t<<r|e>>>32-r,im=(t,e,r)=>e<<r|t>>>32-r,nm=(t,e,r)=>e<<r-32|t>>>64-r,sm=(t,e,r)=>t<<r-32|e>>>64-r,Yi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function om(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Pa(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function fr(t,e){return t<<32-e|t>>>e}const Uh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function am(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function qh(t){for(let e=0;e<t.length;e++)t[e]=am(t[e])}function cm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Vs(t){return typeof t=="string"&&(t=cm(t)),Cn(t),t}function um(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Cn(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}class Ra{clone(){return this._cloneInto()}}function zh(t){const e=i=>t().update(Vs(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function kh(t=32){if(Yi&&typeof Yi.getRandomValues=="function")return Yi.getRandomValues(new Uint8Array(t));if(Yi&&typeof Yi.randomBytes=="function")return Yi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const jh=[],Vh=[],Kh=[],fm=BigInt(0),Bn=BigInt(1),hm=BigInt(2),dm=BigInt(7),lm=BigInt(256),pm=BigInt(113);for(let t=0,e=Bn,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],jh.push(2*(5*i+r)),Vh.push((t+1)*(t+2)/2%64);let n=fm;for(let s=0;s<7;s++)e=(e<<Bn^(e>>dm)*pm)%lm,e&hm&&(n^=Bn<<(Bn<<BigInt(s))-Bn);Kh.push(n)}const[bm,gm]=tm(Kh,!0),Hh=(t,e,r)=>r>32?nm(t,e,r):rm(t,e,r),Wh=(t,e,r)=>r>32?sm(t,e,r):im(t,e,r);function ym(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],f=r[c+1],d=Hh(u,f,1)^r[a],b=Wh(u,f,1)^r[a+1];for(let v=0;v<50;v+=10)t[o+v]^=d,t[o+v+1]^=b}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=Vh[o],c=Hh(n,s,a),u=Wh(n,s,a),f=jh[o];n=t[f],s=t[f+1],t[f]=c,t[f+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=bm[i],t[1]^=gm[i]}r.fill(0)}class Ta extends Ra{constructor(e,r,i,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ks(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=om(this.state)}keccak(){Uh||qh(this.state32),ym(this.state32,this.rounds),Uh||qh(this.state32),this.posOut=0,this.pos=0}update(e){Gi(this);const{blockLen:r,state:i}=this;e=Vs(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Gi(this,!1),Cn(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ks(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Fh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new Ta(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Gh=((t,e,r)=>zh(()=>new Ta(e,t,r)))(1,136,256/8);function Yh(t,e){const r=e||"hex",i=Gh(Nn(t,{strict:!1})?Yv(t):t);return r==="bytes"?i:Ma(i)}class Xh extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Na=new Xh(8192);function vm(t,e){if(Na.has(`${t}.${e}`))return Na.get(`${t}.${e}`);const r=e?`${e}${t.toLowerCase()}`:t.substring(2).toLowerCase(),i=Yh(Bh(r),"bytes"),n=(e?r.substring(`${e}0x`.length):r).split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(i[o>>1]&15)>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());const s=`0x${n.join("")}`;return Na.set(`${t}.${e}`,s),s}function mm(t){const e=Yh(`0x${t.substring(4)}`).substring(26);return vm(`0x${e}`)}async function wm({hash:t,signature:e}){const r=Nn(t)?t:Ma(t),{secp256k1:i}=await Promise.resolve().then(function(){return ew});return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:u,s:f,v:d,yParity:b}=e,v=Number(b??d),g=Jh(v);return new i.Signature($a(u),$a(f)).addRecoveryBit(g)}const o=Nn(e)?e:Ma(e),a=jv(`0x${o.slice(130)}`),c=Jh(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function Jh(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function _m({hash:t,signature:e}){return mm(await wm({hash:t,signature:e}))}function Em(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function xm(t,e,r){return t&e^~t&r}function Sm(t,e,r){return t&e^t&r^e&r}class Im extends Ra{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Pa(this.buffer)}update(e){Gi(this);const{view:r,buffer:i,blockLen:n}=this;e=Vs(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Pa(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Gi(this),Fh(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let d=o;d<n;d++)r[d]=0;Em(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=Pa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,f[d],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}}const Am=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Hr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Wr=new Uint32Array(64);class Om extends Im{constructor(){super(64,32,8,!1),this.A=Hr[0]|0,this.B=Hr[1]|0,this.C=Hr[2]|0,this.D=Hr[3]|0,this.E=Hr[4]|0,this.F=Hr[5]|0,this.G=Hr[6]|0,this.H=Hr[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let d=0;d<16;d++,r+=4)Wr[d]=e.getUint32(r,!1);for(let d=16;d<64;d++){const b=Wr[d-15],v=Wr[d-2],g=fr(b,7)^fr(b,18)^b>>>3,E=fr(v,17)^fr(v,19)^v>>>10;Wr[d]=E+Wr[d-7]+g+Wr[d-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:u,H:f}=this;for(let d=0;d<64;d++){const b=fr(a,6)^fr(a,11)^fr(a,25),v=f+b+xm(a,c,u)+Am[d]+Wr[d]|0,E=(fr(i,2)^fr(i,13)^fr(i,22))+Sm(i,n,s)|0;f=u,u=c,c=a,a=o+v|0,o=s,s=n,n=i,i=v+E|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(i,n,s,o,a,c,u,f)}roundClean(){Wr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ks=zh(()=>new Om);new Xh(128);const Dm=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Zh=new Uint8Array(new Array(16).fill(0).map((t,e)=>e)),$m=Zh.map(t=>(9*t+5)%16);let Mm=[Zh],Pm=[$m];for(let t=0;t<4;t++)for(let e of[Mm,Pm])e.push(e[t].map(r=>Dm[r]));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Hs=BigInt(0),Ws=BigInt(1),Rm=BigInt(2);function vi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function hr(t){if(!vi(t))throw new Error("Uint8Array expected")}function Xi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Tm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ji(t){hr(t);let e="";for(let r=0;r<t.length;r++)e+=Tm[t[r]];return e}function Zi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Ca(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Hs:BigInt("0x"+t)}const Tr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Qh(t){if(t>=Tr._0&&t<=Tr._9)return t-Tr._0;if(t>=Tr.A&&t<=Tr.F)return t-(Tr.A-10);if(t>=Tr.a&&t<=Tr.f)return t-(Tr.a-10)}function Qi(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=Qh(t.charCodeAt(s)),a=Qh(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function dr(t){return Ca(Ji(t))}function Ba(t){return hr(t),Ca(Ji(Uint8Array.from(t).reverse()))}function Gr(t,e){return Qi(t.toString(16).padStart(e*2,"0"))}function Fa(t,e){return Gr(t,e).reverse()}function Nm(t){return Qi(Zi(t))}function mt(t,e,r){let i;if(typeof e=="string")try{i=Qi(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(vi(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Ft(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];hr(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}function Cm(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}function Gs(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const La=t=>typeof t=="bigint"&&Hs<=t;function en(t,e,r){return La(t)&&La(e)&&La(r)&&e<=t&&t<r}function Yr(t,e,r,i){if(!en(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function ed(t){let e;for(e=0;t>Hs;t>>=Ws,e+=1);return e}function Bm(t,e){return t>>BigInt(e)&Ws}function Fm(t,e,r){return t|(r?Ws:Hs)<<BigInt(e)}const Ua=t=>(Rm<<BigInt(t-1))-Ws,qa=t=>new Uint8Array(t),td=t=>Uint8Array.from(t);function rd(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=qa(t),n=qa(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...d)=>r(n,i,...d),c=(d=qa())=>{n=a(td([0]),d),i=a(),d.length!==0&&(n=a(td([1]),d),i=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const b=[];for(;d<e;){i=a();const v=i.slice();b.push(v),d+=i.length}return Ft(...b)};return(d,b)=>{o(),c(d);let v;for(;!(v=b(u()));)c();return o(),v}}const Lm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||vi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function tn(t,e,r={}){const i=(n,s,o)=>{const a=Lm[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}const Um=()=>{throw new Error("not implemented")};function za(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}var qm=Object.freeze({__proto__:null,isBytes:vi,abytes:hr,abool:Xi,bytesToHex:Ji,numberToHexUnpadded:Zi,hexToNumber:Ca,hexToBytes:Qi,bytesToNumberBE:dr,bytesToNumberLE:Ba,numberToBytesBE:Gr,numberToBytesLE:Fa,numberToVarBytesBE:Nm,ensureBytes:mt,concatBytes:Ft,equalBytes:Cm,utf8ToBytes:Gs,inRange:en,aInRange:Yr,bitLen:ed,bitGet:Bm,bitSet:Fm,bitMask:Ua,createHmacDrbg:rd,validateObject:tn,notImplemented:Um,memoized:za});const zm="0.1.1";function km(){return zm}class It extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof It){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause?.message?r.cause.message:r.details})(),n=r.cause instanceof It&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${n??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||n?["",i?`Details: ${i}`:void 0,n?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${km()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=n,this.shortMessage=e}walk(e){return id(this,e)}}function id(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?id(t.cause,e):e?null:t}function jm(t,e){if(od(t)>e)throw new Jm({givenSize:od(t),maxSize:e})}const Nr={zero:48,nine:57,A:65,F:70,a:97,f:102};function nd(t){if(t>=Nr.zero&&t<=Nr.nine)return t-Nr.zero;if(t>=Nr.A&&t<=Nr.F)return t-(Nr.A-10);if(t>=Nr.a&&t<=Nr.f)return t-(Nr.a-10)}function Vm(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new Zm({size:t.length,targetSize:i,type:"Bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=r==="right";n[o?s:i-s-1]=t[o?s:t.length-s-1]}return n}function ka(t,e){if(Va(t)>e)throw new s3({givenSize:Va(t),maxSize:e})}function sd(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const n=t.replace("0x","");if(n.length>i*2)throw new o3({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const Km=new TextEncoder;function Hm(t){return t instanceof Uint8Array?t:typeof t=="string"?Gm(t):Wm(t)}function Wm(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Gm(t,e={}){const{size:r}=e;let i=t;r&&(ka(t,r),i=ja(t,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=nd(n.charCodeAt(c++)),f=nd(n.charCodeAt(c++));if(u===void 0||f===void 0)throw new It(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);o[a]=u*16+f}return o}function Ym(t,e={}){const{size:r}=e,i=Km.encode(t);return typeof r=="number"?(jm(i,r),Xm(i,r)):i}function Xm(t,e){return Vm(t,{dir:"right",size:e})}function od(t){return t.length}class Jm extends It{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Zm extends It{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}const Qm=new TextEncoder,e3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ad(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function t3(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(ka(r,e.size),Ys(r,e.size)):r}function cd(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=e3[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(ka(i,e.size),ja(i,e.size)):i}function r3(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const u=typeof t=="bigint"?"n":"";throw new n3({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:i,value:`${t}${u}`})}const c=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?Ys(c,i):c}function i3(t,e={}){return cd(Qm.encode(t),e)}function Ys(t,e){return sd(t,{dir:"left",size:e})}function ja(t,e){return sd(t,{dir:"right",size:e})}function Va(t){return Math.ceil((t.length-2)/2)}class n3 extends It{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number \`${s}\` is not in safe${n?` ${n*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class s3 extends It{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class o3 extends It{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function a3(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=Gh(Hm(t));return r==="Bytes"?i:cd(i)}class c3 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Ka={checksum:new c3(8192)}.checksum,u3=/^0x[a-fA-F0-9]{40}$/;function ud(t,e={}){const{strict:r=!0}=e;if(!u3.test(t))throw new fd({address:t,cause:new h3});if(r){if(t.toLowerCase()===t)return;if(f3(t)!==t)throw new fd({address:t,cause:new d3})}}function f3(t){if(Ka.has(t))return Ka.get(t);ud(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=a3(Ym(e),{as:"Bytes"}),i=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&i[s]&&(i[s]=i[s].toUpperCase()),(r[s>>1]&15)>=8&&i[s+1]&&(i[s+1]=i[s+1].toUpperCase());const n=`0x${i.join("")}`;return Ka.set(t,n),n}class fd extends It{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class h3 extends It{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class d3 extends It{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const l3=/^(.*)\[([0-9]*)\]$/,p3=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,b3=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Ha(t,e){if(t.length!==e.length)throw new y3({expectedLength:t.length,givenLength:e.length});const r=[];for(let i=0;i<t.length;i++){const n=t[i],s=e[i];r.push(Ha.encode(n,s))}return ad(...r)}(function(t){function e(r,i,n=!1){if(r==="address"){const c=i;return ud(c),Ys(c.toLowerCase(),n?32:0)}if(r==="string")return i3(i);if(r==="bytes")return i;if(r==="bool")return Ys(t3(i),n?32:1);const s=r.match(b3);if(s){const[c,u,f="256"]=s,d=Number.parseInt(f)/8;return r3(i,{size:n?32:d,signed:u==="int"})}const o=r.match(p3);if(o){const[c,u]=o;if(Number.parseInt(u)!==(i.length-2)/2)throw new g3({expectedSize:Number.parseInt(u),value:i});return ja(i,n?32:0)}const a=r.match(l3);if(a&&Array.isArray(i)){const[c,u]=a,f=[];for(let d=0;d<i.length;d++)f.push(e(u,i[d],!0));return f.length===0?"0x":ad(...f)}throw new v3(r)}t.encode=e})(Ha||(Ha={}));class g3 extends It{constructor({expectedSize:e,value:r}){super(`Size of bytes "${r}" (bytes${Va(r)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class y3 extends It{constructor({expectedLength:e,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class v3 extends It{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class hd extends Ra{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Qv(e);const i=Vs(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Gi(this),this.iHash.update(e),this}digestInto(e){Gi(this),Cn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const dd=(t,e,r)=>new hd(t,e).update(r).digest();dd.create=(t,e)=>new hd(t,e);const nt=BigInt(0),De=BigInt(1),mi=BigInt(2),m3=BigInt(3),Wa=BigInt(4),ld=BigInt(5),pd=BigInt(8);function st(t,e){const r=t%e;return r>=nt?r:e+r}function w3(t,e,r){if(e<nt)throw new Error("invalid exponent, negatives unsupported");if(r<=nt)throw new Error("invalid modulus");if(r===De)return nt;let i=De;for(;e>nt;)e&De&&(i=i*t%r),t=t*t%r,e>>=De;return i}function jt(t,e,r){let i=t;for(;e-- >nt;)i*=i,i%=r;return i}function Ga(t,e){if(t===nt)throw new Error("invert: expected non-zero number");if(e<=nt)throw new Error("invert: expected positive modulus, got "+e);let r=st(t,e),i=e,n=nt,s=De;for(;r!==nt;){const a=i/r,c=i%r,u=n-s*a;i=r,r=c,n=s,s=u}if(i!==De)throw new Error("invert: does not exist");return st(n,e)}function _3(t){const e=(t-De)/mi;let r,i,n;for(r=t-De,i=0;r%mi===nt;r/=mi,i++);for(n=mi;n<t&&w3(n,e,t)!==t-De;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+De)/Wa;return function(c,u){const f=c.pow(u,o);if(!c.eql(c.sqr(f),u))throw new Error("Cannot find square root");return f}}const s=(r+De)/mi;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=i,f=a.pow(a.mul(a.ONE,n),r),d=a.pow(c,s),b=a.pow(c,r);for(;!a.eql(b,a.ONE);){if(a.eql(b,a.ZERO))return a.ZERO;let v=1;for(let E=a.sqr(b);v<u&&!a.eql(E,a.ONE);v++)E=a.sqr(E);const g=a.pow(f,De<<BigInt(u-v-1));f=a.sqr(g),d=a.mul(d,g),b=a.mul(b,f),u=v}return d}}function E3(t){if(t%Wa===m3){const e=(t+De)/Wa;return function(i,n){const s=i.pow(n,e);if(!i.eql(i.sqr(s),n))throw new Error("Cannot find square root");return s}}if(t%pd===ld){const e=(t-ld)/pd;return function(i,n){const s=i.mul(n,mi),o=i.pow(s,e),a=i.mul(n,o),c=i.mul(i.mul(a,mi),o),u=i.mul(a,i.sub(c,i.ONE));if(!i.eql(i.sqr(u),n))throw new Error("Cannot find square root");return u}}return _3(t)}const x3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bd(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=x3.reduce((i,n)=>(i[n]="function",i),e);return tn(t,r)}function S3(t,e,r){if(r<nt)throw new Error("invalid exponent, negatives unsupported");if(r===nt)return t.ONE;if(r===De)return e;let i=t.ONE,n=e;for(;r>nt;)r&De&&(i=t.mul(i,n)),n=t.sqr(n),r>>=De;return i}function I3(t,e){const r=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),n),r}function gd(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function yd(t,e,r=!1,i={}){if(t<=nt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=gd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:Ua(n),ZERO:nt,ONE:De,create:c=>st(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return nt<=c&&c<t},is0:c=>c===nt,isOdd:c=>(c&De)===De,neg:c=>st(-c,t),eql:(c,u)=>c===u,sqr:c=>st(c*c,t),add:(c,u)=>st(c+u,t),sub:(c,u)=>st(c-u,t),mul:(c,u)=>st(c*u,t),pow:(c,u)=>S3(a,c,u),div:(c,u)=>st(c*Ga(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ga(c,t),sqrt:i.sqrt||(c=>(o||(o=E3(t)),o(a,c))),invertBatch:c=>I3(a,c),cmov:(c,u,f)=>f?u:c,toBytes:c=>r?Fa(c,s):Gr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Ba(c):dr(c)}});return Object.freeze(a)}function vd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function md(t){const e=vd(t);return e+Math.ceil(e/2)}function A3(t,e,r=!1){const i=t.length,n=vd(e),s=md(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?Ba(t):dr(t),a=st(o,e-De)+De;return r?Fa(a,n):Gr(a,n)}const wd=BigInt(0),Xs=BigInt(1);function Ya(t,e){const r=e.negate();return t?r:e}function _d(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Xa(t,e){_d(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function O3(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function D3(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Ja=new WeakMap,Ed=new WeakMap;function Za(t){return Ed.get(t)||1}function $3(t,e){return{constTimeNegate:Ya,hasPrecomputes(r){return Za(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>wd;)i&Xs&&(n=n.add(s)),s=s.double(),i>>=Xs;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=Xa(i,e),o=[];let a=r,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let f=1;f<s;f++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=Xa(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),f=2**r,d=BigInt(r);for(let b=0;b<s;b++){const v=b*o;let g=Number(n&u);n>>=d,g>o&&(g-=f,n+=Xs);const E=v,I=v+Math.abs(g)-1,$=b%2!==0,D=g<0;g===0?c=c.add(Ya($,i[E])):a=a.add(Ya(D,i[I]))}return{p:a,f:c}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=Xa(r,e),c=BigInt(2**r-1),u=2**r,f=BigInt(r);for(let d=0;d<o;d++){const b=d*a;if(n===wd)break;let v=Number(n&c);if(n>>=f,v>a&&(v-=u,n+=Xs),v===0)continue;let g=i[b+Math.abs(v)-1];v<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,i,n){let s=Ja.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&Ja.set(i,n(s))),s},wNAFCached(r,i,n){const s=Za(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=Za(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){_d(i,e),Ed.set(r,i),Ja.delete(r)}}}function M3(t,e,r,i){if(O3(r,t),D3(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=ed(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o;let f=n;for(let d=u;d>=0;d-=o){c.fill(n);for(let v=0;v<i.length;v++){const g=i[v],E=Number(g>>BigInt(d)&BigInt(a));c[E]=c[E].add(r[v])}let b=n;for(let v=c.length-1,g=n;v>0;v--)g=g.add(c[v]),b=b.add(g);if(f=f.add(b),d!==0)for(let v=0;v<o;v++)f=f.double()}return f}function xd(t){return bd(t.Fp),tn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Sd(t){t.lowS!==void 0&&Xi("lowS",t.lowS),t.prehash!==void 0&&Xi("prehash",t.prehash)}function P3(t){const e=xd(t);tn(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:R3,hexToBytes:T3}=qm;class N3 extends Error{constructor(e=""){super(e)}}const Cr={Err:N3,_tlv:{encode:(t,e)=>{const{Err:r}=Cr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=Zi(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?Zi(n.length/2|128):"";return Zi(t)+s+n+e},decode(t,e){const{Err:r}=Cr;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const f of u)o=o<<8|f;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Cr;if(t<Qt)throw new e("integer: negative integers are not allowed");let r=Zi(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Cr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return R3(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Cr,n=typeof t=="string"?T3(t):t;hr(n);const{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:u,l:f}=i.decode(2,c);if(f.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Cr,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}},Qt=BigInt(0),ae=BigInt(1),Xr=BigInt(2),Js=BigInt(3),Id=BigInt(4);function C3(t){const e=P3(t),{Fp:r}=e,i=yd(e.n,e.nBitLength),n=e.toBytes||((E,I,$)=>{const D=I.toAffine();return Ft(Uint8Array.from([4]),r.toBytes(D.x),r.toBytes(D.y))}),s=e.fromBytes||(E=>{const I=E.subarray(1),$=r.fromBytes(I.subarray(0,r.BYTES)),D=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:$,y:D}});function o(E){const{a:I,b:$}=e,D=r.sqr(E),M=r.mul(D,E);return r.add(r.add(M,r.mul(E,I)),$)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(E){return en(E,ae,e.n)}function c(E){const{allowedPrivateKeyLengths:I,nByteLength:$,wrapPrivateKey:D,n:M}=e;if(I&&typeof E!="bigint"){if(vi(E)&&(E=Ji(E)),typeof E!="string"||!I.includes(E.length))throw new Error("invalid private key");E=E.padStart($*2,"0")}let P;try{P=typeof E=="bigint"?E:dr(mt("private key",E,$))}catch{throw new Error("invalid private key, expected hex or "+$+" bytes, got "+typeof E)}return D&&(P=st(P,M)),Yr("private key",P,ae,M),P}function u(E){if(!(E instanceof b))throw new Error("ProjectivePoint expected")}const f=za((E,I)=>{const{px:$,py:D,pz:M}=E;if(r.eql(M,r.ONE))return{x:$,y:D};const P=E.is0();I==null&&(I=P?r.ONE:r.inv(M));const T=r.mul($,I),N=r.mul(D,I),C=r.mul(M,I);if(P)return{x:r.ZERO,y:r.ZERO};if(!r.eql(C,r.ONE))throw new Error("invZ was invalid");return{x:T,y:N}}),d=za(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.py))return;throw new Error("bad point: ZERO")}const{x:I,y:$}=E.toAffine();if(!r.isValid(I)||!r.isValid($))throw new Error("bad point: x or y not FE");const D=r.sqr($),M=o(I);if(!r.eql(D,M))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class b{constructor(I,$,D){if(this.px=I,this.py=$,this.pz=D,I==null||!r.isValid(I))throw new Error("x required");if($==null||!r.isValid($))throw new Error("y required");if(D==null||!r.isValid(D))throw new Error("z required");Object.freeze(this)}static fromAffine(I){const{x:$,y:D}=I||{};if(!I||!r.isValid($)||!r.isValid(D))throw new Error("invalid affine point");if(I instanceof b)throw new Error("projective point not allowed");const M=P=>r.eql(P,r.ZERO);return M($)&&M(D)?b.ZERO:new b($,D,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(I){const $=r.invertBatch(I.map(D=>D.pz));return I.map((D,M)=>D.toAffine($[M])).map(b.fromAffine)}static fromHex(I){const $=b.fromAffine(s(mt("pointHex",I)));return $.assertValidity(),$}static fromPrivateKey(I){return b.BASE.multiply(c(I))}static msm(I,$){return M3(b,i,I,$)}_setWindowSize(I){g.setWindowSize(this,I)}assertValidity(){d(this)}hasEvenY(){const{y:I}=this.toAffine();if(r.isOdd)return!r.isOdd(I);throw new Error("Field doesn't support isOdd")}equals(I){u(I);const{px:$,py:D,pz:M}=this,{px:P,py:T,pz:N}=I,C=r.eql(r.mul($,N),r.mul(P,M)),B=r.eql(r.mul(D,N),r.mul(T,M));return C&&B}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){const{a:I,b:$}=e,D=r.mul($,Js),{px:M,py:P,pz:T}=this;let N=r.ZERO,C=r.ZERO,B=r.ZERO,R=r.mul(M,M),V=r.mul(P,P),A=r.mul(T,T),h=r.mul(M,P);return h=r.add(h,h),B=r.mul(M,T),B=r.add(B,B),N=r.mul(I,B),C=r.mul(D,A),C=r.add(N,C),N=r.sub(V,C),C=r.add(V,C),C=r.mul(N,C),N=r.mul(h,N),B=r.mul(D,B),A=r.mul(I,A),h=r.sub(R,A),h=r.mul(I,h),h=r.add(h,B),B=r.add(R,R),R=r.add(B,R),R=r.add(R,A),R=r.mul(R,h),C=r.add(C,R),A=r.mul(P,T),A=r.add(A,A),R=r.mul(A,h),N=r.sub(N,R),B=r.mul(A,V),B=r.add(B,B),B=r.add(B,B),new b(N,C,B)}add(I){u(I);const{px:$,py:D,pz:M}=this,{px:P,py:T,pz:N}=I;let C=r.ZERO,B=r.ZERO,R=r.ZERO;const V=e.a,A=r.mul(e.b,Js);let h=r.mul($,P),p=r.mul(D,T),m=r.mul(M,N),y=r.add($,D),w=r.add(P,T);y=r.mul(y,w),w=r.add(h,p),y=r.sub(y,w),w=r.add($,M);let S=r.add(P,N);return w=r.mul(w,S),S=r.add(h,m),w=r.sub(w,S),S=r.add(D,M),C=r.add(T,N),S=r.mul(S,C),C=r.add(p,m),S=r.sub(S,C),R=r.mul(V,w),C=r.mul(A,m),R=r.add(C,R),C=r.sub(p,R),R=r.add(p,R),B=r.mul(C,R),p=r.add(h,h),p=r.add(p,h),m=r.mul(V,m),w=r.mul(A,w),p=r.add(p,m),m=r.sub(h,m),m=r.mul(V,m),w=r.add(w,m),h=r.mul(p,w),B=r.add(B,h),h=r.mul(S,w),C=r.mul(y,C),C=r.sub(C,h),h=r.mul(y,p),R=r.mul(S,R),R=r.add(R,h),new b(C,B,R)}subtract(I){return this.add(I.negate())}is0(){return this.equals(b.ZERO)}wNAF(I){return g.wNAFCached(this,I,b.normalizeZ)}multiplyUnsafe(I){const{endo:$,n:D}=e;Yr("scalar",I,Qt,D);const M=b.ZERO;if(I===Qt)return M;if(this.is0()||I===ae)return this;if(!$||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,I,b.normalizeZ);let{k1neg:P,k1:T,k2neg:N,k2:C}=$.splitScalar(I),B=M,R=M,V=this;for(;T>Qt||C>Qt;)T&ae&&(B=B.add(V)),C&ae&&(R=R.add(V)),V=V.double(),T>>=ae,C>>=ae;return P&&(B=B.negate()),N&&(R=R.negate()),R=new b(r.mul(R.px,$.beta),R.py,R.pz),B.add(R)}multiply(I){const{endo:$,n:D}=e;Yr("scalar",I,ae,D);let M,P;if($){const{k1neg:T,k1:N,k2neg:C,k2:B}=$.splitScalar(I);let{p:R,f:V}=this.wNAF(N),{p:A,f:h}=this.wNAF(B);R=g.constTimeNegate(T,R),A=g.constTimeNegate(C,A),A=new b(r.mul(A.px,$.beta),A.py,A.pz),M=R.add(A),P=V.add(h)}else{const{p:T,f:N}=this.wNAF(I);M=T,P=N}return b.normalizeZ([M,P])[0]}multiplyAndAddUnsafe(I,$,D){const M=b.BASE,P=(N,C)=>C===Qt||C===ae||!N.equals(M)?N.multiplyUnsafe(C):N.multiply(C),T=P(this,$).add(P(I,D));return T.is0()?void 0:T}toAffine(I){return f(this,I)}isTorsionFree(){const{h:I,isTorsionFree:$}=e;if(I===ae)return!0;if($)return $(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:I,clearCofactor:$}=e;return I===ae?this:$?$(b,this):this.multiplyUnsafe(e.h)}toRawBytes(I=!0){return Xi("isCompressed",I),this.assertValidity(),n(b,this,I)}toHex(I=!0){return Xi("isCompressed",I),Ji(this.toRawBytes(I))}}b.BASE=new b(e.Gx,e.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO);const v=e.nBitLength,g=$3(b,e.endo?Math.ceil(v/2):v);return{CURVE:e,ProjectivePoint:b,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function B3(t){const e=xd(t);return tn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function F3(t){const e=B3(t),{Fp:r,n:i}=e,n=r.BYTES+1,s=2*r.BYTES+1;function o(m){return st(m,i)}function a(m){return Ga(m,i)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:d}=C3({...e,toBytes(m,y,w){const S=y.toAffine(),O=r.toBytes(S.x),_=Ft;return Xi("isCompressed",w),w?_(Uint8Array.from([y.hasEvenY()?2:3]),O):_(Uint8Array.from([4]),O,r.toBytes(S.y))},fromBytes(m){const y=m.length,w=m[0],S=m.subarray(1);if(y===n&&(w===2||w===3)){const O=dr(S);if(!en(O,ae,r.ORDER))throw new Error("Point is not on curve");const _=f(O);let l;try{l=r.sqrt(_)}catch(L){const U=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+U)}const x=(l&ae)===ae;return(w&1)===1!==x&&(l=r.neg(l)),{x:O,y:l}}else if(y===s&&w===4){const O=r.fromBytes(S.subarray(0,r.BYTES)),_=r.fromBytes(S.subarray(r.BYTES,2*r.BYTES));return{x:O,y:_}}else{const O=n,_=s;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+_+", got "+y)}}}),b=m=>Ji(Gr(m,e.nByteLength));function v(m){const y=i>>ae;return m>y}function g(m){return v(m)?o(-m):m}const E=(m,y,w)=>dr(m.slice(y,w));class I{constructor(y,w,S){this.r=y,this.s=w,this.recovery=S,this.assertValidity()}static fromCompact(y){const w=e.nByteLength;return y=mt("compactSignature",y,w*2),new I(E(y,0,w),E(y,w,2*w))}static fromDER(y){const{r:w,s:S}=Cr.toSig(mt("DER",y));return new I(w,S)}assertValidity(){Yr("r",this.r,ae,i),Yr("s",this.s,ae,i)}addRecoveryBit(y){return new I(this.r,this.s,y)}recoverPublicKey(y){const{r:w,s:S,recovery:O}=this,_=N(mt("msgHash",y));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const l=O===2||O===3?w+e.n:w;if(l>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const x=(O&1)===0?"02":"03",F=c.fromHex(x+b(l)),L=a(l),U=o(-_*L),j=o(S*L),K=c.BASE.multiplyAndAddUnsafe(F,U,j);if(!K)throw new Error("point at infinify");return K.assertValidity(),K}hasHighS(){return v(this.s)}normalizeS(){return this.hasHighS()?new I(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Qi(this.toDERHex())}toDERHex(){return Cr.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Qi(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const $={isValidPrivateKey(m){try{return u(m),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const m=md(e.n);return A3(e.randomBytes(m),e.n)},precompute(m=8,y=c.BASE){return y._setWindowSize(m),y.multiply(BigInt(3)),y}};function D(m,y=!0){return c.fromPrivateKey(m).toRawBytes(y)}function M(m){const y=vi(m),w=typeof m=="string",S=(y||w)&&m.length;return y?S===n||S===s:w?S===2*n||S===2*s:m instanceof c}function P(m,y,w=!0){if(M(m))throw new Error("first arg must be private key");if(!M(y))throw new Error("second arg must be public key");return c.fromHex(y).multiply(u(m)).toRawBytes(w)}const T=e.bits2int||function(m){if(m.length>8192)throw new Error("input is too large");const y=dr(m),w=m.length*8-e.nBitLength;return w>0?y>>BigInt(w):y},N=e.bits2int_modN||function(m){return o(T(m))},C=Ua(e.nBitLength);function B(m){return Yr("num < 2^"+e.nBitLength,m,Qt,C),Gr(m,e.nByteLength)}function R(m,y,w=V){if(["recovered","canonical"].some(J=>J in w))throw new Error("sign() legacy options not supported");const{hash:S,randomBytes:O}=e;let{lowS:_,prehash:l,extraEntropy:x}=w;_==null&&(_=!0),m=mt("msgHash",m),Sd(w),l&&(m=mt("prehashed msgHash",S(m)));const F=N(m),L=u(y),U=[B(L),B(F)];if(x!=null&&x!==!1){const J=x===!0?O(r.BYTES):x;U.push(mt("extraEntropy",J))}const j=Ft(...U),K=F;function W(J){const H=T(J);if(!d(H))return;const G=a(H),Pe=c.BASE.multiply(H).toAffine(),Q=o(Pe.x);if(Q===Qt)return;const ne=o(G*o(K+Q*L));if(ne===Qt)return;let xt=(Pe.x===Q?0:2)|Number(Pe.y&ae),fe=ne;return _&&v(ne)&&(fe=g(ne),xt^=1),new I(Q,fe,xt)}return{seed:j,k2sig:W}}const V={lowS:e.lowS,prehash:!1},A={lowS:e.lowS,prehash:!1};function h(m,y,w=V){const{seed:S,k2sig:O}=R(m,y,w),_=e;return rd(_.hash.outputLen,_.nByteLength,_.hmac)(S,O)}c.BASE._setWindowSize(8);function p(m,y,w,S=A){const O=m;y=mt("msgHash",y),w=mt("publicKey",w);const{lowS:_,prehash:l,format:x}=S;if(Sd(S),"strict"in S)throw new Error("options.strict was renamed to lowS");if(x!==void 0&&x!=="compact"&&x!=="der")throw new Error("format must be compact or der");const F=typeof O=="string"||vi(O),L=!F&&!x&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!F&&!L)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let U,j;try{if(L&&(U=new I(O.r,O.s)),F){try{x!=="compact"&&(U=I.fromDER(O))}catch(xt){if(!(xt instanceof Cr.Err))throw xt}!U&&x!=="der"&&(U=I.fromCompact(O))}j=c.fromHex(w)}catch{return!1}if(!U||_&&U.hasHighS())return!1;l&&(y=e.hash(y));const{r:K,s:W}=U,J=N(y),H=a(W),G=o(J*H),Pe=o(K*H),Q=c.BASE.multiplyAndAddUnsafe(j,G,Pe)?.toAffine();return Q?o(Q.x)===K:!1}return{CURVE:e,getPublicKey:D,getSharedSecret:P,sign:h,verify:p,ProjectivePoint:c,Signature:I,utils:$}}function L3(t,e){const r=t.ORDER;let i=Qt;for(let g=r-ae;g%Xr===Qt;g/=Xr)i+=ae;const n=i,s=Xr<<n-ae-ae,o=s*Xr,a=(r-ae)/o,c=(a-ae)/Xr,u=o-ae,f=s,d=t.pow(e,a),b=t.pow(e,(a+ae)/Xr);let v=(g,E)=>{let I=d,$=t.pow(E,u),D=t.sqr($);D=t.mul(D,E);let M=t.mul(g,D);M=t.pow(M,c),M=t.mul(M,$),$=t.mul(M,E),D=t.mul(M,g);let P=t.mul(D,$);M=t.pow(P,f);let T=t.eql(M,t.ONE);$=t.mul(D,b),M=t.mul(P,I),D=t.cmov($,D,T),P=t.cmov(M,P,T);for(let N=n;N>ae;N--){let C=N-Xr;C=Xr<<C-ae;let B=t.pow(P,C);const R=t.eql(B,t.ONE);$=t.mul(D,I),I=t.mul(I,I),B=t.mul(P,I),D=t.cmov($,D,R),P=t.cmov(B,P,R)}return{isValid:T,value:D}};if(t.ORDER%Id===Js){const g=(t.ORDER-Js)/Id,E=t.sqrt(t.neg(e));v=(I,$)=>{let D=t.sqr($);const M=t.mul(I,$);D=t.mul(D,M);let P=t.pow(D,g);P=t.mul(P,M);const T=t.mul(P,E),N=t.mul(t.sqr(P),$),C=t.eql(N,I);let B=t.cmov(T,P,C);return{isValid:C,value:B}}}return v}function U3(t,e){if(bd(t),!t.isValid(e.A)||!t.isValid(e.B)||!t.isValid(e.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const r=L3(t,e.Z);if(!t.isOdd)throw new Error("Fp.isOdd is not implemented!");return i=>{let n,s,o,a,c,u,f,d;n=t.sqr(i),n=t.mul(n,e.Z),s=t.sqr(n),s=t.add(s,n),o=t.add(s,t.ONE),o=t.mul(o,e.B),a=t.cmov(e.Z,t.neg(s),!t.eql(s,t.ZERO)),a=t.mul(a,e.A),s=t.sqr(o),u=t.sqr(a),c=t.mul(u,e.A),s=t.add(s,c),s=t.mul(s,o),u=t.mul(u,a),c=t.mul(u,e.B),s=t.add(s,c),f=t.mul(n,o);const{isValid:b,value:v}=r(s,u);d=t.mul(n,i),d=t.mul(d,v),f=t.cmov(f,o,b),d=t.cmov(d,v,b);const g=t.isOdd(i)===t.isOdd(d);return d=t.cmov(t.neg(d),d,g),f=t.div(f,a),{x:f,y:d}}}function q3(t){return{hash:t,hmac:(e,...r)=>dd(t,e,um(...r)),randomBytes:kh}}function z3(t,e){const r=i=>F3({...t,...q3(i)});return{...r(e),create:r}}const k3=dr;function Jr(t,e){if(Fn(t),Fn(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);const r=Array.from({length:e}).fill(0);for(let i=e-1;i>=0;i--)r[i]=t&255,t>>>=8;return new Uint8Array(r)}function j3(t,e){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t[i]^e[i];return r}function Fn(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function V3(t,e,r,i){hr(t),hr(e),Fn(r),e.length>255&&(e=i(Ft(Gs("H2C-OVERSIZE-DST-"),e)));const{outputLen:n,blockLen:s}=i,o=Math.ceil(r/n);if(r>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=Ft(e,Jr(e.length,1)),c=Jr(0,s),u=Jr(r,2),f=new Array(o),d=i(Ft(c,t,u,Jr(0,1),a));f[0]=i(Ft(d,Jr(1,1),a));for(let v=1;v<=o;v++){const g=[j3(d,f[v-1]),Jr(v+1,1),a];f[v]=i(Ft(...g))}return Ft(...f).slice(0,r)}function K3(t,e,r,i,n){if(hr(t),hr(e),Fn(r),e.length>255){const s=Math.ceil(2*i/8);e=n.create({dkLen:s}).update(Gs("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return n.create({dkLen:r}).update(t).update(Jr(r,2)).update(e).update(Jr(e.length,1)).digest()}function Ad(t,e,r){tn(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:i,k:n,m:s,hash:o,expand:a,DST:c}=r;hr(t),Fn(e);const u=typeof c=="string"?Gs(c):c,f=i.toString(2).length,d=Math.ceil((f+n)/8),b=e*s*d;let v;if(a==="xmd")v=V3(t,u,b,o);else if(a==="xof")v=K3(t,u,b,n,o);else if(a==="_internal_pass")v=t;else throw new Error('expand must be "xmd" or "xof"');const g=new Array(e);for(let E=0;E<e;E++){const I=new Array(s);for(let $=0;$<s;$++){const D=d*($+E*s),M=v.subarray(D,D+d);I[$]=st(k3(M),i)}g[E]=I}return g}function H3(t,e){const r=e.map(i=>Array.from(i).reverse());return(i,n)=>{const[s,o,a,c]=r.map(u=>u.reduce((f,d)=>t.add(t.mul(f,i),d)));return i=t.div(s,o),n=t.mul(n,t.div(a,c)),{x:i,y:n}}}function W3(t,e,r){if(typeof e!="function")throw new Error("mapToCurve() must be defined");return{hashToCurve(i,n){const s=Ad(i,2,{...r,DST:r.DST,...n}),o=t.fromAffine(e(s[0])),a=t.fromAffine(e(s[1])),c=o.add(a).clearCofactor();return c.assertValidity(),c},encodeToCurve(i,n){const s=Ad(i,1,{...r,DST:r.encodeDST,...n}),o=t.fromAffine(e(s[0])).clearCofactor();return o.assertValidity(),o},mapToCurve(i){if(!Array.isArray(i))throw new Error("mapToCurve: expected array of bigints");for(const s of i)if(typeof s!="bigint")throw new Error("mapToCurve: expected array of bigints");const n=t.fromAffine(e(i)).clearCofactor();return n.assertValidity(),n}}}const Ln=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Zs=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Un=BigInt(1),Qs=BigInt(2),Od=(t,e)=>(t+e/Qs)/e;function Dd(t){const e=Ln,r=BigInt(3),i=BigInt(6),n=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,f=u*u*t%e,d=jt(f,r,e)*f%e,b=jt(d,r,e)*f%e,v=jt(b,Qs,e)*u%e,g=jt(v,n,e)*v%e,E=jt(g,s,e)*g%e,I=jt(E,a,e)*E%e,$=jt(I,c,e)*I%e,D=jt($,a,e)*E%e,M=jt(D,r,e)*f%e,P=jt(M,o,e)*g%e,T=jt(P,i,e)*u%e,N=jt(T,Qs,e);if(!Zr.eql(Zr.sqr(N),t))throw new Error("Cannot find square root");return N}const Zr=yd(Ln,void 0,void 0,{sqrt:Dd}),qn=z3({a:BigInt(0),b:BigInt(7),Fp:Zr,n:Zs,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Zs,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Un*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=Od(s*t,e),c=Od(-i*t,e);let u=st(t-a*r-c*n,e),f=st(-a*i-c*s,e);const d=u>o,b=f>o;if(d&&(u=e-u),b&&(f=e-f),u>o||f>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:u,k2neg:b,k2:f}}}},Ks),$d=BigInt(0),Md={};function eo(t,...e){let r=Md[t];if(r===void 0){const i=Ks(Uint8Array.from(t,n=>n.charCodeAt(0)));r=Ft(i,i),Md[t]=r}return Ks(Ft(r,...e))}const Qa=t=>t.toRawBytes(!0).slice(1),ec=t=>Gr(t,32),tc=t=>st(t,Ln),zn=t=>st(t,Zs),rc=qn.ProjectivePoint,G3=(t,e,r)=>rc.BASE.multiplyAndAddUnsafe(t,e,r);function ic(t){let e=qn.utils.normPrivateKeyToScalar(t),r=rc.fromPrivateKey(e);return{scalar:r.hasEvenY()?e:zn(-e),bytes:Qa(r)}}function Pd(t){Yr("x",t,Un,Ln);const e=tc(t*t),r=tc(e*t+BigInt(7));let i=Dd(r);i%Qs!==$d&&(i=tc(-i));const n=new rc(t,i,Un);return n.assertValidity(),n}const rn=dr;function Rd(...t){return zn(rn(eo("BIP0340/challenge",...t)))}function Y3(t){return ic(t).bytes}function X3(t,e,r=kh(32)){const i=mt("message",t),{bytes:n,scalar:s}=ic(e),o=mt("auxRand",r,32),a=ec(s^rn(eo("BIP0340/aux",o))),c=eo("BIP0340/nonce",a,n,i),u=zn(rn(c));if(u===$d)throw new Error("sign failed: k is zero");const{bytes:f,scalar:d}=ic(u),b=Rd(f,n,i),v=new Uint8Array(64);if(v.set(f,0),v.set(ec(zn(d+b*s)),32),!Td(v,i,n))throw new Error("sign: Invalid signature produced");return v}function Td(t,e,r){const i=mt("signature",t,64),n=mt("message",e),s=mt("publicKey",r,32);try{const o=Pd(rn(s)),a=rn(i.subarray(0,32));if(!en(a,Un,Ln))return!1;const c=rn(i.subarray(32,64));if(!en(c,Un,Zs))return!1;const u=Rd(ec(a),Qa(o),n),f=G3(o,c,zn(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==a)}catch{return!1}}const J3={getPublicKey:Y3,sign:X3,verify:Td,utils:{randomPrivateKey:qn.utils.randomPrivateKey,lift_x:Pd,pointToBytes:Qa,numberToBytesBE:Gr,bytesToNumberBE:dr,taggedHash:eo,mod:st}},Z3=H3(Zr,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),Q3=U3(Zr,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:Zr.create(BigInt("-11"))}),Nd=W3(qn.ProjectivePoint,t=>{const{x:e,y:r}=Q3(Zr.create(t[0]));return Z3(e,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:Zr.ORDER,m:1,k:128,expand:"xmd",hash:Ks});var ew=Object.freeze({__proto__:null,secp256k1:qn,schnorr:J3,hashToCurve:Nd.hashToCurve,encodeToCurve:Nd.encodeToCurve});function tw(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const f=t.charAt(u),d=f.charCodeAt(0);if(e[d]!==255)throw new TypeError(f+" is ambiguous");e[d]=u}const r=t.length,i=t.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let f=0,d=0,b=0;const v=u.length;for(;b!==v&&u[b]===0;)b++,f++;const g=(v-b)*s+1>>>0,E=new Uint8Array(g);for(;b!==v;){let D=u[b],M=0;for(let P=g-1;(D!==0||M<d)&&P!==-1;P--,M++)D+=256*E[P]>>>0,E[P]=D%r>>>0,D=D/r>>>0;if(D!==0)throw new Error("Non-zero carry");d=M,b++}let I=g-d;for(;I!==g&&E[I]===0;)I++;let $=i.repeat(f);for(;I<g;++I)$+=t.charAt(E[I]);return $}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let f=0,d=0,b=0;for(;u[f]===i;)d++,f++;const v=(u.length-f)*n+1>>>0,g=new Uint8Array(v);for(;u[f];){let D=e[u.charCodeAt(f)];if(D===255)return;let M=0;for(let P=v-1;(D!==0||M<b)&&P!==-1;P--,M++)D+=r*g[P]>>>0,g[P]=D%256>>>0,D=D/256>>>0;if(D!==0)throw new Error("Non-zero carry");b=M,f++}let E=v-b;for(;E!==v&&g[E]===0;)E++;const I=new Uint8Array(d+(v-E));let $=d;for(;E!==v;)I[$++]=g[E++];return I}function c(u){const f=a(u);if(f)return f;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var rw="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",iw=tw(rw);function Cd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function nc(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Cd(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return r}function nw(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var E=0,I=0,$=0,D=g.length;$!==D&&g[$]===0;)$++,E++;for(var M=(D-$)*f+1>>>0,P=new Uint8Array(M);$!==D;){for(var T=g[$],N=0,C=M-1;(T!==0||N<I)&&C!==-1;C--,N++)T+=256*P[C]>>>0,P[C]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");I=N,$++}for(var B=M-I;B!==M&&P[B]===0;)B++;for(var R=c.repeat(E);B<M;++B)R+=t.charAt(P[B]);return R}function b(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var E=0;if(g[E]!==" "){for(var I=0,$=0;g[E]===c;)I++,E++;for(var D=(g.length-E)*u+1>>>0,M=new Uint8Array(D);g[E];){var P=r[g.charCodeAt(E)];if(P===255)return;for(var T=0,N=D-1;(P!==0||T<$)&&N!==-1;N--,T++)P+=a*M[N]>>>0,M[N]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");$=T,E++}if(g[E]!==" "){for(var C=D-$;C!==D&&M[C]===0;)C++;for(var B=new Uint8Array(I+(D-C)),R=I;C!==D;)B[R++]=M[C++];return B}}}function v(g){var E=b(g);if(E)return E;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:b,decode:v}}var sw=nw,ow=sw;const Bd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},aw=t=>new TextEncoder().encode(t),cw=t=>new TextDecoder().decode(t);class uw{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class fw{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Fd(this,e)}}class hw{constructor(e){this.decoders=e}or(e){return Fd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Fd=(t,e)=>new hw({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class dw{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new uw(e,r,i),this.decoder=new fw(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const to=({name:t,prefix:e,encode:r,decode:i})=>new dw(t,e,r,i),kn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=ow(r,e);return to({prefix:t,name:e,encode:i,decode:s=>Bd(n(s))})},lw=(t,e,r,i)=>{const n={};for(let f=0;f<e.length;++f)n[e[f]]=f;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let f=0;f<s;++f){const d=n[t[f]];if(d===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|d,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},pw=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},dt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>to({prefix:e,name:t,encode(n){return pw(n,i,r)},decode(n){return lw(n,i,r,t)}}),bw=to({prefix:"\0",name:"identity",encode:t=>cw(t),decode:t=>aw(t)});var gw=Object.freeze({__proto__:null,identity:bw});const yw=dt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var vw=Object.freeze({__proto__:null,base2:yw});const mw=dt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ww=Object.freeze({__proto__:null,base8:mw});const _w=kn({prefix:"9",name:"base10",alphabet:"0123456789"});var Ew=Object.freeze({__proto__:null,base10:_w});const xw=dt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Sw=dt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Iw=Object.freeze({__proto__:null,base16:xw,base16upper:Sw});const Aw=dt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ow=dt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Dw=dt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$w=dt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Mw=dt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Pw=dt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Rw=dt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Tw=dt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Nw=dt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Cw=Object.freeze({__proto__:null,base32:Aw,base32upper:Ow,base32pad:Dw,base32padupper:$w,base32hex:Mw,base32hexupper:Pw,base32hexpad:Rw,base32hexpadupper:Tw,base32z:Nw});const Bw=kn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Fw=kn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Lw=Object.freeze({__proto__:null,base36:Bw,base36upper:Fw});const Uw=kn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qw=kn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var zw=Object.freeze({__proto__:null,base58btc:Uw,base58flickr:qw});const kw=dt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),jw=dt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Vw=dt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Kw=dt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Hw=Object.freeze({__proto__:null,base64:kw,base64pad:jw,base64url:Vw,base64urlpad:Kw});const Ld=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ww=Ld.reduce((t,e,r)=>(t[r]=e,t),[]),Gw=Ld.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Yw(t){return t.reduce((e,r)=>(e+=Ww[r],e),"")}function Xw(t){const e=[];for(const r of t){const i=Gw[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Jw=to({prefix:"\u{1F680}",name:"base256emoji",encode:Yw,decode:Xw});var Zw=Object.freeze({__proto__:null,base256emoji:Jw}),Qw=qd,Ud=128,e6=127,t6=~e6,r6=Math.pow(2,31);function qd(t,e,r){e=e||[],r=r||0;for(var i=r;t>=r6;)e[r++]=t&255|Ud,t/=128;for(;t&t6;)e[r++]=t&255|Ud,t>>>=7;return e[r]=t|0,qd.bytes=r-i+1,e}var i6=sc,n6=128,zd=127;function sc(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw sc.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&zd)<<n:(o&zd)*Math.pow(2,n),n+=7}while(o>=n6);return sc.bytes=s-i,r}var s6=Math.pow(2,7),o6=Math.pow(2,14),a6=Math.pow(2,21),c6=Math.pow(2,28),u6=Math.pow(2,35),f6=Math.pow(2,42),h6=Math.pow(2,49),d6=Math.pow(2,56),l6=Math.pow(2,63),p6=function(t){return t<s6?1:t<o6?2:t<a6?3:t<c6?4:t<u6?5:t<f6?6:t<h6?7:t<d6?8:t<l6?9:10},b6={encode:Qw,decode:i6,encodingLength:p6},kd=b6;const jd=(t,e,r=0)=>(kd.encode(t,e,r),e),Vd=t=>kd.encodingLength(t),oc=(t,e)=>{const r=e.byteLength,i=Vd(t),n=i+Vd(r),s=new Uint8Array(n+r);return jd(t,s,0),jd(r,s,i),s.set(e,n),new g6(t,r,e,s)};class g6{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Kd=({name:t,code:e,encode:r})=>new y6(t,e,r);class y6{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?oc(this.code,r):r.then(i=>oc(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Hd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),v6=Kd({name:"sha2-256",code:18,encode:Hd("SHA-256")}),m6=Kd({name:"sha2-512",code:19,encode:Hd("SHA-512")});var w6=Object.freeze({__proto__:null,sha256:v6,sha512:m6});const Wd=0,_6="identity",Gd=Bd;var E6=Object.freeze({__proto__:null,identity:{code:Wd,name:_6,encode:Gd,digest:t=>oc(Wd,Gd(t))}});new TextEncoder,new TextDecoder;const Yd={...gw,...vw,...ww,...Ew,...Iw,...Cw,...Lw,...zw,...Hw,...Zw};({...w6,...E6});function Xd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Jd=Xd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ac=Xd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Cd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Zd={utf8:Jd,"utf-8":Jd,hex:Yd.base16,latin1:ac,ascii:ac,binary:ac,...Yd};function Vt(t,e="utf8"){const r=Zd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function At(t,e="utf8"){const r=Zd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var Qd={},x6="elliptic",S6="6.6.1",I6="EC cryptography",A6="lib/elliptic.js",O6=["lib"],D6={lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},$6={type:"git",url:"git@github.com:indutny/elliptic"},M6=["EC","Elliptic","curve","Cryptography"],P6="Fedor Indutny <fedor@indutny.com>",R6="MIT",T6={url:"https://github.com/indutny/elliptic/issues"},N6="https://github.com/indutny/elliptic",C6={brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},B6={"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"},F6={name:x6,version:S6,description:I6,main:A6,files:O6,scripts:D6,repository:$6,keywords:M6,author:P6,license:R6,bugs:T6,homepage:N6,devDependencies:C6,dependencies:B6},Lt={},lr={exports:{}},L6={},U6=Object.freeze({__proto__:null,default:L6}),el=jo(U6);(function(t){(function(e,r){function i(A,h){if(!A)throw new Error(h||"Assertion failed")}function n(A,h){A.super_=h;var p=function(){};p.prototype=h.prototype,A.prototype=new p,A.prototype.constructor=A}function s(A,h,p){if(s.isBN(A))return A;this.negative=0,this.words=null,this.length=0,this.red=null,A!==null&&((h==="le"||h==="be")&&(p=h,h=10),this._init(A||0,h||10,p||"be"))}typeof e=="object"?e.exports=s:r.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=el.Buffer}catch{}s.isBN=function(h){return h instanceof s?!0:h!==null&&typeof h=="object"&&h.constructor.wordSize===s.wordSize&&Array.isArray(h.words)},s.max=function(h,p){return h.cmp(p)>0?h:p},s.min=function(h,p){return h.cmp(p)<0?h:p},s.prototype._init=function(h,p,m){if(typeof h=="number")return this._initNumber(h,p,m);if(typeof h=="object")return this._initArray(h,p,m);p==="hex"&&(p=16),i(p===(p|0)&&p>=2&&p<=36),h=h.toString().replace(/\s+/g,"");var y=0;h[0]==="-"&&(y++,this.negative=1),y<h.length&&(p===16?this._parseHex(h,y,m):(this._parseBase(h,p,y),m==="le"&&this._initArray(this.toArray(),p,m)))},s.prototype._initNumber=function(h,p,m){h<0&&(this.negative=1,h=-h),h<67108864?(this.words=[h&67108863],this.length=1):h<4503599627370496?(this.words=[h&67108863,h/67108864&67108863],this.length=2):(i(h<9007199254740992),this.words=[h&67108863,h/67108864&67108863,1],this.length=3),m==="le"&&this._initArray(this.toArray(),p,m)},s.prototype._initArray=function(h,p,m){if(i(typeof h.length=="number"),h.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(h.length/3),this.words=new Array(this.length);for(var y=0;y<this.length;y++)this.words[y]=0;var w,S,O=0;if(m==="be")for(y=h.length-1,w=0;y>=0;y-=3)S=h[y]|h[y-1]<<8|h[y-2]<<16,this.words[w]|=S<<O&67108863,this.words[w+1]=S>>>26-O&67108863,O+=24,O>=26&&(O-=26,w++);else if(m==="le")for(y=0,w=0;y<h.length;y+=3)S=h[y]|h[y+1]<<8|h[y+2]<<16,this.words[w]|=S<<O&67108863,this.words[w+1]=S>>>26-O&67108863,O+=24,O>=26&&(O-=26,w++);return this.strip()};function a(A,h){var p=A.charCodeAt(h);return p>=65&&p<=70?p-55:p>=97&&p<=102?p-87:p-48&15}function c(A,h,p){var m=a(A,p);return p-1>=h&&(m|=a(A,p-1)<<4),m}s.prototype._parseHex=function(h,p,m){this.length=Math.ceil((h.length-p)/6),this.words=new Array(this.length);for(var y=0;y<this.length;y++)this.words[y]=0;var w=0,S=0,O;if(m==="be")for(y=h.length-1;y>=p;y-=2)O=c(h,p,y)<<w,this.words[S]|=O&67108863,w>=18?(w-=18,S+=1,this.words[S]|=O>>>26):w+=8;else{var _=h.length-p;for(y=_%2===0?p+1:p;y<h.length;y+=2)O=c(h,p,y)<<w,this.words[S]|=O&67108863,w>=18?(w-=18,S+=1,this.words[S]|=O>>>26):w+=8}this.strip()};function u(A,h,p,m){for(var y=0,w=Math.min(A.length,p),S=h;S<w;S++){var O=A.charCodeAt(S)-48;y*=m,O>=49?y+=O-49+10:O>=17?y+=O-17+10:y+=O}return y}s.prototype._parseBase=function(h,p,m){this.words=[0],this.length=1;for(var y=0,w=1;w<=67108863;w*=p)y++;y--,w=w/p|0;for(var S=h.length-m,O=S%y,_=Math.min(S,S-O)+m,l=0,x=m;x<_;x+=y)l=u(h,x,x+y,p),this.imuln(w),this.words[0]+l<67108864?this.words[0]+=l:this._iaddn(l);if(O!==0){var F=1;for(l=u(h,x,h.length,p),x=0;x<O;x++)F*=p;this.imuln(F),this.words[0]+l<67108864?this.words[0]+=l:this._iaddn(l)}this.strip()},s.prototype.copy=function(h){h.words=new Array(this.length);for(var p=0;p<this.length;p++)h.words[p]=this.words[p];h.length=this.length,h.negative=this.negative,h.red=this.red},s.prototype.clone=function(){var h=new s(null);return this.copy(h),h},s.prototype._expand=function(h){for(;this.length<h;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],b=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(h,p){h=h||10,p=p|0||1;var m;if(h===16||h==="hex"){m="";for(var y=0,w=0,S=0;S<this.length;S++){var O=this.words[S],_=((O<<y|w)&16777215).toString(16);w=O>>>24-y&16777215,y+=2,y>=26&&(y-=26,S--),w!==0||S!==this.length-1?m=f[6-_.length]+_+m:m=_+m}for(w!==0&&(m=w.toString(16)+m);m.length%p!==0;)m="0"+m;return this.negative!==0&&(m="-"+m),m}if(h===(h|0)&&h>=2&&h<=36){var l=d[h],x=b[h];m="";var F=this.clone();for(F.negative=0;!F.isZero();){var L=F.modn(x).toString(h);F=F.idivn(x),F.isZero()?m=L+m:m=f[l-L.length]+L+m}for(this.isZero()&&(m="0"+m);m.length%p!==0;)m="0"+m;return this.negative!==0&&(m="-"+m),m}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var h=this.words[0];return this.length===2?h+=this.words[1]*67108864:this.length===3&&this.words[2]===1?h+=4503599627370496+this.words[1]*67108864:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-h:h},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(h,p){return i(typeof o<"u"),this.toArrayLike(o,h,p)},s.prototype.toArray=function(h,p){return this.toArrayLike(Array,h,p)},s.prototype.toArrayLike=function(h,p,m){var y=this.byteLength(),w=m||Math.max(1,y);i(y<=w,"byte array longer than desired length"),i(w>0,"Requested array length <= 0"),this.strip();var S=p==="le",O=new h(w),_,l,x=this.clone();if(S){for(l=0;!x.isZero();l++)_=x.andln(255),x.iushrn(8),O[l]=_;for(;l<w;l++)O[l]=0}else{for(l=0;l<w-y;l++)O[l]=0;for(l=0;!x.isZero();l++)_=x.andln(255),x.iushrn(8),O[w-l-1]=_}return O},Math.clz32?s.prototype._countBits=function(h){return 32-Math.clz32(h)}:s.prototype._countBits=function(h){var p=h,m=0;return p>=4096&&(m+=13,p>>>=13),p>=64&&(m+=7,p>>>=7),p>=8&&(m+=4,p>>>=4),p>=2&&(m+=2,p>>>=2),m+p},s.prototype._zeroBits=function(h){if(h===0)return 26;var p=h,m=0;return(p&8191)===0&&(m+=13,p>>>=13),(p&127)===0&&(m+=7,p>>>=7),(p&15)===0&&(m+=4,p>>>=4),(p&3)===0&&(m+=2,p>>>=2),(p&1)===0&&m++,m},s.prototype.bitLength=function(){var h=this.words[this.length-1],p=this._countBits(h);return(this.length-1)*26+p};function v(A){for(var h=new Array(A.bitLength()),p=0;p<h.length;p++){var m=p/26|0,y=p%26;h[p]=(A.words[m]&1<<y)>>>y}return h}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var h=0,p=0;p<this.length;p++){var m=this._zeroBits(this.words[p]);if(h+=m,m!==26)break}return h},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(h){return this.negative!==0?this.abs().inotn(h).iaddn(1):this.clone()},s.prototype.fromTwos=function(h){return this.testn(h-1)?this.notn(h).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(h){for(;this.length<h.length;)this.words[this.length++]=0;for(var p=0;p<h.length;p++)this.words[p]=this.words[p]|h.words[p];return this.strip()},s.prototype.ior=function(h){return i((this.negative|h.negative)===0),this.iuor(h)},s.prototype.or=function(h){return this.length>h.length?this.clone().ior(h):h.clone().ior(this)},s.prototype.uor=function(h){return this.length>h.length?this.clone().iuor(h):h.clone().iuor(this)},s.prototype.iuand=function(h){var p;this.length>h.length?p=h:p=this;for(var m=0;m<p.length;m++)this.words[m]=this.words[m]&h.words[m];return this.length=p.length,this.strip()},s.prototype.iand=function(h){return i((this.negative|h.negative)===0),this.iuand(h)},s.prototype.and=function(h){return this.length>h.length?this.clone().iand(h):h.clone().iand(this)},s.prototype.uand=function(h){return this.length>h.length?this.clone().iuand(h):h.clone().iuand(this)},s.prototype.iuxor=function(h){var p,m;this.length>h.length?(p=this,m=h):(p=h,m=this);for(var y=0;y<m.length;y++)this.words[y]=p.words[y]^m.words[y];if(this!==p)for(;y<p.length;y++)this.words[y]=p.words[y];return this.length=p.length,this.strip()},s.prototype.ixor=function(h){return i((this.negative|h.negative)===0),this.iuxor(h)},s.prototype.xor=function(h){return this.length>h.length?this.clone().ixor(h):h.clone().ixor(this)},s.prototype.uxor=function(h){return this.length>h.length?this.clone().iuxor(h):h.clone().iuxor(this)},s.prototype.inotn=function(h){i(typeof h=="number"&&h>=0);var p=Math.ceil(h/26)|0,m=h%26;this._expand(p),m>0&&p--;for(var y=0;y<p;y++)this.words[y]=~this.words[y]&67108863;return m>0&&(this.words[y]=~this.words[y]&67108863>>26-m),this.strip()},s.prototype.notn=function(h){return this.clone().inotn(h)},s.prototype.setn=function(h,p){i(typeof h=="number"&&h>=0);var m=h/26|0,y=h%26;return this._expand(m+1),p?this.words[m]=this.words[m]|1<<y:this.words[m]=this.words[m]&~(1<<y),this.strip()},s.prototype.iadd=function(h){var p;if(this.negative!==0&&h.negative===0)return this.negative=0,p=this.isub(h),this.negative^=1,this._normSign();if(this.negative===0&&h.negative!==0)return h.negative=0,p=this.isub(h),h.negative=1,p._normSign();var m,y;this.length>h.length?(m=this,y=h):(m=h,y=this);for(var w=0,S=0;S<y.length;S++)p=(m.words[S]|0)+(y.words[S]|0)+w,this.words[S]=p&67108863,w=p>>>26;for(;w!==0&&S<m.length;S++)p=(m.words[S]|0)+w,this.words[S]=p&67108863,w=p>>>26;if(this.length=m.length,w!==0)this.words[this.length]=w,this.length++;else if(m!==this)for(;S<m.length;S++)this.words[S]=m.words[S];return this},s.prototype.add=function(h){var p;return h.negative!==0&&this.negative===0?(h.negative=0,p=this.sub(h),h.negative^=1,p):h.negative===0&&this.negative!==0?(this.negative=0,p=h.sub(this),this.negative=1,p):this.length>h.length?this.clone().iadd(h):h.clone().iadd(this)},s.prototype.isub=function(h){if(h.negative!==0){h.negative=0;var p=this.iadd(h);return h.negative=1,p._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(h),this.negative=1,this._normSign();var m=this.cmp(h);if(m===0)return this.negative=0,this.length=1,this.words[0]=0,this;var y,w;m>0?(y=this,w=h):(y=h,w=this);for(var S=0,O=0;O<w.length;O++)p=(y.words[O]|0)-(w.words[O]|0)+S,S=p>>26,this.words[O]=p&67108863;for(;S!==0&&O<y.length;O++)p=(y.words[O]|0)+S,S=p>>26,this.words[O]=p&67108863;if(S===0&&O<y.length&&y!==this)for(;O<y.length;O++)this.words[O]=y.words[O];return this.length=Math.max(this.length,O),y!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(h){return this.clone().isub(h)};function g(A,h,p){p.negative=h.negative^A.negative;var m=A.length+h.length|0;p.length=m,m=m-1|0;var y=A.words[0]|0,w=h.words[0]|0,S=y*w,O=S&67108863,_=S/67108864|0;p.words[0]=O;for(var l=1;l<m;l++){for(var x=_>>>26,F=_&67108863,L=Math.min(l,h.length-1),U=Math.max(0,l-A.length+1);U<=L;U++){var j=l-U|0;y=A.words[j]|0,w=h.words[U]|0,S=y*w+F,x+=S/67108864|0,F=S&67108863}p.words[l]=F|0,_=x|0}return _!==0?p.words[l]=_|0:p.length--,p.strip()}var E=function(h,p,m){var y=h.words,w=p.words,S=m.words,O=0,_,l,x,F=y[0]|0,L=F&8191,U=F>>>13,j=y[1]|0,K=j&8191,W=j>>>13,J=y[2]|0,H=J&8191,G=J>>>13,Pe=y[3]|0,Q=Pe&8191,ne=Pe>>>13,xt=y[4]|0,fe=xt&8191,Ee=xt>>>13,zo=y[5]|0,xe=zo&8191,ye=zo>>>13,ms=y[6]|0,ge=ms&8191,ve=ms>>>13,ws=y[7]|0,me=ws&8191,we=ws>>>13,_s=y[8]|0,Se=_s&8191,Ie=_s>>>13,ko=y[9]|0,Ae=ko&8191,Re=ko>>>13,a1=w[0]|0,Te=a1&8191,Ne=a1>>>13,c1=w[1]|0,Ce=c1&8191,Be=c1>>>13,u1=w[2]|0,Fe=u1&8191,Le=u1>>>13,f1=w[3]|0,Ue=f1&8191,qe=f1>>>13,h1=w[4]|0,ze=h1&8191,ke=h1>>>13,d1=w[5]|0,je=d1&8191,Ve=d1>>>13,l1=w[6]|0,Ke=l1&8191,He=l1>>>13,p1=w[7]|0,We=p1&8191,Ge=p1>>>13,b1=w[8]|0,Ye=b1&8191,Xe=b1>>>13,g1=w[9]|0,Je=g1&8191,Ze=g1>>>13;m.negative=h.negative^p.negative,m.length=19,_=Math.imul(L,Te),l=Math.imul(L,Ne),l=l+Math.imul(U,Te)|0,x=Math.imul(U,Ne);var Iu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Iu>>>26)|0,Iu&=67108863,_=Math.imul(K,Te),l=Math.imul(K,Ne),l=l+Math.imul(W,Te)|0,x=Math.imul(W,Ne),_=_+Math.imul(L,Ce)|0,l=l+Math.imul(L,Be)|0,l=l+Math.imul(U,Ce)|0,x=x+Math.imul(U,Be)|0;var Au=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Au>>>26)|0,Au&=67108863,_=Math.imul(H,Te),l=Math.imul(H,Ne),l=l+Math.imul(G,Te)|0,x=Math.imul(G,Ne),_=_+Math.imul(K,Ce)|0,l=l+Math.imul(K,Be)|0,l=l+Math.imul(W,Ce)|0,x=x+Math.imul(W,Be)|0,_=_+Math.imul(L,Fe)|0,l=l+Math.imul(L,Le)|0,l=l+Math.imul(U,Fe)|0,x=x+Math.imul(U,Le)|0;var Ou=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Ou>>>26)|0,Ou&=67108863,_=Math.imul(Q,Te),l=Math.imul(Q,Ne),l=l+Math.imul(ne,Te)|0,x=Math.imul(ne,Ne),_=_+Math.imul(H,Ce)|0,l=l+Math.imul(H,Be)|0,l=l+Math.imul(G,Ce)|0,x=x+Math.imul(G,Be)|0,_=_+Math.imul(K,Fe)|0,l=l+Math.imul(K,Le)|0,l=l+Math.imul(W,Fe)|0,x=x+Math.imul(W,Le)|0,_=_+Math.imul(L,Ue)|0,l=l+Math.imul(L,qe)|0,l=l+Math.imul(U,Ue)|0,x=x+Math.imul(U,qe)|0;var Du=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Du>>>26)|0,Du&=67108863,_=Math.imul(fe,Te),l=Math.imul(fe,Ne),l=l+Math.imul(Ee,Te)|0,x=Math.imul(Ee,Ne),_=_+Math.imul(Q,Ce)|0,l=l+Math.imul(Q,Be)|0,l=l+Math.imul(ne,Ce)|0,x=x+Math.imul(ne,Be)|0,_=_+Math.imul(H,Fe)|0,l=l+Math.imul(H,Le)|0,l=l+Math.imul(G,Fe)|0,x=x+Math.imul(G,Le)|0,_=_+Math.imul(K,Ue)|0,l=l+Math.imul(K,qe)|0,l=l+Math.imul(W,Ue)|0,x=x+Math.imul(W,qe)|0,_=_+Math.imul(L,ze)|0,l=l+Math.imul(L,ke)|0,l=l+Math.imul(U,ze)|0,x=x+Math.imul(U,ke)|0;var $u=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+($u>>>26)|0,$u&=67108863,_=Math.imul(xe,Te),l=Math.imul(xe,Ne),l=l+Math.imul(ye,Te)|0,x=Math.imul(ye,Ne),_=_+Math.imul(fe,Ce)|0,l=l+Math.imul(fe,Be)|0,l=l+Math.imul(Ee,Ce)|0,x=x+Math.imul(Ee,Be)|0,_=_+Math.imul(Q,Fe)|0,l=l+Math.imul(Q,Le)|0,l=l+Math.imul(ne,Fe)|0,x=x+Math.imul(ne,Le)|0,_=_+Math.imul(H,Ue)|0,l=l+Math.imul(H,qe)|0,l=l+Math.imul(G,Ue)|0,x=x+Math.imul(G,qe)|0,_=_+Math.imul(K,ze)|0,l=l+Math.imul(K,ke)|0,l=l+Math.imul(W,ze)|0,x=x+Math.imul(W,ke)|0,_=_+Math.imul(L,je)|0,l=l+Math.imul(L,Ve)|0,l=l+Math.imul(U,je)|0,x=x+Math.imul(U,Ve)|0;var Mu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Mu>>>26)|0,Mu&=67108863,_=Math.imul(ge,Te),l=Math.imul(ge,Ne),l=l+Math.imul(ve,Te)|0,x=Math.imul(ve,Ne),_=_+Math.imul(xe,Ce)|0,l=l+Math.imul(xe,Be)|0,l=l+Math.imul(ye,Ce)|0,x=x+Math.imul(ye,Be)|0,_=_+Math.imul(fe,Fe)|0,l=l+Math.imul(fe,Le)|0,l=l+Math.imul(Ee,Fe)|0,x=x+Math.imul(Ee,Le)|0,_=_+Math.imul(Q,Ue)|0,l=l+Math.imul(Q,qe)|0,l=l+Math.imul(ne,Ue)|0,x=x+Math.imul(ne,qe)|0,_=_+Math.imul(H,ze)|0,l=l+Math.imul(H,ke)|0,l=l+Math.imul(G,ze)|0,x=x+Math.imul(G,ke)|0,_=_+Math.imul(K,je)|0,l=l+Math.imul(K,Ve)|0,l=l+Math.imul(W,je)|0,x=x+Math.imul(W,Ve)|0,_=_+Math.imul(L,Ke)|0,l=l+Math.imul(L,He)|0,l=l+Math.imul(U,Ke)|0,x=x+Math.imul(U,He)|0;var Pu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Pu>>>26)|0,Pu&=67108863,_=Math.imul(me,Te),l=Math.imul(me,Ne),l=l+Math.imul(we,Te)|0,x=Math.imul(we,Ne),_=_+Math.imul(ge,Ce)|0,l=l+Math.imul(ge,Be)|0,l=l+Math.imul(ve,Ce)|0,x=x+Math.imul(ve,Be)|0,_=_+Math.imul(xe,Fe)|0,l=l+Math.imul(xe,Le)|0,l=l+Math.imul(ye,Fe)|0,x=x+Math.imul(ye,Le)|0,_=_+Math.imul(fe,Ue)|0,l=l+Math.imul(fe,qe)|0,l=l+Math.imul(Ee,Ue)|0,x=x+Math.imul(Ee,qe)|0,_=_+Math.imul(Q,ze)|0,l=l+Math.imul(Q,ke)|0,l=l+Math.imul(ne,ze)|0,x=x+Math.imul(ne,ke)|0,_=_+Math.imul(H,je)|0,l=l+Math.imul(H,Ve)|0,l=l+Math.imul(G,je)|0,x=x+Math.imul(G,Ve)|0,_=_+Math.imul(K,Ke)|0,l=l+Math.imul(K,He)|0,l=l+Math.imul(W,Ke)|0,x=x+Math.imul(W,He)|0,_=_+Math.imul(L,We)|0,l=l+Math.imul(L,Ge)|0,l=l+Math.imul(U,We)|0,x=x+Math.imul(U,Ge)|0;var Ru=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Ru>>>26)|0,Ru&=67108863,_=Math.imul(Se,Te),l=Math.imul(Se,Ne),l=l+Math.imul(Ie,Te)|0,x=Math.imul(Ie,Ne),_=_+Math.imul(me,Ce)|0,l=l+Math.imul(me,Be)|0,l=l+Math.imul(we,Ce)|0,x=x+Math.imul(we,Be)|0,_=_+Math.imul(ge,Fe)|0,l=l+Math.imul(ge,Le)|0,l=l+Math.imul(ve,Fe)|0,x=x+Math.imul(ve,Le)|0,_=_+Math.imul(xe,Ue)|0,l=l+Math.imul(xe,qe)|0,l=l+Math.imul(ye,Ue)|0,x=x+Math.imul(ye,qe)|0,_=_+Math.imul(fe,ze)|0,l=l+Math.imul(fe,ke)|0,l=l+Math.imul(Ee,ze)|0,x=x+Math.imul(Ee,ke)|0,_=_+Math.imul(Q,je)|0,l=l+Math.imul(Q,Ve)|0,l=l+Math.imul(ne,je)|0,x=x+Math.imul(ne,Ve)|0,_=_+Math.imul(H,Ke)|0,l=l+Math.imul(H,He)|0,l=l+Math.imul(G,Ke)|0,x=x+Math.imul(G,He)|0,_=_+Math.imul(K,We)|0,l=l+Math.imul(K,Ge)|0,l=l+Math.imul(W,We)|0,x=x+Math.imul(W,Ge)|0,_=_+Math.imul(L,Ye)|0,l=l+Math.imul(L,Xe)|0,l=l+Math.imul(U,Ye)|0,x=x+Math.imul(U,Xe)|0;var Tu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Tu>>>26)|0,Tu&=67108863,_=Math.imul(Ae,Te),l=Math.imul(Ae,Ne),l=l+Math.imul(Re,Te)|0,x=Math.imul(Re,Ne),_=_+Math.imul(Se,Ce)|0,l=l+Math.imul(Se,Be)|0,l=l+Math.imul(Ie,Ce)|0,x=x+Math.imul(Ie,Be)|0,_=_+Math.imul(me,Fe)|0,l=l+Math.imul(me,Le)|0,l=l+Math.imul(we,Fe)|0,x=x+Math.imul(we,Le)|0,_=_+Math.imul(ge,Ue)|0,l=l+Math.imul(ge,qe)|0,l=l+Math.imul(ve,Ue)|0,x=x+Math.imul(ve,qe)|0,_=_+Math.imul(xe,ze)|0,l=l+Math.imul(xe,ke)|0,l=l+Math.imul(ye,ze)|0,x=x+Math.imul(ye,ke)|0,_=_+Math.imul(fe,je)|0,l=l+Math.imul(fe,Ve)|0,l=l+Math.imul(Ee,je)|0,x=x+Math.imul(Ee,Ve)|0,_=_+Math.imul(Q,Ke)|0,l=l+Math.imul(Q,He)|0,l=l+Math.imul(ne,Ke)|0,x=x+Math.imul(ne,He)|0,_=_+Math.imul(H,We)|0,l=l+Math.imul(H,Ge)|0,l=l+Math.imul(G,We)|0,x=x+Math.imul(G,Ge)|0,_=_+Math.imul(K,Ye)|0,l=l+Math.imul(K,Xe)|0,l=l+Math.imul(W,Ye)|0,x=x+Math.imul(W,Xe)|0,_=_+Math.imul(L,Je)|0,l=l+Math.imul(L,Ze)|0,l=l+Math.imul(U,Je)|0,x=x+Math.imul(U,Ze)|0;var Nu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Nu>>>26)|0,Nu&=67108863,_=Math.imul(Ae,Ce),l=Math.imul(Ae,Be),l=l+Math.imul(Re,Ce)|0,x=Math.imul(Re,Be),_=_+Math.imul(Se,Fe)|0,l=l+Math.imul(Se,Le)|0,l=l+Math.imul(Ie,Fe)|0,x=x+Math.imul(Ie,Le)|0,_=_+Math.imul(me,Ue)|0,l=l+Math.imul(me,qe)|0,l=l+Math.imul(we,Ue)|0,x=x+Math.imul(we,qe)|0,_=_+Math.imul(ge,ze)|0,l=l+Math.imul(ge,ke)|0,l=l+Math.imul(ve,ze)|0,x=x+Math.imul(ve,ke)|0,_=_+Math.imul(xe,je)|0,l=l+Math.imul(xe,Ve)|0,l=l+Math.imul(ye,je)|0,x=x+Math.imul(ye,Ve)|0,_=_+Math.imul(fe,Ke)|0,l=l+Math.imul(fe,He)|0,l=l+Math.imul(Ee,Ke)|0,x=x+Math.imul(Ee,He)|0,_=_+Math.imul(Q,We)|0,l=l+Math.imul(Q,Ge)|0,l=l+Math.imul(ne,We)|0,x=x+Math.imul(ne,Ge)|0,_=_+Math.imul(H,Ye)|0,l=l+Math.imul(H,Xe)|0,l=l+Math.imul(G,Ye)|0,x=x+Math.imul(G,Xe)|0,_=_+Math.imul(K,Je)|0,l=l+Math.imul(K,Ze)|0,l=l+Math.imul(W,Je)|0,x=x+Math.imul(W,Ze)|0;var Cu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Cu>>>26)|0,Cu&=67108863,_=Math.imul(Ae,Fe),l=Math.imul(Ae,Le),l=l+Math.imul(Re,Fe)|0,x=Math.imul(Re,Le),_=_+Math.imul(Se,Ue)|0,l=l+Math.imul(Se,qe)|0,l=l+Math.imul(Ie,Ue)|0,x=x+Math.imul(Ie,qe)|0,_=_+Math.imul(me,ze)|0,l=l+Math.imul(me,ke)|0,l=l+Math.imul(we,ze)|0,x=x+Math.imul(we,ke)|0,_=_+Math.imul(ge,je)|0,l=l+Math.imul(ge,Ve)|0,l=l+Math.imul(ve,je)|0,x=x+Math.imul(ve,Ve)|0,_=_+Math.imul(xe,Ke)|0,l=l+Math.imul(xe,He)|0,l=l+Math.imul(ye,Ke)|0,x=x+Math.imul(ye,He)|0,_=_+Math.imul(fe,We)|0,l=l+Math.imul(fe,Ge)|0,l=l+Math.imul(Ee,We)|0,x=x+Math.imul(Ee,Ge)|0,_=_+Math.imul(Q,Ye)|0,l=l+Math.imul(Q,Xe)|0,l=l+Math.imul(ne,Ye)|0,x=x+Math.imul(ne,Xe)|0,_=_+Math.imul(H,Je)|0,l=l+Math.imul(H,Ze)|0,l=l+Math.imul(G,Je)|0,x=x+Math.imul(G,Ze)|0;var Bu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Bu>>>26)|0,Bu&=67108863,_=Math.imul(Ae,Ue),l=Math.imul(Ae,qe),l=l+Math.imul(Re,Ue)|0,x=Math.imul(Re,qe),_=_+Math.imul(Se,ze)|0,l=l+Math.imul(Se,ke)|0,l=l+Math.imul(Ie,ze)|0,x=x+Math.imul(Ie,ke)|0,_=_+Math.imul(me,je)|0,l=l+Math.imul(me,Ve)|0,l=l+Math.imul(we,je)|0,x=x+Math.imul(we,Ve)|0,_=_+Math.imul(ge,Ke)|0,l=l+Math.imul(ge,He)|0,l=l+Math.imul(ve,Ke)|0,x=x+Math.imul(ve,He)|0,_=_+Math.imul(xe,We)|0,l=l+Math.imul(xe,Ge)|0,l=l+Math.imul(ye,We)|0,x=x+Math.imul(ye,Ge)|0,_=_+Math.imul(fe,Ye)|0,l=l+Math.imul(fe,Xe)|0,l=l+Math.imul(Ee,Ye)|0,x=x+Math.imul(Ee,Xe)|0,_=_+Math.imul(Q,Je)|0,l=l+Math.imul(Q,Ze)|0,l=l+Math.imul(ne,Je)|0,x=x+Math.imul(ne,Ze)|0;var Fu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Fu>>>26)|0,Fu&=67108863,_=Math.imul(Ae,ze),l=Math.imul(Ae,ke),l=l+Math.imul(Re,ze)|0,x=Math.imul(Re,ke),_=_+Math.imul(Se,je)|0,l=l+Math.imul(Se,Ve)|0,l=l+Math.imul(Ie,je)|0,x=x+Math.imul(Ie,Ve)|0,_=_+Math.imul(me,Ke)|0,l=l+Math.imul(me,He)|0,l=l+Math.imul(we,Ke)|0,x=x+Math.imul(we,He)|0,_=_+Math.imul(ge,We)|0,l=l+Math.imul(ge,Ge)|0,l=l+Math.imul(ve,We)|0,x=x+Math.imul(ve,Ge)|0,_=_+Math.imul(xe,Ye)|0,l=l+Math.imul(xe,Xe)|0,l=l+Math.imul(ye,Ye)|0,x=x+Math.imul(ye,Xe)|0,_=_+Math.imul(fe,Je)|0,l=l+Math.imul(fe,Ze)|0,l=l+Math.imul(Ee,Je)|0,x=x+Math.imul(Ee,Ze)|0;var Lu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Lu>>>26)|0,Lu&=67108863,_=Math.imul(Ae,je),l=Math.imul(Ae,Ve),l=l+Math.imul(Re,je)|0,x=Math.imul(Re,Ve),_=_+Math.imul(Se,Ke)|0,l=l+Math.imul(Se,He)|0,l=l+Math.imul(Ie,Ke)|0,x=x+Math.imul(Ie,He)|0,_=_+Math.imul(me,We)|0,l=l+Math.imul(me,Ge)|0,l=l+Math.imul(we,We)|0,x=x+Math.imul(we,Ge)|0,_=_+Math.imul(ge,Ye)|0,l=l+Math.imul(ge,Xe)|0,l=l+Math.imul(ve,Ye)|0,x=x+Math.imul(ve,Xe)|0,_=_+Math.imul(xe,Je)|0,l=l+Math.imul(xe,Ze)|0,l=l+Math.imul(ye,Je)|0,x=x+Math.imul(ye,Ze)|0;var Uu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(Uu>>>26)|0,Uu&=67108863,_=Math.imul(Ae,Ke),l=Math.imul(Ae,He),l=l+Math.imul(Re,Ke)|0,x=Math.imul(Re,He),_=_+Math.imul(Se,We)|0,l=l+Math.imul(Se,Ge)|0,l=l+Math.imul(Ie,We)|0,x=x+Math.imul(Ie,Ge)|0,_=_+Math.imul(me,Ye)|0,l=l+Math.imul(me,Xe)|0,l=l+Math.imul(we,Ye)|0,x=x+Math.imul(we,Xe)|0,_=_+Math.imul(ge,Je)|0,l=l+Math.imul(ge,Ze)|0,l=l+Math.imul(ve,Je)|0,x=x+Math.imul(ve,Ze)|0;var qu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(qu>>>26)|0,qu&=67108863,_=Math.imul(Ae,We),l=Math.imul(Ae,Ge),l=l+Math.imul(Re,We)|0,x=Math.imul(Re,Ge),_=_+Math.imul(Se,Ye)|0,l=l+Math.imul(Se,Xe)|0,l=l+Math.imul(Ie,Ye)|0,x=x+Math.imul(Ie,Xe)|0,_=_+Math.imul(me,Je)|0,l=l+Math.imul(me,Ze)|0,l=l+Math.imul(we,Je)|0,x=x+Math.imul(we,Ze)|0;var zu=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(zu>>>26)|0,zu&=67108863,_=Math.imul(Ae,Ye),l=Math.imul(Ae,Xe),l=l+Math.imul(Re,Ye)|0,x=Math.imul(Re,Xe),_=_+Math.imul(Se,Je)|0,l=l+Math.imul(Se,Ze)|0,l=l+Math.imul(Ie,Je)|0,x=x+Math.imul(Ie,Ze)|0;var ku=(O+_|0)+((l&8191)<<13)|0;O=(x+(l>>>13)|0)+(ku>>>26)|0,ku&=67108863,_=Math.imul(Ae,Je),l=Math.imul(Ae,Ze),l=l+Math.imul(Re,Je)|0,x=Math.imul(Re,Ze);var ju=(O+_|0)+((l&8191)<<13)|0;return O=(x+(l>>>13)|0)+(ju>>>26)|0,ju&=67108863,S[0]=Iu,S[1]=Au,S[2]=Ou,S[3]=Du,S[4]=$u,S[5]=Mu,S[6]=Pu,S[7]=Ru,S[8]=Tu,S[9]=Nu,S[10]=Cu,S[11]=Bu,S[12]=Fu,S[13]=Lu,S[14]=Uu,S[15]=qu,S[16]=zu,S[17]=ku,S[18]=ju,O!==0&&(S[19]=O,m.length++),m};Math.imul||(E=g);function I(A,h,p){p.negative=h.negative^A.negative,p.length=A.length+h.length;for(var m=0,y=0,w=0;w<p.length-1;w++){var S=y;y=0;for(var O=m&67108863,_=Math.min(w,h.length-1),l=Math.max(0,w-A.length+1);l<=_;l++){var x=w-l,F=A.words[x]|0,L=h.words[l]|0,U=F*L,j=U&67108863;S=S+(U/67108864|0)|0,j=j+O|0,O=j&67108863,S=S+(j>>>26)|0,y+=S>>>26,S&=67108863}p.words[w]=O,m=S,S=y}return m!==0?p.words[w]=m:p.length--,p.strip()}function $(A,h,p){var m=new D;return m.mulp(A,h,p)}s.prototype.mulTo=function(h,p){var m,y=this.length+h.length;return this.length===10&&h.length===10?m=E(this,h,p):y<63?m=g(this,h,p):y<1024?m=I(this,h,p):m=$(this,h,p),m};function D(A,h){this.x=A,this.y=h}D.prototype.makeRBT=function(h){for(var p=new Array(h),m=s.prototype._countBits(h)-1,y=0;y<h;y++)p[y]=this.revBin(y,m,h);return p},D.prototype.revBin=function(h,p,m){if(h===0||h===m-1)return h;for(var y=0,w=0;w<p;w++)y|=(h&1)<<p-w-1,h>>=1;return y},D.prototype.permute=function(h,p,m,y,w,S){for(var O=0;O<S;O++)y[O]=p[h[O]],w[O]=m[h[O]]},D.prototype.transform=function(h,p,m,y,w,S){this.permute(S,h,p,m,y,w);for(var O=1;O<w;O<<=1)for(var _=O<<1,l=Math.cos(2*Math.PI/_),x=Math.sin(2*Math.PI/_),F=0;F<w;F+=_)for(var L=l,U=x,j=0;j<O;j++){var K=m[F+j],W=y[F+j],J=m[F+j+O],H=y[F+j+O],G=L*J-U*H;H=L*H+U*J,J=G,m[F+j]=K+J,y[F+j]=W+H,m[F+j+O]=K-J,y[F+j+O]=W-H,j!==_&&(G=l*L-x*U,U=l*U+x*L,L=G)}},D.prototype.guessLen13b=function(h,p){var m=Math.max(p,h)|1,y=m&1,w=0;for(m=m/2|0;m;m=m>>>1)w++;return 1<<w+1+y},D.prototype.conjugate=function(h,p,m){if(!(m<=1))for(var y=0;y<m/2;y++){var w=h[y];h[y]=h[m-y-1],h[m-y-1]=w,w=p[y],p[y]=-p[m-y-1],p[m-y-1]=-w}},D.prototype.normalize13b=function(h,p){for(var m=0,y=0;y<p/2;y++){var w=Math.round(h[2*y+1]/p)*8192+Math.round(h[2*y]/p)+m;h[y]=w&67108863,w<67108864?m=0:m=w/67108864|0}return h},D.prototype.convert13b=function(h,p,m,y){for(var w=0,S=0;S<p;S++)w=w+(h[S]|0),m[2*S]=w&8191,w=w>>>13,m[2*S+1]=w&8191,w=w>>>13;for(S=2*p;S<y;++S)m[S]=0;i(w===0),i((w&-8192)===0)},D.prototype.stub=function(h){for(var p=new Array(h),m=0;m<h;m++)p[m]=0;return p},D.prototype.mulp=function(h,p,m){var y=2*this.guessLen13b(h.length,p.length),w=this.makeRBT(y),S=this.stub(y),O=new Array(y),_=new Array(y),l=new Array(y),x=new Array(y),F=new Array(y),L=new Array(y),U=m.words;U.length=y,this.convert13b(h.words,h.length,O,y),this.convert13b(p.words,p.length,x,y),this.transform(O,S,_,l,y,w),this.transform(x,S,F,L,y,w);for(var j=0;j<y;j++){var K=_[j]*F[j]-l[j]*L[j];l[j]=_[j]*L[j]+l[j]*F[j],_[j]=K}return this.conjugate(_,l,y),this.transform(_,l,U,S,y,w),this.conjugate(U,S,y),this.normalize13b(U,y),m.negative=h.negative^p.negative,m.length=h.length+p.length,m.strip()},s.prototype.mul=function(h){var p=new s(null);return p.words=new Array(this.length+h.length),this.mulTo(h,p)},s.prototype.mulf=function(h){var p=new s(null);return p.words=new Array(this.length+h.length),$(this,h,p)},s.prototype.imul=function(h){return this.clone().mulTo(h,this)},s.prototype.imuln=function(h){i(typeof h=="number"),i(h<67108864);for(var p=0,m=0;m<this.length;m++){var y=(this.words[m]|0)*h,w=(y&67108863)+(p&67108863);p>>=26,p+=y/67108864|0,p+=w>>>26,this.words[m]=w&67108863}return p!==0&&(this.words[m]=p,this.length++),this},s.prototype.muln=function(h){return this.clone().imuln(h)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(h){var p=v(h);if(p.length===0)return new s(1);for(var m=this,y=0;y<p.length&&p[y]===0;y++,m=m.sqr());if(++y<p.length)for(var w=m.sqr();y<p.length;y++,w=w.sqr())p[y]!==0&&(m=m.mul(w));return m},s.prototype.iushln=function(h){i(typeof h=="number"&&h>=0);var p=h%26,m=(h-p)/26,y=67108863>>>26-p<<26-p,w;if(p!==0){var S=0;for(w=0;w<this.length;w++){var O=this.words[w]&y,_=(this.words[w]|0)-O<<p;this.words[w]=_|S,S=O>>>26-p}S&&(this.words[w]=S,this.length++)}if(m!==0){for(w=this.length-1;w>=0;w--)this.words[w+m]=this.words[w];for(w=0;w<m;w++)this.words[w]=0;this.length+=m}return this.strip()},s.prototype.ishln=function(h){return i(this.negative===0),this.iushln(h)},s.prototype.iushrn=function(h,p,m){i(typeof h=="number"&&h>=0);var y;p?y=(p-p%26)/26:y=0;var w=h%26,S=Math.min((h-w)/26,this.length),O=67108863^67108863>>>w<<w,_=m;if(y-=S,y=Math.max(0,y),_){for(var l=0;l<S;l++)_.words[l]=this.words[l];_.length=S}if(S!==0)if(this.length>S)for(this.length-=S,l=0;l<this.length;l++)this.words[l]=this.words[l+S];else this.words[0]=0,this.length=1;var x=0;for(l=this.length-1;l>=0&&(x!==0||l>=y);l--){var F=this.words[l]|0;this.words[l]=x<<26-w|F>>>w,x=F&O}return _&&x!==0&&(_.words[_.length++]=x),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(h,p,m){return i(this.negative===0),this.iushrn(h,p,m)},s.prototype.shln=function(h){return this.clone().ishln(h)},s.prototype.ushln=function(h){return this.clone().iushln(h)},s.prototype.shrn=function(h){return this.clone().ishrn(h)},s.prototype.ushrn=function(h){return this.clone().iushrn(h)},s.prototype.testn=function(h){i(typeof h=="number"&&h>=0);var p=h%26,m=(h-p)/26,y=1<<p;if(this.length<=m)return!1;var w=this.words[m];return!!(w&y)},s.prototype.imaskn=function(h){i(typeof h=="number"&&h>=0);var p=h%26,m=(h-p)/26;if(i(this.negative===0,"imaskn works only with positive numbers"),this.length<=m)return this;if(p!==0&&m++,this.length=Math.min(m,this.length),p!==0){var y=67108863^67108863>>>p<<p;this.words[this.length-1]&=y}return this.strip()},s.prototype.maskn=function(h){return this.clone().imaskn(h)},s.prototype.iaddn=function(h){return i(typeof h=="number"),i(h<67108864),h<0?this.isubn(-h):this.negative!==0?this.length===1&&(this.words[0]|0)<h?(this.words[0]=h-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(h),this.negative=1,this):this._iaddn(h)},s.prototype._iaddn=function(h){this.words[0]+=h;for(var p=0;p<this.length&&this.words[p]>=67108864;p++)this.words[p]-=67108864,p===this.length-1?this.words[p+1]=1:this.words[p+1]++;return this.length=Math.max(this.length,p+1),this},s.prototype.isubn=function(h){if(i(typeof h=="number"),i(h<67108864),h<0)return this.iaddn(-h);if(this.negative!==0)return this.negative=0,this.iaddn(h),this.negative=1,this;if(this.words[0]-=h,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var p=0;p<this.length&&this.words[p]<0;p++)this.words[p]+=67108864,this.words[p+1]-=1;return this.strip()},s.prototype.addn=function(h){return this.clone().iaddn(h)},s.prototype.subn=function(h){return this.clone().isubn(h)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(h,p,m){var y=h.length+m,w;this._expand(y);var S,O=0;for(w=0;w<h.length;w++){S=(this.words[w+m]|0)+O;var _=(h.words[w]|0)*p;S-=_&67108863,O=(S>>26)-(_/67108864|0),this.words[w+m]=S&67108863}for(;w<this.length-m;w++)S=(this.words[w+m]|0)+O,O=S>>26,this.words[w+m]=S&67108863;if(O===0)return this.strip();for(i(O===-1),O=0,w=0;w<this.length;w++)S=-(this.words[w]|0)+O,O=S>>26,this.words[w]=S&67108863;return this.negative=1,this.strip()},s.prototype._wordDiv=function(h,p){var m=this.length-h.length,y=this.clone(),w=h,S=w.words[w.length-1]|0,O=this._countBits(S);m=26-O,m!==0&&(w=w.ushln(m),y.iushln(m),S=w.words[w.length-1]|0);var _=y.length-w.length,l;if(p!=="mod"){l=new s(null),l.length=_+1,l.words=new Array(l.length);for(var x=0;x<l.length;x++)l.words[x]=0}var F=y.clone()._ishlnsubmul(w,1,_);F.negative===0&&(y=F,l&&(l.words[_]=1));for(var L=_-1;L>=0;L--){var U=(y.words[w.length+L]|0)*67108864+(y.words[w.length+L-1]|0);for(U=Math.min(U/S|0,67108863),y._ishlnsubmul(w,U,L);y.negative!==0;)U--,y.negative=0,y._ishlnsubmul(w,1,L),y.isZero()||(y.negative^=1);l&&(l.words[L]=U)}return l&&l.strip(),y.strip(),p!=="div"&&m!==0&&y.iushrn(m),{div:l||null,mod:y}},s.prototype.divmod=function(h,p,m){if(i(!h.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var y,w,S;return this.negative!==0&&h.negative===0?(S=this.neg().divmod(h,p),p!=="mod"&&(y=S.div.neg()),p!=="div"&&(w=S.mod.neg(),m&&w.negative!==0&&w.iadd(h)),{div:y,mod:w}):this.negative===0&&h.negative!==0?(S=this.divmod(h.neg(),p),p!=="mod"&&(y=S.div.neg()),{div:y,mod:S.mod}):(this.negative&h.negative)!==0?(S=this.neg().divmod(h.neg(),p),p!=="div"&&(w=S.mod.neg(),m&&w.negative!==0&&w.isub(h)),{div:S.div,mod:w}):h.length>this.length||this.cmp(h)<0?{div:new s(0),mod:this}:h.length===1?p==="div"?{div:this.divn(h.words[0]),mod:null}:p==="mod"?{div:null,mod:new s(this.modn(h.words[0]))}:{div:this.divn(h.words[0]),mod:new s(this.modn(h.words[0]))}:this._wordDiv(h,p)},s.prototype.div=function(h){return this.divmod(h,"div",!1).div},s.prototype.mod=function(h){return this.divmod(h,"mod",!1).mod},s.prototype.umod=function(h){return this.divmod(h,"mod",!0).mod},s.prototype.divRound=function(h){var p=this.divmod(h);if(p.mod.isZero())return p.div;var m=p.div.negative!==0?p.mod.isub(h):p.mod,y=h.ushrn(1),w=h.andln(1),S=m.cmp(y);return S<0||w===1&&S===0?p.div:p.div.negative!==0?p.div.isubn(1):p.div.iaddn(1)},s.prototype.modn=function(h){i(h<=67108863);for(var p=(1<<26)%h,m=0,y=this.length-1;y>=0;y--)m=(p*m+(this.words[y]|0))%h;return m},s.prototype.idivn=function(h){i(h<=67108863);for(var p=0,m=this.length-1;m>=0;m--){var y=(this.words[m]|0)+p*67108864;this.words[m]=y/h|0,p=y%h}return this.strip()},s.prototype.divn=function(h){return this.clone().idivn(h)},s.prototype.egcd=function(h){i(h.negative===0),i(!h.isZero());var p=this,m=h.clone();p.negative!==0?p=p.umod(h):p=p.clone();for(var y=new s(1),w=new s(0),S=new s(0),O=new s(1),_=0;p.isEven()&&m.isEven();)p.iushrn(1),m.iushrn(1),++_;for(var l=m.clone(),x=p.clone();!p.isZero();){for(var F=0,L=1;(p.words[0]&L)===0&&F<26;++F,L<<=1);if(F>0)for(p.iushrn(F);F-- >0;)(y.isOdd()||w.isOdd())&&(y.iadd(l),w.isub(x)),y.iushrn(1),w.iushrn(1);for(var U=0,j=1;(m.words[0]&j)===0&&U<26;++U,j<<=1);if(U>0)for(m.iushrn(U);U-- >0;)(S.isOdd()||O.isOdd())&&(S.iadd(l),O.isub(x)),S.iushrn(1),O.iushrn(1);p.cmp(m)>=0?(p.isub(m),y.isub(S),w.isub(O)):(m.isub(p),S.isub(y),O.isub(w))}return{a:S,b:O,gcd:m.iushln(_)}},s.prototype._invmp=function(h){i(h.negative===0),i(!h.isZero());var p=this,m=h.clone();p.negative!==0?p=p.umod(h):p=p.clone();for(var y=new s(1),w=new s(0),S=m.clone();p.cmpn(1)>0&&m.cmpn(1)>0;){for(var O=0,_=1;(p.words[0]&_)===0&&O<26;++O,_<<=1);if(O>0)for(p.iushrn(O);O-- >0;)y.isOdd()&&y.iadd(S),y.iushrn(1);for(var l=0,x=1;(m.words[0]&x)===0&&l<26;++l,x<<=1);if(l>0)for(m.iushrn(l);l-- >0;)w.isOdd()&&w.iadd(S),w.iushrn(1);p.cmp(m)>=0?(p.isub(m),y.isub(w)):(m.isub(p),w.isub(y))}var F;return p.cmpn(1)===0?F=y:F=w,F.cmpn(0)<0&&F.iadd(h),F},s.prototype.gcd=function(h){if(this.isZero())return h.abs();if(h.isZero())return this.abs();var p=this.clone(),m=h.clone();p.negative=0,m.negative=0;for(var y=0;p.isEven()&&m.isEven();y++)p.iushrn(1),m.iushrn(1);do{for(;p.isEven();)p.iushrn(1);for(;m.isEven();)m.iushrn(1);var w=p.cmp(m);if(w<0){var S=p;p=m,m=S}else if(w===0||m.cmpn(1)===0)break;p.isub(m)}while(!0);return m.iushln(y)},s.prototype.invm=function(h){return this.egcd(h).a.umod(h)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(h){return this.words[0]&h},s.prototype.bincn=function(h){i(typeof h=="number");var p=h%26,m=(h-p)/26,y=1<<p;if(this.length<=m)return this._expand(m+1),this.words[m]|=y,this;for(var w=y,S=m;w!==0&&S<this.length;S++){var O=this.words[S]|0;O+=w,w=O>>>26,O&=67108863,this.words[S]=O}return w!==0&&(this.words[S]=w,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(h){var p=h<0;if(this.negative!==0&&!p)return-1;if(this.negative===0&&p)return 1;this.strip();var m;if(this.length>1)m=1;else{p&&(h=-h),i(h<=67108863,"Number is too big");var y=this.words[0]|0;m=y===h?0:y<h?-1:1}return this.negative!==0?-m|0:m},s.prototype.cmp=function(h){if(this.negative!==0&&h.negative===0)return-1;if(this.negative===0&&h.negative!==0)return 1;var p=this.ucmp(h);return this.negative!==0?-p|0:p},s.prototype.ucmp=function(h){if(this.length>h.length)return 1;if(this.length<h.length)return-1;for(var p=0,m=this.length-1;m>=0;m--){var y=this.words[m]|0,w=h.words[m]|0;if(y!==w){y<w?p=-1:y>w&&(p=1);break}}return p},s.prototype.gtn=function(h){return this.cmpn(h)===1},s.prototype.gt=function(h){return this.cmp(h)===1},s.prototype.gten=function(h){return this.cmpn(h)>=0},s.prototype.gte=function(h){return this.cmp(h)>=0},s.prototype.ltn=function(h){return this.cmpn(h)===-1},s.prototype.lt=function(h){return this.cmp(h)===-1},s.prototype.lten=function(h){return this.cmpn(h)<=0},s.prototype.lte=function(h){return this.cmp(h)<=0},s.prototype.eqn=function(h){return this.cmpn(h)===0},s.prototype.eq=function(h){return this.cmp(h)===0},s.red=function(h){return new R(h)},s.prototype.toRed=function(h){return i(!this.red,"Already a number in reduction context"),i(this.negative===0,"red works only with positives"),h.convertTo(this)._forceRed(h)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(h){return this.red=h,this},s.prototype.forceRed=function(h){return i(!this.red,"Already a number in reduction context"),this._forceRed(h)},s.prototype.redAdd=function(h){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,h)},s.prototype.redIAdd=function(h){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,h)},s.prototype.redSub=function(h){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,h)},s.prototype.redISub=function(h){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,h)},s.prototype.redShl=function(h){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,h)},s.prototype.redMul=function(h){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,h),this.red.mul(this,h)},s.prototype.redIMul=function(h){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,h),this.red.imul(this,h)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(h){return i(this.red&&!h.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,h)};var M={k256:null,p224:null,p192:null,p25519:null};function P(A,h){this.name=A,this.p=new s(h,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}P.prototype._tmp=function(){var h=new s(null);return h.words=new Array(Math.ceil(this.n/13)),h},P.prototype.ireduce=function(h){var p=h,m;do this.split(p,this.tmp),p=this.imulK(p),p=p.iadd(this.tmp),m=p.bitLength();while(m>this.n);var y=m<this.n?-1:p.ucmp(this.p);return y===0?(p.words[0]=0,p.length=1):y>0?p.isub(this.p):p.strip!==void 0?p.strip():p._strip(),p},P.prototype.split=function(h,p){h.iushrn(this.n,0,p)},P.prototype.imulK=function(h){return h.imul(this.k)};function T(){P.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}n(T,P),T.prototype.split=function(h,p){for(var m=4194303,y=Math.min(h.length,9),w=0;w<y;w++)p.words[w]=h.words[w];if(p.length=y,h.length<=9){h.words[0]=0,h.length=1;return}var S=h.words[9];for(p.words[p.length++]=S&m,w=10;w<h.length;w++){var O=h.words[w]|0;h.words[w-10]=(O&m)<<4|S>>>22,S=O}S>>>=22,h.words[w-10]=S,S===0&&h.length>10?h.length-=10:h.length-=9},T.prototype.imulK=function(h){h.words[h.length]=0,h.words[h.length+1]=0,h.length+=2;for(var p=0,m=0;m<h.length;m++){var y=h.words[m]|0;p+=y*977,h.words[m]=p&67108863,p=y*64+(p/67108864|0)}return h.words[h.length-1]===0&&(h.length--,h.words[h.length-1]===0&&h.length--),h};function N(){P.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}n(N,P);function C(){P.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}n(C,P);function B(){P.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}n(B,P),B.prototype.imulK=function(h){for(var p=0,m=0;m<h.length;m++){var y=(h.words[m]|0)*19+p,w=y&67108863;y>>>=26,h.words[m]=w,p=y}return p!==0&&(h.words[h.length++]=p),h},s._prime=function(h){if(M[h])return M[h];var p;if(h==="k256")p=new T;else if(h==="p224")p=new N;else if(h==="p192")p=new C;else if(h==="p25519")p=new B;else throw new Error("Unknown prime "+h);return M[h]=p,p};function R(A){if(typeof A=="string"){var h=s._prime(A);this.m=h.p,this.prime=h}else i(A.gtn(1),"modulus must be greater than 1"),this.m=A,this.prime=null}R.prototype._verify1=function(h){i(h.negative===0,"red works only with positives"),i(h.red,"red works only with red numbers")},R.prototype._verify2=function(h,p){i((h.negative|p.negative)===0,"red works only with positives"),i(h.red&&h.red===p.red,"red works only with red numbers")},R.prototype.imod=function(h){return this.prime?this.prime.ireduce(h)._forceRed(this):h.umod(this.m)._forceRed(this)},R.prototype.neg=function(h){return h.isZero()?h.clone():this.m.sub(h)._forceRed(this)},R.prototype.add=function(h,p){this._verify2(h,p);var m=h.add(p);return m.cmp(this.m)>=0&&m.isub(this.m),m._forceRed(this)},R.prototype.iadd=function(h,p){this._verify2(h,p);var m=h.iadd(p);return m.cmp(this.m)>=0&&m.isub(this.m),m},R.prototype.sub=function(h,p){this._verify2(h,p);var m=h.sub(p);return m.cmpn(0)<0&&m.iadd(this.m),m._forceRed(this)},R.prototype.isub=function(h,p){this._verify2(h,p);var m=h.isub(p);return m.cmpn(0)<0&&m.iadd(this.m),m},R.prototype.shl=function(h,p){return this._verify1(h),this.imod(h.ushln(p))},R.prototype.imul=function(h,p){return this._verify2(h,p),this.imod(h.imul(p))},R.prototype.mul=function(h,p){return this._verify2(h,p),this.imod(h.mul(p))},R.prototype.isqr=function(h){return this.imul(h,h.clone())},R.prototype.sqr=function(h){return this.mul(h,h)},R.prototype.sqrt=function(h){if(h.isZero())return h.clone();var p=this.m.andln(3);if(i(p%2===1),p===3){var m=this.m.add(new s(1)).iushrn(2);return this.pow(h,m)}for(var y=this.m.subn(1),w=0;!y.isZero()&&y.andln(1)===0;)w++,y.iushrn(1);i(!y.isZero());var S=new s(1).toRed(this),O=S.redNeg(),_=this.m.subn(1).iushrn(1),l=this.m.bitLength();for(l=new s(2*l*l).toRed(this);this.pow(l,_).cmp(O)!==0;)l.redIAdd(O);for(var x=this.pow(l,y),F=this.pow(h,y.addn(1).iushrn(1)),L=this.pow(h,y),U=w;L.cmp(S)!==0;){for(var j=L,K=0;j.cmp(S)!==0;K++)j=j.redSqr();i(K<U);var W=this.pow(x,new s(1).iushln(U-K-1));F=F.redMul(W),x=W.redSqr(),L=L.redMul(x),U=K}return F},R.prototype.invm=function(h){var p=h._invmp(this.m);return p.negative!==0?(p.negative=0,this.imod(p).redNeg()):this.imod(p)},R.prototype.pow=function(h,p){if(p.isZero())return new s(1).toRed(this);if(p.cmpn(1)===0)return h.clone();var m=4,y=new Array(1<<m);y[0]=new s(1).toRed(this),y[1]=h;for(var w=2;w<y.length;w++)y[w]=this.mul(y[w-1],h);var S=y[0],O=0,_=0,l=p.bitLength()%26;for(l===0&&(l=26),w=p.length-1;w>=0;w--){for(var x=p.words[w],F=l-1;F>=0;F--){var L=x>>F&1;if(S!==y[0]&&(S=this.sqr(S)),L===0&&O===0){_=0;continue}O<<=1,O|=L,_++,!(_!==m&&(w!==0||F!==0))&&(S=this.mul(S,y[O]),_=0,O=0)}l=26}return S},R.prototype.convertTo=function(h){var p=h.umod(this.m);return p===h?p.clone():p},R.prototype.convertFrom=function(h){var p=h.clone();return p.red=null,p},s.mont=function(h){return new V(h)};function V(A){R.call(this,A),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}n(V,R),V.prototype.convertTo=function(h){return this.imod(h.ushln(this.shift))},V.prototype.convertFrom=function(h){var p=this.imod(h.mul(this.rinv));return p.red=null,p},V.prototype.imul=function(h,p){if(h.isZero()||p.isZero())return h.words[0]=0,h.length=1,h;var m=h.imul(p),y=m.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),w=m.isub(y).iushrn(this.shift),S=w;return w.cmp(this.m)>=0?S=w.isub(this.m):w.cmpn(0)<0&&(S=w.iadd(this.m)),S._forceRed(this)},V.prototype.mul=function(h,p){if(h.isZero()||p.isZero())return new s(0)._forceRed(this);var m=h.mul(p),y=m.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),w=m.isub(y).iushrn(this.shift),S=w;return w.cmp(this.m)>=0?S=w.isub(this.m):w.cmpn(0)<0&&(S=w.iadd(this.m)),S._forceRed(this)},V.prototype.invm=function(h){var p=this.imod(h._invmp(this.m).mul(this.r2));return p._forceRed(this)}})(t,Jt)})(lr);var wi=tl;function tl(t,e){if(!t)throw new Error(e||"Assertion failed")}tl.equal=function(e,r,i){if(e!=r)throw new Error(i||"Assertion failed: "+e+" != "+r)};var cc={};(function(t){var e=t;function r(s,o){if(Array.isArray(s))return s.slice();if(!s)return[];var a=[];if(typeof s!="string"){for(var c=0;c<s.length;c++)a[c]=s[c]|0;return a}if(o==="hex"){s=s.replace(/[^a-z0-9]+/ig,""),s.length%2!==0&&(s="0"+s);for(var c=0;c<s.length;c+=2)a.push(parseInt(s[c]+s[c+1],16))}else for(var c=0;c<s.length;c++){var u=s.charCodeAt(c),f=u>>8,d=u&255;f?a.push(f,d):a.push(d)}return a}e.toArray=r;function i(s){return s.length===1?"0"+s:s}e.zero2=i;function n(s){for(var o="",a=0;a<s.length;a++)o+=i(s[a].toString(16));return o}e.toHex=n,e.encode=function(o,a){return a==="hex"?n(o):o}})(cc),function(t){var e=t,r=lr.exports,i=wi,n=cc;e.assert=i,e.toArray=n.toArray,e.zero2=n.zero2,e.toHex=n.toHex,e.encode=n.encode;function s(f,d,b){var v=new Array(Math.max(f.bitLength(),b)+1),g;for(g=0;g<v.length;g+=1)v[g]=0;var E=1<<d+1,I=f.clone();for(g=0;g<v.length;g++){var $,D=I.andln(E-1);I.isOdd()?(D>(E>>1)-1?$=(E>>1)-D:$=D,I.isubn($)):$=0,v[g]=$,I.iushrn(1)}return v}e.getNAF=s;function o(f,d){var b=[[],[]];f=f.clone(),d=d.clone();for(var v=0,g=0,E;f.cmpn(-v)>0||d.cmpn(-g)>0;){var I=f.andln(3)+v&3,$=d.andln(3)+g&3;I===3&&(I=-1),$===3&&($=-1);var D;(I&1)===0?D=0:(E=f.andln(7)+v&7,(E===3||E===5)&&$===2?D=-I:D=I),b[0].push(D);var M;($&1)===0?M=0:(E=d.andln(7)+g&7,(E===3||E===5)&&I===2?M=-$:M=$),b[1].push(M),2*v===D+1&&(v=1-v),2*g===M+1&&(g=1-g),f.iushrn(1),d.iushrn(1)}return b}e.getJSF=o;function a(f,d,b){var v="_"+d;f.prototype[d]=function(){return this[v]!==void 0?this[v]:this[v]=b.call(this)}}e.cachedProperty=a;function c(f){return typeof f=="string"?e.toArray(f,"hex"):f}e.parseBytes=c;function u(f){return new r(f,"hex","le")}e.intFromLE=u}(Lt);var ro={exports:{}},uc;ro.exports=function(e){return uc||(uc=new Qr(null)),uc.generate(e)};function Qr(t){this.rand=t}if(ro.exports.Rand=Qr,Qr.prototype.generate=function(e){return this._rand(e)},Qr.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var r=new Uint8Array(e),i=0;i<r.length;i++)r[i]=this.rand.getByte();return r},typeof self=="object")self.crypto&&self.crypto.getRandomValues?Qr.prototype._rand=function(e){var r=new Uint8Array(e);return self.crypto.getRandomValues(r),r}:self.msCrypto&&self.msCrypto.getRandomValues?Qr.prototype._rand=function(e){var r=new Uint8Array(e);return self.msCrypto.getRandomValues(r),r}:typeof window=="object"&&(Qr.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var rl=el;if(typeof rl.randomBytes!="function")throw new Error("Not supported");Qr.prototype._rand=function(e){return rl.randomBytes(e)}}catch{}var fc={},_i=lr.exports,jn=Lt,io=jn.getNAF,q6=jn.getJSF,no=jn.assert;function ei(t,e){this.type=t,this.p=new _i(e.p,16),this.red=e.prime?_i.red(e.prime):_i.mont(this.p),this.zero=new _i(0).toRed(this.red),this.one=new _i(1).toRed(this.red),this.two=new _i(2).toRed(this.red),this.n=e.n&&new _i(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var so=ei;ei.prototype.point=function(){throw new Error("Not implemented")},ei.prototype.validate=function(){throw new Error("Not implemented")},ei.prototype._fixedNafMul=function(e,r){no(e.precomputed);var i=e._getDoubles(),n=io(r,1,this._bitLength),s=(1<<i.step+1)-(i.step%2===0?2:1);s/=3;var o=[],a,c;for(a=0;a<n.length;a+=i.step){c=0;for(var u=a+i.step-1;u>=a;u--)c=(c<<1)+n[u];o.push(c)}for(var f=this.jpoint(null,null,null),d=this.jpoint(null,null,null),b=s;b>0;b--){for(a=0;a<o.length;a++)c=o[a],c===b?d=d.mixedAdd(i.points[a]):c===-b&&(d=d.mixedAdd(i.points[a].neg()));f=f.add(d)}return f.toP()},ei.prototype._wnafMul=function(e,r){var i=4,n=e._getNAFPoints(i);i=n.wnd;for(var s=n.points,o=io(r,i,this._bitLength),a=this.jpoint(null,null,null),c=o.length-1;c>=0;c--){for(var u=0;c>=0&&o[c]===0;c--)u++;if(c>=0&&u++,a=a.dblp(u),c<0)break;var f=o[c];no(f!==0),e.type==="affine"?f>0?a=a.mixedAdd(s[f-1>>1]):a=a.mixedAdd(s[-f-1>>1].neg()):f>0?a=a.add(s[f-1>>1]):a=a.add(s[-f-1>>1].neg())}return e.type==="affine"?a.toP():a},ei.prototype._wnafMulAdd=function(e,r,i,n,s){var o=this._wnafT1,a=this._wnafT2,c=this._wnafT3,u=0,f,d,b;for(f=0;f<n;f++){b=r[f];var v=b._getNAFPoints(e);o[f]=v.wnd,a[f]=v.points}for(f=n-1;f>=1;f-=2){var g=f-1,E=f;if(o[g]!==1||o[E]!==1){c[g]=io(i[g],o[g],this._bitLength),c[E]=io(i[E],o[E],this._bitLength),u=Math.max(c[g].length,u),u=Math.max(c[E].length,u);continue}var I=[r[g],null,null,r[E]];r[g].y.cmp(r[E].y)===0?(I[1]=r[g].add(r[E]),I[2]=r[g].toJ().mixedAdd(r[E].neg())):r[g].y.cmp(r[E].y.redNeg())===0?(I[1]=r[g].toJ().mixedAdd(r[E]),I[2]=r[g].add(r[E].neg())):(I[1]=r[g].toJ().mixedAdd(r[E]),I[2]=r[g].toJ().mixedAdd(r[E].neg()));var $=[-3,-1,-5,-7,0,7,5,1,3],D=q6(i[g],i[E]);for(u=Math.max(D[0].length,u),c[g]=new Array(u),c[E]=new Array(u),d=0;d<u;d++){var M=D[0][d]|0,P=D[1][d]|0;c[g][d]=$[(M+1)*3+(P+1)],c[E][d]=0,a[g]=I}}var T=this.jpoint(null,null,null),N=this._wnafT4;for(f=u;f>=0;f--){for(var C=0;f>=0;){var B=!0;for(d=0;d<n;d++)N[d]=c[d][f]|0,N[d]!==0&&(B=!1);if(!B)break;C++,f--}if(f>=0&&C++,T=T.dblp(C),f<0)break;for(d=0;d<n;d++){var R=N[d];R!==0&&(R>0?b=a[d][R-1>>1]:R<0&&(b=a[d][-R-1>>1].neg()),b.type==="affine"?T=T.mixedAdd(b):T=T.add(b))}}for(f=0;f<n;f++)a[f]=null;return s?T:T.toP()};function Kt(t,e){this.curve=t,this.type=e,this.precomputed=null}ei.BasePoint=Kt,Kt.prototype.eq=function(){throw new Error("Not implemented")},Kt.prototype.validate=function(){return this.curve.validate(this)},ei.prototype.decodePoint=function(e,r){e=jn.toArray(e,r);var i=this.p.byteLength();if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1===2*i){e[0]===6?no(e[e.length-1]%2===0):e[0]===7&&no(e[e.length-1]%2===1);var n=this.point(e.slice(1,1+i),e.slice(1+i,1+2*i));return n}else if((e[0]===2||e[0]===3)&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),e[0]===3);throw new Error("Unknown point format")},Kt.prototype.encodeCompressed=function(e){return this.encode(e,!0)},Kt.prototype._encode=function(e){var r=this.curve.p.byteLength(),i=this.getX().toArray("be",r);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",r))},Kt.prototype.encode=function(e,r){return jn.encode(this._encode(r),e)},Kt.prototype.precompute=function(e){if(this.precomputed)return this;var r={doubles:null,naf:null,beta:null};return r.naf=this._getNAFPoints(8),r.doubles=this._getDoubles(4,e),r.beta=this._getBeta(),this.precomputed=r,this},Kt.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var r=this.precomputed.doubles;return r?r.points.length>=Math.ceil((e.bitLength()+1)/r.step):!1},Kt.prototype._getDoubles=function(e,r){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],n=this,s=0;s<r;s+=e){for(var o=0;o<e;o++)n=n.dbl();i.push(n)}return{step:e,points:i}},Kt.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var r=[this],i=(1<<e)-1,n=i===1?null:this.dbl(),s=1;s<i;s++)r[s]=r[s-1].add(n);return{wnd:e,points:r}},Kt.prototype._getBeta=function(){return null},Kt.prototype.dblp=function(e){for(var r=this,i=0;i<e;i++)r=r.dbl();return r};var nn={exports:{}};typeof Object.create=="function"?nn.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:nn.exports=function(e,r){if(r){e.super_=r;var i=function(){};i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e}};var z6=Lt,_e=lr.exports,hc=nn.exports,sn=so,k6=z6.assert;function Ht(t){sn.call(this,"short",t),this.a=new _e(t.a,16).toRed(this.red),this.b=new _e(t.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(t),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}hc(Ht,sn);var j6=Ht;Ht.prototype._getEndomorphism=function(e){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var r,i;if(e.beta)r=new _e(e.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);r=n[0].cmp(n[1])<0?n[0]:n[1],r=r.toRed(this.red)}if(e.lambda)i=new _e(e.lambda,16);else{var s=this._getEndoRoots(this.n);this.g.mul(s[0]).x.cmp(this.g.x.redMul(r))===0?i=s[0]:(i=s[1],k6(this.g.mul(i).x.cmp(this.g.x.redMul(r))===0))}var o;return e.basis?o=e.basis.map(function(a){return{a:new _e(a.a,16),b:new _e(a.b,16)}}):o=this._getEndoBasis(i),{beta:r,lambda:i,basis:o}}},Ht.prototype._getEndoRoots=function(e){var r=e===this.p?this.red:_e.mont(e),i=new _e(2).toRed(r).redInvm(),n=i.redNeg(),s=new _e(3).toRed(r).redNeg().redSqrt().redMul(i),o=n.redAdd(s).fromRed(),a=n.redSub(s).fromRed();return[o,a]},Ht.prototype._getEndoBasis=function(e){for(var r=this.n.ushrn(Math.floor(this.n.bitLength()/2)),i=e,n=this.n.clone(),s=new _e(1),o=new _e(0),a=new _e(0),c=new _e(1),u,f,d,b,v,g,E,I=0,$,D;i.cmpn(0)!==0;){var M=n.div(i);$=n.sub(M.mul(i)),D=a.sub(M.mul(s));var P=c.sub(M.mul(o));if(!d&&$.cmp(r)<0)u=E.neg(),f=s,d=$.neg(),b=D;else if(d&&++I===2)break;E=$,n=i,i=$,a=s,s=D,c=o,o=P}v=$.neg(),g=D;var T=d.sqr().add(b.sqr()),N=v.sqr().add(g.sqr());return N.cmp(T)>=0&&(v=u,g=f),d.negative&&(d=d.neg(),b=b.neg()),v.negative&&(v=v.neg(),g=g.neg()),[{a:d,b},{a:v,b:g}]},Ht.prototype._endoSplit=function(e){var r=this.endo.basis,i=r[0],n=r[1],s=n.b.mul(e).divRound(this.n),o=i.b.neg().mul(e).divRound(this.n),a=s.mul(i.a),c=o.mul(n.a),u=s.mul(i.b),f=o.mul(n.b),d=e.sub(a).sub(c),b=u.add(f).neg();return{k1:d,k2:b}},Ht.prototype.pointFromX=function(e,r){e=new _e(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=i.redSqrt();if(n.redSqr().redSub(i).cmp(this.zero)!==0)throw new Error("invalid point");var s=n.fromRed().isOdd();return(r&&!s||!r&&s)&&(n=n.redNeg()),this.point(e,n)},Ht.prototype.validate=function(e){if(e.inf)return!0;var r=e.x,i=e.y,n=this.a.redMul(r),s=r.redSqr().redMul(r).redIAdd(n).redIAdd(this.b);return i.redSqr().redISub(s).cmpn(0)===0},Ht.prototype._endoWnafMulAdd=function(e,r,i){for(var n=this._endoWnafT1,s=this._endoWnafT2,o=0;o<e.length;o++){var a=this._endoSplit(r[o]),c=e[o],u=c._getBeta();a.k1.negative&&(a.k1.ineg(),c=c.neg(!0)),a.k2.negative&&(a.k2.ineg(),u=u.neg(!0)),n[o*2]=c,n[o*2+1]=u,s[o*2]=a.k1,s[o*2+1]=a.k2}for(var f=this._wnafMulAdd(1,n,s,o*2,i),d=0;d<o*2;d++)n[d]=null,s[d]=null;return f};function ot(t,e,r,i){sn.BasePoint.call(this,t,"affine"),e===null&&r===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new _e(e,16),this.y=new _e(r,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}hc(ot,sn.BasePoint),Ht.prototype.point=function(e,r,i){return new ot(this,e,r,i)},Ht.prototype.pointFromJSON=function(e,r){return ot.fromJSON(this,e,r)},ot.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var r=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,n=function(s){return i.point(s.x.redMul(i.endo.beta),s.y)};e.beta=r,r.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return r}},ot.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},ot.fromJSON=function(e,r,i){typeof r=="string"&&(r=JSON.parse(r));var n=e.point(r[0],r[1],i);if(!r[2])return n;function s(a){return e.point(a[0],a[1],i)}var o=r[2];return n.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[n].concat(o.doubles.points.map(s))},naf:o.naf&&{wnd:o.naf.wnd,points:[n].concat(o.naf.points.map(s))}},n},ot.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},ot.prototype.isInfinity=function(){return this.inf},ot.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(this.x.cmp(e.x)===0)return this.curve.point(null,null);var r=this.y.redSub(e.y);r.cmpn(0)!==0&&(r=r.redMul(this.x.redSub(e.x).redInvm()));var i=r.redSqr().redISub(this.x).redISub(e.x),n=r.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,n)},ot.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(e.cmpn(0)===0)return this.curve.point(null,null);var r=this.curve.a,i=this.x.redSqr(),n=e.redInvm(),s=i.redAdd(i).redIAdd(i).redIAdd(r).redMul(n),o=s.redSqr().redISub(this.x.redAdd(this.x)),a=s.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,a)},ot.prototype.getX=function(){return this.x.fromRed()},ot.prototype.getY=function(){return this.y.fromRed()},ot.prototype.mul=function(e){return e=new _e(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},ot.prototype.mulAdd=function(e,r,i){var n=[this,r],s=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(n,s):this.curve._wnafMulAdd(1,n,s,2)},ot.prototype.jmulAdd=function(e,r,i){var n=[this,r],s=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(n,s,!0):this.curve._wnafMulAdd(1,n,s,2,!0)},ot.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||this.x.cmp(e.x)===0&&this.y.cmp(e.y)===0)},ot.prototype.neg=function(e){if(this.inf)return this;var r=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,n=function(s){return s.neg()};r.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(n)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(n)}}}return r},ot.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var e=this.curve.jpoint(this.x,this.y,this.curve.one);return e};function lt(t,e,r,i){sn.BasePoint.call(this,t,"jacobian"),e===null&&r===null&&i===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new _e(0)):(this.x=new _e(e,16),this.y=new _e(r,16),this.z=new _e(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}hc(lt,sn.BasePoint),Ht.prototype.jpoint=function(e,r,i){return new lt(this,e,r,i)},lt.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),r=e.redSqr(),i=this.x.redMul(r),n=this.y.redMul(r).redMul(e);return this.curve.point(i,n)},lt.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},lt.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var r=e.z.redSqr(),i=this.z.redSqr(),n=this.x.redMul(r),s=e.x.redMul(i),o=this.y.redMul(r.redMul(e.z)),a=e.y.redMul(i.redMul(this.z)),c=n.redSub(s),u=o.redSub(a);if(c.cmpn(0)===0)return u.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var f=c.redSqr(),d=f.redMul(c),b=n.redMul(f),v=u.redSqr().redIAdd(d).redISub(b).redISub(b),g=u.redMul(b.redISub(v)).redISub(o.redMul(d)),E=this.z.redMul(e.z).redMul(c);return this.curve.jpoint(v,g,E)},lt.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var r=this.z.redSqr(),i=this.x,n=e.x.redMul(r),s=this.y,o=e.y.redMul(r).redMul(this.z),a=i.redSub(n),c=s.redSub(o);if(a.cmpn(0)===0)return c.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var u=a.redSqr(),f=u.redMul(a),d=i.redMul(u),b=c.redSqr().redIAdd(f).redISub(d).redISub(d),v=c.redMul(d.redISub(b)).redISub(s.redMul(f)),g=this.z.redMul(a);return this.curve.jpoint(b,v,g)},lt.prototype.dblp=function(e){if(e===0)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var r;if(this.curve.zeroA||this.curve.threeA){var i=this;for(r=0;r<e;r++)i=i.dbl();return i}var n=this.curve.a,s=this.curve.tinv,o=this.x,a=this.y,c=this.z,u=c.redSqr().redSqr(),f=a.redAdd(a);for(r=0;r<e;r++){var d=o.redSqr(),b=f.redSqr(),v=b.redSqr(),g=d.redAdd(d).redIAdd(d).redIAdd(n.redMul(u)),E=o.redMul(b),I=g.redSqr().redISub(E.redAdd(E)),$=E.redISub(I),D=g.redMul($);D=D.redIAdd(D).redISub(v);var M=f.redMul(c);r+1<e&&(u=u.redMul(v)),o=I,c=M,f=D}return this.curve.jpoint(o,f.redMul(s),c)},lt.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},lt.prototype._zeroDbl=function(){var e,r,i;if(this.zOne){var n=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(n).redISub(o);a=a.redIAdd(a);var c=n.redAdd(n).redIAdd(n),u=c.redSqr().redISub(a).redISub(a),f=o.redIAdd(o);f=f.redIAdd(f),f=f.redIAdd(f),e=u,r=c.redMul(a.redISub(u)).redISub(f),i=this.y.redAdd(this.y)}else{var d=this.x.redSqr(),b=this.y.redSqr(),v=b.redSqr(),g=this.x.redAdd(b).redSqr().redISub(d).redISub(v);g=g.redIAdd(g);var E=d.redAdd(d).redIAdd(d),I=E.redSqr(),$=v.redIAdd(v);$=$.redIAdd($),$=$.redIAdd($),e=I.redISub(g).redISub(g),r=E.redMul(g.redISub(e)).redISub($),i=this.y.redMul(this.z),i=i.redIAdd(i)}return this.curve.jpoint(e,r,i)},lt.prototype._threeDbl=function(){var e,r,i;if(this.zOne){var n=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(n).redISub(o);a=a.redIAdd(a);var c=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),u=c.redSqr().redISub(a).redISub(a);e=u;var f=o.redIAdd(o);f=f.redIAdd(f),f=f.redIAdd(f),r=c.redMul(a.redISub(u)).redISub(f),i=this.y.redAdd(this.y)}else{var d=this.z.redSqr(),b=this.y.redSqr(),v=this.x.redMul(b),g=this.x.redSub(d).redMul(this.x.redAdd(d));g=g.redAdd(g).redIAdd(g);var E=v.redIAdd(v);E=E.redIAdd(E);var I=E.redAdd(E);e=g.redSqr().redISub(I),i=this.y.redAdd(this.z).redSqr().redISub(b).redISub(d);var $=b.redSqr();$=$.redIAdd($),$=$.redIAdd($),$=$.redIAdd($),r=g.redMul(E.redISub(e)).redISub($)}return this.curve.jpoint(e,r,i)},lt.prototype._dbl=function(){var e=this.curve.a,r=this.x,i=this.y,n=this.z,s=n.redSqr().redSqr(),o=r.redSqr(),a=i.redSqr(),c=o.redAdd(o).redIAdd(o).redIAdd(e.redMul(s)),u=r.redAdd(r);u=u.redIAdd(u);var f=u.redMul(a),d=c.redSqr().redISub(f.redAdd(f)),b=f.redISub(d),v=a.redSqr();v=v.redIAdd(v),v=v.redIAdd(v),v=v.redIAdd(v);var g=c.redMul(b).redISub(v),E=i.redAdd(i).redMul(n);return this.curve.jpoint(d,g,E)},lt.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),r=this.y.redSqr(),i=this.z.redSqr(),n=r.redSqr(),s=e.redAdd(e).redIAdd(e),o=s.redSqr(),a=this.x.redAdd(r).redSqr().redISub(e).redISub(n);a=a.redIAdd(a),a=a.redAdd(a).redIAdd(a),a=a.redISub(o);var c=a.redSqr(),u=n.redIAdd(n);u=u.redIAdd(u),u=u.redIAdd(u),u=u.redIAdd(u);var f=s.redIAdd(a).redSqr().redISub(o).redISub(c).redISub(u),d=r.redMul(f);d=d.redIAdd(d),d=d.redIAdd(d);var b=this.x.redMul(c).redISub(d);b=b.redIAdd(b),b=b.redIAdd(b);var v=this.y.redMul(f.redMul(u.redISub(f)).redISub(a.redMul(c)));v=v.redIAdd(v),v=v.redIAdd(v),v=v.redIAdd(v);var g=this.z.redAdd(a).redSqr().redISub(i).redISub(c);return this.curve.jpoint(b,v,g)},lt.prototype.mul=function(e,r){return e=new _e(e,r),this.curve._wnafMul(this,e)},lt.prototype.eq=function(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e)return!0;var r=this.z.redSqr(),i=e.z.redSqr();if(this.x.redMul(i).redISub(e.x.redMul(r)).cmpn(0)!==0)return!1;var n=r.redMul(this.z),s=i.redMul(e.z);return this.y.redMul(s).redISub(e.y.redMul(n)).cmpn(0)===0},lt.prototype.eqXToP=function(e){var r=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(r);if(this.x.cmp(i)===0)return!0;for(var n=e.clone(),s=this.curve.redN.redMul(r);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(s),this.x.cmp(i)===0)return!0}},lt.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},lt.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var on=lr.exports,il=nn.exports,oo=so,V6=Lt;function an(t){oo.call(this,"mont",t),this.a=new on(t.a,16).toRed(this.red),this.b=new on(t.b,16).toRed(this.red),this.i4=new on(4).toRed(this.red).redInvm(),this.two=new on(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}il(an,oo);var K6=an;an.prototype.validate=function(e){var r=e.normalize().x,i=r.redSqr(),n=i.redMul(r).redAdd(i.redMul(this.a)).redAdd(r),s=n.redSqrt();return s.redSqr().cmp(n)===0};function at(t,e,r){oo.BasePoint.call(this,t,"projective"),e===null&&r===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new on(e,16),this.z=new on(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}il(at,oo.BasePoint),an.prototype.decodePoint=function(e,r){return this.point(V6.toArray(e,r),1)},an.prototype.point=function(e,r){return new at(this,e,r)},an.prototype.pointFromJSON=function(e){return at.fromJSON(this,e)},at.prototype.precompute=function(){},at.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},at.fromJSON=function(e,r){return new at(e,r[0],r[1]||e.one)},at.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},at.prototype.isInfinity=function(){return this.z.cmpn(0)===0},at.prototype.dbl=function(){var e=this.x.redAdd(this.z),r=e.redSqr(),i=this.x.redSub(this.z),n=i.redSqr(),s=r.redSub(n),o=r.redMul(n),a=s.redMul(n.redAdd(this.curve.a24.redMul(s)));return this.curve.point(o,a)},at.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},at.prototype.diffAdd=function(e,r){var i=this.x.redAdd(this.z),n=this.x.redSub(this.z),s=e.x.redAdd(e.z),o=e.x.redSub(e.z),a=o.redMul(i),c=s.redMul(n),u=r.z.redMul(a.redAdd(c).redSqr()),f=r.x.redMul(a.redISub(c).redSqr());return this.curve.point(u,f)},at.prototype.mul=function(e){for(var r=e.clone(),i=this,n=this.curve.point(null,null),s=this,o=[];r.cmpn(0)!==0;r.iushrn(1))o.push(r.andln(1));for(var a=o.length-1;a>=0;a--)o[a]===0?(i=i.diffAdd(n,s),n=n.dbl()):(n=i.diffAdd(n,s),i=i.dbl());return n},at.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},at.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},at.prototype.eq=function(e){return this.getX().cmp(e.getX())===0},at.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},at.prototype.getX=function(){return this.normalize(),this.x.fromRed()};var H6=Lt,Br=lr.exports,nl=nn.exports,ao=so,W6=H6.assert;function pr(t){this.twisted=(t.a|0)!==1,this.mOneA=this.twisted&&(t.a|0)===-1,this.extended=this.mOneA,ao.call(this,"edwards",t),this.a=new Br(t.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new Br(t.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new Br(t.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),W6(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(t.c|0)===1}nl(pr,ao);var G6=pr;pr.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},pr.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},pr.prototype.jpoint=function(e,r,i,n){return this.point(e,r,i,n)},pr.prototype.pointFromX=function(e,r){e=new Br(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr(),n=this.c2.redSub(this.a.redMul(i)),s=this.one.redSub(this.c2.redMul(this.d).redMul(i)),o=n.redMul(s.redInvm()),a=o.redSqrt();if(a.redSqr().redSub(o).cmp(this.zero)!==0)throw new Error("invalid point");var c=a.fromRed().isOdd();return(r&&!c||!r&&c)&&(a=a.redNeg()),this.point(e,a)},pr.prototype.pointFromY=function(e,r){e=new Br(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr(),n=i.redSub(this.c2),s=i.redMul(this.d).redMul(this.c2).redSub(this.a),o=n.redMul(s.redInvm());if(o.cmp(this.zero)===0){if(r)throw new Error("invalid point");return this.point(this.zero,e)}var a=o.redSqrt();if(a.redSqr().redSub(o).cmp(this.zero)!==0)throw new Error("invalid point");return a.fromRed().isOdd()!==r&&(a=a.redNeg()),this.point(a,e)},pr.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var r=e.x.redSqr(),i=e.y.redSqr(),n=r.redMul(this.a).redAdd(i),s=this.c2.redMul(this.one.redAdd(this.d.redMul(r).redMul(i)));return n.cmp(s)===0};function de(t,e,r,i,n){ao.BasePoint.call(this,t,"projective"),e===null&&r===null&&i===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new Br(e,16),this.y=new Br(r,16),this.z=i?new Br(i,16):this.curve.one,this.t=n&&new Br(n,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}nl(de,ao.BasePoint),pr.prototype.pointFromJSON=function(e){return de.fromJSON(this,e)},pr.prototype.point=function(e,r,i,n){return new de(this,e,r,i,n)},de.fromJSON=function(e,r){return new de(e,r[0],r[1],r[2])},de.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},de.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)},de.prototype._extDbl=function(){var e=this.x.redSqr(),r=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var n=this.curve._mulA(e),s=this.x.redAdd(this.y).redSqr().redISub(e).redISub(r),o=n.redAdd(r),a=o.redSub(i),c=n.redSub(r),u=s.redMul(a),f=o.redMul(c),d=s.redMul(c),b=a.redMul(o);return this.curve.point(u,f,b,d)},de.prototype._projDbl=function(){var e=this.x.redAdd(this.y).redSqr(),r=this.x.redSqr(),i=this.y.redSqr(),n,s,o,a,c,u;if(this.curve.twisted){a=this.curve._mulA(r);var f=a.redAdd(i);this.zOne?(n=e.redSub(r).redSub(i).redMul(f.redSub(this.curve.two)),s=f.redMul(a.redSub(i)),o=f.redSqr().redSub(f).redSub(f)):(c=this.z.redSqr(),u=f.redSub(c).redISub(c),n=e.redSub(r).redISub(i).redMul(u),s=f.redMul(a.redSub(i)),o=f.redMul(u))}else a=r.redAdd(i),c=this.curve._mulC(this.z).redSqr(),u=a.redSub(c).redSub(c),n=this.curve._mulC(e.redISub(a)).redMul(u),s=this.curve._mulC(a).redMul(r.redISub(i)),o=a.redMul(u);return this.curve.point(n,s,o)},de.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},de.prototype._extAdd=function(e){var r=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),n=this.t.redMul(this.curve.dd).redMul(e.t),s=this.z.redMul(e.z.redAdd(e.z)),o=i.redSub(r),a=s.redSub(n),c=s.redAdd(n),u=i.redAdd(r),f=o.redMul(a),d=c.redMul(u),b=o.redMul(u),v=a.redMul(c);return this.curve.point(f,d,v,b)},de.prototype._projAdd=function(e){var r=this.z.redMul(e.z),i=r.redSqr(),n=this.x.redMul(e.x),s=this.y.redMul(e.y),o=this.curve.d.redMul(n).redMul(s),a=i.redSub(o),c=i.redAdd(o),u=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(n).redISub(s),f=r.redMul(a).redMul(u),d,b;return this.curve.twisted?(d=r.redMul(c).redMul(s.redSub(this.curve._mulA(n))),b=a.redMul(c)):(d=r.redMul(c).redMul(s.redSub(n)),b=this.curve._mulC(a).redMul(c)),this.curve.point(f,d,b)},de.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},de.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},de.prototype.mulAdd=function(e,r,i){return this.curve._wnafMulAdd(1,[this,r],[e,i],2,!1)},de.prototype.jmulAdd=function(e,r,i){return this.curve._wnafMulAdd(1,[this,r],[e,i],2,!0)},de.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},de.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},de.prototype.getX=function(){return this.normalize(),this.x.fromRed()},de.prototype.getY=function(){return this.normalize(),this.y.fromRed()},de.prototype.eq=function(e){return this===e||this.getX().cmp(e.getX())===0&&this.getY().cmp(e.getY())===0},de.prototype.eqXToP=function(e){var r=e.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(r)===0)return!0;for(var i=e.clone(),n=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(n),this.x.cmp(r)===0)return!0}},de.prototype.toP=de.prototype.normalize,de.prototype.mixedAdd=de.prototype.add,function(t){var e=t;e.base=so,e.short=j6,e.mont=K6,e.edwards=G6}(fc);var co={},uo={},Z={},Y6=wi,X6=nn.exports;Z.inherits=X6;function J6(t,e){return(t.charCodeAt(e)&64512)!==55296||e<0||e+1>=t.length?!1:(t.charCodeAt(e+1)&64512)===56320}function Z6(t,e){if(Array.isArray(t))return t.slice();if(!t)return[];var r=[];if(typeof t=="string")if(e){if(e==="hex")for(t=t.replace(/[^a-z0-9]+/ig,""),t.length%2!==0&&(t="0"+t),n=0;n<t.length;n+=2)r.push(parseInt(t[n]+t[n+1],16))}else for(var i=0,n=0;n<t.length;n++){var s=t.charCodeAt(n);s<128?r[i++]=s:s<2048?(r[i++]=s>>6|192,r[i++]=s&63|128):J6(t,n)?(s=65536+((s&1023)<<10)+(t.charCodeAt(++n)&1023),r[i++]=s>>18|240,r[i++]=s>>12&63|128,r[i++]=s>>6&63|128,r[i++]=s&63|128):(r[i++]=s>>12|224,r[i++]=s>>6&63|128,r[i++]=s&63|128)}else for(n=0;n<t.length;n++)r[n]=t[n]|0;return r}Z.toArray=Z6;function Q6(t){for(var e="",r=0;r<t.length;r++)e+=ol(t[r].toString(16));return e}Z.toHex=Q6;function sl(t){var e=t>>>24|t>>>8&65280|t<<8&16711680|(t&255)<<24;return e>>>0}Z.htonl=sl;function e8(t,e){for(var r="",i=0;i<t.length;i++){var n=t[i];e==="little"&&(n=sl(n)),r+=al(n.toString(16))}return r}Z.toHex32=e8;function ol(t){return t.length===1?"0"+t:t}Z.zero2=ol;function al(t){return t.length===7?"0"+t:t.length===6?"00"+t:t.length===5?"000"+t:t.length===4?"0000"+t:t.length===3?"00000"+t:t.length===2?"000000"+t:t.length===1?"0000000"+t:t}Z.zero8=al;function t8(t,e,r,i){var n=r-e;Y6(n%4===0);for(var s=new Array(n/4),o=0,a=e;o<s.length;o++,a+=4){var c;i==="big"?c=t[a]<<24|t[a+1]<<16|t[a+2]<<8|t[a+3]:c=t[a+3]<<24|t[a+2]<<16|t[a+1]<<8|t[a],s[o]=c>>>0}return s}Z.join32=t8;function r8(t,e){for(var r=new Array(t.length*4),i=0,n=0;i<t.length;i++,n+=4){var s=t[i];e==="big"?(r[n]=s>>>24,r[n+1]=s>>>16&255,r[n+2]=s>>>8&255,r[n+3]=s&255):(r[n+3]=s>>>24,r[n+2]=s>>>16&255,r[n+1]=s>>>8&255,r[n]=s&255)}return r}Z.split32=r8;function i8(t,e){return t>>>e|t<<32-e}Z.rotr32=i8;function n8(t,e){return t<<e|t>>>32-e}Z.rotl32=n8;function s8(t,e){return t+e>>>0}Z.sum32=s8;function o8(t,e,r){return t+e+r>>>0}Z.sum32_3=o8;function a8(t,e,r,i){return t+e+r+i>>>0}Z.sum32_4=a8;function c8(t,e,r,i,n){return t+e+r+i+n>>>0}Z.sum32_5=c8;function u8(t,e,r,i){var n=t[e],s=t[e+1],o=i+s>>>0,a=(o<i?1:0)+r+n;t[e]=a>>>0,t[e+1]=o}Z.sum64=u8;function f8(t,e,r,i){var n=e+i>>>0,s=(n<e?1:0)+t+r;return s>>>0}Z.sum64_hi=f8;function h8(t,e,r,i){var n=e+i;return n>>>0}Z.sum64_lo=h8;function d8(t,e,r,i,n,s,o,a){var c=0,u=e;u=u+i>>>0,c+=u<e?1:0,u=u+s>>>0,c+=u<s?1:0,u=u+a>>>0,c+=u<a?1:0;var f=t+r+n+o+c;return f>>>0}Z.sum64_4_hi=d8;function l8(t,e,r,i,n,s,o,a){var c=e+i+s+a;return c>>>0}Z.sum64_4_lo=l8;function p8(t,e,r,i,n,s,o,a,c,u){var f=0,d=e;d=d+i>>>0,f+=d<e?1:0,d=d+s>>>0,f+=d<s?1:0,d=d+a>>>0,f+=d<a?1:0,d=d+u>>>0,f+=d<u?1:0;var b=t+r+n+o+c+f;return b>>>0}Z.sum64_5_hi=p8;function b8(t,e,r,i,n,s,o,a,c,u){var f=e+i+s+a+u;return f>>>0}Z.sum64_5_lo=b8;function g8(t,e,r){var i=e<<32-r|t>>>r;return i>>>0}Z.rotr64_hi=g8;function y8(t,e,r){var i=t<<32-r|e>>>r;return i>>>0}Z.rotr64_lo=y8;function v8(t,e,r){return t>>>r}Z.shr64_hi=v8;function m8(t,e,r){var i=t<<32-r|e>>>r;return i>>>0}Z.shr64_lo=m8;var cn={},cl=Z,w8=wi;function fo(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}cn.BlockHash=fo,fo.prototype.update=function(e,r){if(e=cl.toArray(e,r),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var i=e.length%this._delta8;this.pending=e.slice(e.length-i,e.length),this.pending.length===0&&(this.pending=null),e=cl.join32(e,0,e.length-i,this.endian);for(var n=0;n<e.length;n+=this._delta32)this._update(e,n,n+this._delta32)}return this},fo.prototype.digest=function(e){return this.update(this._pad()),w8(this.pending===null),this._digest(e)},fo.prototype._pad=function(){var e=this.pendingTotal,r=this._delta8,i=r-(e+this.padLength)%r,n=new Array(i+this.padLength);n[0]=128;for(var s=1;s<i;s++)n[s]=0;if(e<<=3,this.endian==="big"){for(var o=8;o<this.padLength;o++)n[s++]=0;n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=e>>>24&255,n[s++]=e>>>16&255,n[s++]=e>>>8&255,n[s++]=e&255}else for(n[s++]=e&255,n[s++]=e>>>8&255,n[s++]=e>>>16&255,n[s++]=e>>>24&255,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0,o=8;o<this.padLength;o++)n[s++]=0;return n};var un={},br={},_8=Z,gr=_8.rotr32;function E8(t,e,r,i){if(t===0)return ul(e,r,i);if(t===1||t===3)return hl(e,r,i);if(t===2)return fl(e,r,i)}br.ft_1=E8;function ul(t,e,r){return t&e^~t&r}br.ch32=ul;function fl(t,e,r){return t&e^t&r^e&r}br.maj32=fl;function hl(t,e,r){return t^e^r}br.p32=hl;function x8(t){return gr(t,2)^gr(t,13)^gr(t,22)}br.s0_256=x8;function S8(t){return gr(t,6)^gr(t,11)^gr(t,25)}br.s1_256=S8;function I8(t){return gr(t,7)^gr(t,18)^t>>>3}br.g0_256=I8;function A8(t){return gr(t,17)^gr(t,19)^t>>>10}br.g1_256=A8;var fn=Z,O8=cn,D8=br,dc=fn.rotl32,Vn=fn.sum32,$8=fn.sum32_5,M8=D8.ft_1,dl=O8.BlockHash,P8=[1518500249,1859775393,2400959708,3395469782];function yr(){if(!(this instanceof yr))return new yr;dl.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}fn.inherits(yr,dl);var R8=yr;yr.blockSize=512,yr.outSize=160,yr.hmacStrength=80,yr.padLength=64,yr.prototype._update=function(e,r){for(var i=this.W,n=0;n<16;n++)i[n]=e[r+n];for(;n<i.length;n++)i[n]=dc(i[n-3]^i[n-8]^i[n-14]^i[n-16],1);var s=this.h[0],o=this.h[1],a=this.h[2],c=this.h[3],u=this.h[4];for(n=0;n<i.length;n++){var f=~~(n/20),d=$8(dc(s,5),M8(f,o,a,c),u,i[n],P8[f]);u=c,c=a,a=dc(o,30),o=s,s=d}this.h[0]=Vn(this.h[0],s),this.h[1]=Vn(this.h[1],o),this.h[2]=Vn(this.h[2],a),this.h[3]=Vn(this.h[3],c),this.h[4]=Vn(this.h[4],u)},yr.prototype._digest=function(e){return e==="hex"?fn.toHex32(this.h,"big"):fn.split32(this.h,"big")};var hn=Z,T8=cn,dn=br,N8=wi,er=hn.sum32,C8=hn.sum32_4,B8=hn.sum32_5,F8=dn.ch32,L8=dn.maj32,U8=dn.s0_256,q8=dn.s1_256,z8=dn.g0_256,k8=dn.g1_256,ll=T8.BlockHash,j8=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function vr(){if(!(this instanceof vr))return new vr;ll.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=j8,this.W=new Array(64)}hn.inherits(vr,ll);var pl=vr;vr.blockSize=512,vr.outSize=256,vr.hmacStrength=192,vr.padLength=64,vr.prototype._update=function(e,r){for(var i=this.W,n=0;n<16;n++)i[n]=e[r+n];for(;n<i.length;n++)i[n]=C8(k8(i[n-2]),i[n-7],z8(i[n-15]),i[n-16]);var s=this.h[0],o=this.h[1],a=this.h[2],c=this.h[3],u=this.h[4],f=this.h[5],d=this.h[6],b=this.h[7];for(N8(this.k.length===i.length),n=0;n<i.length;n++){var v=B8(b,q8(u),F8(u,f,d),this.k[n],i[n]),g=er(U8(s),L8(s,o,a));b=d,d=f,f=u,u=er(c,v),c=a,a=o,o=s,s=er(v,g)}this.h[0]=er(this.h[0],s),this.h[1]=er(this.h[1],o),this.h[2]=er(this.h[2],a),this.h[3]=er(this.h[3],c),this.h[4]=er(this.h[4],u),this.h[5]=er(this.h[5],f),this.h[6]=er(this.h[6],d),this.h[7]=er(this.h[7],b)},vr.prototype._digest=function(e){return e==="hex"?hn.toHex32(this.h,"big"):hn.split32(this.h,"big")};var lc=Z,bl=pl;function Fr(){if(!(this instanceof Fr))return new Fr;bl.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}lc.inherits(Fr,bl);var V8=Fr;Fr.blockSize=512,Fr.outSize=224,Fr.hmacStrength=192,Fr.padLength=64,Fr.prototype._digest=function(e){return e==="hex"?lc.toHex32(this.h.slice(0,7),"big"):lc.split32(this.h.slice(0,7),"big")};var Tt=Z,K8=cn,H8=wi,mr=Tt.rotr64_hi,wr=Tt.rotr64_lo,gl=Tt.shr64_hi,yl=Tt.shr64_lo,ti=Tt.sum64,pc=Tt.sum64_hi,bc=Tt.sum64_lo,W8=Tt.sum64_4_hi,G8=Tt.sum64_4_lo,Y8=Tt.sum64_5_hi,X8=Tt.sum64_5_lo,vl=K8.BlockHash,J8=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function tr(){if(!(this instanceof tr))return new tr;vl.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=J8,this.W=new Array(160)}Tt.inherits(tr,vl);var ml=tr;tr.blockSize=1024,tr.outSize=512,tr.hmacStrength=192,tr.padLength=128,tr.prototype._prepareBlock=function(e,r){for(var i=this.W,n=0;n<32;n++)i[n]=e[r+n];for(;n<i.length;n+=2){var s=c4(i[n-4],i[n-3]),o=u4(i[n-4],i[n-3]),a=i[n-14],c=i[n-13],u=o4(i[n-30],i[n-29]),f=a4(i[n-30],i[n-29]),d=i[n-32],b=i[n-31];i[n]=W8(s,o,a,c,u,f,d,b),i[n+1]=G8(s,o,a,c,u,f,d,b)}},tr.prototype._update=function(e,r){this._prepareBlock(e,r);var i=this.W,n=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],c=this.h[4],u=this.h[5],f=this.h[6],d=this.h[7],b=this.h[8],v=this.h[9],g=this.h[10],E=this.h[11],I=this.h[12],$=this.h[13],D=this.h[14],M=this.h[15];H8(this.k.length===i.length);for(var P=0;P<i.length;P+=2){var T=D,N=M,C=n4(b,v),B=s4(b,v),R=Z8(b,v,g,E,I),V=Q8(b,v,g,E,I,$),A=this.k[P],h=this.k[P+1],p=i[P],m=i[P+1],y=Y8(T,N,C,B,R,V,A,h,p,m),w=X8(T,N,C,B,R,V,A,h,p,m);T=r4(n,s),N=i4(n,s),C=e4(n,s,o,a,c),B=t4(n,s,o,a,c,u);var S=pc(T,N,C,B),O=bc(T,N,C,B);D=I,M=$,I=g,$=E,g=b,E=v,b=pc(f,d,y,w),v=bc(d,d,y,w),f=c,d=u,c=o,u=a,o=n,a=s,n=pc(y,w,S,O),s=bc(y,w,S,O)}ti(this.h,0,n,s),ti(this.h,2,o,a),ti(this.h,4,c,u),ti(this.h,6,f,d),ti(this.h,8,b,v),ti(this.h,10,g,E),ti(this.h,12,I,$),ti(this.h,14,D,M)},tr.prototype._digest=function(e){return e==="hex"?Tt.toHex32(this.h,"big"):Tt.split32(this.h,"big")};function Z8(t,e,r,i,n){var s=t&r^~t&n;return s<0&&(s+=4294967296),s}function Q8(t,e,r,i,n,s){var o=e&i^~e&s;return o<0&&(o+=4294967296),o}function e4(t,e,r,i,n){var s=t&r^t&n^r&n;return s<0&&(s+=4294967296),s}function t4(t,e,r,i,n,s){var o=e&i^e&s^i&s;return o<0&&(o+=4294967296),o}function r4(t,e){var r=mr(t,e,28),i=mr(e,t,2),n=mr(e,t,7),s=r^i^n;return s<0&&(s+=4294967296),s}function i4(t,e){var r=wr(t,e,28),i=wr(e,t,2),n=wr(e,t,7),s=r^i^n;return s<0&&(s+=4294967296),s}function n4(t,e){var r=mr(t,e,14),i=mr(t,e,18),n=mr(e,t,9),s=r^i^n;return s<0&&(s+=4294967296),s}function s4(t,e){var r=wr(t,e,14),i=wr(t,e,18),n=wr(e,t,9),s=r^i^n;return s<0&&(s+=4294967296),s}function o4(t,e){var r=mr(t,e,1),i=mr(t,e,8),n=gl(t,e,7),s=r^i^n;return s<0&&(s+=4294967296),s}function a4(t,e){var r=wr(t,e,1),i=wr(t,e,8),n=yl(t,e,7),s=r^i^n;return s<0&&(s+=4294967296),s}function c4(t,e){var r=mr(t,e,19),i=mr(e,t,29),n=gl(t,e,6),s=r^i^n;return s<0&&(s+=4294967296),s}function u4(t,e){var r=wr(t,e,19),i=wr(e,t,29),n=yl(t,e,6),s=r^i^n;return s<0&&(s+=4294967296),s}var gc=Z,wl=ml;function Lr(){if(!(this instanceof Lr))return new Lr;wl.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}gc.inherits(Lr,wl);var f4=Lr;Lr.blockSize=1024,Lr.outSize=384,Lr.hmacStrength=192,Lr.padLength=128,Lr.prototype._digest=function(e){return e==="hex"?gc.toHex32(this.h.slice(0,12),"big"):gc.split32(this.h.slice(0,12),"big")},un.sha1=R8,un.sha224=V8,un.sha256=pl,un.sha384=f4,un.sha512=ml;var _l={},Ei=Z,h4=cn,ho=Ei.rotl32,El=Ei.sum32,Kn=Ei.sum32_3,xl=Ei.sum32_4,Sl=h4.BlockHash;function _r(){if(!(this instanceof _r))return new _r;Sl.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}Ei.inherits(_r,Sl),_l.ripemd160=_r,_r.blockSize=512,_r.outSize=160,_r.hmacStrength=192,_r.padLength=64,_r.prototype._update=function(e,r){for(var i=this.h[0],n=this.h[1],s=this.h[2],o=this.h[3],a=this.h[4],c=i,u=n,f=s,d=o,b=a,v=0;v<80;v++){var g=El(ho(xl(i,Il(v,n,s,o),e[p4[v]+r],d4(v)),g4[v]),a);i=a,a=o,o=ho(s,10),s=n,n=g,g=El(ho(xl(c,Il(79-v,u,f,d),e[b4[v]+r],l4(v)),y4[v]),b),c=b,b=d,d=ho(f,10),f=u,u=g}g=Kn(this.h[1],s,d),this.h[1]=Kn(this.h[2],o,b),this.h[2]=Kn(this.h[3],a,c),this.h[3]=Kn(this.h[4],i,u),this.h[4]=Kn(this.h[0],n,f),this.h[0]=g},_r.prototype._digest=function(e){return e==="hex"?Ei.toHex32(this.h,"little"):Ei.split32(this.h,"little")};function Il(t,e,r,i){return t<=15?e^r^i:t<=31?e&r|~e&i:t<=47?(e|~r)^i:t<=63?e&i|r&~i:e^(r|~i)}function d4(t){return t<=15?0:t<=31?1518500249:t<=47?1859775393:t<=63?2400959708:2840853838}function l4(t){return t<=15?1352829926:t<=31?1548603684:t<=47?1836072691:t<=63?2053994217:0}var p4=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],b4=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],g4=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],y4=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],v4=Z,m4=wi;function ln(t,e,r){if(!(this instanceof ln))return new ln(t,e,r);this.Hash=t,this.blockSize=t.blockSize/8,this.outSize=t.outSize/8,this.inner=null,this.outer=null,this._init(v4.toArray(e,r))}var w4=ln;ln.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),m4(e.length<=this.blockSize);for(var r=e.length;r<this.blockSize;r++)e.push(0);for(r=0;r<e.length;r++)e[r]^=54;for(this.inner=new this.Hash().update(e),r=0;r<e.length;r++)e[r]^=106;this.outer=new this.Hash().update(e)},ln.prototype.update=function(e,r){return this.inner.update(e,r),this},ln.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)},function(t){var e=t;e.utils=Z,e.common=cn,e.sha=un,e.ripemd=_l,e.hmac=w4,e.sha1=e.sha.sha1,e.sha256=e.sha.sha256,e.sha224=e.sha.sha224,e.sha384=e.sha.sha384,e.sha512=e.sha.sha512,e.ripemd160=e.ripemd.ripemd160}(uo);var yc,Al;function _4(){return Al||(Al=1,yc={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),yc}(function(t){var e=t,r=uo,i=fc,n=Lt,s=n.assert;function o(u){u.type==="short"?this.curve=new i.short(u):u.type==="edwards"?this.curve=new i.edwards(u):this.curve=new i.mont(u),this.g=this.curve.g,this.n=this.curve.n,this.hash=u.hash,s(this.g.validate(),"Invalid curve"),s(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=o;function a(u,f){Object.defineProperty(e,u,{configurable:!0,enumerable:!0,get:function(){var d=new o(f);return Object.defineProperty(e,u,{configurable:!0,enumerable:!0,value:d}),d}})}a("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:r.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),a("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:r.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),a("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:r.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),a("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:r.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),a("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:r.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),a("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["9"]}),a("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var c;try{c=_4()}catch{c=void 0}a("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:r.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",c]})})(co);var E4=uo,xi=cc,Ol=wi;function ri(t){if(!(this instanceof ri))return new ri(t);this.hash=t.hash,this.predResist=!!t.predResist,this.outLen=this.hash.outSize,this.minEntropy=t.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=xi.toArray(t.entropy,t.entropyEnc||"hex"),r=xi.toArray(t.nonce,t.nonceEnc||"hex"),i=xi.toArray(t.pers,t.persEnc||"hex");Ol(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,r,i)}var x4=ri;ri.prototype._init=function(e,r,i){var n=e.concat(r).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var s=0;s<this.V.length;s++)this.K[s]=0,this.V[s]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},ri.prototype._hmac=function(){return new E4.hmac(this.hash,this.K)},ri.prototype._update=function(e){var r=this._hmac().update(this.V).update([0]);e&&(r=r.update(e)),this.K=r.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},ri.prototype.reseed=function(e,r,i,n){typeof r!="string"&&(n=i,i=r,r=null),e=xi.toArray(e,r),i=xi.toArray(i,n),Ol(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1},ri.prototype.generate=function(e,r,i,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof r!="string"&&(n=i,i=r,r=null),i&&(i=xi.toArray(i,n||"hex"),this._update(i));for(var s=[];s.length<e;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,e);return this._update(i),this._reseed++,xi.encode(o,r)};var S4=lr.exports,I4=Lt,vc=I4.assert;function wt(t,e){this.ec=t,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}var A4=wt;wt.fromPublic=function(e,r,i){return r instanceof wt?r:new wt(e,{pub:r,pubEnc:i})},wt.fromPrivate=function(e,r,i){return r instanceof wt?r:new wt(e,{priv:r,privEnc:i})},wt.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},wt.prototype.getPublic=function(e,r){return typeof e=="string"&&(r=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),r?this.pub.encode(r,e):this.pub},wt.prototype.getPrivate=function(e){return e==="hex"?this.priv.toString(16,2):this.priv},wt.prototype._importPrivate=function(e,r){this.priv=new S4(e,r||16),this.priv=this.priv.umod(this.ec.curve.n)},wt.prototype._importPublic=function(e,r){if(e.x||e.y){this.ec.curve.type==="mont"?vc(e.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&vc(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,r)},wt.prototype.derive=function(e){return e.validate()||vc(e.validate(),"public point not validated"),e.mul(this.priv).getX()},wt.prototype.sign=function(e,r,i){return this.ec.sign(e,this,r,i)},wt.prototype.verify=function(e,r,i){return this.ec.verify(e,r,this,void 0,i)},wt.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var lo=lr.exports,mc=Lt,O4=mc.assert;function po(t,e){if(t instanceof po)return t;this._importDER(t,e)||(O4(t.r&&t.s,"Signature without r or s"),this.r=new lo(t.r,16),this.s=new lo(t.s,16),t.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=t.recoveryParam)}var D4=po;function $4(){this.place=0}function wc(t,e){var r=t[e.place++];if(!(r&128))return r;var i=r&15;if(i===0||i>4||t[e.place]===0)return!1;for(var n=0,s=0,o=e.place;s<i;s++,o++)n<<=8,n|=t[o],n>>>=0;return n<=127?!1:(e.place=o,n)}function Dl(t){for(var e=0,r=t.length-1;!t[e]&&!(t[e+1]&128)&&e<r;)e++;return e===0?t:t.slice(e)}po.prototype._importDER=function(e,r){e=mc.toArray(e,r);var i=new $4;if(e[i.place++]!==48)return!1;var n=wc(e,i);if(n===!1||n+i.place!==e.length||e[i.place++]!==2)return!1;var s=wc(e,i);if(s===!1||(e[i.place]&128)!==0)return!1;var o=e.slice(i.place,s+i.place);if(i.place+=s,e[i.place++]!==2)return!1;var a=wc(e,i);if(a===!1||e.length!==a+i.place||(e[i.place]&128)!==0)return!1;var c=e.slice(i.place,a+i.place);if(o[0]===0)if(o[1]&128)o=o.slice(1);else return!1;if(c[0]===0)if(c[1]&128)c=c.slice(1);else return!1;return this.r=new lo(o),this.s=new lo(c),this.recoveryParam=null,!0};function _c(t,e){if(e<128){t.push(e);return}var r=1+(Math.log(e)/Math.LN2>>>3);for(t.push(r|128);--r;)t.push(e>>>(r<<3)&255);t.push(e)}po.prototype.toDER=function(e){var r=this.r.toArray(),i=this.s.toArray();for(r[0]&128&&(r=[0].concat(r)),i[0]&128&&(i=[0].concat(i)),r=Dl(r),i=Dl(i);!i[0]&&!(i[1]&128);)i=i.slice(1);var n=[2];_c(n,r.length),n=n.concat(r),n.push(2),_c(n,i.length);var s=n.concat(i),o=[48];return _c(o,s.length),o=o.concat(s),mc.encode(o,e)};var rr=lr.exports,$l=x4,M4=Lt,Ec=co,P4=ro.exports,Si=M4.assert,xc=A4,bo=D4;function Wt(t){if(!(this instanceof Wt))return new Wt(t);typeof t=="string"&&(Si(Object.prototype.hasOwnProperty.call(Ec,t),"Unknown curve "+t),t=Ec[t]),t instanceof Ec.PresetCurve&&(t={curve:t}),this.curve=t.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=t.curve.g,this.g.precompute(t.curve.n.bitLength()+1),this.hash=t.hash||t.curve.hash}var R4=Wt;Wt.prototype.keyPair=function(e){return new xc(this,e)},Wt.prototype.keyFromPrivate=function(e,r){return xc.fromPrivate(this,e,r)},Wt.prototype.keyFromPublic=function(e,r){return xc.fromPublic(this,e,r)},Wt.prototype.genKeyPair=function(e){e||(e={});for(var r=new $l({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||P4(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),n=this.n.sub(new rr(2));;){var s=new rr(r.generate(i));if(!(s.cmp(n)>0))return s.iaddn(1),this.keyFromPrivate(s)}},Wt.prototype._truncateToN=function(e,r,i){var n;if(rr.isBN(e)||typeof e=="number")e=new rr(e,16),n=e.byteLength();else if(typeof e=="object")n=e.length,e=new rr(e,16);else{var s=e.toString();n=s.length+1>>>1,e=new rr(s,16)}typeof i!="number"&&(i=n*8);var o=i-this.n.bitLength();return o>0&&(e=e.ushrn(o)),!r&&e.cmp(this.n)>=0?e.sub(this.n):e},Wt.prototype.sign=function(e,r,i,n){if(typeof i=="object"&&(n=i,i=null),n||(n={}),typeof e!="string"&&typeof e!="number"&&!rr.isBN(e)){Si(typeof e=="object"&&e&&typeof e.length=="number","Expected message to be an array-like, a hex string, or a BN instance"),Si(e.length>>>0===e.length);for(var s=0;s<e.length;s++)Si((e[s]&255)===e[s])}r=this.keyFromPrivate(r,i),e=this._truncateToN(e,!1,n.msgBitLength),Si(!e.isNeg(),"Can not sign a negative message");var o=this.n.byteLength(),a=r.getPrivate().toArray("be",o),c=e.toArray("be",o);Si(new rr(c).eq(e),"Can not sign message");for(var u=new $l({hash:this.hash,entropy:a,nonce:c,pers:n.pers,persEnc:n.persEnc||"utf8"}),f=this.n.sub(new rr(1)),d=0;;d++){var b=n.k?n.k(d):new rr(u.generate(this.n.byteLength()));if(b=this._truncateToN(b,!0),!(b.cmpn(1)<=0||b.cmp(f)>=0)){var v=this.g.mul(b);if(!v.isInfinity()){var g=v.getX(),E=g.umod(this.n);if(E.cmpn(0)!==0){var I=b.invm(this.n).mul(E.mul(r.getPrivate()).iadd(e));if(I=I.umod(this.n),I.cmpn(0)!==0){var $=(v.getY().isOdd()?1:0)|(g.cmp(E)!==0?2:0);return n.canonical&&I.cmp(this.nh)>0&&(I=this.n.sub(I),$^=1),new bo({r:E,s:I,recoveryParam:$})}}}}}},Wt.prototype.verify=function(e,r,i,n,s){s||(s={}),e=this._truncateToN(e,!1,s.msgBitLength),i=this.keyFromPublic(i,n),r=new bo(r,"hex");var o=r.r,a=r.s;if(o.cmpn(1)<0||o.cmp(this.n)>=0||a.cmpn(1)<0||a.cmp(this.n)>=0)return!1;var c=a.invm(this.n),u=c.mul(e).umod(this.n),f=c.mul(o).umod(this.n),d;return this.curve._maxwellTrick?(d=this.g.jmulAdd(u,i.getPublic(),f),d.isInfinity()?!1:d.eqXToP(o)):(d=this.g.mulAdd(u,i.getPublic(),f),d.isInfinity()?!1:d.getX().umod(this.n).cmp(o)===0)},Wt.prototype.recoverPubKey=function(t,e,r,i){Si((3&r)===r,"The recovery param is more than two bits"),e=new bo(e,i);var n=this.n,s=new rr(t),o=e.r,a=e.s,c=r&1,u=r>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&u)throw new Error("Unable to find sencond key candinate");u?o=this.curve.pointFromX(o.add(this.curve.n),c):o=this.curve.pointFromX(o,c);var f=e.r.invm(n),d=n.sub(s).mul(f).umod(n),b=a.mul(f).umod(n);return this.g.mulAdd(d,o,b)},Wt.prototype.getKeyRecoveryParam=function(t,e,r,i){if(e=new bo(e,i),e.recoveryParam!==null)return e.recoveryParam;for(var n=0;n<4;n++){var s;try{s=this.recoverPubKey(t,e,n)}catch{continue}if(s.eq(r))return n}throw new Error("Unable to find valid recovery factor")};var Hn=Lt,Ml=Hn.assert,Pl=Hn.parseBytes,pn=Hn.cachedProperty;function ct(t,e){this.eddsa=t,this._secret=Pl(e.secret),t.isPoint(e.pub)?this._pub=e.pub:this._pubBytes=Pl(e.pub)}ct.fromPublic=function(e,r){return r instanceof ct?r:new ct(e,{pub:r})},ct.fromSecret=function(e,r){return r instanceof ct?r:new ct(e,{secret:r})},ct.prototype.secret=function(){return this._secret},pn(ct,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),pn(ct,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),pn(ct,"privBytes",function(){var e=this.eddsa,r=this.hash(),i=e.encodingLength-1,n=r.slice(0,e.encodingLength);return n[0]&=248,n[i]&=127,n[i]|=64,n}),pn(ct,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),pn(ct,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),pn(ct,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),ct.prototype.sign=function(e){return Ml(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},ct.prototype.verify=function(e,r){return this.eddsa.verify(e,r,this)},ct.prototype.getSecret=function(e){return Ml(this._secret,"KeyPair is public only"),Hn.encode(this.secret(),e)},ct.prototype.getPublic=function(e){return Hn.encode(this.pubBytes(),e)};var T4=ct,N4=lr.exports,go=Lt,Rl=go.assert,yo=go.cachedProperty,C4=go.parseBytes;function Ii(t,e){this.eddsa=t,typeof e!="object"&&(e=C4(e)),Array.isArray(e)&&(Rl(e.length===t.encodingLength*2,"Signature has invalid size"),e={R:e.slice(0,t.encodingLength),S:e.slice(t.encodingLength)}),Rl(e.R&&e.S,"Signature without R or S"),t.isPoint(e.R)&&(this._R=e.R),e.S instanceof N4&&(this._S=e.S),this._Rencoded=Array.isArray(e.R)?e.R:e.Rencoded,this._Sencoded=Array.isArray(e.S)?e.S:e.Sencoded}yo(Ii,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),yo(Ii,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),yo(Ii,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),yo(Ii,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),Ii.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},Ii.prototype.toHex=function(){return go.encode(this.toBytes(),"hex").toUpperCase()};var B4=Ii,F4=uo,L4=co,bn=Lt,U4=bn.assert,Tl=bn.parseBytes,Nl=T4,Cl=B4;function Nt(t){if(U4(t==="ed25519","only tested with ed25519 so far"),!(this instanceof Nt))return new Nt(t);t=L4[t].curve,this.curve=t,this.g=t.g,this.g.precompute(t.n.bitLength()+1),this.pointClass=t.point().constructor,this.encodingLength=Math.ceil(t.n.bitLength()/8),this.hash=F4.sha512}var q4=Nt;Nt.prototype.sign=function(e,r){e=Tl(e);var i=this.keyFromSecret(r),n=this.hashInt(i.messagePrefix(),e),s=this.g.mul(n),o=this.encodePoint(s),a=this.hashInt(o,i.pubBytes(),e).mul(i.priv()),c=n.add(a).umod(this.curve.n);return this.makeSignature({R:s,S:c,Rencoded:o})},Nt.prototype.verify=function(e,r,i){if(e=Tl(e),r=this.makeSignature(r),r.S().gte(r.eddsa.curve.n)||r.S().isNeg())return!1;var n=this.keyFromPublic(i),s=this.hashInt(r.Rencoded(),n.pubBytes(),e),o=this.g.mul(r.S()),a=r.R().add(n.pub().mul(s));return a.eq(o)},Nt.prototype.hashInt=function(){for(var e=this.hash(),r=0;r<arguments.length;r++)e.update(arguments[r]);return bn.intFromLE(e.digest()).umod(this.curve.n)},Nt.prototype.keyFromPublic=function(e){return Nl.fromPublic(this,e)},Nt.prototype.keyFromSecret=function(e){return Nl.fromSecret(this,e)},Nt.prototype.makeSignature=function(e){return e instanceof Cl?e:new Cl(this,e)},Nt.prototype.encodePoint=function(e){var r=e.getY().toArray("le",this.encodingLength);return r[this.encodingLength-1]|=e.getX().isOdd()?128:0,r},Nt.prototype.decodePoint=function(e){e=bn.parseBytes(e);var r=e.length-1,i=e.slice(0,r).concat(e[r]&-129),n=(e[r]&128)!==0,s=bn.intFromLE(i);return this.curve.pointFromY(s,n)},Nt.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},Nt.prototype.decodeInt=function(e){return bn.intFromLE(e)},Nt.prototype.isPoint=function(e){return e instanceof this.pointClass},function(t){var e=t;e.version=F6.version,e.utils=Lt,e.rand=ro.exports,e.curve=fc,e.curves=co,e.ec=R4,e.eddsa=q4}(Qd);const z4={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var k4=Object.defineProperty,Bl=Object.getOwnPropertySymbols,j4=Object.prototype.hasOwnProperty,V4=Object.prototype.propertyIsEnumerable,Fl=(t,e,r)=>e in t?k4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,K4=(t,e)=>{for(var r in e||(e={}))j4.call(e,r)&&Fl(t,r,e[r]);if(Bl)for(var r of Bl(e))V4.call(e,r)&&Fl(t,r,e[r]);return t};const H4=":";function vo(t){const[e,r]=t.split(H4);return{namespace:e,reference:r}}function Ll(t,e){return t.includes(":")?[t]:e.chains||[]}const W4="ReactNative",Ut={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},G4="js";function mo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ii(){return!Tn()&&!!Aa()&&navigator.product===W4}function Y4(){return ii()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function X4(){return ii()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Wn(){return!mo()&&!!Aa()&&!!Tn()}function Gn(){return ii()?Ut.reactNative:mo()?Ut.node:Wn()?Ut.browser:Ut.unknown}function Ul(){var t;try{return ii()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function J4(t,e){const r=new URLSearchParams(t);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const n=e[i];n!==void 0&&r.set(i,n)}return r.toString()}function ql(){return Ah()||{name:"",description:"",url:"",icons:[""]}}function Z4(){if(Gn()===Ut.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=xv();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Q4(){var t;const e=Gn();return e===Ut.browser?[e,((t=Ih())==null?void 0:t.host)||"unknown"].join(":"):e}function zl(t,e,r){const i=Z4(),n=Q4();return[[t,e].join("-"),[G4,r].join("-"),i,n].join("/")}function e5({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),f=zl(t,e,i),d={auth:n,ua:f,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},b=J4(u[1]||"",d);return u[0]+"?"+b}function Ai(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Sc(t){return Object.fromEntries(t.entries())}function Ic(t){return new Map(Object.entries(t))}function Oi(t=z.FIVE_MINUTES,e){const r=z.toMiliseconds(t||z.FIVE_MINUTES);let i,n,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),i=a,n=c})}}function ni(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const o=await t;i(o)}catch(o){n(o)}clearTimeout(s)})}function kl(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function t5(t){return kl("topic",t)}function r5(t){return kl("id",t)}function jl(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function et(t,e){return z.fromMiliseconds((e||Date.now())+z.toMiliseconds(t))}function si(t){return Date.now()>=z.toMiliseconds(t)}function se(t,e){return`${t}${e?`:${e}`:""}`}function i5(t=[],e=[]){return[...new Set([...t,...e])]}async function n5({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r,s=n?.href;if(typeof s!="string")return;const o=s5(s,t,e),a=Gn();if(a===Ut.browser){if(!((i=Tn())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}o5(o)}else a===Ut.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function s5(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${f5(i,!0)}`}else n=`${n}/wc?${i}`;return n}function o5(t){let e="_self";u5()?e="_top":(c5()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function a5(t,e){let r="";try{if(Wn()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function Vl(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function Kl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ac(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function c5(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function u5(){try{return window.self!==window.top}catch{return!1}}function f5(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Hl(t){return Buffer.from(t,"base64").toString("utf-8")}function h5(t){return new Promise(e=>setTimeout(e,t))}function Yn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function d5(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function wo(t,...e){if(!d5(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Oc(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Yn(t.outputLen),Yn(t.blockLen)}function gn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Wl(t,e){wo(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const _o=BigInt(2**32-1),Gl=BigInt(32);function l5(t,e=!1){return e?{h:Number(t&_o),l:Number(t>>Gl&_o)}:{h:Number(t>>Gl&_o)|0,l:Number(t&_o)|0}}function p5(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=l5(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const b5=(t,e,r)=>t<<r|e>>>32-r,g5=(t,e,r)=>e<<r|t>>>32-r,y5=(t,e,r)=>e<<r-32|t>>>64-r,v5=(t,e,r)=>t<<r-32|e>>>64-r,yn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function m5(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Dc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Er(t,e){return t<<32-e|t>>>e}const Yl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function w5(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Xl(t){for(let e=0;e<t.length;e++)t[e]=w5(t[e])}function _5(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function vn(t){return typeof t=="string"&&(t=_5(t)),wo(t),t}class $c{clone(){return this._cloneInto()}}function Jl(t){const e=i=>t().update(vn(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Xn(t=32){if(yn&&typeof yn.getRandomValues=="function")return yn.getRandomValues(new Uint8Array(t));if(yn&&typeof yn.randomBytes=="function")return yn.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Zl=[],Ql=[],e0=[],E5=BigInt(0),Jn=BigInt(1),x5=BigInt(2),S5=BigInt(7),I5=BigInt(256),A5=BigInt(113);for(let t=0,e=Jn,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Zl.push(2*(5*i+r)),Ql.push((t+1)*(t+2)/2%64);let n=E5;for(let s=0;s<7;s++)e=(e<<Jn^(e>>S5)*A5)%I5,e&x5&&(n^=Jn<<(Jn<<BigInt(s))-Jn);e0.push(n)}const[O5,D5]=p5(e0,!0),t0=(t,e,r)=>r>32?y5(t,e,r):b5(t,e,r),r0=(t,e,r)=>r>32?v5(t,e,r):g5(t,e,r);function $5(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],f=r[c+1],d=t0(u,f,1)^r[a],b=r0(u,f,1)^r[a+1];for(let v=0;v<50;v+=10)t[o+v]^=d,t[o+v+1]^=b}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=Ql[o],c=t0(n,s,a),u=r0(n,s,a),f=Zl[o];n=t[f],s=t[f+1],t[f]=c,t[f+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=O5[i],t[1]^=D5[i]}r.fill(0)}class Mc extends $c{constructor(e,r,i,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Yn(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=m5(this.state)}keccak(){Yl||Xl(this.state32),$5(this.state32,this.rounds),Yl||Xl(this.state32),this.posOut=0,this.pos=0}update(e){gn(this);const{blockLen:r,state:i}=this;e=vn(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){gn(this,!1),wo(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Yn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Wl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new Mc(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const M5=(t,e,r)=>Jl(()=>new Mc(e,t,r)),P5=M5(1,136,256/8),R5="https://rpc.walletconnect.org/v1";function i0(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(P5(r)).toString("hex")}async function T5(t,e,r,i,n,s){switch(r.t){case"eip191":return await N5(t,e,r.s);case"eip1271":return await C5(t,e,r.s,i,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function N5(t,e,r){return(await _m({hash:i0(e),signature:r})).toLowerCase()===t.toLowerCase()}async function C5(t,e,r,i,n,s){const o=vo(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",f=r.substring(2),d=i0(e).substring(2),b=a+d+c+u+f,v=await fetch(`${s||R5}/?chainId=${i}&projectId=${n}`,{method:"POST",body:JSON.stringify({id:B5(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:b},"latest"]})}),{result:g}=await v.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function B5(){return Date.now()+Math.floor(Math.random()*1e3)}function F5(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const n=1+i*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return iw.encode(s)}var L5=Object.defineProperty,U5=Object.defineProperties,q5=Object.getOwnPropertyDescriptors,n0=Object.getOwnPropertySymbols,z5=Object.prototype.hasOwnProperty,k5=Object.prototype.propertyIsEnumerable,s0=(t,e,r)=>e in t?L5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,j5=(t,e)=>{for(var r in e||(e={}))z5.call(e,r)&&s0(t,r,e[r]);if(n0)for(var r of n0(e))k5.call(e,r)&&s0(t,r,e[r]);return t},V5=(t,e)=>U5(t,q5(e));const K5="did:pkh:",Pc=t=>t?.split(":"),H5=t=>{const e=t&&Pc(t);if(e)return t.includes(K5)?e[3]:e[1]},Rc=t=>{const e=t&&Pc(t);if(e)return e[2]+":"+e[3]},Eo=t=>{const e=t&&Pc(t);if(e)return e.pop()};async function o0(t){const{cacao:e,projectId:r}=t,{s:i,p:n}=e,s=a0(n,n.iss),o=Eo(n.iss);return await T5(o,s,i,Rc(n.iss),r)}const a0=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=Eo(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${H5(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,f=t.exp?`Expiration Time: ${t.exp}`:void 0,d=t.nbf?`Not Before: ${t.nbf}`:void 0,b=t.requestId?`Request ID: ${t.requestId}`:void 0,v=t.resources?`Resources:${t.resources.map(E=>`
- ${E}`).join("")}`:void 0,g=xo(t.resources);if(g){const E=Zn(g);n=t9(n,E)}return[r,i,"",n,"",s,o,a,c,u,f,d,b,v].filter(E=>E!=null).join(`
`)};function W5(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function G5(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Di(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(n=>{const s=i[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function Y5(t,e,r,i={}){return r?.sort((n,s)=>n.localeCompare(s)),{att:{[t]:X5(e,r,i)}}}function X5(t,e,r={}){e=e?.sort((n,s)=>n.localeCompare(s));const i=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...i)}function c0(t){return Di(t),`urn:recap:${W5(t).replace(/=/g,"")}`}function Zn(t){const e=G5(t.replace("urn:recap:",""));return Di(e),e}function J5(t,e,r){const i=Y5(t,e,r);return c0(i)}function Z5(t){return t&&t.includes("urn:recap:")}function Q5(t,e){const r=Zn(t),i=Zn(e),n=e9(r,i);return c0(n)}function e9(t,e){Di(t),Di(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),i={att:{}};return r.forEach(n=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;i.att[n]=V5(j5({},i.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((u=e.att[n])==null?void 0:u[a])})})}),i}function t9(t="",e){Di(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(d=>({ability:d.split("/")[0],action:d.split("/")[1]}));c.sort((d,b)=>d.action.localeCompare(b.action));const u={};c.forEach(d=>{u[d.ability]||(u[d.ability]=[]),u[d.ability].push(d.action)});const f=Object.keys(u).map(d=>(n++,`(${n}) '${d}': '${u[d].join("', '")}' for '${a}'.`));i.push(f.join(", ").replace(".,","."))});const s=i.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function u0(t){var e;const r=Zn(t);Di(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(n=>n.split("/")[1]):[]}function f0(t){const e=Zn(t);Di(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function xo(t){if(!t)return;const e=t?.[t.length-1];return Z5(e)?e:void 0}function Tc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function h0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function qt(t,...e){if(!h0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function d0(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function r9(t,e){qt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function l0(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const oi=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),i9=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function n9(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Nc(t){if(typeof t=="string")t=n9(t);else if(h0(t))t=Cc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function s9(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function o9(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const a9=(t,e)=>{function r(i,...n){if(qt(i),t.nonceLength!==void 0){const u=n[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?qt(u):qt(u,t.nonceLength)}const s=t.tagLength;s&&n[1]!==void 0&&qt(n[1]);const o=e(i,...n),a=(u,f)=>{if(f!==void 0){if(u!==2)throw new Error("cipher output not supported");qt(f)}};let c=!1;return{encrypt(u,f){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,qt(u),a(o.encrypt.length,f),o.encrypt(u,f)},decrypt(u,f){if(qt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,f),o.decrypt(u,f)}}}return Object.assign(r,t),r};function p0(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!c9(e))throw new Error("invalid output, must be aligned");return e}function b0(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function c9(t){return t.byteOffset%4===0}function Cc(t){return Uint8Array.from(t)}function mn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const g0=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),u9=g0("expand 16-byte k"),f9=g0("expand 32-byte k"),h9=oi(u9),d9=oi(f9);function re(t,e){return t<<e|t>>>32-e}function Bc(t){return t.byteOffset%4===0}const So=64,l9=16,y0=2**32-1,v0=new Uint32Array;function p9(t,e,r,i,n,s,o,a){const c=n.length,u=new Uint8Array(So),f=oi(u),d=Bc(n)&&Bc(s),b=d?oi(n):v0,v=d?oi(s):v0;for(let g=0;g<c;o++){if(t(e,r,i,f,o,a),o>=y0)throw new Error("arx: counter overflow");const E=Math.min(So,c-g);if(d&&E===So){const I=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let $=0,D;$<l9;$++)D=I+$,v[D]=b[D]^f[$];g+=So;continue}for(let I=0,$;I<E;I++)$=g+I,s[$]=n[$]^u[I];g+=E}}function b9(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=s9({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Tc(n),Tc(o),l0(s),l0(r),(a,c,u,f,d=0)=>{qt(a),qt(c),qt(u);const b=u.length;if(f===void 0&&(f=new Uint8Array(b)),qt(f),Tc(d),d<0||d>=y0)throw new Error("arx: counter overflow");if(f.length<b)throw new Error(`arx: output (${f.length}) is shorter than data (${b})`);const v=[];let g=a.length,E,I;if(g===32)v.push(E=Cc(a)),I=d9;else if(g===16&&r)E=new Uint8Array(32),E.set(a),E.set(a,16),I=h9,v.push(E);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Bc(c)||v.push(c=Cc(c));const $=oi(E);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(I,$,oi(c.subarray(0,16)),$),c=c.subarray(16)}const D=16-n;if(D!==c.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){const P=new Uint8Array(12);P.set(c,s?0:12-c.length),c=P,v.push(c)}const M=oi(c);return p9(t,I,$,M,u,f,d,o),mn(...v),f}}const pt=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class g9{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Nc(e),qt(e,32);const r=pt(e,0),i=pt(e,2),n=pt(e,4),s=pt(e,6),o=pt(e,8),a=pt(e,10),c=pt(e,12),u=pt(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let f=0;f<8;f++)this.pad[f]=pt(e,16+2*f)}process(e,r,i=!1){const n=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],f=o[3],d=o[4],b=o[5],v=o[6],g=o[7],E=o[8],I=o[9],$=pt(e,r+0),D=pt(e,r+2),M=pt(e,r+4),P=pt(e,r+6),T=pt(e,r+8),N=pt(e,r+10),C=pt(e,r+12),B=pt(e,r+14);let R=s[0]+($&8191),V=s[1]+(($>>>13|D<<3)&8191),A=s[2]+((D>>>10|M<<6)&8191),h=s[3]+((M>>>7|P<<9)&8191),p=s[4]+((P>>>4|T<<12)&8191),m=s[5]+(T>>>1&8191),y=s[6]+((T>>>14|N<<2)&8191),w=s[7]+((N>>>11|C<<5)&8191),S=s[8]+((C>>>8|B<<8)&8191),O=s[9]+(B>>>5|n),_=0,l=_+R*a+V*(5*I)+A*(5*E)+h*(5*g)+p*(5*v);_=l>>>13,l&=8191,l+=m*(5*b)+y*(5*d)+w*(5*f)+S*(5*u)+O*(5*c),_+=l>>>13,l&=8191;let x=_+R*c+V*a+A*(5*I)+h*(5*E)+p*(5*g);_=x>>>13,x&=8191,x+=m*(5*v)+y*(5*b)+w*(5*d)+S*(5*f)+O*(5*u),_+=x>>>13,x&=8191;let F=_+R*u+V*c+A*a+h*(5*I)+p*(5*E);_=F>>>13,F&=8191,F+=m*(5*g)+y*(5*v)+w*(5*b)+S*(5*d)+O*(5*f),_+=F>>>13,F&=8191;let L=_+R*f+V*u+A*c+h*a+p*(5*I);_=L>>>13,L&=8191,L+=m*(5*E)+y*(5*g)+w*(5*v)+S*(5*b)+O*(5*d),_+=L>>>13,L&=8191;let U=_+R*d+V*f+A*u+h*c+p*a;_=U>>>13,U&=8191,U+=m*(5*I)+y*(5*E)+w*(5*g)+S*(5*v)+O*(5*b),_+=U>>>13,U&=8191;let j=_+R*b+V*d+A*f+h*u+p*c;_=j>>>13,j&=8191,j+=m*a+y*(5*I)+w*(5*E)+S*(5*g)+O*(5*v),_+=j>>>13,j&=8191;let K=_+R*v+V*b+A*d+h*f+p*u;_=K>>>13,K&=8191,K+=m*c+y*a+w*(5*I)+S*(5*E)+O*(5*g),_+=K>>>13,K&=8191;let W=_+R*g+V*v+A*b+h*d+p*f;_=W>>>13,W&=8191,W+=m*u+y*c+w*a+S*(5*I)+O*(5*E),_+=W>>>13,W&=8191;let J=_+R*E+V*g+A*v+h*b+p*d;_=J>>>13,J&=8191,J+=m*f+y*u+w*c+S*a+O*(5*I),_+=J>>>13,J&=8191;let H=_+R*I+V*E+A*g+h*v+p*b;_=H>>>13,H&=8191,H+=m*d+y*f+w*u+S*c+O*a,_+=H>>>13,H&=8191,_=(_<<2)+_|0,_=_+l|0,l=_&8191,_=_>>>13,x+=_,s[0]=l,s[1]=x,s[2]=F,s[3]=L,s[4]=U,s[5]=j,s[6]=K,s[7]=W,s[8]=J,s[9]=H}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+n,n=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;mn(i)}update(e){d0(this);const{buffer:r,blockLen:i}=this;e=Nc(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o===i){for(;i<=n-s;s+=i)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){mn(this.h,this.r,this.buffer,this.pad)}digestInto(e){d0(this),r9(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function y9(t){const e=(i,n)=>t(n).update(Nc(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const v9=y9(t=>new g9(t));function m9(t,e,r,i,n,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],f=e[0],d=e[1],b=e[2],v=e[3],g=e[4],E=e[5],I=e[6],$=e[7],D=n,M=r[0],P=r[1],T=r[2],N=o,C=a,B=c,R=u,V=f,A=d,h=b,p=v,m=g,y=E,w=I,S=$,O=D,_=M,l=P,x=T;for(let L=0;L<s;L+=2)N=N+V|0,O=re(O^N,16),m=m+O|0,V=re(V^m,12),N=N+V|0,O=re(O^N,8),m=m+O|0,V=re(V^m,7),C=C+A|0,_=re(_^C,16),y=y+_|0,A=re(A^y,12),C=C+A|0,_=re(_^C,8),y=y+_|0,A=re(A^y,7),B=B+h|0,l=re(l^B,16),w=w+l|0,h=re(h^w,12),B=B+h|0,l=re(l^B,8),w=w+l|0,h=re(h^w,7),R=R+p|0,x=re(x^R,16),S=S+x|0,p=re(p^S,12),R=R+p|0,x=re(x^R,8),S=S+x|0,p=re(p^S,7),N=N+A|0,x=re(x^N,16),w=w+x|0,A=re(A^w,12),N=N+A|0,x=re(x^N,8),w=w+x|0,A=re(A^w,7),C=C+h|0,O=re(O^C,16),S=S+O|0,h=re(h^S,12),C=C+h|0,O=re(O^C,8),S=S+O|0,h=re(h^S,7),B=B+p|0,_=re(_^B,16),m=m+_|0,p=re(p^m,12),B=B+p|0,_=re(_^B,8),m=m+_|0,p=re(p^m,7),R=R+V|0,l=re(l^R,16),y=y+l|0,V=re(V^y,12),R=R+V|0,l=re(l^R,8),y=y+l|0,V=re(V^y,7);let F=0;i[F++]=o+N|0,i[F++]=a+C|0,i[F++]=c+B|0,i[F++]=u+R|0,i[F++]=f+V|0,i[F++]=d+A|0,i[F++]=b+h|0,i[F++]=v+p|0,i[F++]=g+m|0,i[F++]=E+y|0,i[F++]=I+w|0,i[F++]=$+S|0,i[F++]=D+O|0,i[F++]=M+_|0,i[F++]=P+l|0,i[F++]=T+x|0}const w9=b9(m9,{counterRight:!1,counterLength:4,allowShortKeys:!1}),_9=new Uint8Array(16),m0=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(_9.subarray(r))},E9=new Uint8Array(32);function w0(t,e,r,i,n){const s=t(e,r,E9),o=v9.create(s);n&&m0(o,n),m0(o,i);const a=new Uint8Array(16),c=i9(a);b0(c,0,BigInt(n?n.length:0),!0),b0(c,8,BigInt(i.length),!0),o.update(a);const u=o.digest();return mn(s,a),u}const x9=t=>(e,r,i)=>({encrypt(n,s){const o=n.length;s=p0(o+16,s,!1),s.set(n);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=w0(t,e,r,a,i);return s.set(c,o),mn(c),s},decrypt(n,s){s=p0(n.length-16,s,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=w0(t,e,r,o,i);if(!o9(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),t(e,r,s,s,1),mn(c),s}}),_0=a9({blockSize:64,nonceLength:12,tagLength:16},x9(w9));class E0 extends $c{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Oc(e);const i=vn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return gn(this),this.iHash.update(e),this}digestInto(e){gn(this),wo(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Fc=(t,e,r)=>new E0(t,e).update(r).digest();Fc.create=(t,e)=>new E0(t,e);function S9(t,e,r){return Oc(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Fc(t,vn(r),vn(e))}const Lc=new Uint8Array([0]),x0=new Uint8Array;function I9(t,e,r,i=32){if(Oc(t),Yn(i),i>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/t.outputLen);r===void 0&&(r=x0);const s=new Uint8Array(n*t.outputLen),o=Fc.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<n;u++)Lc[0]=u+1,a.update(u===0?x0:c).update(r).update(Lc).digestInto(c),s.set(c,t.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Lc.fill(0),s.slice(0,i)}const A9=(t,e,r,i,n)=>I9(t,S9(t,e,r),i,n);function O9(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function D9(t,e,r){return t&e^~t&r}function $9(t,e,r){return t&e^t&r^e&r}class M9 extends $c{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Dc(this.buffer)}update(e){gn(this);const{view:r,buffer:i,blockLen:n}=this;e=vn(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Dc(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){gn(this),Wl(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let d=o;d<n;d++)r[d]=0;O9(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=Dc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,f[d],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}}const P9=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ai=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ci=new Uint32Array(64);class R9 extends M9{constructor(){super(64,32,8,!1),this.A=ai[0]|0,this.B=ai[1]|0,this.C=ai[2]|0,this.D=ai[3]|0,this.E=ai[4]|0,this.F=ai[5]|0,this.G=ai[6]|0,this.H=ai[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let d=0;d<16;d++,r+=4)ci[d]=e.getUint32(r,!1);for(let d=16;d<64;d++){const b=ci[d-15],v=ci[d-2],g=Er(b,7)^Er(b,18)^b>>>3,E=Er(v,17)^Er(v,19)^v>>>10;ci[d]=E+ci[d-7]+g+ci[d-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:u,H:f}=this;for(let d=0;d<64;d++){const b=Er(a,6)^Er(a,11)^Er(a,25),v=f+b+D9(a,c,u)+P9[d]+ci[d]|0,g=(Er(i,2)^Er(i,13)^Er(i,22))+$9(i,n,s)|0;f=u,u=c,c=a,a=o+v|0,o=s,s=n,n=i,i=v+g|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(i,n,s,o,a,c,u,f)}roundClean(){ci.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Io=Jl(()=>new R9);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const S0=BigInt(0);function Uc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function I0(t){if(!Uc(t))throw new Error("Uint8Array expected")}const T9=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function N9(t){I0(t);let e="";for(let r=0;r<t.length;r++)e+=T9[t[r]];return e}function C9(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?S0:BigInt("0x"+t)}const Ur={_0:48,_9:57,A:65,F:70,a:97,f:102};function A0(t){if(t>=Ur._0&&t<=Ur._9)return t-Ur._0;if(t>=Ur.A&&t<=Ur.F)return t-(Ur.A-10);if(t>=Ur.a&&t<=Ur.f)return t-(Ur.a-10)}function O0(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=A0(t.charCodeAt(s)),a=A0(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function D0(t){return I0(t),C9(N9(Uint8Array.from(t).reverse()))}function B9(t,e){return O0(t.toString(16).padStart(e*2,"0"))}function F9(t,e){return B9(t,e).reverse()}function $0(t,e,r){let i;if(typeof e=="string")try{i=O0(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Uc(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}const qc=t=>typeof t=="bigint"&&S0<=t;function L9(t,e,r){return qc(t)&&qc(e)&&qc(r)&&e<=t&&t<r}function M0(t,e,r,i){if(!L9(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}const U9={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Uc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function q9(t,e,r={}){const i=(n,s,o)=>{const a=U9[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}const wn=BigInt(0),Ao=BigInt(1);function P0(t,e){const r=t%e;return r>=wn?r:e+r}function z9(t,e,r){if(e<wn)throw new Error("invalid exponent, negatives unsupported");if(r<=wn)throw new Error("invalid modulus");if(r===Ao)return wn;let i=Ao;for(;e>wn;)e&Ao&&(i=i*t%r),t=t*t%r,e>>=Ao;return i}function ir(t,e,r){let i=t;for(;e-- >wn;)i*=i,i%=r;return i}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const _n=BigInt(0),zc=BigInt(1);function k9(t){return q9(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze(K4({},t))}function j9(t){const e=k9(t),{P:r}=e,i=D=>P0(D,r),n=e.montgomeryBits,s=Math.ceil(n/8),o=e.nByteLength,a=e.adjustScalarBytes||(D=>D),c=e.powPminus2||(D=>z9(D,r-BigInt(2),r));function u(D,M,P){const T=i(D*(M-P));return M=i(M-T),P=i(P+T),[M,P]}const f=(e.a-BigInt(2))/BigInt(4);function d(D,M){M0("u",D,_n,r),M0("scalar",M,_n,r);const P=M,T=D;let N=zc,C=_n,B=D,R=zc,V=_n,A;for(let p=BigInt(n-1);p>=_n;p--){const m=P>>p&zc;V^=m,A=u(V,N,B),N=A[0],B=A[1],A=u(V,C,R),C=A[0],R=A[1],V=m;const y=N+C,w=i(y*y),S=N-C,O=i(S*S),_=w-O,l=B+R,x=B-R,F=i(x*y),L=i(l*S),U=F+L,j=F-L;B=i(U*U),R=i(T*i(j*j)),N=i(w*O),C=i(_*(w+i(f*_)))}A=u(V,N,B),N=A[0],B=A[1],A=u(V,C,R),C=A[0],R=A[1];const h=c(C);return i(N*h)}function b(D){return F9(i(D),s)}function v(D){const M=$0("u coordinate",D,s);return o===32&&(M[31]&=127),D0(M)}function g(D){const M=$0("scalar",D),P=M.length;if(P!==s&&P!==o){let T=""+s+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+P)}return D0(a(M))}function E(D,M){const P=v(M),T=g(D),N=d(P,T);if(N===_n)throw new Error("invalid private or public key received");return b(N)}const I=b(e.Gu);function $(D){return E(D,I)}return{scalarMult:E,scalarMultBase:$,getSharedSecret:(D,M)=>E(D,M),getPublicKey:D=>$(D),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:I}}const kc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const V9=BigInt(1),R0=BigInt(2),K9=BigInt(3),H9=BigInt(5);BigInt(8);function W9(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=kc,o=t*t%s*t%s,a=ir(o,R0,s)*o%s,c=ir(a,V9,s)*t%s,u=ir(c,H9,s)*c%s,f=ir(u,e,s)*u%s,d=ir(f,r,s)*f%s,b=ir(d,i,s)*d%s,v=ir(b,n,s)*b%s,g=ir(v,n,s)*b%s,E=ir(g,e,s)*u%s;return{pow_p_5_8:ir(E,R0,s)*t%s,b2:o}}function G9(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const jc=j9({P:kc,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=kc,{pow_p_5_8:r,b2:i}=W9(t);return P0(ir(r,K9,e)*i,e)},adjustScalarBytes:G9,randomBytes:Xn}),T0="base10",_t="base16",ui="base64pad",Qn="base64url",es="utf8",N0=0,qr=1,ts=2,Y9=0,C0=1,rs=12,Vc=32;function X9(){const t=jc.utils.randomPrivateKey(),e=jc.getPublicKey(t);return{privateKey:At(t,_t),publicKey:At(e,_t)}}function Kc(){const t=Xn(Vc);return At(t,_t)}function J9(t,e){const r=jc.getSharedSecret(Vt(t,_t),Vt(e,_t)),i=A9(Io,r,void 0,void 0,Vc);return At(i,_t)}function Oo(t){const e=Io(Vt(t,_t));return At(e,_t)}function xr(t){const e=Io(Vt(t,es));return At(e,_t)}function B0(t){return Vt(`${t}`,T0)}function $i(t){return Number(At(t,T0))}function Z9(t){const e=B0(typeof t.type<"u"?t.type:N0);if($i(e)===qr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?Vt(t.senderPublicKey,_t):void 0,i=typeof t.iv<"u"?Vt(t.iv,_t):Xn(rs),n=Vt(t.symKey,_t),s=_0(n,i).encrypt(Vt(t.message,es));return F0({type:e,sealed:s,iv:i,senderPublicKey:r,encoding:t.encoding})}function Q9(t){const e=Vt(t.symKey,_t),{sealed:r,iv:i}=is(t),n=_0(e,i).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return At(n,es)}function e7(t,e){const r=B0(ts),i=Xn(rs),n=Vt(t,es);return F0({type:r,sealed:n,iv:i,encoding:e})}function t7(t,e){const{sealed:r}=is({encoded:t,encoding:e});return At(r,es)}function F0(t){const{encoding:e=ui}=t;if($i(t.type)===ts)return At(nc([t.type,t.sealed]),e);if($i(t.type)===qr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return At(nc([t.type,t.senderPublicKey,t.iv,t.sealed]),e)}return At(nc([t.type,t.iv,t.sealed]),e)}function is(t){const{encoded:e,encoding:r=ui}=t,i=Vt(e,r),n=i.slice(Y9,C0),s=C0;if($i(n)===qr){const u=s+Vc,f=u+rs,d=i.slice(s,u),b=i.slice(u,f),v=i.slice(f);return{type:n,sealed:v,iv:b,senderPublicKey:d}}if($i(n)===ts){const u=i.slice(s),f=Xn(rs);return{type:n,sealed:u,iv:f}}const o=s+rs,a=i.slice(s,o),c=i.slice(o);return{type:n,sealed:c,iv:a}}function r7(t,e){const r=is({encoded:t,encoding:e?.encoding});return L0({type:$i(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?At(r.senderPublicKey,_t):void 0,receiverPublicKey:e?.receiverPublicKey})}function L0(t){const e=t?.type||N0;if(e===qr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function U0(t){return t.type===qr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function q0(t){return t.type===ts}function i7(t){return new Qd.ec("p256").keyFromPublic({x:Buffer.from(t.x,"base64").toString("hex"),y:Buffer.from(t.y,"base64").toString("hex")},"hex")}function n7(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const r=e.length%4;return r>0&&(e+="=".repeat(4-r)),e}function s7(t){return Buffer.from(n7(t),"base64")}function o7(t,e){const[r,i,n]=t.split("."),s=s7(n);if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32).toString("hex"),a=s.slice(32,64).toString("hex"),c=`${r}.${i}`,u=Io(c),f=i7(e),d=At(u,_t);if(!f.verify(d,{r:o,s:a}))throw new Error("Invalid signature");return Ia(t).payload}const a7="irn";function Do(t){return t?.relay||{protocol:a7}}function ns(t){const e=z4[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function c7(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function z0(t){if(!t.includes("wc:")){const u=Hl(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a={};o.forEach((u,f)=>{a[f]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:u7(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:c7(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function u7(t){return t.startsWith("//")?t.substring(2):t}function f7(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=n,o=r+e+s;t[s]&&(i[o]=t[s])}),i}function k0(t){const e=new URLSearchParams,r=f7(t.relay);Object.keys(r).sort().forEach(n=>{e.set(n,r[n])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const i=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${i}`}function $o(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}function En(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function h7(t){const e=[];return Object.values(t).forEach(r=>{e.push(...En(r.accounts))}),e}function d7(t,e){const r=[];return Object.values(t).forEach(i=>{En(i.accounts).includes(e)&&r.push(...i.methods)}),r}function l7(t,e){const r=[];return Object.values(t).forEach(i=>{En(i.accounts).includes(e)&&r.push(...i.events)}),r}function p7(t){const e={};return t?.forEach(r=>{var i;const[n,s]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(i=e[n].chains)==null||i.push(`${n}:${s}`)}),e}function j0(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=p7(e);for(const[i,n]of Object.entries(r))n.methods?n.methods=i5(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}const b7={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},g7={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function k(t,e){const{message:r,code:i}=g7[t];return{message:e?`${r} ${e}`:r,code:i}}function le(t,e){const{message:r,code:i}=b7[t];return{message:e?`${r} ${e}`:r,code:i}}function ss(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Mo(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function bt(t){return typeof t>"u"}function $e(t,e){return e&&bt(t)?!0:typeof t=="string"&&!!t.trim().length}function Hc(t,e){return e&&bt(t)?!0:typeof t=="number"&&!isNaN(t)}function y7(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Ai(n,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],f=En(a),d=r[o];(!Ai(Ll(o,d),f)||!Ai(d.methods,c)||!Ai(d.events,u))&&(s=!1)}),s):!1}function Po(t){return $e(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function v7(t){if($e(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Po(r)}}return!1}function m7(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if($e(t,!1)){if(e(t))return!0;const r=Hl(t);return e(r)}}catch{}return!1}function w7(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function _7(t){return t?.topic}function E7(t,e){let r=null;return $e(t?.publicKey,!1)||(r=k("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function V0(t){let e=!0;return ss(t)?t.length&&(e=t.every(r=>$e(r,!1))):e=!1,e}function x7(t,e,r){let i=null;return ss(e)&&e.length?e.forEach(n=>{i||Po(n)||(i=le("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):Po(t)||(i=le("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function S7(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const o=x7(n,Ll(n,s),`${e} ${r}`);o&&(i=o)}),i}function I7(t,e){let r=null;return ss(t)?t.forEach(i=>{r||v7(i)||(r=le("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=le("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function A7(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=I7(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function O7(t,e){let r=null;return V0(t?.methods)?V0(t?.events)||(r=le("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=le("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function K0(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=O7(i,`${e}, namespace`);n&&(r=n)}),r}function D7(t,e,r){let i=null;if(t&&Mo(t)){const n=K0(t,e);n&&(i=n);const s=S7(t,e,r);s&&(i=s)}else i=k("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Wc(t,e){let r=null;if(t&&Mo(t)){const i=K0(t,e);i&&(r=i);const n=A7(t,e);n&&(r=n)}else r=k("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function H0(t){return $e(t.protocol,!0)}function $7(t,e){let r=!1;return e&&!t?r=!0:t&&ss(t)&&t.length&&t.forEach(i=>{r=H0(i)}),r}function M7(t){return typeof t=="number"}function Ct(t){return typeof t<"u"&&typeof t!==null}function P7(t){return!(!t||typeof t!="object"||!t.code||!Hc(t.code,!1)||!t.message||!$e(t.message,!1))}function R7(t){return!(bt(t)||!$e(t.method,!1))}function T7(t){return!(bt(t)||bt(t.result)&&bt(t.error)||!Hc(t.id,!1)||!$e(t.jsonrpc,!1))}function N7(t){return!(bt(t)||!$e(t.name,!1))}function W0(t,e){return!(!Po(e)||!h7(t).includes(e))}function C7(t,e,r){return $e(r,!1)?d7(t,e).includes(r):!1}function B7(t,e,r){return $e(r,!1)?l7(t,e).includes(r):!1}function G0(t,e,r){let i=null;const n=F7(t),s=L7(e),o=Object.keys(n),a=Object.keys(s),c=Y0(Object.keys(t)),u=Y0(Object.keys(e)),f=c.filter(d=>!u.includes(d));return f.length&&(i=k("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(e).toString()}`)),Ai(o,a)||(i=k("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(d=>{if(!d.includes(":")||i)return;const b=En(e[d].accounts);b.includes(d)||(i=k("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${d}
        Required: ${d}
        Approved: ${b.toString()}`))}),o.forEach(d=>{i||(Ai(n[d].methods,s[d].methods)?Ai(n[d].events,s[d].events)||(i=k("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${d}`)):i=k("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${d}`))}),i}function F7(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Y0(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function L7(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=En(t[r].accounts);i?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function U7(t,e){return Hc(t,!1)&&t<=e.max&&t>=e.min}function X0(){const t=Gn();return new Promise(e=>{switch(t){case Ut.browser:e(q7());break;case Ut.reactNative:e(z7());break;case Ut.node:e(k7());break;default:e(!0)}})}function q7(){return Wn()&&navigator?.onLine}async function z7(){if(ii()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function k7(){return!0}function j7(t){switch(Gn()){case Ut.browser:V7(t);break;case Ut.reactNative:K7(t);break}}function V7(t){!ii()&&Wn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function K7(t){ii()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}const Gc={};class os{static get(e){return Gc[e]}static set(e,r){Gc[e]=r}static delete(e){delete Gc[e]}}const H7="PARSE_ERROR",W7="INVALID_REQUEST",G7="METHOD_NOT_FOUND",Y7="INVALID_PARAMS",J0="INTERNAL_ERROR",Yc="SERVER_ERROR",X7=[-32700,-32600,-32601,-32602,-32603],as={[H7]:{code:-32700,message:"Parse error"},[W7]:{code:-32600,message:"Invalid Request"},[G7]:{code:-32601,message:"Method not found"},[Y7]:{code:-32602,message:"Invalid params"},[J0]:{code:-32603,message:"Internal error"},[Yc]:{code:-32e3,message:"Server error"}},Z0=Yc;function J7(t){return X7.includes(t)}function Q0(t){return Object.keys(as).includes(t)?as[t]:as[Z0]}function Z7(t){const e=Object.values(as).find(r=>r.code===t);return e||as[Z0]}function Q7(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var ep={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Xc=function(t,e){return Xc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Xc(t,e)};function e_(t,e){Xc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Jc=function(){return Jc=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Jc.apply(this,arguments)};function t_(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function r_(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function i_(t,e){return function(r,i){e(r,i,t)}}function n_(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function s_(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(f){try{u(i.next(f))}catch(d){o(d)}}function c(f){try{u(i.throw(f))}catch(d){o(d)}}function u(f){f.done?s(f.value):n(f.value).then(a,c)}u((i=i.apply(t,e||[])).next())})}function o_(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(f){return c([u,f])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(f){u=[6,f],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function a_(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function c_(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Zc(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function tp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function u_(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(tp(arguments[e]));return t}function f_(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function cs(t){return this instanceof cs?(this.v=t,this):new cs(t)}function h_(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(b){i[b]&&(n[b]=function(v){return new Promise(function(g,E){s.push([b,v,g,E])>1||a(b,v)})})}function a(b,v){try{c(i[b](v))}catch(g){d(s[0][3],g)}}function c(b){b.value instanceof cs?Promise.resolve(b.value.v).then(u,f):d(s[0][2],b)}function u(b){a("next",b)}function f(b){a("throw",b)}function d(b,v){b(v),s.shift(),s.length&&a(s[0][0],s[0][1])}}function d_(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:cs(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function l_(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Zc=="function"?Zc(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function p_(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function b_(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function g_(t){return t&&t.__esModule?t:{default:t}}function y_(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function v_(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var m_=Object.freeze({__proto__:null,__extends:e_,get __assign(){return Jc},__rest:t_,__decorate:r_,__param:i_,__metadata:n_,__awaiter:s_,__generator:o_,__createBinding:a_,__exportStar:c_,__values:Zc,__read:tp,__spread:u_,__spreadArrays:f_,__await:cs,__asyncGenerator:h_,__asyncDelegator:d_,__asyncValues:l_,__makeTemplateObject:p_,__importStar:b_,__importDefault:g_,__classPrivateFieldGet:y_,__classPrivateFieldSet:v_}),w_=jo(m_),zr={},rp;function __(){if(rp)return zr;rp=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.isBrowserCryptoAvailable=zr.getSubtleCrypto=zr.getBrowerCrypto=void 0;function t(){return Jt?.crypto||Jt?.msCrypto||{}}zr.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}zr.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return zr.isBrowserCryptoAvailable=r,zr}var kr={},ip;function E_(){if(ip)return kr;ip=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.isBrowser=kr.isNode=kr.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}kr.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}kr.isNode=e;function r(){return!t()&&!e()}return kr.isBrowser=r,kr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=w_;e.__exportStar(__(),t),e.__exportStar(E_(),t)})(ep);function Sr(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Mi(t=6){return BigInt(Sr(t))}function Pi(t,e,r){return{id:r||Sr(),jsonrpc:"2.0",method:t,params:e}}function Qc(t,e){return{id:t,jsonrpc:"2.0",result:e}}function eu(t,e,r){return{id:t,jsonrpc:"2.0",error:x_(e,r)}}function x_(t,e){return typeof t>"u"?Q0(J0):(typeof t=="string"&&(t=Object.assign(Object.assign({},Q0(Yc)),{message:t})),typeof e<"u"&&(t.data=e),J7(t.code)&&(t=Z7(t.code)),t)}class S_{}class I_ extends S_{constructor(){super()}}class A_ extends I_{constructor(e){super()}}const O_="^wss?:";function D_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function $_(t,e){const r=D_(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function np(t){return $_(t,O_)}function M_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function sp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function tu(t){return sp(t)&&"method"in t}function Ro(t){return sp(t)&&(Ir(t)||Gt(t))}function Ir(t){return"result"in t}function Gt(t){return"error"in t}class P_ extends A_{constructor(e){super(e),this.events=new $t.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Pi(e.method,e.params||[],e.id||Mi().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{Gt(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ro(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const R_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),T_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",op=t=>t.split("?")[0],ap=10,N_=R_();class C_{constructor(e){if(this.url=e,this.events=new $t.exports.EventEmitter,this.registering=!1,!np(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(pi(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!np(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=ep.isReactNative()?void 0:{rejectUnauthorized:!M_(e)},s=new N_(e,[],n);T_()?s.onerror=o=>{const a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?qi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=eu(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Q7(e,op(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ap&&this.events.setMaxListeners(ap)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${op(this.url)}`));return this.events.emit("register_error",r),r}}var B_=Object.defineProperty,cp=Object.getOwnPropertySymbols,F_=Object.prototype.hasOwnProperty,L_=Object.prototype.propertyIsEnumerable,up=(t,e,r)=>e in t?B_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ot=(t,e)=>{for(var r in e||(e={}))F_.call(e,r)&&up(t,r,e[r]);if(cp)for(var r of cp(e))L_.call(e,r)&&up(t,r,e[r]);return t};const fp="wc",hp=2,To="core",Ar=`${fp}@2:${To}:`,U_={name:To,logger:"error"},q_={database:":memory:"},z_="crypto",dp="client_ed25519_seed",k_=z.ONE_DAY,j_="keychain",V_="0.3",K_="messages",H_="0.3",lp=z.SIX_HOURS,W_="publisher",pp="irn",G_="error",bp="wss://relay.walletconnect.org",Y_="relayer",ut={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},X_="_subscription",Yt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},J_=.1,ru="2.19.1",be={link_mode:"link_mode",relay:"relay"},No={inbound:"inbound",outbound:"outbound"},Z_="0.3",Q_="WALLETCONNECT_CLIENT_ID",gp="WALLETCONNECT_LINK_MODE_APPS",zt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},eE="subscription",tE="0.3",rE="pairing",iE="0.3",us={wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}},Ri={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},nr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},nE="history",sE="0.3",oE="expirer",Xt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},aE="0.3",cE="verify-api",uE="https://verify.walletconnect.com",yp="https://verify.walletconnect.org",fs=yp,fE=`${fs}/v3`,hE=[uE,yp],dE="echo",lE="https://echo.walletconnect.com",Or={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},jr={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},sr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ti={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Ni={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},hs={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},pE=.1,bE="event-client",gE=86400,yE="https://pulse.walletconnect.org/batch";function vE(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var E=0,I=0,$=0,D=g.length;$!==D&&g[$]===0;)$++,E++;for(var M=(D-$)*f+1>>>0,P=new Uint8Array(M);$!==D;){for(var T=g[$],N=0,C=M-1;(T!==0||N<I)&&C!==-1;C--,N++)T+=256*P[C]>>>0,P[C]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");I=N,$++}for(var B=M-I;B!==M&&P[B]===0;)B++;for(var R=c.repeat(E);B<M;++B)R+=t.charAt(P[B]);return R}function b(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var E=0;if(g[E]!==" "){for(var I=0,$=0;g[E]===c;)I++,E++;for(var D=(g.length-E)*u+1>>>0,M=new Uint8Array(D);g[E];){var P=r[g.charCodeAt(E)];if(P===255)return;for(var T=0,N=D-1;(P!==0||T<$)&&N!==-1;N--,T++)P+=a*M[N]>>>0,M[N]=P%256>>>0,P=P/256>>>0;if(P!==0)throw new Error("Non-zero carry");$=T,E++}if(g[E]!==" "){for(var C=D-$;C!==D&&M[C]===0;)C++;for(var B=new Uint8Array(I+(D-C)),R=I;C!==D;)B[R++]=M[C++];return B}}}function v(g){var E=b(g);if(E)return E;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:b,decode:v}}var mE=vE,wE=mE;const vp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},_E=t=>new TextEncoder().encode(t),EE=t=>new TextDecoder().decode(t);class xE{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class SE{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return mp(this,e)}}class IE{constructor(e){this.decoders=e}or(e){return mp(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const mp=(t,e)=>new IE(Ot(Ot({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class AE{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new xE(e,r,i),this.decoder=new SE(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Co=({name:t,prefix:e,encode:r,decode:i})=>new AE(t,e,r,i),ds=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=wE(r,e);return Co({prefix:t,name:e,encode:i,decode:s=>vp(n(s))})},OE=(t,e,r,i)=>{const n={};for(let f=0;f<e.length;++f)n[e[f]]=f;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let f=0;f<s;++f){const d=n[t[f]];if(d===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|d,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},DE=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},gt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Co({prefix:e,name:t,encode(n){return DE(n,i,r)},decode(n){return OE(n,i,r,t)}}),$E=Co({prefix:"\0",name:"identity",encode:t=>EE(t),decode:t=>_E(t)});var ME=Object.freeze({__proto__:null,identity:$E});const PE=gt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var RE=Object.freeze({__proto__:null,base2:PE});const TE=gt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var NE=Object.freeze({__proto__:null,base8:TE});const CE=ds({prefix:"9",name:"base10",alphabet:"0123456789"});var BE=Object.freeze({__proto__:null,base10:CE});const FE=gt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),LE=gt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var UE=Object.freeze({__proto__:null,base16:FE,base16upper:LE});const qE=gt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),zE=gt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),kE=gt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jE=gt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),VE=gt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),KE=gt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),HE=gt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),WE=gt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),GE=gt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var YE=Object.freeze({__proto__:null,base32:qE,base32upper:zE,base32pad:kE,base32padupper:jE,base32hex:VE,base32hexupper:KE,base32hexpad:HE,base32hexpadupper:WE,base32z:GE});const XE=ds({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),JE=ds({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ZE=Object.freeze({__proto__:null,base36:XE,base36upper:JE});const QE=ds({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ex=ds({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var tx=Object.freeze({__proto__:null,base58btc:QE,base58flickr:ex});const rx=gt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ix=gt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),nx=gt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),sx=gt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ox=Object.freeze({__proto__:null,base64:rx,base64pad:ix,base64url:nx,base64urlpad:sx});const wp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ax=wp.reduce((t,e,r)=>(t[r]=e,t),[]),cx=wp.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function ux(t){return t.reduce((e,r)=>(e+=ax[r],e),"")}function fx(t){const e=[];for(const r of t){const i=cx[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const hx=Co({prefix:"\u{1F680}",name:"base256emoji",encode:ux,decode:fx});var dx=Object.freeze({__proto__:null,base256emoji:hx}),lx=Ep,_p=128,px=127,bx=~px,gx=Math.pow(2,31);function Ep(t,e,r){e=e||[],r=r||0;for(var i=r;t>=gx;)e[r++]=t&255|_p,t/=128;for(;t&bx;)e[r++]=t&255|_p,t>>>=7;return e[r]=t|0,Ep.bytes=r-i+1,e}var yx=iu,vx=128,xp=127;function iu(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw iu.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&xp)<<n:(o&xp)*Math.pow(2,n),n+=7}while(o>=vx);return iu.bytes=s-i,r}var mx=Math.pow(2,7),wx=Math.pow(2,14),_x=Math.pow(2,21),Ex=Math.pow(2,28),xx=Math.pow(2,35),Sx=Math.pow(2,42),Ix=Math.pow(2,49),Ax=Math.pow(2,56),Ox=Math.pow(2,63),Dx=function(t){return t<mx?1:t<wx?2:t<_x?3:t<Ex?4:t<xx?5:t<Sx?6:t<Ix?7:t<Ax?8:t<Ox?9:10},$x={encode:lx,decode:yx,encodingLength:Dx},Sp=$x;const Ip=(t,e,r=0)=>(Sp.encode(t,e,r),e),Ap=t=>Sp.encodingLength(t),nu=(t,e)=>{const r=e.byteLength,i=Ap(t),n=i+Ap(r),s=new Uint8Array(n+r);return Ip(t,s,0),Ip(r,s,i),s.set(e,n),new Mx(t,r,e,s)};class Mx{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Op=({name:t,code:e,encode:r})=>new Px(t,e,r);class Px{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?nu(this.code,r):r.then(i=>nu(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Dp=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Rx=Op({name:"sha2-256",code:18,encode:Dp("SHA-256")}),Tx=Op({name:"sha2-512",code:19,encode:Dp("SHA-512")});var Nx=Object.freeze({__proto__:null,sha256:Rx,sha512:Tx});const $p=0,Cx="identity",Mp=vp;var Bx=Object.freeze({__proto__:null,identity:{code:$p,name:Cx,encode:Mp,digest:t=>nu($p,Mp(t))}});new TextEncoder,new TextDecoder;const Pp=Ot(Ot(Ot(Ot(Ot(Ot(Ot(Ot(Ot(Ot({},ME),RE),NE),BE),UE),YE),ZE),tx),ox),dx);Ot(Ot({},Nx),Bx);function Fx(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Rp(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Tp=Rp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),su=Rp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Fx(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Lx=Ot({utf8:Tp,"utf-8":Tp,hex:Pp.base16,latin1:su,ascii:su,binary:su},Pp);function Ux(t,e="utf8"){const r=Lx[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}var qx=Object.defineProperty,zx=(t,e,r)=>e in t?qx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Dr=(t,e,r)=>zx(t,typeof e!="symbol"?e+"":e,r);class kx{constructor(e,r){this.core=e,this.logger=r,Dr(this,"keychain",new Map),Dr(this,"name",j_),Dr(this,"version",V_),Dr(this,"initialized",!1),Dr(this,"storagePrefix",Ar),Dr(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),Dr(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Dr(this,"set",async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()}),Dr(this,"get",i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=k("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n}),Dr(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=St(r,this.name)}get context(){return Pt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Sc(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ic(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}}var jx=Object.defineProperty,Vx=(t,e,r)=>e in t?jx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yt=(t,e,r)=>Vx(t,typeof e!="symbol"?e+"":e,r);class Kx{constructor(e,r,i){this.core=e,this.logger=r,yt(this,"name",z_),yt(this,"keychain"),yt(this,"randomSessionIdentifier",Kc()),yt(this,"initialized",!1),yt(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),yt(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),yt(this,"getClientId",async()=>{this.isInitialized();const n=await this.getClientSeed(),s=wh(n);return mh(s.publicKey)}),yt(this,"generateKeyPair",()=>{this.isInitialized();const n=X9();return this.setPrivateKey(n.publicKey,n.privateKey)}),yt(this,"signJWT",async n=>{this.isInitialized();const s=await this.getClientSeed(),o=wh(s),a=this.randomSessionIdentifier;return await pv(a,n,k_,o)}),yt(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=J9(a,s);return this.setSymKey(c,o)}),yt(this,"setSymKey",async(n,s)=>{this.isInitialized();const o=s||Oo(n);return await this.keychain.set(o,n),o}),yt(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),yt(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),yt(this,"encode",async(n,s,o)=>{this.isInitialized();const a=L0(o),c=pi(s);if(q0(a))return e7(c,o?.encoding);if(U0(a)){const b=a.senderPublicKey,v=a.receiverPublicKey;n=await this.generateSharedKey(b,v)}const u=this.getSymKey(n),{type:f,senderPublicKey:d}=a;return Z9({type:f,symKey:u,message:c,senderPublicKey:d,encoding:o?.encoding})}),yt(this,"decode",async(n,s,o)=>{this.isInitialized();const a=r7(s,o);if(q0(a)){const c=t7(s,o?.encoding);return qi(c)}if(U0(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;n=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(n),u=Q9({symKey:c,encoded:s,encoding:o?.encoding});return qi(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),yt(this,"getPayloadType",(n,s=ui)=>{const o=is({encoded:n,encoding:s});return $i(o.type)}),yt(this,"getPayloadSenderPublicKey",(n,s=ui)=>{const o=is({encoded:n,encoding:s});return o.senderPublicKey?At(o.senderPublicKey,_t):void 0}),this.core=e,this.logger=St(r,this.name),this.keychain=i||new kx(this.core,this.logger)}get context(){return Pt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(dp)}catch{e=Kc(),await this.keychain.set(dp,e)}return Ux(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Hx=Object.defineProperty,Wx=Object.defineProperties,Gx=Object.getOwnPropertyDescriptors,Np=Object.getOwnPropertySymbols,Yx=Object.prototype.hasOwnProperty,Xx=Object.prototype.propertyIsEnumerable,ou=(t,e,r)=>e in t?Hx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jx=(t,e)=>{for(var r in e||(e={}))Yx.call(e,r)&&ou(t,r,e[r]);if(Np)for(var r of Np(e))Xx.call(e,r)&&ou(t,r,e[r]);return t},Zx=(t,e)=>Wx(t,Gx(e)),kt=(t,e,r)=>ou(t,typeof e!="symbol"?e+"":e,r);class Qx extends lg{constructor(e,r){super(e,r),this.logger=e,this.core=r,kt(this,"messages",new Map),kt(this,"messagesWithoutClientAck",new Map),kt(this,"name",K_),kt(this,"version",H_),kt(this,"initialized",!1),kt(this,"storagePrefix",Ar),kt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),kt(this,"set",async(i,n,s)=>{this.isInitialized();const o=xr(n);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(i,a),s===No.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,Zx(Jx({},c),{[o]:n}))}return await this.persist(),o}),kt(this,"get",i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n}),kt(this,"getWithoutAck",i=>{this.isInitialized();const n={};for(const s of i){const o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),kt(this,"has",(i,n)=>{this.isInitialized();const s=this.get(i),o=xr(n);return typeof s[o]<"u"}),kt(this,"ack",async(i,n)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;const o=xr(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),kt(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=St(e,this.name),this.core=r}get context(){return Pt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Sc(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Sc(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ic(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ic(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}}var eS=Object.defineProperty,tS=Object.defineProperties,rS=Object.getOwnPropertyDescriptors,Cp=Object.getOwnPropertySymbols,iS=Object.prototype.hasOwnProperty,nS=Object.prototype.propertyIsEnumerable,au=(t,e,r)=>e in t?eS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bo=(t,e)=>{for(var r in e||(e={}))iS.call(e,r)&&au(t,r,e[r]);if(Cp)for(var r of Cp(e))nS.call(e,r)&&au(t,r,e[r]);return t},cu=(t,e)=>tS(t,rS(e)),or=(t,e,r)=>au(t,typeof e!="symbol"?e+"":e,r);class sS extends pg{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,or(this,"events",new $t.exports.EventEmitter),or(this,"name",W_),or(this,"queue",new Map),or(this,"publishTimeout",z.toMiliseconds(z.ONE_MINUTE)),or(this,"initialPublishTimeout",z.toMiliseconds(z.ONE_SECOND*15)),or(this,"needsTransportRestart",!1),or(this,"publish",async(i,n,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const a=s?.ttl||lp,c=Do(s),u=s?.prompt||!1,f=s?.tag||0,d=s?.id||Mi().toString(),b={topic:i,message:n,opts:{ttl:a,relay:c,prompt:u,tag:f,id:d,attestation:s?.attestation,tvf:s?.tvf}},v=`Failed to publish payload, please try again. id:${d} tag:${f}`;try{const g=new Promise(async E=>{const I=({id:D})=>{b.opts.id===D&&(this.removeRequestFromQueue(D),this.relayer.events.removeListener(ut.publish,I),E(b))};this.relayer.events.on(ut.publish,I);const $=ni(new Promise((D,M)=>{this.rpcPublish({topic:i,message:n,ttl:a,prompt:u,tag:f,id:d,attestation:s?.attestation,tvf:s?.tvf}).then(D).catch(P=>{this.logger.warn(P,P?.message),M(P)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${f}`);try{await $,this.events.removeListener(ut.publish,I)}catch(D){this.queue.set(d,cu(Bo({},b),{attempt:1})),this.logger.warn(D,D?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:n,opts:s}}),await ni(g,this.publishTimeout,v)}catch(g){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(g),(o=s?.internal)!=null&&o.throwOnFailedPublish)throw g}finally{this.queue.delete(d)}}),or(this,"on",(i,n)=>{this.events.on(i,n)}),or(this,"once",(i,n)=>{this.events.once(i,n)}),or(this,"off",(i,n)=>{this.events.off(i,n)}),or(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.relayer=e,this.logger=St(r,this.name),this.registerEventListeners()}get context(){return Pt(this.logger)}async rpcPublish(e){var r,i,n,s;const{topic:o,message:a,ttl:c=lp,prompt:u,tag:f,id:d,attestation:b,tvf:v}=e,g={method:ns(Do().protocol).publish,params:Bo({topic:o,message:a,ttl:c,prompt:u,tag:f,attestation:b},v),id:d};bt((r=g.params)==null?void 0:r.prompt)&&((i=g.params)==null||delete i.prompt),bt((n=g.params)==null?void 0:n.tag)&&((s=g.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g});const E=await this.relayer.request(g);return this.relayer.events.emit(ut.publish,e),this.logger.debug("Successfully Published Payload"),E}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const i=e.attempt+1;this.queue.set(r,cu(Bo({},e),{attempt:i}));const{topic:n,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(cu(Bo({},e),{topic:n,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ui.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ut.connection_stalled);return}this.checkQueue()}),this.relayer.on(ut.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var oS=Object.defineProperty,aS=(t,e,r)=>e in t?oS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xn=(t,e,r)=>aS(t,typeof e!="symbol"?e+"":e,r);class cS{constructor(){xn(this,"map",new Map),xn(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),xn(this,"get",e=>this.map.get(e)||[]),xn(this,"exists",(e,r)=>this.get(e).includes(r)),xn(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),xn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var uS=Object.defineProperty,fS=Object.defineProperties,hS=Object.getOwnPropertyDescriptors,Bp=Object.getOwnPropertySymbols,dS=Object.prototype.hasOwnProperty,lS=Object.prototype.propertyIsEnumerable,uu=(t,e,r)=>e in t?uS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ls=(t,e)=>{for(var r in e||(e={}))dS.call(e,r)&&uu(t,r,e[r]);if(Bp)for(var r of Bp(e))lS.call(e,r)&&uu(t,r,e[r]);return t},fu=(t,e)=>fS(t,hS(e)),ce=(t,e,r)=>uu(t,typeof e!="symbol"?e+"":e,r);class pS extends yg{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ce(this,"subscriptions",new Map),ce(this,"topicMap",new cS),ce(this,"events",new $t.exports.EventEmitter),ce(this,"name",eE),ce(this,"version",tE),ce(this,"pending",new Map),ce(this,"cached",[]),ce(this,"initialized",!1),ce(this,"storagePrefix",Ar),ce(this,"subscribeTimeout",z.toMiliseconds(z.ONE_MINUTE)),ce(this,"initialSubscribeTimeout",z.toMiliseconds(z.ONE_SECOND*15)),ce(this,"clientId"),ce(this,"batchSubscribeTopicsLimit",500),ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ce(this,"subscribe",async(i,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=Do(n),o={topic:i,relay:s,transportType:n?.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,s,n);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),ce(this,"unsubscribe",async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)}),ce(this,"isSubscribed",i=>new Promise(n=>{n(this.topicMap.topics.includes(i))})),ce(this,"isKnownTopic",i=>new Promise(n=>{n(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),ce(this,"on",(i,n)=>{this.events.on(i,n)}),ce(this,"once",(i,n)=>{this.events.once(i,n)}),ce(this,"off",(i,n)=>{this.events.off(i,n)}),ce(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),ce(this,"start",async()=>{await this.onConnect()}),ce(this,"stop",async()=>{await this.onDisconnect()}),ce(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ce(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(n=>{i.push(n)}),await this.batchSubscribe(i)}),ce(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Ui.pulse,async()=>{await this.checkPending()}),this.events.on(zt.created,async i=>{const n=zt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()}),this.events.on(zt.deleted,async i=>{const n=zt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()})}),this.relayer=e,this.logger=St(r,this.name),this.clientId=""}get context(){return Pt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Do(i);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);const s=le("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,i){var n;(!i||i?.transportType===be.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const s={method:ns(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(n=i?.internal)==null?void 0:n.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(i?.transportType===be.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(f=>this.logger.warn(f))},z.toMiliseconds(z.ONE_SECOND)),a;const c=new Promise(async f=>{const d=b=>{b.topic===e&&(this.events.removeListener(zt.created,d),f(b.id))};this.events.on(zt.created,d);try{const b=await ni(new Promise((v,g)=>{this.relayer.request(s).catch(E=>{this.logger.warn(E,E?.message),g(E)}).then(v)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(zt.created,d),f(b)}catch{}}),u=await ni(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ut.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ns(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await ni(new Promise(n=>{this.relayer.request(i).catch(s=>this.logger.warn(s)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ut.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ns(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await ni(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ut.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:ns(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,fu(ls({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,ls({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,ls({},r)),this.topicMap.set(r.topic,e),this.events.emit(zt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=k("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(zt.deleted,fu(ls({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(zt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(zt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=k("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>fu(ls({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await h5(z.toMiliseconds(z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return xr(e+await this.getClientId())}}var bS=Object.defineProperty,Fp=Object.getOwnPropertySymbols,gS=Object.prototype.hasOwnProperty,yS=Object.prototype.propertyIsEnumerable,hu=(t,e,r)=>e in t?bS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lp=(t,e)=>{for(var r in e||(e={}))gS.call(e,r)&&hu(t,r,e[r]);if(Fp)for(var r of Fp(e))yS.call(e,r)&&hu(t,r,e[r]);return t},ie=(t,e,r)=>hu(t,typeof e!="symbol"?e+"":e,r);class vS extends bg{constructor(e){super(e),ie(this,"protocol","wc"),ie(this,"version",2),ie(this,"core"),ie(this,"logger"),ie(this,"events",new $t.exports.EventEmitter),ie(this,"provider"),ie(this,"messages"),ie(this,"subscriber"),ie(this,"publisher"),ie(this,"name",Y_),ie(this,"transportExplicitlyClosed",!1),ie(this,"initialized",!1),ie(this,"connectionAttemptInProgress",!1),ie(this,"relayUrl"),ie(this,"projectId"),ie(this,"packageName"),ie(this,"bundleId"),ie(this,"hasExperiencedNetworkDisruption",!1),ie(this,"pingTimeout"),ie(this,"heartBeatTimeout",z.toMiliseconds(z.THIRTY_SECONDS+z.FIVE_SECONDS)),ie(this,"reconnectTimeout"),ie(this,"connectPromise"),ie(this,"reconnectInProgress",!1),ie(this,"requestsInFlight",[]),ie(this,"connectTimeout",z.toMiliseconds(z.ONE_SECOND*15)),ie(this,"request",async r=>{var i,n;this.logger.debug("Publishing Request Payload");const s=r.id||Mi().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${s}:${((n=r.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),ie(this,"resetPingTimeout",()=>{mo()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,n,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:n.terminate)==null||s.call(n)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),ie(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),ie(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(ut.connect)}),ie(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),ie(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(ut.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ie(this,"registerProviderListeners",()=>{this.provider.on(Yt.payload,this.onPayloadHandler),this.provider.on(Yt.connect,this.onConnectHandler),this.provider.on(Yt.disconnect,this.onDisconnectHandler),this.provider.on(Yt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?St(e.logger,this.name):$r(na({level:e.logger||G_})),this.messages=new Qx(this.logger,e.core),this.subscriber=new pS(this,this.logger),this.publisher=new sS(this,this.logger),this.relayUrl=e?.relayUrl||bp,this.projectId=e.projectId,Y4()?this.packageName=Ul():X4()&&(this.bundleId=Ul()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return Pt(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:be.relay},No.outbound)}async subscribe(e,r){var i,n,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(n=r?.internal)==null?void 0:n.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=f=>{f.topic===e&&(this.subscriber.off(zt.created,u),c())};return await Promise.all([new Promise(f=>{c=f,this.subscriber.on(zt.created,u)}),new Promise(async(f,d)=>{a=await this.subscriber.subscribe(e,Lp({internal:{throwOnFailedPublish:o}},r)).catch(b=>{o&&d(b)})||a,f()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await ni(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await X0())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,n)=>i.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const n=et(z.FIVE_MINUTES),s={topic:i,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit(ut.message,e),await this.recordMessageEvent(e,No.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,n)=>{const s=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Yt.disconnect,s),await ni(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(Yt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Yt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Yt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const n=i;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,z.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,n,s;if(mo())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new P_(new C_(e5({sdkVersion:ru,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:n}=e;await this.messages.set(i,n,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.warn(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),tu(e)){if(!e.method.endsWith(X_))return;const r=e.params,{topic:i,message:n,publishedAt:s,attestation:o}=r.data,a={topic:i,message:n,publishedAt:s,transportType:be.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Lp({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Ro(e)&&this.events.emit(ut.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,No.inbound),this.events.emit(ut.message,e))}async acknowledgePayload(e){const r=Qc(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Yt.payload,this.onPayloadHandler),this.provider.off(Yt.connect,this.onConnectHandler),this.provider.off(Yt.disconnect,this.onDisconnectHandler),this.provider.off(Yt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await X0();j7(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ut.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},z.toMiliseconds(J_)))))}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}}function mS(){}function Up(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function qp(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function zp(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const wS="[object RegExp]",_S="[object String]",ES="[object Number]",xS="[object Boolean]",kp="[object Arguments]",SS="[object Symbol]",IS="[object Date]",AS="[object Map]",OS="[object Set]",DS="[object Array]",$S="[object Function]",MS="[object ArrayBuffer]",du="[object Object]",PS="[object Error]",RS="[object DataView]",TS="[object Uint8Array]",NS="[object Uint8ClampedArray]",CS="[object Uint16Array]",BS="[object Uint32Array]",FS="[object BigUint64Array]",LS="[object Int8Array]",US="[object Int16Array]",qS="[object Int32Array]",zS="[object BigInt64Array]",kS="[object Float32Array]",jS="[object Float64Array]";function VS(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function KS(t,e,r){return ps(t,e,void 0,void 0,void 0,void 0,r)}function ps(t,e,r,i,n,s,o){const a=o(t,e,r,i,n,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return bs(t,e,s,o)}return bs(t,e,s,o)}function bs(t,e,r,i){if(Object.is(t,e))return!0;let n=zp(t),s=zp(e);if(n===kp&&(n=du),s===kp&&(s=du),n!==s)return!1;switch(n){case _S:return t.toString()===e.toString();case ES:{const c=t.valueOf(),u=e.valueOf();return VS(c,u)}case xS:case IS:case SS:return Object.is(t.valueOf(),e.valueOf());case wS:return t.source===e.source&&t.flags===e.flags;case $S:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case AS:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!ps(u,e.get(c),c,t,e,r,i))return!1;return!0}case OS:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let f=0;f<c.length;f++){const d=c[f],b=u.findIndex(v=>ps(d,v,void 0,t,e,r,i));if(b===-1)return!1;u.splice(b,1)}return!0}case DS:case TS:case NS:case CS:case BS:case FS:case LS:case US:case qS:case zS:case kS:case jS:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!ps(t[c],e[c],c,t,e,r,i))return!1;return!0}case MS:return t.byteLength!==e.byteLength?!1:bs(new Uint8Array(t),new Uint8Array(e),r,i);case RS:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:bs(new Uint8Array(t),new Uint8Array(e),r,i);case PS:return t.name===e.name&&t.message===e.message;case du:{if(!(bs(t.constructor,e.constructor,r,i)||Up(t)&&Up(e)))return!1;const c=[...Object.keys(t),...qp(t)],u=[...Object.keys(e),...qp(e)];if(c.length!==u.length)return!1;for(let f=0;f<c.length;f++){const d=c[f],b=t[d];if(!Object.hasOwn(e,d))return!1;const v=e[d];if(!ps(b,v,d,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function HS(t,e){return KS(t,e,mS)}var WS=Object.defineProperty,jp=Object.getOwnPropertySymbols,GS=Object.prototype.hasOwnProperty,YS=Object.prototype.propertyIsEnumerable,lu=(t,e,r)=>e in t?WS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vp=(t,e)=>{for(var r in e||(e={}))GS.call(e,r)&&lu(t,r,e[r]);if(jp)for(var r of jp(e))YS.call(e,r)&&lu(t,r,e[r]);return t},Bt=(t,e,r)=>lu(t,typeof e!="symbol"?e+"":e,r);class Ci extends gg{constructor(e,r,i,n=Ar,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,Bt(this,"map",new Map),Bt(this,"version",Z_),Bt(this,"cached",[]),Bt(this,"initialized",!1),Bt(this,"getKey"),Bt(this,"storagePrefix",Ar),Bt(this,"recentlyDeleted",[]),Bt(this,"recentlyDeletedLimit",200),Bt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!bt(o)?this.map.set(this.getKey(o),o):w7(o)?this.map.set(o.id,o):_7(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Bt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Bt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Bt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>HS(a[c],o[c]))):this.values)),Bt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Vp(Vp({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Bt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=St(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Pt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=k("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=k("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=k("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}}var XS=Object.defineProperty,JS=(t,e,r)=>e in t?XS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ee=(t,e,r)=>JS(t,typeof e!="symbol"?e+"":e,r);class ZS{constructor(e,r){this.core=e,this.logger=r,ee(this,"name",rE),ee(this,"version",iE),ee(this,"events",new $t.exports),ee(this,"pairings"),ee(this,"initialized",!1),ee(this,"storagePrefix",Ar),ee(this,"ignoredPayloadTypes",[qr]),ee(this,"registeredMethods",[]),ee(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ee(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),ee(this,"create",async i=>{this.isInitialized();const n=Kc(),s=await this.core.crypto.setSymKey(n),o=et(z.FIVE_MINUTES),a={protocol:pp},c={topic:s,expiry:o,relay:a,active:!1,methods:i?.methods},u=k0({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Ri.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i?.transportType}),{topic:s,uri:u}}),ee(this,"pair",async i=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Or.pairing_started]}});this.isValidPair(i,n);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=z0(i.uri);n.props.properties.topic=s,n.addTrace(Or.pairing_uri_validation_success),n.addTrace(Or.pairing_uri_not_expired);let f;if(this.pairings.keys.includes(s)){if(f=this.pairings.get(s),n.addTrace(Or.existing_pairing),f.active)throw n.setError(jr.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(Or.pairing_not_expired)}const d=c||et(z.FIVE_MINUTES),b={topic:s,relay:a,expiry:d,active:!1,methods:u};this.core.expirer.set(s,d),await this.pairings.set(s,b),n.addTrace(Or.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(Ri.create,b),n.addTrace(Or.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(Or.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(jr.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(v){throw n.setError(jr.subscribe_pairing_topic_failure),v}return n.addTrace(Or.subscribe_pairing_topic_success),b}),ee(this,"activate",async({topic:i})=>{this.isInitialized();const n=et(z.FIVE_MINUTES);this.core.expirer.set(i,n),await this.pairings.update(i,{active:!0,expiry:n})}),ee(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Oi();this.events.once(se("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),ee(this,"updateExpiry",async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})}),ee(this,"updateMetadata",async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})}),ee(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ee(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",le("USER_DISCONNECTED")),await this.deletePairing(n))}),ee(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:n,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(n);return k0({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),ee(this,"sendRequest",async(i,n,s)=>{const o=Pi(n,s),a=await this.core.crypto.encode(i,o),c=us[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),ee(this,"sendResult",async(i,n,s)=>{const o=Qc(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=us[c].res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),ee(this,"sendError",async(i,n,s)=>{const o=eu(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=us[c]?us[c].res:us.unregistered_method.res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),ee(this,"deletePairing",async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,le("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])}),ee(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(n=>si(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))}),ee(this,"onRelayEventRequest",async i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),ee(this,"onRelayEventResponse",async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(o)}}),ee(this,"onPairingPingRequest",async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(Ri.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),ee(this,"onPairingPingResponse",(i,n)=>{const{id:s}=n;setTimeout(()=>{Ir(n)?this.events.emit(se("pairing_ping",s),{}):Gt(n)&&this.events.emit(se("pairing_ping",s),{error:n.error})},500)}),ee(this,"onPairingDeleteRequest",async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Ri.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),ee(this,"onUnknownRpcMethodRequest",async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=le("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),ee(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(le("WC_METHOD_UNSUPPORTED",i))}),ee(this,"isValidPair",(i,n)=>{var s;if(!Ct(i)){const{message:a}=k("MISSING_OR_INVALID",`pair() params: ${i}`);throw n.setError(jr.malformed_pairing_uri),new Error(a)}if(!m7(i.uri)){const{message:a}=k("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw n.setError(jr.malformed_pairing_uri),new Error(a)}const o=z0(i?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=k("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(jr.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=k("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(jr.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&z.toMiliseconds(o?.expiryTimestamp)<Date.now()){n.setError(jr.pairing_expired);const{message:a}=k("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ee(this,"isValidPing",async i=>{if(!Ct(i)){const{message:s}=k("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),ee(this,"isValidDisconnect",async i=>{if(!Ct(i)){const{message:s}=k("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),ee(this,"isValidPairingTopic",async i=>{if(!$e(i,!1)){const{message:n}=k("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=k("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(si(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=k("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}}),this.core=e,this.logger=St(r,this.name),this.pairings=new Ci(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Pt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ut.message,async e=>{const{topic:r,message:i,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==be.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const s=await this.core.crypto.decode(r,i);tu(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Ro(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Xt.expired,async e=>{const{topic:r}=jl(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ri.expire,{topic:r}))})}}var QS=Object.defineProperty,eI=(t,e,r)=>e in t?QS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vt=(t,e,r)=>eI(t,typeof e!="symbol"?e+"":e,r);class tI extends dg{constructor(e,r){super(e,r),this.core=e,this.logger=r,vt(this,"records",new Map),vt(this,"events",new $t.exports.EventEmitter),vt(this,"name",nE),vt(this,"version",sE),vt(this,"cached",[]),vt(this,"initialized",!1),vt(this,"storagePrefix",Ar),vt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),vt(this,"set",(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:et(z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(nr.created,o)}),vt(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Gt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.persist(),this.events.emit(nr.updated,n))}),vt(this,"get",async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n))),vt(this,"delete",(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(nr.deleted,s)}}),this.persist()}),vt(this,"exists",async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1)),vt(this,"on",(i,n)=>{this.events.on(i,n)}),vt(this,"once",(i,n)=>{this.events.once(i,n)}),vt(this,"off",(i,n)=>{this.events.off(i,n)}),vt(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=St(r,this.name)}get context(){return Pt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Pi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=k("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(nr.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=k("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(nr.created,e=>{const r=nr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(nr.updated,e=>{const r=nr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(nr.deleted,e=>{const r=nr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Ui.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(nr.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}}var rI=Object.defineProperty,iI=(t,e,r)=>e in t?rI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Et=(t,e,r)=>iI(t,typeof e!="symbol"?e+"":e,r);class nI extends vg{constructor(e,r){super(e,r),this.core=e,this.logger=r,Et(this,"expirations",new Map),Et(this,"events",new $t.exports.EventEmitter),Et(this,"name",oE),Et(this,"version",aE),Et(this,"cached",[]),Et(this,"initialized",!1),Et(this,"storagePrefix",Ar),Et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Et(this,"has",i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}}),Et(this,"set",(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Xt.created,{target:s,expiration:o})}),Et(this,"get",i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)}),Et(this,"del",i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(Xt.deleted,{target:n,expiration:s})}}),Et(this,"on",(i,n)=>{this.events.on(i,n)}),Et(this,"once",(i,n)=>{this.events.once(i,n)}),Et(this,"off",(i,n)=>{this.events.off(i,n)}),Et(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=St(r,this.name)}get context(){return Pt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return t5(e);if(typeof e=="number")return r5(e);const{message:r}=k("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Xt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=k("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=k("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Xt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Ui.pulse,()=>this.checkExpirations()),this.events.on(Xt.created,e=>{const r=Xt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Xt.expired,e=>{const r=Xt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Xt.deleted,e=>{const r=Xt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sI=Object.defineProperty,oI=(t,e,r)=>e in t?sI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Me=(t,e,r)=>oI(t,typeof e!="symbol"?e+"":e,r);class aI extends mg{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,Me(this,"name",cE),Me(this,"abortController"),Me(this,"isDevEnv"),Me(this,"verifyUrlV3",fE),Me(this,"storagePrefix",Ar),Me(this,"version",hp),Me(this,"publicKey"),Me(this,"fetchPromise"),Me(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&z.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Me(this,"register",async n=>{if(!Wn()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Tn(),f=this.startAbortTimer(z.ONE_SECOND*5),d=await new Promise((b,v)=>{const g=()=>{window.removeEventListener("message",I),u.body.removeChild(E),v("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const E=u.createElement("iframe");E.src=c,E.style.display="none",E.addEventListener("error",g,{signal:this.abortController.signal});const I=$=>{if($.data&&typeof $.data=="string")try{const D=JSON.parse($.data);if(D.type==="verify_attestation"){if(Ia(D.attestation).payload.id!==o)return;clearInterval(f),u.body.removeChild(E),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",I),b(D.attestation===null?"":D.attestation)}}catch(D){this.logger.warn(D)}};u.body.appendChild(E),window.addEventListener("message",I,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(u){this.logger.warn(u)}return""}),Me(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Ia(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),Me(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);const o=this.startAbortTimer(z.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Me(this,"getVerifyUrl",n=>{let s=n||fs;return hE.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${fs}`),s=fs),s}),Me(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(z.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),Me(this,"persistPublicKey",async n=>{this.logger.debug("persisting public key to local storage",n),await this.store.setItem(this.storeKey,n),this.publicKey=n}),Me(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Me(this,"isValidJwtAttestation",async n=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Me(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Me(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),Me(this,"validateAttestation",(n,s)=>{const o=o7(n,s.publicKey),a={hasExpired:z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=St(r,this.name),this.abortController=new AbortController,this.isDevEnv=Ac(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Pt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),z.toMiliseconds(e))}}var cI=Object.defineProperty,uI=(t,e,r)=>e in t?cI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Kp=(t,e,r)=>uI(t,typeof e!="symbol"?e+"":e,r);class fI extends wg{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Kp(this,"context",dE),Kp(this,"registerDeviceToken",async i=>{const{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${lE}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=St(r,this.context)}}var hI=Object.defineProperty,Hp=Object.getOwnPropertySymbols,dI=Object.prototype.hasOwnProperty,lI=Object.prototype.propertyIsEnumerable,pu=(t,e,r)=>e in t?hI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gs=(t,e)=>{for(var r in e||(e={}))dI.call(e,r)&&pu(t,r,e[r]);if(Hp)for(var r of Hp(e))lI.call(e,r)&&pu(t,r,e[r]);return t},ft=(t,e,r)=>pu(t,typeof e!="symbol"?e+"":e,r);class pI extends _g{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,ft(this,"context",bE),ft(this,"storagePrefix",Ar),ft(this,"storageVersion",pE),ft(this,"events",new Map),ft(this,"shouldPersist",!1),ft(this,"init",async()=>{if(!Ac())try{const n={eventId:Kl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:zl(this.core.relayer.protocol,this.core.relayer.version,ru)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),ft(this,"createEvent",n=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,u=Kl(),f=this.core.projectId||"",d=Date.now(),b=gs({eventId:u,timestamp:d,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:f,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,b),this.shouldPersist=!0),b}),ft(this,"getEvent",n=>{const{eventId:s,topic:o}=n;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return gs(gs({},a),this.setMethods(a.eventId))}),ft(this,"deleteEvent",n=>{const{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),ft(this,"setEventListeners",()=>{this.core.heartbeat.on(Ui.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{z.fromMiliseconds(Date.now())-z.fromMiliseconds(n.timestamp)>gE&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),ft(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),ft(this,"addTrace",(n,s)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),ft(this,"setError",(n,s)=>{const o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),ft(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ft(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,gs(gs({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),ft(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),ft(this,"sendEvent",async n=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${yE}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ru}${s}`,{method:"POST",body:JSON.stringify(n)})}),ft(this,"getAppDomain",()=>ql().url),this.logger=St(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var bI=Object.defineProperty,Wp=Object.getOwnPropertySymbols,gI=Object.prototype.hasOwnProperty,yI=Object.prototype.propertyIsEnumerable,bu=(t,e,r)=>e in t?bI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gp=(t,e)=>{for(var r in e||(e={}))gI.call(e,r)&&bu(t,r,e[r]);if(Wp)for(var r of Wp(e))yI.call(e,r)&&bu(t,r,e[r]);return t},pe=(t,e,r)=>bu(t,typeof e!="symbol"?e+"":e,r);class gu extends cg{constructor(e){var r;super(e),pe(this,"protocol",fp),pe(this,"version",hp),pe(this,"name",To),pe(this,"relayUrl"),pe(this,"projectId"),pe(this,"customStoragePrefix"),pe(this,"events",new $t.exports.EventEmitter),pe(this,"logger"),pe(this,"heartbeat"),pe(this,"relayer"),pe(this,"crypto"),pe(this,"storage"),pe(this,"history"),pe(this,"expirer"),pe(this,"pairing"),pe(this,"verify"),pe(this,"echoClient"),pe(this,"linkModeSupportedApps"),pe(this,"eventClient"),pe(this,"initialized",!1),pe(this,"logChunkController"),pe(this,"on",(o,a)=>this.events.on(o,a)),pe(this,"once",(o,a)=>this.events.once(o,a)),pe(this,"off",(o,a)=>this.events.off(o,a)),pe(this,"removeListener",(o,a)=>this.events.removeListener(o,a)),pe(this,"dispatchEnvelope",({topic:o,message:a,sessionExists:c})=>{if(!o||!a)return;const u={topic:o,message:a,publishedAt:Date.now(),transportType:be.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:c})}),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||bp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=na({level:typeof e?.logger=="string"&&e.logger?e.logger:U_.logger,name:To}),{logger:n,chunkLoggerController:s}=sg({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=s,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var o,a;(o=this.logChunkController)!=null&&o.downloadLogsBlobInBrowser&&((a=this.logChunkController)==null||a.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=St(n,this.name),this.heartbeat=new Jo,this.crypto=new Kx(this,this.logger,e?.keychain),this.history=new tI(this,this.logger),this.expirer=new nI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Pb(Gp(Gp({},q_),e?.storageOptions)),this.relayer=new vS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ZS(this,this.logger),this.verify=new aI(this,this.logger,this.storage),this.echoClient=new fI(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new pI(this,this.logger,e?.telemetryEnabled)}static async init(e){const r=new gu(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(Q_,i),r}get context(){return Pt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(gp,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(gp)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const vI=gu,yu="wc",vu=2,mu="client",Fo=`${yu}@${vu}:${mu}:`,Lo={name:mu,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},mI={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},wI={database:":memory:"},wu="WALLETCONNECT_DEEPLINK_CHOICE",_I={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},EI="history",xI="0.3",Yp="proposal",SI=z.THIRTY_DAYS,_u="Proposal expired",Xp="session",Bi=z.SEVEN_DAYS,Jp="engine",tt={wc_sessionPropose:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1119}}},Uo={min:z.FIVE_MINUTES,max:z.SEVEN_DAYS},ar={idle:"IDLE",active:"ACTIVE"},Eu={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},Zp="request",Qp=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],e1="wc",II=1.5,t1="auth",r1="authKeys",i1="pairingTopics",n1="requests",ys=`${e1}@${1.5}:${t1}:`,vs=`${ys}:PUB_KEY`;var AI=Object.defineProperty,OI=Object.defineProperties,DI=Object.getOwnPropertyDescriptors,s1=Object.getOwnPropertySymbols,$I=Object.prototype.hasOwnProperty,MI=Object.prototype.propertyIsEnumerable,xu=(t,e,r)=>e in t?AI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ue=(t,e)=>{for(var r in e||(e={}))$I.call(e,r)&&xu(t,r,e[r]);if(s1)for(var r of s1(e))MI.call(e,r)&&xu(t,r,e[r]);return t},Dt=(t,e)=>OI(t,DI(e)),q=(t,e,r)=>xu(t,typeof e!="symbol"?e+"":e,r);class PI extends Ig{constructor(e){super(e),q(this,"name",Jp),q(this,"events",new $t.exports),q(this,"initialized",!1),q(this,"requestQueue",{state:ar.idle,queue:[]}),q(this,"sessionRequestQueue",{state:ar.idle,queue:[]}),q(this,"requestQueueDelay",z.ONE_SECOND),q(this,"expectedPairingMethodMap",new Map),q(this,"recentlyDeletedMap",new Map),q(this,"recentlyDeletedLimit",200),q(this,"relayMessageCache",[]),q(this,"pendingSessions",new Map),q(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(tt)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay)))}),q(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Dt(ue({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=i;let f=n,d,b=!1;try{if(f){const N=this.client.core.pairing.pairings.get(f);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),b=N.active}}catch(N){throw this.client.logger.error(`connect() -> pairing.get(${f}) failed`),N}if(!f||!b){const{topic:N,uri:C}=await this.client.core.pairing.create();f=N,d=C}if(!f){const{message:N}=k("NO_MATCHING_KEY",`connect() pairing topic: ${f}`);throw new Error(N)}const v=await this.client.core.crypto.generateKeyPair(),g=tt.wc_sessionPropose.req.ttl||z.FIVE_MINUTES,E=et(g),I=Dt(ue(ue({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:pp}],proposer:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:E,pairingTopic:f},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Sr()}),$=se("session_connect",I.id),{reject:D,resolve:M,done:P}=Oi(g,_u),T=({id:N})=>{N===I.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(I.id),this.events.emit($,{error:{message:_u,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once($,({error:N,session:C})=>{this.client.events.off("proposal_expire",T),N?D(N):C&&M(C)}),await this.sendRequest({topic:f,method:"wc_sessionPropose",params:I,throwOnFailedPublish:!0,clientRpcId:I.id}),await this.setProposal(I.id,I),{uri:d,approval:P}}),q(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),q(this,"approve",async r=>{var i,n,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[sr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(R){throw o.setError(Ti.no_internet_connection),R}try{await this.isValidProposalId(r?.id)}catch(R){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Ti.proposal_not_found),R}try{await this.isValidApprove(r)}catch(R){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ti.session_approve_namespace_validation_failure),R}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:f,scopedProperties:d,sessionConfig:b}=r,v=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:E,requiredNamespaces:I,optionalNamespaces:$}=v;let D=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:g});D||(D=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:sr.session_approve_started,properties:{topic:g,trace:[sr.session_approve_started,sr.session_namespaces_validation_success]}}));const M=await this.client.core.crypto.generateKeyPair(),P=E.publicKey,T=await this.client.core.crypto.generateSharedKey(M,P),N=ue(ue(ue({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:M,metadata:this.client.metadata},expiry:et(Bi)},f&&{sessionProperties:f}),d&&{scopedProperties:d}),b&&{sessionConfig:b}),C=be.relay;D.addTrace(sr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:C})}catch(R){throw D.setError(Ti.subscribe_session_topic_failure),R}D.addTrace(sr.subscribe_session_topic_success);const B=Dt(ue({},N),{topic:T,requiredNamespaces:I,optionalNamespaces:$,pairingTopic:g,acknowledged:!1,self:N.controller,peer:{publicKey:E.publicKey,metadata:E.metadata},controller:M,transportType:be.relay});await this.client.session.set(T,B),D.addTrace(sr.store_session);try{D.addTrace(sr.publishing_session_settle),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:N,throwOnFailedPublish:!0}).catch(R=>{throw D?.setError(Ti.session_settle_publish_failure),R}),D.addTrace(sr.session_settle_publish_success),D.addTrace(sr.publishing_session_approve),await this.sendResult({id:a,topic:g,result:{relay:{protocol:c??"irn"},responderPublicKey:M},throwOnFailedPublish:!0}).catch(R=>{throw D?.setError(Ti.session_approve_publish_failure),R}),D.addTrace(sr.session_approve_publish_success)}catch(R){throw this.client.logger.error(R),this.client.session.delete(T,le("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),R}return this.client.core.eventClient.deleteEvent({eventId:D.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:E.metadata}),await this.client.proposal.delete(a,le("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(T,et(Bi)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),q(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:n}=r;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&(await this.sendError({id:i,topic:s,error:n,rpcOpts:tt.wc_sessionPropose.reject}),await this.client.proposal.delete(i,le("USER_DISCONNECTED")))}),q(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(d){throw this.client.logger.error("update() -> isValidUpdate() failed"),d}const{topic:i,namespaces:n}=r,{done:s,resolve:o,reject:a}=Oi(),c=Sr(),u=Mi().toString(),f=this.client.session.get(i).namespaces;return this.events.once(se("session_update",c),({error:d})=>{d?a(d):o()}),await this.client.session.update(i,{namespaces:n}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(d=>{this.client.logger.error(d),this.client.session.update(i,{namespaces:f}),a(d)}),{acknowledged:s}}),q(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,n=Sr(),{done:s,resolve:o,reject:a}=Oi();return this.events.once(se("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,et(Bi)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),q(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch($){throw this.client.logger.error("request() -> isValidRequest() failed"),$}const{chainId:i,request:n,topic:s,expiry:o=tt.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);a?.transportType===be.relay&&await this.confirmOnlineStateOrThrow();const c=Sr(),u=Mi().toString(),{done:f,resolve:d,reject:b}=Oi(o,"Request expired. Please try again.");this.events.once(se("session_request",c),({error:$,result:D})=>{$?b($):d(D)});const v="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:v,params:{request:Dt(ue({},n),{expiryTimestamp:et(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch($=>b($)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),await f();const E={request:Dt(ue({},n),{expiryTimestamp:et(o)}),chainId:i},I=this.shouldSetTVF(v,E);return await Promise.all([new Promise(async $=>{await this.sendRequest(ue({clientRpcId:c,relayRpcId:u,topic:s,method:v,params:E,expiry:o,throwOnFailedPublish:!0},I&&{tvf:this.getTVFParams(c,E)})).catch(D=>b(D)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),$()}),new Promise(async $=>{var D;if(!((D=a.sessionConfig)!=null&&D.disableDeepLink)){const M=await a5(this.client.core.storage,wu);await n5({id:c,topic:s,wcDeepLink:M})}$()}),f()]).then($=>$[2])}),q(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n,o=this.client.session.get(i);o.transportType===be.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Ir(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0,appLink:a}):Gt(n)&&await this.sendError({id:s,topic:i,error:n.error,appLink:a}),this.cleanupAfterResponse(r)}),q(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=Sr(),s=Mi().toString(),{done:o,resolve:a,reject:c}=Oi();this.events.once(se("session_ping",n),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),q(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r,o=Mi().toString(),a=Sr();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),q(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:le("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=k("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}}),q(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>y7(i,r)))),q(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),q(this,"authenticate",async(r,i)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);const s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?be.link_mode:be.relay;o===be.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:f,nonce:d,type:b,exp:v,nbf:g,methods:E=[],expiry:I}=r,$=[...r.resources||[]],{topic:D,uri:M}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:D,uri:M}});const P=await this.client.core.crypto.generateKeyPair(),T=Oo(P);if(await Promise.all([this.client.auth.authKeys.set(vs,{responseTopic:T,publicKey:P}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:D})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${D}`),E.length>0){const{namespace:_}=vo(a[0]);let l=J5(_,"request",E);xo($)&&(l=Q5(l,$.pop())),$.push(l)}const N=I&&I>tt.wc_sessionAuthenticate.req.ttl?I:tt.wc_sessionAuthenticate.req.ttl,C={authPayload:{type:b??"caip122",chains:a,statement:c,aud:u,domain:f,version:"1",nonce:d,iat:new Date().toISOString(),exp:v,nbf:g,resources:$},requester:{publicKey:P,metadata:this.client.metadata},expiryTimestamp:et(N)},B={eip155:{chains:a,methods:[...new Set(["personal_sign",...E])],events:["chainChanged","accountsChanged"]}},R={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:D,proposer:{publicKey:P,metadata:this.client.metadata},expiryTimestamp:et(tt.wc_sessionPropose.req.ttl),id:Sr()},{done:V,resolve:A,reject:h}=Oi(N,"Request expired"),p=Sr(),m=se("session_connect",R.id),y=se("session_request",p),w=async({error:_,session:l})=>{this.events.off(y,S),_?h(_):l&&A({session:l})},S=async _=>{var l,x,F;if(await this.deletePendingAuthRequest(p,{message:"fulfilled",code:0}),_.error){const H=le("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===H.code?void 0:(this.events.off(m,w),h(_.error.message))}await this.deleteProposal(R.id),this.events.off(m,w);const{cacaos:L,responder:U}=_.result,j=[],K=[];for(const H of L){await o0({cacao:H,projectId:this.client.core.projectId})||(this.client.logger.error(H,"Signature verification failed"),h(le("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:G}=H,Pe=xo(G.resources),Q=[Rc(G.iss)],ne=Eo(G.iss);if(Pe){const xt=u0(Pe),fe=f0(Pe);j.push(...xt),Q.push(...fe)}for(const xt of Q)K.push(`${xt}:${ne}`)}const W=await this.client.core.crypto.generateSharedKey(P,U.publicKey);let J;j.length>0&&(J={topic:W,acknowledged:!0,self:{publicKey:P,metadata:this.client.metadata},peer:U,controller:U.publicKey,expiry:et(Bi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:D,namespaces:j0([...new Set(j)],[...new Set(K)]),transportType:o},await this.client.core.relayer.subscribe(W,{transportType:o}),await this.client.session.set(W,J),D&&await this.client.core.pairing.updateMetadata({topic:D,metadata:U.metadata}),J=this.client.session.get(W)),(l=this.client.metadata.redirect)!=null&&l.linkMode&&(x=U.metadata.redirect)!=null&&x.linkMode&&(F=U.metadata.redirect)!=null&&F.universal&&i&&(this.client.core.addLinkModeSupportedApp(U.metadata.redirect.universal),this.client.session.update(W,{transportType:be.link_mode})),A({auths:L,session:J})};this.events.once(m,w),this.events.once(y,S);let O;try{if(s){const _=Pi("wc_sessionAuthenticate",C,p);this.client.core.history.set(D,_);const l=await this.client.core.crypto.encode("",_,{type:ts,encoding:Qn});O=$o(i,D,l)}else await Promise.all([this.sendRequest({topic:D,method:"wc_sessionAuthenticate",params:C,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:p}),this.sendRequest({topic:D,method:"wc_sessionPropose",params:R,expiry:tt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:R.id})])}catch(_){throw this.events.off(m,w),this.events.off(y,S),_}return await this.setProposal(R.id,R),await this.setAuthRequest(p,{request:Dt(ue({},C),{verifyContext:{}}),pairingTopic:D,transportType:o}),{uri:O??M,response:V}}),q(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:n}=r,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Ni.authenticated_session_approve_started]}});try{this.isInitialized()}catch(I){throw s.setError(hs.no_internet_connection),I}const o=this.getPendingAuthRequest(i);if(!o)throw s.setError(hs.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||be.relay;a===be.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),f=Oo(c),d={type:qr,receiverPublicKey:c,senderPublicKey:u},b=[],v=[];for(const I of n){if(!await o0({cacao:I,projectId:this.client.core.projectId})){s.setError(hs.invalid_cacao);const T=le("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:f,error:T,encodeOpts:d}),new Error(T.message)}s.addTrace(Ni.cacaos_verified);const{p:$}=I,D=xo($.resources),M=[Rc($.iss)],P=Eo($.iss);if(D){const T=u0(D),N=f0(D);b.push(...T),M.push(...N)}for(const T of M)v.push(`${T}:${P}`)}const g=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Ni.create_authenticated_session_topic);let E;if(b?.length>0){E={topic:g,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:et(Bi),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:j0([...new Set(b)],[...new Set(v)]),transportType:a},s.addTrace(Ni.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(I){throw s.setError(hs.subscribe_authenticated_session_topic_failure),I}s.addTrace(Ni.subscribe_authenticated_session_topic_success),await this.client.session.set(g,E),s.addTrace(Ni.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Ni.publishing_authenticated_session_approve);try{await this.sendResult({topic:f,id:i,result:{cacaos:n,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(I){throw s.setError(hs.authenticated_session_approve_publish_failure),I}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:E}}),q(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:n}=r,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===be.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Oo(o),u={type:qr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:n,encodeOpts:u,rpcOpts:tt.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,le("USER_DISCONNECTED"))}),q(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:n}=r;return a0(i,n)}),q(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),q(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),q(this,"deleteSession",async r=>{var i;const{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,le("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(wu).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===n&&this.deletePendingSessionRequest(u.id,le("USER_DISCONNECTED"))}),n===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=ar.idle),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),q(this,"deleteProposal",async(r,i)=>{if(i)try{const n=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:n.pairingTopic});s?.setError(Ti.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,le("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),q(this,"deletePendingSessionRequest",async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=ar.idle,this.client.events.emit("session_request_expire",{id:r}))}),q(this,"deletePendingAuthRequest",async(r,i,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])}),q(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),q(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,et(tt.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),q(this,"setAuthRequest",async(r,i)=>{const{request:n,pairingTopic:s,transportType:o=be.relay}=i;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),q(this,"setPendingSessionRequest",async r=>{const{id:i,topic:n,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||et(tt.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:o})}),q(this,"sendRequest",async r=>{const{topic:i,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:f,tvf:d}=r,b=Pi(n,s,c);let v;const g=!!f;try{const $=g?Qn:ui;v=await this.client.core.crypto.encode(i,b,{encoding:$})}catch($){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),$}let E;if(Qp.includes(n)){const $=xr(JSON.stringify(b)),D=xr(v);E=await this.client.core.verify.register({id:D,decryptedId:$})}const I=tt[n].req;if(I.attestation=E,o&&(I.ttl=o),a&&(I.id=a),this.client.core.history.set(i,b),g){const $=$o(f,i,v);await global.Linking.openURL($,this.client.name)}else{const $=tt[n].req;o&&($.ttl=o),a&&($.id=a),$.tvf=Dt(ue({},d),{correlationId:b.id}),u?($.internal=Dt(ue({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,v,$)):this.client.core.relayer.publish(i,v,$).catch(D=>this.client.logger.error(D))}return b.id}),q(this,"sendResult",async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=Qc(i,s);let f;const d=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=d?Qn:ui;f=await this.client.core.crypto.encode(n,u,Dt(ue({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),g}let b,v;try{b=await this.client.core.history.get(n,i);const g=b.request;try{this.shouldSetTVF(g.method,g.params)&&(v=this.getTVFParams(i,g.params,s))}catch(E){this.client.logger.warn("sendResult() -> getTVFParams() failed",E)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),g}if(d){const g=$o(c,n,f);await global.Linking.openURL(g,this.client.name)}else{const g=b.request.method,E=tt[g].res;E.tvf=Dt(ue({},v),{correlationId:i}),o?(E.internal=Dt(ue({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,f,E)):this.client.core.relayer.publish(n,f,E).catch(I=>this.client.logger.error(I))}await this.client.core.history.resolve(u)}),q(this,"sendError",async r=>{const{id:i,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=eu(i,s);let f;const d=c&&typeof(global==null?void 0:global.Linking)<"u";try{const v=d?Qn:ui;f=await this.client.core.crypto.encode(n,u,Dt(ue({},o||{}),{encoding:v}))}catch(v){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),v}let b;try{b=await this.client.core.history.get(n,i)}catch(v){throw this.client.logger.error(`sendError() -> history.get(${n}, ${i}) failed`),v}if(d){const v=$o(c,n,f);await global.Linking.openURL(v,this.client.name)}else{const v=b.request.method,g=a||tt[v].res;this.client.core.relayer.publish(n,f,g)}await this.client.core.history.resolve(u)}),q(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;si(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{si(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])}),q(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),q(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),q(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ar.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ar.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=ar.idle}),q(this,"processRequest",async r=>{const{topic:i,payload:n,attestation:s,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,n);case"wc_sessionPing":return await this.onSessionPingRequest(i,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),q(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n,transportType:s}=r,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),q(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:n}=k("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),q(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:n}=r,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),q(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:n,attestation:s,encryptedId:o}=r,{params:a,id:c}=n;try{const u=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(jr.proposal_listener_not_found)),this.isValidConnect(ue({},n.params));const f=a.expiryTimestamp||et(tt.wc_sessionPropose.req.ttl),d=ue({id:c,pairingTopic:i,expiryTimestamp:f},a);await this.setProposal(c,d);const b=await this.getVerifyContext({attestationId:s,hash:xr(JSON.stringify(n)),encryptedId:o,metadata:d.proposer.metadata});u?.addTrace(Or.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:d,verifyContext:b})}catch(u){await this.sendError({id:c,topic:i,error:u,rpcOpts:tt.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),q(this,"onSessionProposeResponse",async(r,i,n)=>{const{id:s}=i;if(Ir(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const f=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:f,pairingTopic:r,proposalId:s,publicKey:c});const d=await this.client.core.relayer.subscribe(f,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:r})}else if(Gt(i)){await this.client.proposal.delete(s,le("USER_DISCONNECTED"));const o=se("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),q(this,"onSessionSettleRequest",async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:f,scopedProperties:d,sessionConfig:b}=i.params,v=[...this.pendingSessions.values()].find(I=>I.sessionTopic===r);if(!v)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(v.proposalId),E=Dt(ue(ue(ue({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:v.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:v.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},f&&{sessionProperties:f}),d&&{scopedProperties:d}),b&&{sessionConfig:b}),{transportType:be.relay});await this.client.session.set(E.topic,E),await this.setExpiry(E.topic,E.expiry),await this.client.core.pairing.updateMetadata({topic:v.pairingTopic,metadata:E.peer.metadata}),this.client.events.emit("session_connect",{session:E}),this.events.emit(se("session_connect",v.proposalId),{session:E}),this.pendingSessions.delete(v.proposalId),this.deleteProposal(v.proposalId,!1),this.cleanupDuplicatePairings(E),await this.sendResult({id:i.id,topic:r,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),q(this,"onSessionSettleResponse",async(r,i)=>{const{id:n}=i;Ir(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(se("session_approve",n),{})):Gt(i)&&(await this.client.session.delete(r,le("USER_DISCONNECTED")),this.events.emit(se("session_approve",n),{error:i.error}))}),q(this,"onSessionUpdateRequest",async(r,i)=>{const{params:n,id:s}=i;try{const o=`${r}_session_update`,a=os.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:le("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ue({topic:r},n));try{os.set(o,s),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw os.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),q(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),q(this,"onSessionUpdateResponse",(r,i)=>{const{id:n}=i,s=se("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Ir(i)?this.events.emit(se("session_update",n),{}):Gt(i)&&this.events.emit(se("session_update",n),{error:i.error})}),q(this,"onSessionExtendRequest",async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,et(Bi)),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),q(this,"onSessionExtendResponse",(r,i)=>{const{id:n}=i,s=se("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Ir(i)?this.events.emit(se("session_extend",n),{}):Gt(i)&&this.events.emit(se("session_extend",n),{error:i.error})}),q(this,"onSessionPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),q(this,"onSessionPingResponse",(r,i)=>{const{id:n}=i,s=se("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Ir(i)?this.events.emit(se("session_ping",n),{}):Gt(i)&&this.events.emit(se("session_ping",n),{error:i.error})},500)}),q(this,"onSessionDeleteRequest",async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),Promise.all([new Promise(s=>{this.client.core.relayer.once(ut.publish,async()=>{s(await this.deleteSession({topic:r,id:n}))})}),this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:le("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),q(this,"onSessionRequest",async r=>{var i,n,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:f}=r,{id:d,params:b}=a;try{await this.isValidRequest(ue({topic:o},b));const v=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:xr(JSON.stringify(Pi("wc_sessionRequest",b,d))),encryptedId:u,metadata:v.peer.metadata,transportType:f}),E={id:d,topic:o,params:b,verifyContext:g};await this.setPendingSessionRequest(E),f===be.link_mode&&(i=v.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((n=v.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(E):(this.addSessionRequestToSessionRequestQueue(E),this.processSessionRequestQueue())}catch(v){await this.sendError({id:d,topic:o,error:v}),this.client.logger.error(v)}}),q(this,"onSessionRequestResponse",(r,i)=>{const{id:n}=i,s=se("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Ir(i)?this.events.emit(se("session_request",n),{result:i.result}):Gt(i)&&this.events.emit(se("session_request",n),{error:i.error})}),q(this,"onSessionEventRequest",async(r,i)=>{const{id:n,params:s}=i;try{const o=`${r}_session_event_${s.event.name}`,a=os.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(ue({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),os.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),q(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:n}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Ir(i)?this.events.emit(se("session_request",n),{result:i.result}):Gt(i)&&this.events.emit(se("session_request",n),{error:i.error})}),q(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:f,expiryTimestamp:d}=s.params,b=await this.getVerifyContext({attestationId:o,hash:xr(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),v={requester:u,pairingTopic:n,id:s.id,authPayload:f,verifyContext:b,expiryTimestamp:d};await this.setAuthRequest(s.id,{request:v,pairingTopic:n,transportType:c}),c===be.link_mode&&(i=u.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:b})}catch(u){this.client.logger.error(u);const f=s.params.requester.publicKey,d=await this.client.core.crypto.generateKeyPair(),b=this.getAppLinkIfEnabled(s.params.requester.metadata,c),v={type:qr,receiverPublicKey:f,senderPublicKey:d};await this.sendError({id:s.id,topic:n,error:u,encodeOpts:v,rpcOpts:tt.wc_sessionAuthenticate.autoReject,appLink:b})}}),q(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),q(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ar.idle,this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay))}),q(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=se("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(se("session_request",s.request.id),{error:i})})}),q(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ar.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ar.active,this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),q(this,"emitSessionRequest",r=>{this.client.events.emit("session_request",r)}),q(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:Pi("wc_sessionPropose",Dt(ue({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id)})}),q(this,"isValidConnect",async r=>{if(!Ct(r)){const{message:u}=k("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(bt(i)||await this.isValidPairingTopic(i),!$7(c,!0)){const{message:u}=k("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!bt(n)&&Mo(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!bt(s)&&Mo(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),bt(o)||this.validateSessionProps(o,"sessionProperties"),!bt(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(f=>u.includes(f)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),q(this,"validateNamespaces",(r,i)=>{const n=D7(r,"connect()",i);if(n)throw new Error(n.message)}),q(this,"isValidApprove",async r=>{if(!Ct(r))throw new Error(k("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=Wc(n,"approve()");if(u)throw new Error(u.message);const f=G0(c.requiredNamespaces,n,"approve()");if(f)throw new Error(f.message);if(!$e(s,!0)){const{message:d}=k("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(d)}if(bt(o)||this.validateSessionProps(o,"sessionProperties"),!bt(a)){this.validateSessionProps(a,"scopedProperties");const d=new Set(Object.keys(n));if(!Object.keys(a).every(b=>d.has(b)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(d).join(", ")}`)}}),q(this,"isValidReject",async r=>{if(!Ct(r)){const{message:s}=k("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!P7(n)){const{message:s}=k("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),q(this,"isValidSessionSettleRequest",r=>{if(!Ct(r)){const{message:u}=k("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!H0(i)){const{message:u}=k("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=E7(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Wc(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(si(o)){const{message:u}=k("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),q(this,"isValidUpdate",async r=>{if(!Ct(r)){const{message:c}=k("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:n}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=Wc(n,"update()");if(o)throw new Error(o.message);const a=G0(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),q(this,"isValidExtend",async r=>{if(!Ct(r)){const{message:n}=k("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),q(this,"isValidRequest",async r=>{if(!Ct(r)){const{message:c}=k("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:n,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!W0(a,s)){const{message:c}=k("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!R7(n)){const{message:c}=k("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!C7(a,s,n.method)){const{message:c}=k("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(o&&!U7(o,Uo)){const{message:c}=k("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Uo.min} and ${Uo.max}`);throw new Error(c)}}),q(this,"isValidRespond",async r=>{var i;if(!Ct(r)){const{message:o}=k("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(o){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),o}if(!T7(s)){const{message:o}=k("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),q(this,"isValidPing",async r=>{if(!Ct(r)){const{message:n}=k("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),q(this,"isValidEmit",async r=>{if(!Ct(r)){const{message:a}=k("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!W0(o,s)){const{message:a}=k("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!N7(n)){const{message:a}=k("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!B7(o,s,n.name)){const{message:a}=k("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),q(this,"isValidDisconnect",async r=>{if(!Ct(r)){const{message:n}=k("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),q(this,"isValidAuthenticate",r=>{const{chains:i,uri:n,domain:s,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!$e(n,!1))throw new Error("uri is required parameter");if(!$e(s,!1))throw new Error("domain is required parameter");if(!$e(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>vo(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=vo(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),q(this,"getVerifyContext",async r=>{const{attestationId:i,hash:n,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||fs,validation:"UNKNOWN",origin:o.url||""}};try{if(a===be.link_mode){const f=this.getAppLinkIfEnabled(o,a);return c.verified.validation=f&&new URL(f).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:i,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),q(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((n,s)=>{if(n==null){const{message:o}=k("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),q(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),q(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),q(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:n}=k("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(n)}}),q(this,"isLinkModeEnabled",(r,i)=>{var n,s,o,a,c,u,f,d,b;return!r||i!==be.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((f=r?.redirect)==null?void 0:f.universal)!==void 0&&((d=r?.redirect)==null?void 0:d.universal)!==""&&((b=r?.redirect)==null?void 0:b.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),q(this,"getAppLinkIfEnabled",(r,i)=>{var n;return this.isLinkModeEnabled(r,i)?(n=r?.redirect)==null?void 0:n.universal:void 0}),q(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Vl(r,"topic")||"",n=decodeURIComponent(Vl(r,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:be.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:n,sessionExists:s})}),q(this,"registerLinkModeListeners",async()=>{var r;if(Ac()||ii()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await i.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),q(this,"shouldSetTVF",(r,i)=>{if(!i||r!=="wc_sessionRequest")return!1;const{request:n}=i;return Object.keys(Eu).includes(n.method)}),q(this,"getTVFParams",(r,i,n)=>{var s,o;try{const a=i.request.method,c=this.extractTxHashesFromResult(a,n);return Dt(ue({correlationId:r,rpcMethods:[a],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(o=(s=i.request.params)==null?void 0:s[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),q(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const n=r?.data||((i=r?.[0])==null?void 0:i.data);if(!n.startsWith("0x"))return!1;const s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),q(this,"extractTxHashesFromResult",(r,i)=>{try{const n=Eu[r];if(typeof i=="string")return[i];const s=i[n.key];if(ss(s))return r==="solana_signAllTransactions"?s.map(o=>F5(o)):s;if(typeof s=="string")return[s]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,n]of Object.entries(r))for(const s of n)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=k("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ut.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(vs)?this.client.auth.authKeys.get(vs):{responseTopic:void 0,publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:s===be.link_mode?Qn:ui});tu(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:s,encryptedId:xr(i)})):Ro(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Xt.expired,async e=>{const{topic:r,id:i}=jl(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,k("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,k("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ri.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ri.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!$e(e,!1)){const{message:r}=k("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=k("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(si(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=k("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!$e(e,!1)){const{message:r}=k("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=k("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(si(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=k("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=k("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if($e(e,!1)){const{message:r}=k("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=k("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!M7(e)){const{message:r}=k("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=k("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(si(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=k("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class RI extends Ci{constructor(e,r){super(e,r,Yp,Fo),this.core=e,this.logger=r}}class o1 extends Ci{constructor(e,r){super(e,r,Xp,Fo),this.core=e,this.logger=r}}class TI extends Ci{constructor(e,r){super(e,r,Zp,Fo,i=>i.id),this.core=e,this.logger=r}}class NI extends Ci{constructor(e,r){super(e,r,r1,ys,()=>vs),this.core=e,this.logger=r}}class CI extends Ci{constructor(e,r){super(e,r,i1,ys),this.core=e,this.logger=r}}class BI extends Ci{constructor(e,r){super(e,r,n1,ys,i=>i.id),this.core=e,this.logger=r}}var FI=Object.defineProperty,LI=(t,e,r)=>e in t?FI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Su=(t,e,r)=>LI(t,typeof e!="symbol"?e+"":e,r);class UI{constructor(e,r){this.core=e,this.logger=r,Su(this,"authKeys"),Su(this,"pairingTopics"),Su(this,"requests"),this.authKeys=new NI(this.core,this.logger),this.pairingTopics=new CI(this.core,this.logger),this.requests=new BI(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var qI=Object.defineProperty,zI=(t,e,r)=>e in t?qI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,te=(t,e,r)=>zI(t,typeof e!="symbol"?e+"":e,r);class qo extends Sg{constructor(e){super(e),te(this,"protocol",yu),te(this,"version",vu),te(this,"name",Lo.name),te(this,"metadata"),te(this,"core"),te(this,"logger"),te(this,"events",new $t.exports.EventEmitter),te(this,"engine"),te(this,"session"),te(this,"proposal"),te(this,"pendingRequest"),te(this,"auth"),te(this,"signConfig"),te(this,"on",(i,n)=>this.events.on(i,n)),te(this,"once",(i,n)=>this.events.once(i,n)),te(this,"off",(i,n)=>this.events.off(i,n)),te(this,"removeListener",(i,n)=>this.events.removeListener(i,n)),te(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),te(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"update",async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"request",async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"find",i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),te(this,"authenticate",async(i,n)=>{try{return await this.engine.authenticate(i,n)}catch(s){throw this.logger.error(s.message),s}}),te(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),te(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||Lo.name,this.metadata=e?.metadata||ql(),this.signConfig=e?.signConfig;const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:$r(na({level:e?.logger||Lo.logger}));this.core=e?.core||new vI(e),this.logger=St(r,this.name),this.session=new o1(this.core,this.logger),this.proposal=new RI(this.core,this.logger),this.pendingRequest=new TI(this.core,this.logger),this.engine=new PI(this),this.auth=new UI(this.core,this.logger)}static async init(e){const r=new qo(e);return await r.initialize(),r}get context(){return Pt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},z.toMiliseconds(z.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const kI=o1,jI=qo;X.AUTH_CONTEXT=t1,X.AUTH_KEYS_CONTEXT=r1,X.AUTH_PAIRING_TOPIC_CONTEXT=i1,X.AUTH_PROTOCOL=e1,X.AUTH_PUBLIC_KEY_NAME=vs,X.AUTH_REQUEST_CONTEXT=n1,X.AUTH_STORAGE_PREFIX=ys,X.AUTH_VERSION=II,X.ENGINE_CONTEXT=Jp,X.ENGINE_QUEUE_STATES=ar,X.ENGINE_RPC_OPTS=tt,X.HISTORY_CONTEXT=EI,X.HISTORY_EVENTS=_I,X.HISTORY_STORAGE_VERSION=xI,X.METHODS_TO_VERIFY=Qp,X.PROPOSAL_CONTEXT=Yp,X.PROPOSAL_EXPIRY=SI,X.PROPOSAL_EXPIRY_MESSAGE=_u,X.REQUEST_CONTEXT=Zp,X.SESSION_CONTEXT=Xp,X.SESSION_EXPIRY=Bi,X.SESSION_REQUEST_EXPIRY_BOUNDARIES=Uo,X.SIGN_CLIENT_CONTEXT=mu,X.SIGN_CLIENT_DEFAULT=Lo,X.SIGN_CLIENT_EVENTS=mI,X.SIGN_CLIENT_PROTOCOL=yu,X.SIGN_CLIENT_STORAGE_OPTIONS=wI,X.SIGN_CLIENT_STORAGE_PREFIX=Fo,X.SIGN_CLIENT_VERSION=vu,X.SessionStore=kI,X.SignClient=jI,X.TVF_METHODS=Eu,X.WALLETCONNECT_DEEPLINK_CHOICE=wu,X.default=qo,Object.defineProperty(X,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
