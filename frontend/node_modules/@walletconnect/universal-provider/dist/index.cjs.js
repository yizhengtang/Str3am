"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var vt=require("@walletconnect/sign-client"),d=require("@walletconnect/utils"),fe=require("@walletconnect/logger"),me=require("@walletconnect/jsonrpc-http-connection"),g=require("@walletconnect/jsonrpc-provider"),ge=require("@walletconnect/jsonrpc-utils"),ft=require("events");function ee(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var mt=ee(vt),$=ee(me),gt=ee(ft);const Pe="error",Pt="wss://relay.walletconnect.org",bt="wc",$t="universal_provider",be=`${bt}@2:${$t}:`,$e="https://rpc.walletconnect.org/v1/",_="generic",yt=`${$e}bundler`,m={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wt(){this.__data__=[],this.size=0}var _t=wt;function Ct(r,e){return r===e||r!==r&&e!==e}var z=Ct,It=z;function Ot(r,e){for(var t=r.length;t--;)if(It(r[t][0],e))return t;return-1}var k=Ot,At=k,jt=Array.prototype,Ht=jt.splice;function Et(r){var e=this.__data__,t=At(e,r);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():Ht.call(e,t,1),--this.size,!0}var St=Et,Nt=k;function Tt(r){var e=this.__data__,t=Nt(e,r);return t<0?void 0:e[t][1]}var Dt=Tt,qt=k;function Rt(r){return qt(this.__data__,r)>-1}var Ut=Rt,Lt=k;function xt(r,e){var t=this.__data__,i=Lt(t,r);return i<0?(++this.size,t.push([r,e])):t[i][1]=e,this}var Mt=xt,Ft=_t,Gt=St,zt=Dt,kt=Ut,Jt=Mt;function C(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}C.prototype.clear=Ft,C.prototype.delete=Gt,C.prototype.get=zt,C.prototype.has=kt,C.prototype.set=Jt;var J=C,Bt=J;function Vt(){this.__data__=new Bt,this.size=0}var Kt=Vt;function Wt(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var Xt=Wt;function Yt(r){return this.__data__.get(r)}var Zt=Yt;function Qt(r){return this.__data__.has(r)}var er=Qt,tr=typeof G=="object"&&G&&G.Object===Object&&G,ye=tr,rr=ye,ir=typeof self=="object"&&self&&self.Object===Object&&self,sr=rr||ir||Function("return this")(),I=sr,ar=I,nr=ar.Symbol,we=nr,_e=we,Ce=Object.prototype,or=Ce.hasOwnProperty,cr=Ce.toString,M=_e?_e.toStringTag:void 0;function hr(r){var e=or.call(r,M),t=r[M];try{r[M]=void 0;var i=!0}catch{}var s=cr.call(r);return i&&(e?r[M]=t:delete r[M]),s}var pr=hr,ur=Object.prototype,lr=ur.toString;function dr(r){return lr.call(r)}var vr=dr,Ie=we,fr=pr,mr=vr,gr="[object Null]",Pr="[object Undefined]",Oe=Ie?Ie.toStringTag:void 0;function br(r){return r==null?r===void 0?Pr:gr:Oe&&Oe in Object(r)?fr(r):mr(r)}var B=br;function $r(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var y=$r,yr=B,wr=y,_r="[object AsyncFunction]",Cr="[object Function]",Ir="[object GeneratorFunction]",Or="[object Proxy]";function Ar(r){if(!wr(r))return!1;var e=yr(r);return e==Cr||e==Ir||e==_r||e==Or}var te=Ar,jr=I,Hr=jr["__core-js_shared__"],Er=Hr,re=Er,Ae=function(){var r=/[^.]+$/.exec(re&&re.keys&&re.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Sr(r){return!!Ae&&Ae in r}var Nr=Sr,Tr=Function.prototype,Dr=Tr.toString;function qr(r){if(r!=null){try{return Dr.call(r)}catch{}try{return r+""}catch{}}return""}var Rr=qr,Ur=te,Lr=Nr,xr=y,Mr=Rr,Fr=/[\\^$.*+?()[\]{}|]/g,Gr=/^\[object .+?Constructor\]$/,zr=Function.prototype,kr=Object.prototype,Jr=zr.toString,Br=kr.hasOwnProperty,Vr=RegExp("^"+Jr.call(Br).replace(Fr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Kr(r){if(!xr(r)||Lr(r))return!1;var e=Ur(r)?Vr:Gr;return e.test(Mr(r))}var Wr=Kr;function Xr(r,e){return r?.[e]}var Yr=Xr,Zr=Wr,Qr=Yr;function ei(r,e){var t=Qr(r,e);return Zr(t)?t:void 0}var ie=ei,ti=ie,ri=I,ii=ti(ri,"Map"),je=ii,si=ie,ai=si(Object,"create"),V=ai,He=V;function ni(){this.__data__=He?He(null):{},this.size=0}var oi=ni;function ci(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var hi=ci,pi=V,ui="__lodash_hash_undefined__",li=Object.prototype,di=li.hasOwnProperty;function vi(r){var e=this.__data__;if(pi){var t=e[r];return t===ui?void 0:t}return di.call(e,r)?e[r]:void 0}var fi=vi,mi=V,gi=Object.prototype,Pi=gi.hasOwnProperty;function bi(r){var e=this.__data__;return mi?e[r]!==void 0:Pi.call(e,r)}var $i=bi,yi=V,wi="__lodash_hash_undefined__";function _i(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=yi&&e===void 0?wi:e,this}var Ci=_i,Ii=oi,Oi=hi,Ai=fi,ji=$i,Hi=Ci;function O(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}O.prototype.clear=Ii,O.prototype.delete=Oi,O.prototype.get=Ai,O.prototype.has=ji,O.prototype.set=Hi;var Ei=O,Ee=Ei,Si=J,Ni=je;function Ti(){this.size=0,this.__data__={hash:new Ee,map:new(Ni||Si),string:new Ee}}var Di=Ti;function qi(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Ri=qi,Ui=Ri;function Li(r,e){var t=r.__data__;return Ui(e)?t[typeof e=="string"?"string":"hash"]:t.map}var K=Li,xi=K;function Mi(r){var e=xi(this,r).delete(r);return this.size-=e?1:0,e}var Fi=Mi,Gi=K;function zi(r){return Gi(this,r).get(r)}var ki=zi,Ji=K;function Bi(r){return Ji(this,r).has(r)}var Vi=Bi,Ki=K;function Wi(r,e){var t=Ki(this,r),i=t.size;return t.set(r,e),this.size+=t.size==i?0:1,this}var Xi=Wi,Yi=Di,Zi=Fi,Qi=ki,es=Vi,ts=Xi;function A(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}A.prototype.clear=Yi,A.prototype.delete=Zi,A.prototype.get=Qi,A.prototype.has=es,A.prototype.set=ts;var rs=A,is=J,ss=je,as=rs,ns=200;function os(r,e){var t=this.__data__;if(t instanceof is){var i=t.__data__;if(!ss||i.length<ns-1)return i.push([r,e]),this.size=++t.size,this;t=this.__data__=new as(i)}return t.set(r,e),this.size=t.size,this}var cs=os,hs=J,ps=Kt,us=Xt,ls=Zt,ds=er,vs=cs;function j(r){var e=this.__data__=new hs(r);this.size=e.size}j.prototype.clear=ps,j.prototype.delete=us,j.prototype.get=ls,j.prototype.has=ds,j.prototype.set=vs;var fs=j,ms=ie,gs=function(){try{var r=ms(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Se=gs,Ne=Se;function Ps(r,e,t){e=="__proto__"&&Ne?Ne(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var se=Ps,bs=se,$s=z;function ys(r,e,t){(t!==void 0&&!$s(r[e],t)||t===void 0&&!(e in r))&&bs(r,e,t)}var Te=ys;function ws(r){return function(e,t,i){for(var s=-1,a=Object(e),n=i(e),o=n.length;o--;){var c=n[r?o:++s];if(t(a[c],c,a)===!1)break}return e}}var _s=ws,Cs=_s,Is=Cs(),Os=Is,ae={exports:{}};(function(r,e){var t=I,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,a=s&&s.exports===i,n=a?t.Buffer:void 0,o=n?n.allocUnsafe:void 0;function c(u,l){if(l)return u.slice();var b=u.length,v=o?o(b):new u.constructor(b);return u.copy(v),v}r.exports=c})(ae,ae.exports);var As=I,js=As.Uint8Array,Hs=js,De=Hs;function Es(r){var e=new r.constructor(r.byteLength);return new De(e).set(new De(r)),e}var Ss=Es,Ns=Ss;function Ts(r,e){var t=e?Ns(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var Ds=Ts;function qs(r,e){var t=-1,i=r.length;for(e||(e=Array(i));++t<i;)e[t]=r[t];return e}var Rs=qs,Us=y,qe=Object.create,Ls=function(){function r(){}return function(e){if(!Us(e))return{};if(qe)return qe(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),xs=Ls;function Ms(r,e){return function(t){return r(e(t))}}var Fs=Ms,Gs=Fs,zs=Gs(Object.getPrototypeOf,Object),Re=zs,ks=Object.prototype;function Js(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||ks;return r===t}var Ue=Js,Bs=xs,Vs=Re,Ks=Ue;function Ws(r){return typeof r.constructor=="function"&&!Ks(r)?Bs(Vs(r)):{}}var Xs=Ws;function Ys(r){return r!=null&&typeof r=="object"}var F=Ys,Zs=B,Qs=F,ea="[object Arguments]";function ta(r){return Qs(r)&&Zs(r)==ea}var ra=ta,Le=ra,ia=F,xe=Object.prototype,sa=xe.hasOwnProperty,aa=xe.propertyIsEnumerable,na=Le(function(){return arguments}())?Le:function(r){return ia(r)&&sa.call(r,"callee")&&!aa.call(r,"callee")},Me=na,oa=Array.isArray,Fe=oa,ca=9007199254740991;function ha(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=ca}var Ge=ha,pa=te,ua=Ge;function la(r){return r!=null&&ua(r.length)&&!pa(r)}var ne=la,da=ne,va=F;function fa(r){return va(r)&&da(r)}var ma=fa,W={exports:{}};function ga(){return!1}var Pa=ga;(function(r,e){var t=I,i=Pa,s=e&&!e.nodeType&&e,a=s&&!0&&r&&!r.nodeType&&r,n=a&&a.exports===s,o=n?t.Buffer:void 0,c=o?o.isBuffer:void 0,u=c||i;r.exports=u})(W,W.exports);var ba=B,$a=Re,ya=F,wa="[object Object]",_a=Function.prototype,Ca=Object.prototype,ze=_a.toString,Ia=Ca.hasOwnProperty,Oa=ze.call(Object);function Aa(r){if(!ya(r)||ba(r)!=wa)return!1;var e=$a(r);if(e===null)return!0;var t=Ia.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&ze.call(t)==Oa}var ja=Aa,Ha=B,Ea=Ge,Sa=F,Na="[object Arguments]",Ta="[object Array]",Da="[object Boolean]",qa="[object Date]",Ra="[object Error]",Ua="[object Function]",La="[object Map]",xa="[object Number]",Ma="[object Object]",Fa="[object RegExp]",Ga="[object Set]",za="[object String]",ka="[object WeakMap]",Ja="[object ArrayBuffer]",Ba="[object DataView]",Va="[object Float32Array]",Ka="[object Float64Array]",Wa="[object Int8Array]",Xa="[object Int16Array]",Ya="[object Int32Array]",Za="[object Uint8Array]",Qa="[object Uint8ClampedArray]",en="[object Uint16Array]",tn="[object Uint32Array]",p={};p[Va]=p[Ka]=p[Wa]=p[Xa]=p[Ya]=p[Za]=p[Qa]=p[en]=p[tn]=!0,p[Na]=p[Ta]=p[Ja]=p[Da]=p[Ba]=p[qa]=p[Ra]=p[Ua]=p[La]=p[xa]=p[Ma]=p[Fa]=p[Ga]=p[za]=p[ka]=!1;function rn(r){return Sa(r)&&Ea(r.length)&&!!p[Ha(r)]}var sn=rn;function an(r){return function(e){return r(e)}}var nn=an,oe={exports:{}};(function(r,e){var t=ye,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,a=s&&s.exports===i,n=a&&t.process,o=function(){try{var c=s&&s.require&&s.require("util").types;return c||n&&n.binding&&n.binding("util")}catch{}}();r.exports=o})(oe,oe.exports);var on=sn,cn=nn,ke=oe.exports,Je=ke&&ke.isTypedArray,hn=Je?cn(Je):on,Be=hn;function pn(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var Ve=pn,un=se,ln=z,dn=Object.prototype,vn=dn.hasOwnProperty;function fn(r,e,t){var i=r[e];(!(vn.call(r,e)&&ln(i,t))||t===void 0&&!(e in r))&&un(r,e,t)}var mn=fn,gn=mn,Pn=se;function bn(r,e,t,i){var s=!t;t||(t={});for(var a=-1,n=e.length;++a<n;){var o=e[a],c=i?i(t[o],r[o],o,t,r):void 0;c===void 0&&(c=r[o]),s?Pn(t,o,c):gn(t,o,c)}return t}var $n=bn;function yn(r,e){for(var t=-1,i=Array(r);++t<r;)i[t]=e(t);return i}var wn=yn,_n=9007199254740991,Cn=/^(?:0|[1-9]\d*)$/;function In(r,e){var t=typeof r;return e=e??_n,!!e&&(t=="number"||t!="symbol"&&Cn.test(r))&&r>-1&&r%1==0&&r<e}var Ke=In,On=wn,An=Me,jn=Fe,Hn=W.exports,En=Ke,Sn=Be,Nn=Object.prototype,Tn=Nn.hasOwnProperty;function Dn(r,e){var t=jn(r),i=!t&&An(r),s=!t&&!i&&Hn(r),a=!t&&!i&&!s&&Sn(r),n=t||i||s||a,o=n?On(r.length,String):[],c=o.length;for(var u in r)(e||Tn.call(r,u))&&!(n&&(u=="length"||s&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||En(u,c)))&&o.push(u);return o}var qn=Dn;function Rn(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var Un=Rn,Ln=y,xn=Ue,Mn=Un,Fn=Object.prototype,Gn=Fn.hasOwnProperty;function zn(r){if(!Ln(r))return Mn(r);var e=xn(r),t=[];for(var i in r)i=="constructor"&&(e||!Gn.call(r,i))||t.push(i);return t}var kn=zn,Jn=qn,Bn=kn,Vn=ne;function Kn(r){return Vn(r)?Jn(r,!0):Bn(r)}var We=Kn,Wn=$n,Xn=We;function Yn(r){return Wn(r,Xn(r))}var Zn=Yn,Xe=Te,Qn=ae.exports,eo=Ds,to=Rs,ro=Xs,Ye=Me,Ze=Fe,io=ma,so=W.exports,ao=te,no=y,oo=ja,co=Be,Qe=Ve,ho=Zn;function po(r,e,t,i,s,a,n){var o=Qe(r,t),c=Qe(e,t),u=n.get(c);if(u){Xe(r,t,u);return}var l=a?a(o,c,t+"",r,e,n):void 0,b=l===void 0;if(b){var v=Ze(c),Q=!v&&so(c),ve=!v&&!Q&&co(c);l=c,v||Q||ve?Ze(o)?l=o:io(o)?l=to(o):Q?(b=!1,l=Qn(c,!0)):ve?(b=!1,l=eo(c,!0)):l=[]:oo(c)||Ye(c)?(l=o,Ye(o)?l=ho(o):(!no(o)||ao(o))&&(l=ro(c))):b=!1}b&&(n.set(c,l),s(l,c,i,a,n),n.delete(c)),Xe(r,t,l)}var uo=po,lo=fs,vo=Te,fo=Os,mo=uo,go=y,Po=We,bo=Ve;function et(r,e,t,i,s){r!==e&&fo(e,function(a,n){if(s||(s=new lo),go(a))mo(r,e,n,t,et,i,s);else{var o=i?i(bo(r,n),a,n+"",r,e,s):void 0;o===void 0&&(o=a),vo(r,n,o)}},Po)}var $o=et;function yo(r){return r}var tt=yo;function wo(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var _o=wo,Co=_o,rt=Math.max;function Io(r,e,t){return e=rt(e===void 0?r.length-1:e,0),function(){for(var i=arguments,s=-1,a=rt(i.length-e,0),n=Array(a);++s<a;)n[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=t(n),Co(r,this,o)}}var Oo=Io;function Ao(r){return function(){return r}}var jo=Ao,Ho=jo,it=Se,Eo=tt,So=it?function(r,e){return it(r,"toString",{configurable:!0,enumerable:!1,value:Ho(e),writable:!0})}:Eo,No=So,To=800,Do=16,qo=Date.now;function Ro(r){var e=0,t=0;return function(){var i=qo(),s=Do-(i-t);if(t=i,s>0){if(++e>=To)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var Uo=Ro,Lo=No,xo=Uo,Mo=xo(Lo),Fo=Mo,Go=tt,zo=Oo,ko=Fo;function Jo(r,e){return ko(zo(r,e,Go),r+"")}var Bo=Jo,Vo=z,Ko=ne,Wo=Ke,Xo=y;function Yo(r,e,t){if(!Xo(t))return!1;var i=typeof e;return(i=="number"?Ko(t)&&Wo(e,t.length):i=="string"&&e in t)?Vo(t[e],r):!1}var Zo=Yo,Qo=Bo,ec=Zo;function tc(r){return Qo(function(e,t){var i=-1,s=t.length,a=s>1?t[s-1]:void 0,n=s>2?t[2]:void 0;for(a=r.length>3&&typeof a=="function"?(s--,a):void 0,n&&ec(t[0],t[1],n)&&(a=s<3?void 0:a,s=1),e=Object(e);++i<s;){var o=t[i];o&&r(e,o,i,a)}return e})}var rc=tc,ic=$o,sc=rc,ac=sc(function(r,e,t){ic(r,e,t)}),nc=ac,oc=Object.defineProperty,cc=Object.defineProperties,hc=Object.getOwnPropertyDescriptors,st=Object.getOwnPropertySymbols,pc=Object.prototype.hasOwnProperty,uc=Object.prototype.propertyIsEnumerable,at=(r,e,t)=>e in r?oc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,X=(r,e)=>{for(var t in e||(e={}))pc.call(e,t)&&at(r,t,e[t]);if(st)for(var t of st(e))uc.call(e,t)&&at(r,t,e[t]);return r},lc=(r,e)=>cc(r,hc(e));function f(r,e,t){var i;const s=d.parseChainId(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${$e}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function w(r){return r.includes(":")?r.split(":")[1]:r}function nt(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function dc(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const a=e.namespaces[s].accounts;i.push(...a)}),i}function ce(r={},e={}){const t=ot(r),i=ot(e);return nc(t,i)}function ot(r){var e,t,i,s;const a={};if(!d.isValidObject(r))return a;for(const[n,o]of Object.entries(r)){const c=d.isCaipNamespace(n)?[n]:o.chains,u=o.methods||[],l=o.events||[],b=o.rpcMap||{},v=d.parseNamespaceKey(n);a[v]=lc(X(X({},a[v]),o),{chains:d.mergeArrays(c,(e=a[v])==null?void 0:e.chains),methods:d.mergeArrays(u,(t=a[v])==null?void 0:t.methods),events:d.mergeArrays(l,(i=a[v])==null?void 0:i.events),rpcMap:X(X({},b),(s=a[v])==null?void 0:s.rpcMap)})}return a}function vc(r){return r.includes(":")?r.split(":")[2]:r}function ct(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],a=i.events||[],n=i.accounts||[],o=d.isCaipNamespace(t)?[t]:i.chains?i.chains:nt(i.accounts);e[t]={chains:o,methods:s,events:a,accounts:n}}return e}function he(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const ht={},h=r=>ht[r],pe=(r,e)=>{ht[r]=e};var fc=Object.defineProperty,mc=(r,e,t)=>e in r?fc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,H=(r,e,t)=>mc(r,typeof e!="symbol"?e+"":e,t);class gc{constructor(e){H(this,"name","polkadot"),H(this,"client"),H(this,"httpProviders"),H(this,"events"),H(this,"namespace"),H(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=w(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Pc=Object.defineProperty,bc=Object.defineProperties,$c=Object.getOwnPropertyDescriptors,pt=Object.getOwnPropertySymbols,yc=Object.prototype.hasOwnProperty,wc=Object.prototype.propertyIsEnumerable,ue=(r,e,t)=>e in r?Pc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ut=(r,e)=>{for(var t in e||(e={}))yc.call(e,t)&&ue(r,t,e[t]);if(pt)for(var t of pt(e))wc.call(e,t)&&ue(r,t,e[t]);return r},lt=(r,e)=>bc(r,$c(e)),E=(r,e,t)=>ue(r,typeof e!="symbol"?e+"":e,t);class _c{constructor(e){E(this,"name","eip155"),E(this,"client"),E(this,"chainId"),E(this,"namespace"),E(this,"httpProviders"),E(this,"events"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||f(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new me.HttpConnection(i,h("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(w(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const a=parseInt(s,16);if(this.isChainApproved(a))this.setDefaultChain(`${a}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${a}`);else throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s;const a=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const n=this.client.session.get(e.topic),o=((s=n?.sessionProperties)==null?void 0:s.capabilities)||{};if(o!=null&&o[a])return o?.[a];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:lt(ut({},n.sessionProperties||{}),{capabilities:lt(ut({},o||{}),{[a]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),a=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(a){const o=this.getBundlerUrl(e.chainId,a);try{return await this.getUserOperationReceipt(o,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,o)}}const n=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(n)try{return await this.getUserOperationReceipt(n,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,n)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ge.formatJsonRpcRequest("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!a.ok)throw new Error(`Failed to fetch user operation receipt - ${a.status}`);return await a.json()}getBundlerUrl(e,t){return`${yt}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var Cc=Object.defineProperty,Ic=(r,e,t)=>e in r?Cc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e,t)=>Ic(r,typeof e!="symbol"?e+"":e,t);class Oc{constructor(e){S(this,"name","solana"),S(this,"client"),S(this,"httpProviders"),S(this,"events"),S(this,"namespace"),S(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=w(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Ac=Object.defineProperty,jc=(r,e,t)=>e in r?Ac(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,N=(r,e,t)=>jc(r,typeof e!="symbol"?e+"":e,t);class Hc{constructor(e){N(this,"name","cosmos"),N(this,"client"),N(this,"httpProviders"),N(this,"events"),N(this,"namespace"),N(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=w(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Ec=Object.defineProperty,Sc=(r,e,t)=>e in r?Ec(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,T=(r,e,t)=>Sc(r,typeof e!="symbol"?e+"":e,t);class Nc{constructor(e){T(this,"name","algorand"),T(this,"client"),T(this,"httpProviders"),T(this,"events"),T(this,"namespace"),T(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||f(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Tc=Object.defineProperty,Dc=(r,e,t)=>e in r?Tc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,D=(r,e,t)=>Dc(r,typeof e!="symbol"?e+"":e,t);class qc{constructor(e){D(this,"name","cip34"),D(this,"client"),D(this,"httpProviders"),D(this,"events"),D(this,"namespace"),D(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=w(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Rc=Object.defineProperty,Uc=(r,e,t)=>e in r?Rc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,q=(r,e,t)=>Uc(r,typeof e!="symbol"?e+"":e,t);class Lc{constructor(e){q(this,"name","elrond"),q(this,"client"),q(this,"httpProviders"),q(this,"events"),q(this,"namespace"),q(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=w(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var xc=Object.defineProperty,Mc=(r,e,t)=>e in r?xc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,R=(r,e,t)=>Mc(r,typeof e!="symbol"?e+"":e,t);class Fc{constructor(e){R(this,"name","multiversx"),R(this,"client"),R(this,"httpProviders"),R(this,"events"),R(this,"namespace"),R(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=w(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Gc=Object.defineProperty,zc=(r,e,t)=>e in r?Gc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,U=(r,e,t)=>zc(r,typeof e!="symbol"?e+"":e,t);class kc{constructor(e){U(this,"name","near"),U(this,"client"),U(this,"httpProviders"),U(this,"events"),U(this,"namespace"),U(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||f(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace);return typeof i>"u"?void 0:new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Jc=Object.defineProperty,Bc=(r,e,t)=>e in r?Jc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,L=(r,e,t)=>Bc(r,typeof e!="symbol"?e+"":e,t);class Vc{constructor(e){L(this,"name","tezos"),L(this,"client"),L(this,"httpProviders"),L(this,"events"),L(this,"namespace"),L(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||f(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace);return typeof i>"u"?void 0:new g.JsonRpcProvider(new $.default(i))}}var Kc=Object.defineProperty,Wc=(r,e,t)=>e in r?Kc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,x=(r,e,t)=>Wc(r,typeof e!="symbol"?e+"":e,t);class Xc{constructor(e){x(this,"name",_),x(this,"client"),x(this,"httpProviders"),x(this,"events"),x(this,"namespace"),x(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const a=d.parseChainId(s);i[`${a.namespace}:${a.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||f(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(i,h("disableProviderPing")))}}var Yc=Object.defineProperty,Zc=Object.defineProperties,Qc=Object.getOwnPropertyDescriptors,dt=Object.getOwnPropertySymbols,eh=Object.prototype.hasOwnProperty,th=Object.prototype.propertyIsEnumerable,le=(r,e,t)=>e in r?Yc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Y=(r,e)=>{for(var t in e||(e={}))eh.call(e,t)&&le(r,t,e[t]);if(dt)for(var t of dt(e))th.call(e,t)&&le(r,t,e[t]);return r},de=(r,e)=>Zc(r,Qc(e)),P=(r,e,t)=>le(r,typeof e!="symbol"?e+"":e,t);class Z{constructor(e){P(this,"client"),P(this,"namespaces"),P(this,"optionalNamespaces"),P(this,"sessionProperties"),P(this,"events",new gt.default),P(this,"rpcProviders",{}),P(this,"session"),P(this,"providerOpts"),P(this,"logger"),P(this,"uri"),P(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:fe.pino(fe.getDefaultLoggerOptions({level:e?.logger||Pe})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new Z(e);return await t.initialize(),t}async request(e,t,i){const[s,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Y({},e),chainId:`${s}:${a}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const a=new Date().getTime();this.request(e,i,s).then(n=>t(null,ge.formatJsonRpcResult(a,n))).catch(n=>t(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:d.getSdkError("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const a=await s();if(this.session=a.session,this.session){const n=ct(this.session.namespaces);this.namespaces=ce(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const a=ct(s.namespaces);return this.namespaces=ce(this.namespaces,a),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),a=this.getProvider(i);a.name===_?a.setDefaultChain(`${i}:${s}`,t):a.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(d.isValidArray(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await mt.default.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Pe,relayUrl:this.providerOpts.relayUrl||Pt,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>d.parseNamespaceKey(t)))];pe("client",this.client),pe("events",this.events),pe("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=dc(t,this.session),s=nt(i),a=ce(this.namespaces,this.optionalNamespaces),n=de(Y({},a[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new _c({namespace:n});break;case"algorand":this.rpcProviders[t]=new Nc({namespace:n});break;case"solana":this.rpcProviders[t]=new Oc({namespace:n});break;case"cosmos":this.rpcProviders[t]=new Hc({namespace:n});break;case"polkadot":this.rpcProviders[t]=new gc({namespace:n});break;case"cip34":this.rpcProviders[t]=new qc({namespace:n});break;case"elrond":this.rpcProviders[t]=new Lc({namespace:n});break;case"multiversx":this.rpcProviders[t]=new Fc({namespace:n});break;case"near":this.rpcProviders[t]=new kc({namespace:n});break;case"tezos":this.rpcProviders[t]=new Vc({namespace:n});break;default:this.rpcProviders[_]?this.rpcProviders[_].updateNamespace(n):this.rpcProviders[_]=new Xc({namespace:n})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;if(i.name==="accountsChanged"){const s=i.data;s&&d.isValidArray(s)&&this.events.emit("accountsChanged",s.map(vc))}else if(i.name==="chainChanged"){const s=t.chainId,a=t.event.data,n=d.parseNamespaceKey(s),o=he(s)!==he(a)?`${n}:${he(a)}`:s;this.onChainChanged(o)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,a=(i=this.client)==null?void 0:i.session.get(e);this.session=de(Y({},a),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",de(Y({},d.getSdkError("USER_DISCONNECTED")),{data:e.topic}))}),this.on(m.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[_]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(n=>d.parseNamespaceKey(n)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=d.parseNamespaceKey(Object.keys(this.namespaces)[0]),a=this.rpcProviders[s].getDefaultChain();return[s,a]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces[`${i}:${s}`]?this.namespaces[`${i}:${s}`].defaultChain=s:this.namespaces[`${i}:${s}`]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${be}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${be}/${e}`)}}const rh=Z;exports.UniversalProvider=rh,exports.default=Z;
//# sourceMappingURL=index.cjs.js.map
