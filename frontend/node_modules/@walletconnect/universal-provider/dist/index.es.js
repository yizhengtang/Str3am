import ft from"@walletconnect/sign-client";import{isValidObject as mt,isCaipNamespace as fe,parseNamespaceKey as U,mergeArrays as ee,parseChainId as me,getSdkError as ge,isValidArray as Pe}from"@walletconnect/utils";import{pino as gt,getDefaultLoggerOptions as Pt}from"@walletconnect/logger";import b,{HttpConnection as bt}from"@walletconnect/jsonrpc-http-connection";import{JsonRpcProvider as m}from"@walletconnect/jsonrpc-provider";import{formatJsonRpcRequest as $t,formatJsonRpcResult as yt}from"@walletconnect/jsonrpc-utils";import wt from"events";const be="error",_t="wss://relay.walletconnect.org",Ct="wc",It="universal_provider",$e=`${Ct}@2:${It}:`,ye="https://rpc.walletconnect.org/v1/",w="generic",Ot=`${ye}bundler`,f={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function At(){this.__data__=[],this.size=0}var jt=At;function Ht(r,e){return r===e||r!==r&&e!==e}var z=Ht,Et=z;function St(r,e){for(var t=r.length;t--;)if(Et(r[t][0],e))return t;return-1}var k=St,Nt=k,Tt=Array.prototype,Dt=Tt.splice;function qt(r){var e=this.__data__,t=Nt(e,r);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():Dt.call(e,t,1),--this.size,!0}var Rt=qt,xt=k;function Lt(r){var e=this.__data__,t=xt(e,r);return t<0?void 0:e[t][1]}var Ut=Lt,Ft=k;function Mt(r){return Ft(this.__data__,r)>-1}var Gt=Mt,zt=k;function kt(r,e){var t=this.__data__,i=zt(t,r);return i<0?(++this.size,t.push([r,e])):t[i][1]=e,this}var Bt=kt,Vt=jt,Jt=Rt,Kt=Ut,Wt=Gt,Xt=Bt;function _(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}_.prototype.clear=Vt,_.prototype.delete=Jt,_.prototype.get=Kt,_.prototype.has=Wt,_.prototype.set=Xt;var B=_,Yt=B;function Zt(){this.__data__=new Yt,this.size=0}var Qt=Zt;function er(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var tr=er;function rr(r){return this.__data__.get(r)}var ir=rr;function sr(r){return this.__data__.has(r)}var nr=sr,ar=typeof G=="object"&&G&&G.Object===Object&&G,we=ar,or=we,cr=typeof self=="object"&&self&&self.Object===Object&&self,hr=or||cr||Function("return this")(),C=hr,pr=C,ur=pr.Symbol,_e=ur,Ce=_e,Ie=Object.prototype,lr=Ie.hasOwnProperty,dr=Ie.toString,F=Ce?Ce.toStringTag:void 0;function vr(r){var e=lr.call(r,F),t=r[F];try{r[F]=void 0;var i=!0}catch{}var s=dr.call(r);return i&&(e?r[F]=t:delete r[F]),s}var fr=vr,mr=Object.prototype,gr=mr.toString;function Pr(r){return gr.call(r)}var br=Pr,Oe=_e,$r=fr,yr=br,wr="[object Null]",_r="[object Undefined]",Ae=Oe?Oe.toStringTag:void 0;function Cr(r){return r==null?r===void 0?_r:wr:Ae&&Ae in Object(r)?$r(r):yr(r)}var V=Cr;function Ir(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var $=Ir,Or=V,Ar=$,jr="[object AsyncFunction]",Hr="[object Function]",Er="[object GeneratorFunction]",Sr="[object Proxy]";function Nr(r){if(!Ar(r))return!1;var e=Or(r);return e==Hr||e==Er||e==jr||e==Sr}var te=Nr,Tr=C,Dr=Tr["__core-js_shared__"],qr=Dr,re=qr,je=function(){var r=/[^.]+$/.exec(re&&re.keys&&re.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Rr(r){return!!je&&je in r}var xr=Rr,Lr=Function.prototype,Ur=Lr.toString;function Fr(r){if(r!=null){try{return Ur.call(r)}catch{}try{return r+""}catch{}}return""}var Mr=Fr,Gr=te,zr=xr,kr=$,Br=Mr,Vr=/[\\^$.*+?()[\]{}|]/g,Jr=/^\[object .+?Constructor\]$/,Kr=Function.prototype,Wr=Object.prototype,Xr=Kr.toString,Yr=Wr.hasOwnProperty,Zr=RegExp("^"+Xr.call(Yr).replace(Vr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Qr(r){if(!kr(r)||zr(r))return!1;var e=Gr(r)?Zr:Jr;return e.test(Br(r))}var ei=Qr;function ti(r,e){return r?.[e]}var ri=ti,ii=ei,si=ri;function ni(r,e){var t=si(r,e);return ii(t)?t:void 0}var ie=ni,ai=ie,oi=C,ci=ai(oi,"Map"),He=ci,hi=ie,pi=hi(Object,"create"),J=pi,Ee=J;function ui(){this.__data__=Ee?Ee(null):{},this.size=0}var li=ui;function di(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var vi=di,fi=J,mi="__lodash_hash_undefined__",gi=Object.prototype,Pi=gi.hasOwnProperty;function bi(r){var e=this.__data__;if(fi){var t=e[r];return t===mi?void 0:t}return Pi.call(e,r)?e[r]:void 0}var $i=bi,yi=J,wi=Object.prototype,_i=wi.hasOwnProperty;function Ci(r){var e=this.__data__;return yi?e[r]!==void 0:_i.call(e,r)}var Ii=Ci,Oi=J,Ai="__lodash_hash_undefined__";function ji(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Oi&&e===void 0?Ai:e,this}var Hi=ji,Ei=li,Si=vi,Ni=$i,Ti=Ii,Di=Hi;function I(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}I.prototype.clear=Ei,I.prototype.delete=Si,I.prototype.get=Ni,I.prototype.has=Ti,I.prototype.set=Di;var qi=I,Se=qi,Ri=B,xi=He;function Li(){this.size=0,this.__data__={hash:new Se,map:new(xi||Ri),string:new Se}}var Ui=Li;function Fi(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Mi=Fi,Gi=Mi;function zi(r,e){var t=r.__data__;return Gi(e)?t[typeof e=="string"?"string":"hash"]:t.map}var K=zi,ki=K;function Bi(r){var e=ki(this,r).delete(r);return this.size-=e?1:0,e}var Vi=Bi,Ji=K;function Ki(r){return Ji(this,r).get(r)}var Wi=Ki,Xi=K;function Yi(r){return Xi(this,r).has(r)}var Zi=Yi,Qi=K;function es(r,e){var t=Qi(this,r),i=t.size;return t.set(r,e),this.size+=t.size==i?0:1,this}var ts=es,rs=Ui,is=Vi,ss=Wi,ns=Zi,as=ts;function O(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}O.prototype.clear=rs,O.prototype.delete=is,O.prototype.get=ss,O.prototype.has=ns,O.prototype.set=as;var os=O,cs=B,hs=He,ps=os,us=200;function ls(r,e){var t=this.__data__;if(t instanceof cs){var i=t.__data__;if(!hs||i.length<us-1)return i.push([r,e]),this.size=++t.size,this;t=this.__data__=new ps(i)}return t.set(r,e),this.size=t.size,this}var ds=ls,vs=B,fs=Qt,ms=tr,gs=ir,Ps=nr,bs=ds;function A(r){var e=this.__data__=new vs(r);this.size=e.size}A.prototype.clear=fs,A.prototype.delete=ms,A.prototype.get=gs,A.prototype.has=Ps,A.prototype.set=bs;var $s=A,ys=ie,ws=function(){try{var r=ys(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Ne=ws,Te=Ne;function _s(r,e,t){e=="__proto__"&&Te?Te(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var se=_s,Cs=se,Is=z;function Os(r,e,t){(t!==void 0&&!Is(r[e],t)||t===void 0&&!(e in r))&&Cs(r,e,t)}var De=Os;function As(r){return function(e,t,i){for(var s=-1,n=Object(e),a=i(e),o=a.length;o--;){var c=a[r?o:++s];if(t(n[c],c,n)===!1)break}return e}}var js=As,Hs=js,Es=Hs(),Ss=Es,ne={exports:{}};(function(r,e){var t=C,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n?t.Buffer:void 0,o=a?a.allocUnsafe:void 0;function c(u,l){if(l)return u.slice();var P=u.length,d=o?o(P):new u.constructor(P);return u.copy(d),d}r.exports=c})(ne,ne.exports);var Ns=C,Ts=Ns.Uint8Array,Ds=Ts,qe=Ds;function qs(r){var e=new r.constructor(r.byteLength);return new qe(e).set(new qe(r)),e}var Rs=qs,xs=Rs;function Ls(r,e){var t=e?xs(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var Us=Ls;function Fs(r,e){var t=-1,i=r.length;for(e||(e=Array(i));++t<i;)e[t]=r[t];return e}var Ms=Fs,Gs=$,Re=Object.create,zs=function(){function r(){}return function(e){if(!Gs(e))return{};if(Re)return Re(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),ks=zs;function Bs(r,e){return function(t){return r(e(t))}}var Vs=Bs,Js=Vs,Ks=Js(Object.getPrototypeOf,Object),xe=Ks,Ws=Object.prototype;function Xs(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Ws;return r===t}var Le=Xs,Ys=ks,Zs=xe,Qs=Le;function en(r){return typeof r.constructor=="function"&&!Qs(r)?Ys(Zs(r)):{}}var tn=en;function rn(r){return r!=null&&typeof r=="object"}var M=rn,sn=V,nn=M,an="[object Arguments]";function on(r){return nn(r)&&sn(r)==an}var cn=on,Ue=cn,hn=M,Fe=Object.prototype,pn=Fe.hasOwnProperty,un=Fe.propertyIsEnumerable,ln=Ue(function(){return arguments}())?Ue:function(r){return hn(r)&&pn.call(r,"callee")&&!un.call(r,"callee")},Me=ln,dn=Array.isArray,Ge=dn,vn=9007199254740991;function fn(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=vn}var ze=fn,mn=te,gn=ze;function Pn(r){return r!=null&&gn(r.length)&&!mn(r)}var ae=Pn,bn=ae,$n=M;function yn(r){return $n(r)&&bn(r)}var wn=yn,W={exports:{}};function _n(){return!1}var Cn=_n;(function(r,e){var t=C,i=Cn,s=e&&!e.nodeType&&e,n=s&&!0&&r&&!r.nodeType&&r,a=n&&n.exports===s,o=a?t.Buffer:void 0,c=o?o.isBuffer:void 0,u=c||i;r.exports=u})(W,W.exports);var In=V,On=xe,An=M,jn="[object Object]",Hn=Function.prototype,En=Object.prototype,ke=Hn.toString,Sn=En.hasOwnProperty,Nn=ke.call(Object);function Tn(r){if(!An(r)||In(r)!=jn)return!1;var e=On(r);if(e===null)return!0;var t=Sn.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&ke.call(t)==Nn}var Dn=Tn,qn=V,Rn=ze,xn=M,Ln="[object Arguments]",Un="[object Array]",Fn="[object Boolean]",Mn="[object Date]",Gn="[object Error]",zn="[object Function]",kn="[object Map]",Bn="[object Number]",Vn="[object Object]",Jn="[object RegExp]",Kn="[object Set]",Wn="[object String]",Xn="[object WeakMap]",Yn="[object ArrayBuffer]",Zn="[object DataView]",Qn="[object Float32Array]",ea="[object Float64Array]",ta="[object Int8Array]",ra="[object Int16Array]",ia="[object Int32Array]",sa="[object Uint8Array]",na="[object Uint8ClampedArray]",aa="[object Uint16Array]",oa="[object Uint32Array]",p={};p[Qn]=p[ea]=p[ta]=p[ra]=p[ia]=p[sa]=p[na]=p[aa]=p[oa]=!0,p[Ln]=p[Un]=p[Yn]=p[Fn]=p[Zn]=p[Mn]=p[Gn]=p[zn]=p[kn]=p[Bn]=p[Vn]=p[Jn]=p[Kn]=p[Wn]=p[Xn]=!1;function ca(r){return xn(r)&&Rn(r.length)&&!!p[qn(r)]}var ha=ca;function pa(r){return function(e){return r(e)}}var ua=pa,oe={exports:{}};(function(r,e){var t=we,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,n=s&&s.exports===i,a=n&&t.process,o=function(){try{var c=s&&s.require&&s.require("util").types;return c||a&&a.binding&&a.binding("util")}catch{}}();r.exports=o})(oe,oe.exports);var la=ha,da=ua,Be=oe.exports,Ve=Be&&Be.isTypedArray,va=Ve?da(Ve):la,Je=va;function fa(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var Ke=fa,ma=se,ga=z,Pa=Object.prototype,ba=Pa.hasOwnProperty;function $a(r,e,t){var i=r[e];(!(ba.call(r,e)&&ga(i,t))||t===void 0&&!(e in r))&&ma(r,e,t)}var ya=$a,wa=ya,_a=se;function Ca(r,e,t,i){var s=!t;t||(t={});for(var n=-1,a=e.length;++n<a;){var o=e[n],c=i?i(t[o],r[o],o,t,r):void 0;c===void 0&&(c=r[o]),s?_a(t,o,c):wa(t,o,c)}return t}var Ia=Ca;function Oa(r,e){for(var t=-1,i=Array(r);++t<r;)i[t]=e(t);return i}var Aa=Oa,ja=9007199254740991,Ha=/^(?:0|[1-9]\d*)$/;function Ea(r,e){var t=typeof r;return e=e??ja,!!e&&(t=="number"||t!="symbol"&&Ha.test(r))&&r>-1&&r%1==0&&r<e}var We=Ea,Sa=Aa,Na=Me,Ta=Ge,Da=W.exports,qa=We,Ra=Je,xa=Object.prototype,La=xa.hasOwnProperty;function Ua(r,e){var t=Ta(r),i=!t&&Na(r),s=!t&&!i&&Da(r),n=!t&&!i&&!s&&Ra(r),a=t||i||s||n,o=a?Sa(r.length,String):[],c=o.length;for(var u in r)(e||La.call(r,u))&&!(a&&(u=="length"||s&&(u=="offset"||u=="parent")||n&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||qa(u,c)))&&o.push(u);return o}var Fa=Ua;function Ma(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var Ga=Ma,za=$,ka=Le,Ba=Ga,Va=Object.prototype,Ja=Va.hasOwnProperty;function Ka(r){if(!za(r))return Ba(r);var e=ka(r),t=[];for(var i in r)i=="constructor"&&(e||!Ja.call(r,i))||t.push(i);return t}var Wa=Ka,Xa=Fa,Ya=Wa,Za=ae;function Qa(r){return Za(r)?Xa(r,!0):Ya(r)}var Xe=Qa,eo=Ia,to=Xe;function ro(r){return eo(r,to(r))}var io=ro,Ye=De,so=ne.exports,no=Us,ao=Ms,oo=tn,Ze=Me,Qe=Ge,co=wn,ho=W.exports,po=te,uo=$,lo=Dn,vo=Je,et=Ke,fo=io;function mo(r,e,t,i,s,n,a){var o=et(r,t),c=et(e,t),u=a.get(c);if(u){Ye(r,t,u);return}var l=n?n(o,c,t+"",r,e,a):void 0,P=l===void 0;if(P){var d=Qe(c),Q=!d&&ho(c),ve=!d&&!Q&&vo(c);l=c,d||Q||ve?Qe(o)?l=o:co(o)?l=ao(o):Q?(P=!1,l=so(c,!0)):ve?(P=!1,l=no(c,!0)):l=[]:lo(c)||Ze(c)?(l=o,Ze(o)?l=fo(o):(!uo(o)||po(o))&&(l=oo(c))):P=!1}P&&(a.set(c,l),s(l,c,i,n,a),a.delete(c)),Ye(r,t,l)}var go=mo,Po=$s,bo=De,$o=Ss,yo=go,wo=$,_o=Xe,Co=Ke;function tt(r,e,t,i,s){r!==e&&$o(e,function(n,a){if(s||(s=new Po),wo(n))yo(r,e,a,t,tt,i,s);else{var o=i?i(Co(r,a),n,a+"",r,e,s):void 0;o===void 0&&(o=n),bo(r,a,o)}},_o)}var Io=tt;function Oo(r){return r}var rt=Oo;function Ao(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var jo=Ao,Ho=jo,it=Math.max;function Eo(r,e,t){return e=it(e===void 0?r.length-1:e,0),function(){for(var i=arguments,s=-1,n=it(i.length-e,0),a=Array(n);++s<n;)a[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=t(a),Ho(r,this,o)}}var So=Eo;function No(r){return function(){return r}}var To=No,Do=To,st=Ne,qo=rt,Ro=st?function(r,e){return st(r,"toString",{configurable:!0,enumerable:!1,value:Do(e),writable:!0})}:qo,xo=Ro,Lo=800,Uo=16,Fo=Date.now;function Mo(r){var e=0,t=0;return function(){var i=Fo(),s=Uo-(i-t);if(t=i,s>0){if(++e>=Lo)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var Go=Mo,zo=xo,ko=Go,Bo=ko(zo),Vo=Bo,Jo=rt,Ko=So,Wo=Vo;function Xo(r,e){return Wo(Ko(r,e,Jo),r+"")}var Yo=Xo,Zo=z,Qo=ae,ec=We,tc=$;function rc(r,e,t){if(!tc(t))return!1;var i=typeof e;return(i=="number"?Qo(t)&&ec(e,t.length):i=="string"&&e in t)?Zo(t[e],r):!1}var ic=rc,sc=Yo,nc=ic;function ac(r){return sc(function(e,t){var i=-1,s=t.length,n=s>1?t[s-1]:void 0,a=s>2?t[2]:void 0;for(n=r.length>3&&typeof n=="function"?(s--,n):void 0,a&&nc(t[0],t[1],a)&&(n=s<3?void 0:n,s=1),e=Object(e);++i<s;){var o=t[i];o&&r(e,o,i,n)}return e})}var oc=ac,cc=Io,hc=oc,pc=hc(function(r,e,t){cc(r,e,t)}),uc=pc,lc=Object.defineProperty,dc=Object.defineProperties,vc=Object.getOwnPropertyDescriptors,nt=Object.getOwnPropertySymbols,fc=Object.prototype.hasOwnProperty,mc=Object.prototype.propertyIsEnumerable,at=(r,e,t)=>e in r?lc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,X=(r,e)=>{for(var t in e||(e={}))fc.call(e,t)&&at(r,t,e[t]);if(nt)for(var t of nt(e))mc.call(e,t)&&at(r,t,e[t]);return r},gc=(r,e)=>dc(r,vc(e));function v(r,e,t){var i;const s=me(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${ye}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function y(r){return r.includes(":")?r.split(":")[1]:r}function ot(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function Pc(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function ce(r={},e={}){const t=ct(r),i=ct(e);return uc(t,i)}function ct(r){var e,t,i,s;const n={};if(!mt(r))return n;for(const[a,o]of Object.entries(r)){const c=fe(a)?[a]:o.chains,u=o.methods||[],l=o.events||[],P=o.rpcMap||{},d=U(a);n[d]=gc(X(X({},n[d]),o),{chains:ee(c,(e=n[d])==null?void 0:e.chains),methods:ee(u,(t=n[d])==null?void 0:t.methods),events:ee(l,(i=n[d])==null?void 0:i.events),rpcMap:X(X({},P),(s=n[d])==null?void 0:s.rpcMap)})}return n}function bc(r){return r.includes(":")?r.split(":")[2]:r}function ht(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],n=i.events||[],a=i.accounts||[],o=fe(t)?[t]:i.chains?i.chains:ot(i.accounts);e[t]={chains:o,methods:s,events:n,accounts:a}}return e}function he(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const pt={},h=r=>pt[r],pe=(r,e)=>{pt[r]=e};var $c=Object.defineProperty,yc=(r,e,t)=>e in r?$c(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,j=(r,e,t)=>yc(r,typeof e!="symbol"?e+"":e,t);class wc{constructor(e){j(this,"name","polkadot"),j(this,"client"),j(this,"httpProviders"),j(this,"events"),j(this,"namespace"),j(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var _c=Object.defineProperty,Cc=Object.defineProperties,Ic=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertySymbols,Oc=Object.prototype.hasOwnProperty,Ac=Object.prototype.propertyIsEnumerable,ue=(r,e,t)=>e in r?_c(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lt=(r,e)=>{for(var t in e||(e={}))Oc.call(e,t)&&ue(r,t,e[t]);if(ut)for(var t of ut(e))Ac.call(e,t)&&ue(r,t,e[t]);return r},dt=(r,e)=>Cc(r,Ic(e)),H=(r,e,t)=>ue(r,typeof e!="symbol"?e+"":e,t);class jc{constructor(e){H(this,"name","eip155"),H(this,"client"),H(this,"chainId"),H(this,"namespace"),H(this,"httpProviders"),H(this,"events"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||v(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new bt(i,h("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(y(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s;const n=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const a=this.client.session.get(e.topic),o=((s=a?.sessionProperties)==null?void 0:s.capabilities)||{};if(o!=null&&o[n])return o?.[n];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:dt(lt({},a.sessionProperties||{}),{capabilities:dt(lt({},o||{}),{[n]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(n){const o=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(o,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,o)}}const a=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,a)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($t("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${Ot}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var Hc=Object.defineProperty,Ec=(r,e,t)=>e in r?Hc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E=(r,e,t)=>Ec(r,typeof e!="symbol"?e+"":e,t);class Sc{constructor(e){E(this,"name","solana"),E(this,"client"),E(this,"httpProviders"),E(this,"events"),E(this,"namespace"),E(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var Nc=Object.defineProperty,Tc=(r,e,t)=>e in r?Nc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e,t)=>Tc(r,typeof e!="symbol"?e+"":e,t);class Dc{constructor(e){S(this,"name","cosmos"),S(this,"client"),S(this,"httpProviders"),S(this,"events"),S(this,"namespace"),S(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var qc=Object.defineProperty,Rc=(r,e,t)=>e in r?qc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,N=(r,e,t)=>Rc(r,typeof e!="symbol"?e+"":e,t);class xc{constructor(e){N(this,"name","algorand"),N(this,"client"),N(this,"httpProviders"),N(this,"events"),N(this,"namespace"),N(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||v(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new m(new b(i,h("disableProviderPing")))}}var Lc=Object.defineProperty,Uc=(r,e,t)=>e in r?Lc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,T=(r,e,t)=>Uc(r,typeof e!="symbol"?e+"":e,t);class Fc{constructor(e){T(this,"name","cip34"),T(this,"client"),T(this,"httpProviders"),T(this,"events"),T(this,"namespace"),T(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=y(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var Mc=Object.defineProperty,Gc=(r,e,t)=>e in r?Mc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,D=(r,e,t)=>Gc(r,typeof e!="symbol"?e+"":e,t);class zc{constructor(e){D(this,"name","elrond"),D(this,"client"),D(this,"httpProviders"),D(this,"events"),D(this,"namespace"),D(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var kc=Object.defineProperty,Bc=(r,e,t)=>e in r?kc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,q=(r,e,t)=>Bc(r,typeof e!="symbol"?e+"":e,t);class Vc{constructor(e){q(this,"name","multiversx"),q(this,"client"),q(this,"httpProviders"),q(this,"events"),q(this,"namespace"),q(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var Jc=Object.defineProperty,Kc=(r,e,t)=>e in r?Jc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,R=(r,e,t)=>Kc(r,typeof e!="symbol"?e+"":e,t);class Wc{constructor(e){R(this,"name","near"),R(this,"client"),R(this,"httpProviders"),R(this,"events"),R(this,"namespace"),R(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||v(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace);return typeof i>"u"?void 0:new m(new b(i,h("disableProviderPing")))}}var Xc=Object.defineProperty,Yc=(r,e,t)=>e in r?Xc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,x=(r,e,t)=>Yc(r,typeof e!="symbol"?e+"":e,t);class Zc{constructor(e){x(this,"name","tezos"),x(this,"client"),x(this,"httpProviders"),x(this,"events"),x(this,"namespace"),x(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||v(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace);return typeof i>"u"?void 0:new m(new b(i))}}var Qc=Object.defineProperty,eh=(r,e,t)=>e in r?Qc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,L=(r,e,t)=>eh(r,typeof e!="symbol"?e+"":e,t);class th{constructor(e){L(this,"name",w),L(this,"client"),L(this,"httpProviders"),L(this,"events"),L(this,"namespace"),L(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=me(s);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new b(i,h("disableProviderPing")))}}var rh=Object.defineProperty,ih=Object.defineProperties,sh=Object.getOwnPropertyDescriptors,vt=Object.getOwnPropertySymbols,nh=Object.prototype.hasOwnProperty,ah=Object.prototype.propertyIsEnumerable,le=(r,e,t)=>e in r?rh(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Y=(r,e)=>{for(var t in e||(e={}))nh.call(e,t)&&le(r,t,e[t]);if(vt)for(var t of vt(e))ah.call(e,t)&&le(r,t,e[t]);return r},de=(r,e)=>ih(r,sh(e)),g=(r,e,t)=>le(r,typeof e!="symbol"?e+"":e,t);class Z{constructor(e){g(this,"client"),g(this,"namespaces"),g(this,"optionalNamespaces"),g(this,"sessionProperties"),g(this,"events",new wt),g(this,"rpcProviders",{}),g(this,"session"),g(this,"providerOpts"),g(this,"logger"),g(this,"uri"),g(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:gt(Pt({level:e?.logger||be})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new Z(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Y({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=new Date().getTime();this.request(e,i,s).then(a=>t(null,yt(n,a))).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ge("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const a=ht(this.session.namespaces);this.namespaces=ce(this.namespaces,a),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=ht(s.namespaces);return this.namespaces=ce(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===w?n.setDefaultChain(`${i}:${s}`,t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Pe(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ft.init({core:this.providerOpts.core,logger:this.providerOpts.logger||be,relayUrl:this.providerOpts.relayUrl||_t,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>U(t)))];pe("client",this.client),pe("events",this.events),pe("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=Pc(t,this.session),s=ot(i),n=ce(this.namespaces,this.optionalNamespaces),a=de(Y({},n[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new jc({namespace:a});break;case"algorand":this.rpcProviders[t]=new xc({namespace:a});break;case"solana":this.rpcProviders[t]=new Sc({namespace:a});break;case"cosmos":this.rpcProviders[t]=new Dc({namespace:a});break;case"polkadot":this.rpcProviders[t]=new wc({namespace:a});break;case"cip34":this.rpcProviders[t]=new Fc({namespace:a});break;case"elrond":this.rpcProviders[t]=new zc({namespace:a});break;case"multiversx":this.rpcProviders[t]=new Vc({namespace:a});break;case"near":this.rpcProviders[t]=new Wc({namespace:a});break;case"tezos":this.rpcProviders[t]=new Zc({namespace:a});break;default:this.rpcProviders[w]?this.rpcProviders[w].updateNamespace(a):this.rpcProviders[w]=new th({namespace:a})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;if(i.name==="accountsChanged"){const s=i.data;s&&Pe(s)&&this.events.emit("accountsChanged",s.map(bc))}else if(i.name==="chainChanged"){const s=t.chainId,n=t.event.data,a=U(s),o=he(s)!==he(n)?`${a}:${he(n)}`:s;this.onChainChanged(o)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,n=(i=this.client)==null?void 0:i.session.get(e);this.session=de(Y({},n),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",de(Y({},ge("USER_DISCONNECTED")),{data:e.topic}))}),this.on(f.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[w]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(a=>U(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=U(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces[`${i}:${s}`]?this.namespaces[`${i}:${s}`].defaultChain=s:this.namespaces[`${i}:${s}`]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${$e}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${$e}/${e}`)}}const oh=Z;export{oh as UniversalProvider,Z as default};
//# sourceMappingURL=index.es.js.map
